$("#collection-report-modal").html("<%= escape_javascript(render 'collection_report.html.erb') %>")

$('.collection-report-timepicker').timepicker({minuteStep: 5});
// $('.collection-report-concerned-person').select2();
$('.collection-report-start-datepicker').datepicker({
  dateFormat: "yy/mm/dd"
});
$('.collection-report-end-datepicker').datepicker({
  dateFormat: "yy/mm/dd"
});

$(".collection-report-concerned-person").on('change', function() {
  var user_id = $('#collection_report_user_name').val()
  var start_date = $('#collection_report_start_date').val()
  var start_time = $('#collection_report_start_time').val()
  var end_date = $('#collection_report_end_date').val()
  var end_time = $('#collection_report_end_time').val()
  var sort = $('#collection_report_sort').val()

  var collection_data = `&user_id=${user_id}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}&sort=${sort}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var collection_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', collection_setting + collection_data)
  }
}).trigger('change')

$("#collection_report_start_date").on('change', function() {
  var user_id = $('#collection_report_user_name').val()
  var start_date = $('#collection_report_start_date').val()
  var start_time = $('#collection_report_start_time').val()
  var end_date = $('#collection_report_end_date').val()
  var end_time = $('#collection_report_end_time').val()
  var sort = $('#collection_report_sort').val()

  var collection_data = `&user_id=${user_id}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}&sort=${sort}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var collection_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', collection_setting + collection_data)
  }
}).trigger('change')

$("#collection_report_start_time").on('change', function() {
  var user_id = $('#collection_report_user_name').val()
  var start_date = $('#collection_report_start_date').val()
  var start_time = $('#collection_report_start_time').val()
  var end_date = $('#collection_report_end_date').val()
  var end_time = $('#collection_report_end_time').val()
  var sort = $('#collection_report_sort').val()

  var collection_data = `&user_id=${user_id}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}&sort=${sort}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var collection_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', collection_setting + collection_data)
  }
}).trigger('change')

$("#collection_report_end_date").on('change', function() {
  var user_id = $('#collection_report_user_name').val()
  var start_date = $('#collection_report_start_date').val()
  var start_time = $('#collection_report_start_time').val()
  var end_date = $('#collection_report_end_date').val()
  var end_time = $('#collection_report_end_time').val()
  var sort = $('#collection_report_sort').val()

  var collection_data = `&user_id=${user_id}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}&sort=${sort}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var collection_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', collection_setting + collection_data)
  }
}).trigger('change')

$("#collection_report_end_time").on('change', function() {
  var user_id = $('#collection_report_user_name').val()
  var start_date = $('#collection_report_start_date').val()
  var start_time = $('#collection_report_start_time').val()
  var end_date = $('#collection_report_end_date').val()
  var end_time = $('#collection_report_end_time').val()
  var sort = $('#collection_report_sort').val()

  var collection_data = `&user_id=${user_id}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}&sort=${sort}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var collection_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', collection_setting + collection_data)
  }
}).trigger('change')

$("#collection_report_sort").on('change', function() {
  var user_id = $('#collection_report_user_name').val()
  var start_date = $('#collection_report_start_date').val()
  var start_time = $('#collection_report_start_time').val()
  var end_date = $('#collection_report_end_date').val()
  var end_time = $('#collection_report_end_time').val()
  var sort = $('#collection_report_sort').val()

  var collection_data = `&user_id=${user_id}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}&sort=${sort}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var collection_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', collection_setting + collection_data)
  }
}).trigger('change')

$('.download_report_setting').on('click', function() {
  $("#collection-report-modal").modal('hide')
})

$("#collection_report_format").on('change', function() {
  var type = $(this).val()
  if (type == 'pdf')
  {
    $('.pdf_report').show()
    $('.xlsx_report').hide()
  }
  else
  {
    $('.pdf_report').hide()
    $('.xlsx_report').show()
  }
}).trigger('change')
