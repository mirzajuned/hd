<div class="row">
  <div class="col-md-12 col-sm-12">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Date</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Time</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Resp. rate/min</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">BP</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Pulse</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Sedation Score</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Medication</th>
          <th class="text-center col-md-1-shared col-sm-1-shared" style="padding-top:0px;padding-bottom:0px;">Bolus ml</th>
          <th class="text-center col-md-1-shared col-sm-1-shared" style="padding-top:0px;padding-bottom:0px;">Bolus Mg</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">O2 Saturation</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Comments</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Name</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;"></th>
        </tr>
      </thead>
      <tbody class="sedation-table-body-added">
        <% if @nursing_record.has_sedation? %>
          <% @nursing_record.sedation.each_with_index do |elem, i| %>
            <tr class="sedations">
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <div class="input-group mb15">
                    <div class="ui-widget">
                      <%= hidden_field_tag "nursing_record[sedation_attributes][#{i}][id]", elem.id, {:class => 'form-control id' } %>
                      <%= hidden_field_tag "nursing_record[sedation_attributes][#{i}][_destroy]", "0", {:class => 'form-control' } %>
                      <%= text_field_tag "nursing_record[sedation_attributes][#{i}][date]", elem.date.try(:strftime, "%d/%m/%Y"), {:maxlength => 40, :class => 'form-control sedation_datepicker', :style =>'width:100%;'} %>
                    </div>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group" style="width: 100%;">
                   <div class="mb15 bootstrap-timepicker timepicker">
                      <%= text_field_tag "nursing_record[sedation_attributes][#{i}][time]",elem.time.try(:strftime, "%I:%M %p") || Time.current.strftime("%I:%M %p") , { :class => "form-control form-control-custom sedation_timepicker ", id: "nursing_record_sedation_attributes_#{i}_time"} %>
                   </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][respiration_rate]",  elem.respiration_rate, { :class => 'form-control',onkeypress:'validate(event)' } %>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][blood_pressure]",  elem.blood_pressure, { :class => 'form-control' } %>
                    <!-- ,onkeypress:'validate(event)' -->
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][pulse]",  elem.pulse, { :class => 'form-control',onkeypress:'validate(event)' } %>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][sedation_score]",  elem.sedation_score, { :class => 'form-control' } %>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][medication]",  elem.medication, { :class => 'form-control' } %>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1-shared col-sm-1-shared">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][bolus_ml]",  elem.bolus_ml, { :class => 'form-control',onkeypress:'validate(event)' } %>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1-shared col-sm-1-shared">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][bolus_mg]",  elem.bolus_mg, { :class => 'form-control',onkeypress:'validate(event)' } %>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][o2_saturation]",  elem.o2_saturation, { :class => 'form-control' } %>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][comments]",  elem.comments, { :class => 'form-control' } %>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[sedation_attributes][#{i}][name]",  elem.name, { :class => 'form-control' } %>
                  </div>
                </div>
              </td>
              <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                <div class="form-group">
                  <a id="addnewsedationbutton1" class="btn btn-xs btn-primary btn-square" href="javascript:;" name="addnewsedationbutton" ><span class="glyphicon glyphicon-plus-sign"></span></a>
                  <a id="removesedationbutton1" class="btn btn-xs btn-primary btn-danger" href="javascript:;" name="removesedationbutton" ><span class="glyphicon glyphicon-remove"></span></a>
                </div>
              </td>
            </tr>
          <% end %>
          <% counter = @nursing_record.sedation.size %>
            <% ((counter + 1)..5).each_with_index do |elem, i| %>
              <%= render partial: "/inpatients/nursing_records/sedation_partial.html.erb", locals: { i: counter } %>
              <% counter = counter + 1 %>
            <% end %>
        <% else %>
            <% (1..5).each_with_index do |elem, i| %>
              <%= render partial: "/inpatients/nursing_records/sedation_partial.html.erb", locals: { i: i } %>
            <% end %>
        <% end %>
      </tbody>
    </table>
    <div class="sedation-table-body-removed" style="display:none;"></div>
  </div>
</div>
<style type="text/css">
  .hide{
    display: none;
  }
  .form-inline .form-group {
    margin-right: 0px;
    margin-left: 0px;
  }
  .sedation_datepicker,.sedation_timepicker{
    background-color: #fff !important;
    cursor: pointer !important;
  }
</style>
<script type="text/javascript">
    datepicker_options = {
    dateFormat: "dd/mm/yy"
  };
  jQuery('.sedation_datepicker').live('focus', function(){
    $(this).datepicker(datepicker_options);
  });
  $('.sedation_timepicker').timepicker({minuteStep: 5});
  _add_button_at_last()
  function _add_button_at_last() {
    var row_count = jQuery("[id^='addnewsedationbutton']").parents('.sedations:visible').length
    jQuery("[id^='addnewsedationbutton']:lt("+(row_count-1)+")").addClass("hidden")
    jQuery("[id^='addnewsedationbutton']:eq("+(row_count-1)+")").removeClass("hidden")
  }
  jQuery('tbody').on('click', "a[name*='addnewsedationbutton']", function() {
    var fieldcounter;
    if (jQuery(".sedation-table-body-added > .sedations").length == 0){
        fieldcounter = 0;
    } else {
        fieldcounter = jQuery(".sedation-table-body-added > .sedations").length;
    }
    var params = { counter: fieldcounter };
    jQuery.ajax({
        type: "GET",
        dataType: "script",
        url: "/inpatient/nursing_records/add_sedation",
        data: {ajax: params, remote: "true" },
        async: false
    });
    _add_button_at_last()
    _renumber_id_after_remove("tbody.sedation-table-body-added", "div.sedation-table-body-removed");
  });
  jQuery('.sedation-table-body-added').on('click', "a[name*='removesedationbutton']", function() {
    event.preventDefault();
    var sedations_removed_tr_html;
    var fieldcounter;
    fieldcounter = jQuery(this).attr('id').slice(-1);
    var sedations_tr_array = jQuery(this).parents('.sedations').find(".id");
    if (sedations_tr_array.length > 0) {
        jQuery(this).parents('.sedations').find("input[name*='_destroy']").val("1");
        sedations_removed_tr_html = jQuery(this).parents('.sedations').wrap('<p/>').parent().html();
        jQuery(this).parents('.sedations').unwrap();
        jQuery('.sedation-table-body-removed').append(sedations_removed_tr_html);
        jQuery(this).parents('.sedations').remove();
        _renumber_id_after_remove("tbody.sedation-table-body-added", "div.sedation-table-body-removed");
    } else {
        jQuery(this).parents('.sedations').remove();
        _renumber_id_after_remove("tbody.sedation-table-body-added", "div.sedation-table-body-removed");
    }
  });
  function validate(evt) {
    var theEvent = evt || window.event;
    var key = theEvent.keyCode || theEvent.which;
    key = String.fromCharCode( key );
    var regex = /[0-9]|\./;
    if( !regex.test(key) ) {
      theEvent.returnValue = false;
      if(theEvent.preventDefault) theEvent.preventDefault();
    }
  }
  function _renumber_id_after_remove(added, removed) {
      var counter = 0;
      jQuery(added).find('.sedations').each(function() {
        jQuery(this).find("input").each(function(index, element) {
          var nameattr, idattr;
          nameattr = element.name.replace(/\[[0-9]+\]/g, '['+counter+']');
          idattr = element.id.replace(/\_[0-9]+\_/g, '_'+counter+'_');
          jQuery(this).attr('name', nameattr);
          jQuery(this).attr('id', idattr);
        });
        jQuery(this).find("select").each(function(index, element) {
          var nameattr, idattr;
          nameattr = element.name.replace(/\[[0-9]+\]/g, '['+counter+']');
          idattr = element.id.replace(/\_[0-9]+\_/g, '_'+counter+'_');
          jQuery(this).attr('name', nameattr);
          jQuery(this).attr('id', idattr);
        });
        jQuery(this).find("a").each(function(index, element) {
          var idattr;
          idattr = element.id.replace(/[0-9]/g, counter);
          jQuery(this).attr('id', idattr);
        });
        counter++;
      });
      jQuery(removed).find(".sedations").each(function() {
        jQuery(this).find("input").each(function(index, element) {
          var nameattr, idattr;
          nameattr = element.name.replace(/\[[0-9]+\]/g, '['+counter+']');
          idattr = element.id.replace(/\_[0-9]+\_/g, '_'+counter+'_');
          jQuery(this).attr('name', nameattr);
          jQuery(this).attr('id', idattr);
        });
        jQuery(this).find("select").each(function(index, element) {
          var nameattr, idattr;
          nameattr = element.name.replace(/\[[0-9]+\]/g, '['+counter+']');
          idattr = element.id.replace(/\_[0-9]+\_/g, '_'+counter+'_');
          jQuery(this).attr('name', nameattr);
          jQuery(this).attr('id', idattr);
        });
        jQuery(this).find("a").each(function(index, element) {
          var idattr;
          idattr = element.id.replace(/[0-9]/g, counter);
          jQuery(this).attr('id', idattr);
        });
        counter++;
      });
      _add_button_at_last()
    }
</script>