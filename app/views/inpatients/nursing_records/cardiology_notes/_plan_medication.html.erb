<style>
  .ui-autocomplete {
    max-height: 150px;
    overflow-y: auto;
    /* prevent horizontal scrollbar */
    overflow-x: hidden;
    /* add padding to account for vertical scrollbar */
    background-color: #d9edf7;
  }
</style>

<%if @current_facility.show_language_support %>
    <div class="col-md-10 col-sm-10 col-xs-10">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
          <th class="text-center col-md-3 col-sm-3" style="padding-top:0px;padding-bottom:0px;">Name</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Type</th>
          <th class="text-center" style="padding-top:0px;padding-bottom:0px;">Quantity</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Frequency&nbsp;&nbsp;<a href="#" data-toggle="tooltip" data-placement="bottom" title="Number of times in a day"><i class="fa fa-info-circle" aria-hidden="true"></i></a></th>
          <th class="text-center col-md-3-shared col-sm-3-shared" style="padding-top:0px;padding-bottom:0px;">Duration&nbsp;&nbsp;<a href="#" data-toggle="tooltip" data-placement="bottom" title="How long you need to take this"><i class="fa fa-info-circle" aria-hidden="true"></i></a></th>
          <th class="text-center col-md-3-shared col-sm-3-shared" style="padding-top:0px;padding-bottom:0px;">Instruction</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Adv. Date</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Adv. Time</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;"></th>
        </tr>
        </thead>
        <tbody class="medication-table-body-added">
        <%@medication_instruction_set << 'Add a text Box'%>
        <% if @nursing_record.has_treatmentmedication? %>

            <% @nursing_record.treatmentmedication.each_with_index do |elem, i| %>
                <tr class="treatmentmedications">

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3 col-sm-3">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <div class="ui-widget">
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][lot_id]", "", {:class => 'form-control id' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][id]", elem.id, {:class => 'form-control id' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][pharmacy_item_id]", elem.pharmacy_item_id, {:class => 'form-control pharmacy_item_id' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][generic_display_name]", elem.generic_display_name, {:class => 'form-control generic_display_name' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][generic_display_ids]", elem.generic_display_ids, {:class => 'form-control generic_display_ids' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicine_from]", elem.medicine_from, {:class => 'form-control medicine_from' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][_destroy]", "0", {:class => 'form-control' } %>
                          <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinename]", elem.medicinename, {:maxlength => 300, :size => 40, :class => 'form-control medicinename', :style =>'width:100%;'} %>

                        </div>
                        <span id="medicinename-contents-<%= "#{i}" %>" class="btn btn-xs btn-success btn-square medicinename-contents hidden" data-medicinecontents=""><i class="fa fa-question-circle"></i></span>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinetype]",  elem.medicinetype, { :class => 'form-control medicinetype' } %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinequantity]", options_for_select(['1/4', '1/2', '1', '2', '3','4','5','6','7','8','9','10','11','12','13','14','15','20','25','30','35','40','45','50'], elem.medicinequantity), { :class => 'form-control medicinequantity' } %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinefrequency]", options_for_select([['Select', ''], '1-1-1', '1-1-0', '1-0-1', '0-1-1', '1-0-0', '0-1-0', '0-0-1','2-2-2','2-0-2', '1-1-1-1','once a week','once a month', '5 times a day', '6 times a day', '8 times a day', '10 times a day', '12 times a day', '24 times a day','Sat-Sun', 'SOS'], elem.medicinefrequency), { :class => 'form-control medicinefrequency'} %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
                    <div class="form-group">
                      <div class="input-group mb15">

                        <div class="row">

                          <div class="col-md-6 col-sm-6 col-xs-6">
                            <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineduration]", options_for_select([['Sel',''],['1','1'], ['2','2'], ['3','3'], ['4','4'], ['5','5'], ['6','6'], ['7','7'], ['8','8'], ['9','9'], ['10','10'], ['11','11'], ['12','12'], ['15', '15'], ['20', '20'], ['25', '25'], ['30', '30'], ['40', '40'], ['50', '50']  ], elem.medicineduration), { :class => 'form-control medicineduration', :style => 'width:100%;padding-left:0px;padding-right:0px;'} %>
                          </div>

                          <div class="col-md-6 col-sm-6 col-xs-6">
                            <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinedurationoption]", options_for_select([['Sel',''], ['Days', 'D'], ['Weeks', 'W'], ['Months', 'M'], ['Next followup', 'F']], elem.medicinedurationoption), { :class => 'form-control medicinedurationoption', :style => 'width:100%;padding-left:0px;padding-right:0px;'} %>
                          </div>
                        </div>
                      </div>
                    </div>
                  </td>

                  <td class="medication_instruction_box" style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
                    <%if elem.medicineinstructions.present?%>
                      <div class="form-group edit_instruction_box">
                        <div class="input-group mb15">
                          <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineinstructions]", elem.medicineinstructions, {:maxlength => 300, :size => 40, :class => 'form-control text_box_val magic', :style => "width: 86%" } %>
                          <button type="button" class="btn btn-link undo_button_edit fa fa-undo" style="width: 0%; margin-left: -11%;"></button>
                        </div>
                      </div>

                      <div class="form-group hide edit_instruction">
                        <div class="input-group mb15">
                          <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][instruction]", options_for_select(@medication_instruction_set,""), {:prompt => 'Please Select', :class => 'form-control instruction_dropdown_edit',:style => "padding: 10px 0px" } %>
                        </div>
                      </div>
                    <%elsif elem.instruction.present?%>
                      <div class="form-group edit-instruction">
                        <div class="input-group mb15">
                          <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][instruction]", options_for_select(@medication_instruction_set,elem.instruction), {:prompt => 'Please Select', :class => 'form-control instruction_dropdown_magic',:style => "padding: 10px 0px" } %>
                        </div>
                      </div>
                      <div class="form-group hide instruction_box">
                        <div class="input-group mb15">
                          <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineinstructions]", nil, {:maxlength => 300, :size => 40, :class => 'form-control text_box_val', :style => "width: 86%" } %>
                          <button type="button" class="btn btn-link undo_button_magic fa fa-undo" style="width: 0%; margin-left: -11%;"></button>
                        </div>
                      </div>
                    <%else%>
                      <div class="form-group instruction">
                        <div class="input-group mb15">
                          <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][instruction]", options_for_select(@medication_instruction_set,""), {:prompt => 'Please Select', :class => 'form-control instruction_dropdown',:style => "padding: 10px 0px" } %>
                        </div>
                      </div>
                      <div class="form-group instruction_box hide">
                        <div class="input-group mb15">
                          <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineinstructions]", nil, {:maxlength => 300, :size => 40, :class => 'form-control text_box_val',  :style => "width: 86%" } %>
                          <button type="button" class="btn btn-link undo_button fa fa-undo" style="width: 0%; margin-left: -11%;"></button>
                        </div>
                      </div>
                    <%end%>
                  </td>
                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                    <div class="form-group" style="width: 100%;">
                       <div class="input-group mb15">
                          <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][date]",elem.date.try(:strftime, "%d/%m/%Y") , { :class => "form-control form-control-custom preop_datepicker ", id: "nursing_record_treatmentmedication_attributes_#{i}_date",readonly: true} %>
                       </div>
                    </div>
                  </td>
                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                    <div class="form-group" style="width: 100%;">
                       <div class="mb15 bootstrap-timepicker timepicker">
                          <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][time]",elem.time.try(:strftime, "%I:%M %p") , { :class => "form-control form-control-custom preop_timepicker ", id: "nursing_record_treatmentmedication_attributes_#{i}_time"} %>
                       </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">

                    <div class="form-group">
                      <a id="addnewmedicationbutton1" class="btn btn-xs btn-primary btn-square" href="javascript:;" name="addnewmedicationbutton" ><span class="glyphicon glyphicon-plus-sign"></span></a>
                      <a id="removemedicationbutton1" class="btn btn-xs btn-primary btn-danger" href="javascript:;" name="removemedicationbutton" ><span class="glyphicon glyphicon-remove"></span></a>
                    </div>

                  </td>

                </tr>
            <% end %>

            <% counter = @nursing_record.treatmentmedication.size %>

            <% ((counter + 1)..5).each_with_index do |elem, i| %>

                <tr class="treatmentmedications">

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3 col-sm-3">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <div class="ui-widget">
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][lot_id]", "", {:class => 'form-control id' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][_destroy]", "0", {:class => 'form-control' } %>
                          <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinename]", nil, {:maxlength => 300, :size => 40, :class => 'form-control medicinename', :style => 'width:100%;' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][pharmacy_item_id]", nil, {:class => 'form-control pharmacy_item_id'} %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][generic_display_name]", nil, {:class => 'form-control generic_display_name'} %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][generic_display_ids]", nil, {:class => 'form-control generic_display_ids'} %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicine_from]", nil, {:class => 'form-control medicine_from'} %>
                        </div>
                        <span id="medicinename-contents-<%= "#{counter}" %>" class="btn btn-xs btn-success btn-square medicinename-contents hidden" data-medicinecontents=""><i class="fa fa-question-circle"></i></span>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinetype]", nil, { :class => 'form-control medicinetype' } %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <%= select_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinequantity]", options_for_select(['1/4', '1/2', '1', '2', '3','4','5','6','7','8','9','10','11','12','13','14','15','20','25','30','35','40','45','50'], "1"), { :class => 'form-control medicinequantity' } %>
                      </div>
                    </div>
                  </td>
                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <%= select_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinefrequency]", options_for_select([['Select', ''], '1-1-1', '1-1-0', '1-0-1', '0-1-1', '1-0-0', '0-1-0', '0-0-1','2-2-2','2-0-2', '1-1-1-1','once a week','once a month', '5 times a day', '6 times a day', '8 times a day', '10 times a day', '12 times a day', '24 times a day','Sat-Sun', 'SOS'], ""), { :class => 'form-control medicinefrequency'} %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
                    <div class="form-group">
                      <div class="input-group mb15">

                        <div class="row">

                          <div class="col-md-6 col-sm-6">
                            <%= select_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicineduration]", options_for_select([['Sel',''],['1','1'], ['2','2'], ['3','3'], ['4','4'], ['5','5'], ['6','6'], ['7','7'], ['8','8'], ['9','9'], ['10','10'], ['11','11'], ['12','12'], ['15', '15'], ['20', '20'], ['25', '25'], ['30', '30'], ['40', '40'], ['50', '50']  ], ""), { :class => 'form-control medicineduration', :style => 'width:100%;padding-left:0px;padding-right:0px;'} %>
                          </div>

                          <div class="col-md-6 col-sm-6">
                            <%= select_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinedurationoption]", options_for_select([['Sel',''], ['Days', 'D'], ['Weeks', 'W'], ['Months', 'M'], ['Next followup', 'F']], ""), { :class => 'form-control medicinedurationoption', :style => 'width:100%;padding-left:0px;padding-right:0px;'} %>
                          </div>
                        </div>

                      </div>
                    </div>
                  </td>

                  <td class="medication_instruction_box" style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
                    <div class="form-group instruction">
                      <div class="input-group mb15">
                        <%= select_tag "nursing_record[treatmentmedication_attributes][#{counter}][instruction]", options_for_select(@medication_instruction_set), {:prompt => 'Please Select', :class => 'form-control instruction_dropdown',:style => "padding: 10px 0px" } %>
                      </div>
                    </div>
                    <div class="form-group instruction_box hide">
                      <div class="input-group mb15">
                        <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicineinstructions]", nil, {:maxlength => 300, :size => 40, :class => 'form-control text_box_val', :style => "width: 86%" } %>
                        <button type="button" class="btn btn-link undo_button fa fa-undo" style="width: 0%; margin-left: -11%;"></button>
                      </div>
                    </div>
                  </td>
                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
                    <div class="form-group" style="width: 100%;">
                      <div class="input-group mb15">
                        <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][date]",nil, { :class => "form-control form-control-custom preop_datepicker", id: "nursing_record_treatmentmedication_attributes_#{counter}_date",readonly: true} %>
                      </div>
                    </div>
                  </td>
                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
                    <div class="form-group" style="width: 100%;">
                      <div class="mb15 bootstrap-timepicker timepicker">
                        <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][time]",nil, { :class => "form-control form-control-custom preop_timepicker", id: "nursing_record_treatmentmedication_attributes_#{counter}_time"} %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">

                    <div class="form-group">
                      <a id="addnewmedicationbutton1" class="btn btn-xs btn-primary btn-square" href="javascript:;" name="addnewmedicationbutton" ><span class="glyphicon glyphicon-plus-sign"></span></a>
                      <a id="removemedicationbutton1" class="btn btn-xs btn-primary btn-danger" href="javascript:;" name="removemedicationbutton" ><span class="glyphicon glyphicon-remove"></span></a>
                    </div>

                  </td>

                </tr>

                <% counter = counter + 1 %>

            <% end %>

        <% else %>

            <% (1..5).each_with_index do |elem, i| %>

                <tr class="treatmentmedications">
                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3 col-sm-3">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <div class="ui-widget">
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][lot_id]", "", {:class => 'form-control lot_id' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][_destroy]", "0", {:class => 'form-control' } %>
                          <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinename]", nil, { :class => 'form-control medicinename', :size => 40, :maxlength => 300, :style => 'width:100%'} %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][pharmacy_item_id]", nil, {:class => 'form-control pharmacy_item_id' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][generic_display_name]", nil, {:class => 'form-control generic_display_name' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][generic_display_ids]", nil, {:class => 'form-control generic_display_ids' } %>
                          <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicine_from]", nil, {:class => 'form-control medicine_from' } %>
                        </div>
                        <span id="medicinename-contents-<%= "#{i}" %>" class="btn btn-xs btn-success btn-square medicinename-contents hidden" data-medicinecontents=""><i class="fa fa-question-circle"></i></span>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinetype]", nil, { :class => 'form-control medicinetype' } %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinequantity]", options_for_select(['1/4', '1/2', '1', '2', '3','4','5','6','7','8','9','10','11','12','13','14','15','20','25','30','35','40','45','50'], "1"), { :class => 'form-control medicinequantity' } %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
                    <div class="form-group">
                      <div class="input-group mb15">
                        <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinefrequency]", options_for_select([['Select', ''], '1-1-1', '1-1-0', '1-0-1', '0-1-1', '1-0-0', '0-1-0', '0-0-1','2-2-2','2-0-2', '1-1-1-1','once a week','once a month', '5 times a day', '6 times a day', '8 times a day', '10 times a day', '12 times a day', '24 times a day','Sat-Sun', 'SOS'], ""), { :class => 'form-control medicinefrequency'} %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
                    <div class="form-group">
                      <div class="input-group mb15">

                        <div class="row">

                          <div class="col-md-6 col-sm-6">
                            <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineduration]", options_for_select([['Sel',''],['1','1'], ['2','2'], ['3','3'], ['4','4'], ['5','5'], ['6','6'], ['7','7'], ['8','8'], ['9','9'], ['10','10'], ['11','11'], ['12','12'], ['15', '15'], ['20', '20'], ['25', '25'], ['30', '30'], ['40', '40'], ['50', '50']  ], ""), { :class => 'form-control medicineduration', :style => 'width:100%;padding-left:0px;padding-right:0px;'} %>
                          </div>

                          <div class="col-md-6 col-sm-6">

                              <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinedurationoption]", options_for_select([['Sel',''], ['Days', 'D'], ['Weeks', 'W'], ['Months', 'M'], ['Next followup', 'F']], ""), { :class => 'form-control medicinedurationoption', style: "width:100%;padding-left:0px;padding-right:0px;"} %>


                          </div>

                        </div>

                      </div>
                    </div>
                  </td>

                  <td class="medication_instruction_box" style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;"class="col-md-3-shared col-sm-3-shared">
                    <div class="form-group instruction">
                      <div class="input-group mb15">
                        <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][instruction]", options_for_select(@medication_instruction_set), {:prompt => 'Please Select', :class => 'form-control instruction_dropdown',:style => "padding: 10px 0px" } %>
                      </div>
                    </div>
                    <div class="form-group hide instruction_box">
                      <div class="input-group mb15">
                        <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineinstructions]", nil, {:maxlength => 300, :size => 40, :class => 'form-control text_box_val', :style => "width: 86%" } %>
                        <button type="button" class="btn btn-link undo_button fa fa-undo" style="width: 0%; margin-left: -11%;"></button>
                      </div>
                    </div>
                  </td>
                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                    <div class="form-group" style="width: 100%;">
                      <div class="input-group mb15">
                        <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][date]",nil, { :class => "form-control form-control-custom preop_datepicker", id: "nursing_record_treatmentmedication_attributes_#{i}_date",readonly: true} %>
                      </div>
                    </div>
                  </td>
                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
                    <div class="form-group" style="width: 100%;">
                      <div class="mb15 bootstrap-timepicker timepicker">
                        <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][time]",nil, { :class => "form-control form-control-custom preop_timepicker", id: "nursing_record_treatmentmedication_attributes_#{i}_time"} %>
                      </div>
                    </div>
                  </td>

                  <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">

                    <div class="form-group">
                      <a id="addnewmedicationbutton1" class="btn btn-xs btn-primary btn-square" href="javascript:;" name="addnewmedicationbutton" ><span class="glyphicon glyphicon-plus-sign"></span></a>
                      <a id="removemedicationbutton1" class="btn btn-xs btn-primary btn-danger" href="javascript:;" name="removemedicationbutton" ><span class="glyphicon glyphicon-remove"></span></a>
                    </div>

                  </td>

                </tr>

            <% end %>

        <% end %>


        </tbody>

      </table>
      <div class="medication-table-body-removed" style="display:none;">
      </div>
    </div>
<% else %>
  <div class="col-md-10 col-sm-10 col-xs-10">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th class="text-center col-md-3 col-sm-3" style="padding-top:0px;padding-bottom:0px;">Name</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Type</th>
          <th class="text-center" style="padding-top:0px;padding-bottom:0px;display: none">Quantity</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Frequency&nbsp;&nbsp;<a href="#" data-toggle="tooltip" data-placement="bottom" title="Number of times in a day"><i class="fa fa-info-circle" aria-hidden="true"></i></a></th>
          <th class="text-center col-md-3-shared col-sm-3-shared" style="padding-top:0px;padding-bottom:0px;">Duration&nbsp;&nbsp;<a href="#" data-toggle="tooltip" data-placement="bottom" title="How long you need to take this"><i class="fa fa-info-circle" aria-hidden="true"></i></a></th>
          <th class="text-center col-md-3-shared col-sm-3-shared" style="padding-top:0px;padding-bottom:0px;">Instruction</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Adv. Date</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;">Adv. Time</th>
          <th class="text-center col-md-1 col-sm-1" style="padding-top:0px;padding-bottom:0px;"></th>
        </tr>
      </thead>
      <tbody class="medication-table-body-added">


      <% if @nursing_record.has_treatmentmedication? %>

        <% @nursing_record.treatmentmedication.each_with_index do |elem, i| %>
          <tr class="treatmentmedications">

            <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3 col-sm-3">
              <div class="form-group">
                <div class="input-group mb15">
                  <div class="ui-widget">
                    <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][lot_id]", "", {:class => 'form-control id' } %>
                    <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][id]", elem.id, {:class => 'form-control id' } %>
                    <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][pharmacy_item_id]", elem.pharmacy_item_id, {:class => 'form-control pharmacy_item_id' } %>
                    <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][generic_display_name]", elem.generic_display_name, {:class => 'form-control generic_display_name' } %>
                    <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][generic_display_ids]", elem.generic_display_ids, {:class => 'form-control generic_display_ids' } %>
                    <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicine_from]", elem.medicine_from, {:class => 'form-control medicine_from' } %>
                    <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][_destroy]", "0", {:class => 'form-control' } %>
                    <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinename]", elem.medicinename, {:maxlength => 300, :size => 40, :class => 'form-control medicinename', :style => 'width:100%;'} %>

                  </div>
                  <span id="medicinename-contents-<%= "#{i}" %>" class="btn btn-xs btn-success btn-square medicinename-contents hidden" data-medicinecontents=""><i class="fa fa-question-circle"></i></span>
                </div>
              </div>
            </td>

            <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
              <div class="form-group">
                <div class="input-group mb15">
                  <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinetype]", elem.medicinetype, { :class => 'form-control medicinetype' } %>
                </div>
              </div>
            </td>

            <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
              <div class="form-group">
                <div class="input-group mb15">
                  <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinequantity]", options_for_select(['1/4', '1/2', '1', '2', '3','4','5','6','7','8','9','10','11','12','13','14','15','20','25','30','35','40','45','50'], elem.medicinequantity), { :class => 'form-control medicinequantity' } %>
                </div>
              </div>
            </td>

            <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
              <div class="form-group">
                <div class="input-group mb15">
                  <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinefrequency]", options_for_select([['Select', ''], '1-1-1', '1-1-0', '1-0-1', '0-1-1', '1-0-0', '0-1-0', '0-0-1','2-2-2','2-0-2', '1-1-1-1','once a week','once a month', '5 times a day', '6 times a day', '8 times a day', '10 times a day', '12 times a day', '24 times a day','Sat-Sun', 'SOS'], elem.medicinefrequency), { :class => 'form-control medicinefrequency'} %>
                </div>
              </div>
            </td>

            <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
              <div class="form-group">
                <div class="input-group mb15">

                  <div class="row">

                    <div class="col-md-4 col-sm-4">
                      <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineduration]", options_for_select([['Sel',''],['1','1'], ['2','2'], ['3','3'], ['4','4'], ['5','5'], ['6','6'], ['7','7'], ['8','8'], ['9','9'], ['10','10'], ['11','11'], ['12','12'], ['15', '15'], ['20', '20'], ['25', '25'], ['30', '30'], ['40', '40'], ['50', '50'] ], elem.medicineduration), { :class => 'form-control medicineduration',:style => 'width:150%'} %>
                    </div>

                    <div class="col-md-8 col-sm-8">

                      <div class="col-md-12 col-sm-12">

                        <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinedurationoption]", options_for_select([['Sel',''], ['Days', 'D'], ['Weeks', 'W'], ['Months', 'M'], ['Next followup', 'F']], elem.medicinedurationoption), { :class => 'form-control medicinedurationoption', style: "width:150%;"} %>

                      </div>

                    </div>

                  </div>

                </div>
              </div>
            </td>

            <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
              <div class="form-group">
                <div class="input-group mb15">
                  <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineinstructions]", elem.medicineinstructions, {:maxlength => 300, :size => 40, :class => 'form-control' } %>
                </div>
              </div>
            </td>
            <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
              <div class="form-group" style="width: 100%;">
                 <div class="input-group mb15">
                    <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][date]",elem.date.try(:strftime, "%d/%m/%Y") , { :class => "form-control form-control-custom preop_datepicker ", id: "nursing_record_treatmentmedication_attributes_#{i}_date",readonly: true} %>
                 </div>
              </div>
            </td>
            <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
              <div class="form-group" style="width: 100%;">
                 <div class="mb15 bootstrap-timepicker timepicker">
                    <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][time]",elem.time.try(:strftime, "%I:%M %p") , { :class => "form-control form-control-custom preop_timepicker ", id: "nursing_record_treatmentmedication_attributes_#{i}_time"} %>
                 </div>
              </div>
            </td>


            <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">

              <div class="form-group">
                <a id="addnewmedicationbutton1" class="btn btn-xs btn-primary btn-square" href="javascript:;" name="addnewmedicationbutton" ><span class="glyphicon glyphicon-plus-sign"></span></a>
                <a id="removemedicationbutton1" class="btn btn-xs btn-primary btn-danger" href="javascript:;" name="removemedicationbutton" ><span class="glyphicon glyphicon-remove"></span></a>
              </div>

            </td>

          </tr>
        <% end %>

        <% counter = @nursing_record.treatmentmedication.size %>

        <% ((counter + 1)..5).each_with_index do |elem, i| %>

        <tr class="treatmentmedications">

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3 col-sm-3">
            <div class="form-group">
              <div class="input-group mb15">
                <div class="ui-widget">
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][lot_id]", "", {:class => 'form-control id' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][_destroy]", "0", {:class => 'form-control' } %>
                  <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinename]", nil, {:maxlength => 300, :size => 40, :class => 'form-control medicinename' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][pharmacy_item_id]", nil, {:class => 'form-control pharmacy_item_id' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][generic_display_name]", nil, {:class => 'form-control generic_display_name' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][generic_display_ids]", nil, {:class => 'form-control generic_display_ids' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicine_from]", nil, {:class => 'form-control medicine_from' } %>
                </div>
                <span id="medicinename-contents-<%= "#{counter}" %>" class="btn btn-xs btn-success btn-square medicinename-contents hidden" data-medicinecontents=""><i class="fa fa-question-circle"></i></span>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
            <div class="form-group">
              <div class="input-group mb15">
                <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinetype]", nil, { :class => 'form-control medicinetype' } %>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
            <div class="form-group">
              <div class="input-group mb15">
                <%= select_tag "opdrecord[treatmentmedication_attributes][#{counter}][medicinequantity]", options_for_select(['1/4', '1/2', '1', '2', '3','4','5','6','7','8','9','10','11','12','13','14','15','20','25','30','35','40','45','50'], "1"), { :class => 'form-control medicinequantity' } %>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
            <div class="form-group">
              <div class="input-group mb15">
                <%= select_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinefrequency]", options_for_select([['Select', ''], '1-1-1', '1-1-0', '1-0-1', '0-1-1', '1-0-0', '0-1-0', '0-0-1','2-2-2','2-0-2', '1-1-1-1','once a week','once a month', '5 times a day', '6 times a day', '8 times a day', '10 times a day', '12 times a day', '24 times a day','Sat-Sun', 'SOS'], ""), { :class => 'form-control medicinefrequency'} %>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
            <div class="form-group">
              <div class="input-group mb15">

                <div class="row">

                  <div class="col-md-4 col-sm-4">
                    <%= select_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicineduration]", options_for_select([['Sel',''],['1','1'], ['2','2'], ['3','3'], ['4','4'], ['5','5'], ['6','6'], ['7','7'], ['8','8'], ['9','9'], ['10','10'], ['11','11'], ['12','12'], ['15', '15'], ['20', '20'], ['25', '25'], ['30', '30'], ['40', '40'], ['50', '50'] ], ""), { :class => 'form-control medicineduration',style: "width:150%;"} %>
                  </div>

                  <div class="col-md-8 col-sm-8">

                    <div class="col-md-12 col-sm-12">

                      <%= select_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinedurationoption]", options_for_select([['Sel',''], ['Days', 'D'], ['Weeks', 'W'], ['Months', 'M'], ['Next followup', 'F']], ""), { :class => 'form-control medicinedurationoption', style: "width:150%;"} %>

                    </div>

                  </div>

                </div>

              </div>
            </div>
          </td>
          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
            <div class="form-group">
              <div class="input-group mb15">
                <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicineinstructions]", nil, {:maxlength => 300, :size => 40, :class => 'form-control' } %>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
            <div class="form-group" style="width: 100%;">
              <div class="input-group mb15">
                <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][date]",nil, { :class => "form-control form-control-custom preop_datepicker", id: "nursing_record_treatmentmedication_attributes_#{counter}_date",readonly: true} %>
              </div>
            </div>
          </td>
          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
            <div class="form-group" style="width: 100%;">
              <div class="mb15 bootstrap-timepicker timepicker">
                <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{counter}][time]",nil, { :class => "form-control form-control-custom preop_timepicker", id: "nursing_record_treatmentmedication_attributes_#{counter}_time" } %>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">

            <div class="form-group">
              <a id="addnewmedicationbutton1" class="btn btn-xs btn-primary btn-square" href="javascript:;" name="addnewmedicationbutton" ><span class="glyphicon glyphicon-plus-sign"></span></a>
              <a id="removemedicationbutton1" class="btn btn-xs btn-primary btn-danger" href="javascript:;" name="removemedicationbutton" ><span class="glyphicon glyphicon-remove"></span></a>
            </div>

          </td>

        </tr>

        <% counter = counter + 1 %>

        <% end %>

        <% else %>

        <% (1..5).each_with_index do |elem, i| %>

        <tr class="treatmentmedications">
          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3 col-sm-3">
            <div class="form-group">
              <div class="input-group mb15">
                <div class="ui-widget">
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][lot_id]", "", {:class => 'form-control id' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][_destroy]", "0", {:class => 'form-control' } %>
                  <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinename]", nil, {:maxlength => 300, :size => 40, :class => 'form-control medicinename', :style => 'width:100%;' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][pharmacy_item_id]", nil, {:class => 'form-control pharmacy_item_id' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][generic_display_name]", nil, {:class => 'form-control generic_display_name' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][generic_display_ids]", nil, {:class => 'form-control generic_display_ids' } %>
                  <%= hidden_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicine_from]", nil, {:class => 'form-control medicine_from' } %>
                </div>
                <span id="medicinename-contents-<%= "#{i}" %>" class="btn btn-xs btn-success btn-square medicinename-contents hidden" data-medicinecontents=""><i class="fa fa-question-circle"></i></span>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
            <div class="form-group">
              <div class="input-group mb15">
                <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinetype]", nil, { :class => 'form-control medicinetype' } %>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
            <div class="form-group">
              <div class="input-group mb15">
                <%= select_tag "nursing_record[treatmentmedication_attributes][#{counter}][medicinequantity]", options_for_select(['1/4', '1/2', '1', '2', '3','4','5','6','7','8','9','10','11','12','13','14','15','20','25','30','35','40','45','50'], "1"), { :class => 'form-control medicinequantity' } %>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;">
            <div class="form-group">
              <div class="input-group mb15">
                <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinefrequency]", options_for_select([['Select', ''], '1-1-1', '1-1-0', '1-0-1', '0-1-1', '1-0-0', '0-1-0', '0-0-1','2-2-2','2-0-2', '1-1-1-1','once a week','once a month', '5 times a day', '6 times a day', '8 times a day', '10 times a day', '12 times a day', '24 times a day','Sat-Sun', 'SOS'], ""), { :class => 'form-control medicinefrequency'} %>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
            <div class="form-group">
              <div class="input-group mb15">

                <div class="row">

                  <div class="col-md-4 col-sm-4">
                    <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineduration]", options_for_select([['Sel',''],['1','1'], ['2','2'], ['3','3'], ['4','4'], ['5','5'], ['6','6'], ['7','7'], ['8','8'], ['9','9'], ['10','10'], ['11','11'], ['12','12'], ['15', '15'], ['20', '20'], ['25', '25'], ['30', '30'], ['40', '40'], ['50', '50'] ], ""), { :class => 'form-control medicineduration',style: "width:150%;"} %>
                  </div>

                  <div class="col-md-8 col-sm-8">

                    <div class="col-md-12 col-sm-12">

                      <%= select_tag "nursing_record[treatmentmedication_attributes][#{i}][medicinedurationoption]", options_for_select([['Sel',''], ['Days', 'D'], ['Weeks', 'W'], ['Months', 'M'], ['Next followup', 'F']], ""), { :class => 'form-control medicinedurationoption', style: "width:150%;"} %>

                    </div>

                  </div>

                </div>

              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-3-shared col-sm-3-shared">
            <div class="form-group">
              <div class="input-group mb15">
                <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][medicineinstructions]", nil, {:maxlength => 300, :size => 40, :class => 'form-control' } %>
              </div>
            </div>
          </td>
          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
            <div class="form-group" style="width: 100%;">
              <div class="input-group mb15">
                <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][date]",nil, { :class => "form-control form-control-custom preop_datepicker", id: "nursing_record_treatmentmedication_attributes_#{i}_date",readonly: true} %>
              </div>
            </div>
          </td>
          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">
            <div class="form-group" style="width: 100%;">
              <div class="mb15 bootstrap-timepicker timepicker">
                <%= text_field_tag "nursing_record[treatmentmedication_attributes][#{i}][time]",nil, { :class => "form-control form-control-custom preop_timepicker", id: "nursing_record_treatmentmedication_attributes_#{i}_time"} %>
              </div>
            </div>
          </td>

          <td style="padding-left:1px;padding-top:1px;padding-bottom:1px;padding:0px;" class="col-md-1 col-sm-1">

            <div class="form-group">
              <a id="addnewmedicationbutton1" class="btn btn-xs btn-primary btn-square" href="javascript:;" name="addnewmedicationbutton" ><span class="glyphicon glyphicon-plus-sign"></span></a>
              <a id="removemedicationbutton1" class="btn btn-xs btn-primary btn-danger" href="javascript:;" name="removemedicationbutton" ><span class="glyphicon glyphicon-remove"></span></a>
            </div>

          </td>

        </tr>

        <% end %>

        <% end %>


      </tbody>

    </table>

    <div class="medication-table-body-removed" style="display:none;">
    </div>

  </div>
<% end %>

<%= javascript_include_tag "autocomplete/medicine" %>

<style type="text/css">
  .hide{
    display: none;
  }
  .form-inline .form-group {
    margin-right: 0px;
    margin-left: 0px;
  }
  .preop_timepicker,.preop_datepicker{
    background-color: #fff !important;
    cursor: pointer !important;
  }
</style>

<script>
  datepicker_options = {
    dateFormat: "dd/mm/yy",
    maxDate: 0
  };

  jQuery('.preop_datepicker').live('focus', function(){
    $(this).datepicker(datepicker_options);
  });
  $('.preop_timepicker').timepicker({minuteStep: 5});

  $(".instruction_dropdown_edit").on("change",function(){
    var id = $(this).attr("id")
    if ($("#"+id).val() == "Add a text Box"){
      $("#"+id).parent(".input-group").parent(".edit_instruction").prev(".edit_instruction_box").removeClass('hide').removeAttr("disabled","disabled");
      $("#"+id).parent(".input-group").parent(".edit_instruction").addClass("hide").attr("disabled","disabled")
      $("#"+id).val("")
    }
  })

  $(".undo_button_edit").on("click",function(e){
    e.preventDefault();
    $(this).parent(".input-group").parent('.edit_instruction_box').children(".input-group").children(".text_box_val").val("")
    $(this).parent(".input-group").parent('.edit_instruction_box').next(".edit_instruction").removeClass("hide");
    $(this).parent(".input-group").parent('.edit_instruction_box').addClass("hide")
  })

  $(".instruction_dropdown_magic").on("change",function(){
    var id = $(this).attr("id")
    if ($("#"+id).val() == "Add a text Box"){
      $("#"+id).parent(".input-group").parent(".edit-instruction").next(".instruction_box").removeClass('hide').removeAttr("disabled","disabled");
      $("#"+id).parent(".input-group").parent(".edit-instruction").hide().attr("disabled","disabled")
      $("#"+id).val("")
    }
  })

  $(".undo_button_magic").on("click",function(e){
    e.preventDefault();
    $(this).parent(".input-group").parent('.instruction_box').parent('.medication_instruction_box').children('.edit-instruction').show().removeAttr("disabled","disabled");
    $(this).parent(".input-group").parent('.instruction_box').children(".input-group").children(".text_box_val").val("")
    $(this).parent(".input-group").parent('.instruction_box').addClass("hide").attr("disabled","disabled");
  })

  $(".instruction_dropdown").on("change",function(){
    var id = $(this).attr("id")
    if ($("#"+id).val() == "Add a text Box"){
      $("#"+id).parent(".input-group").parent(".instruction").next(".instruction_box").removeClass('hide').removeAttr("disabled","disabled");
      $(this).parent(".input-group").parent(".instruction").hide().attr("disabled","disabled");
      $("#"+id).val("")
    }
  })

  $(".undo_button").on("click",function(e){
    e.preventDefault();
    $(this).parent(".input-group").parent('.instruction_box').parent('.medication_instruction_box').children('.instruction').show().removeAttr("disabled","disabled");
    $(this).parent(".input-group").parent('.instruction_box').children(".input-group").children(".text_box_val").val("")
    $(this).parent(".input-group").parent('.instruction_box').addClass("hide").attr("disabled","disabled");
  })

  _add_button_at_last()
  function _add_button_at_last() {
    var row_count = jQuery("[id^='addnewmedicationbutton']").parents('.treatmentmedications:visible').length
    jQuery("[id^='addnewmedicationbutton']:lt("+(row_count-1)+")").addClass("hidden")
    jQuery("[id^='addnewmedicationbutton']:eq("+(row_count-1)+")").removeClass("hidden")
  }
  jQuery('tbody').on('click', "a[name*='addnewmedicationbutton']", function() {
    var fieldcounter;
    if (jQuery(".medication-table-body-added > .treatmentmedications").length == 0){
        fieldcounter = 0;
    } else {
        fieldcounter = jQuery(".medication-table-body-added > .treatmentmedications").length;
    }
    var params = { counter: fieldcounter, specalityfoldername: "<%= @speciality_folder_name %>" };
    jQuery.ajax({
        type: "GET",
        dataType: "script",
        url: "/inpatient/nursing_records/add_medication",
        data: {ajax: params, remote: "true" },
        async: false
    });
    _add_button_at_last()
    _renumber_id_after_remove("tbody.medication-table-body-added", "div.medication-table-body-removed");

    //medicinename_autocomplete();
  });
  jQuery('.medication-table-body-added').on('click', "a[name*='removemedicationbutton']", function() {
    event.preventDefault();
    var medications_removed_tr_html;
    var fieldcounter;
    fieldcounter = jQuery(this).attr('id').slice(-1);
    var medications_tr_array = jQuery(this).parents('.treatmentmedications').find(".id");
    if (medications_tr_array.length > 0) {
        jQuery(this).parents('.treatmentmedications').find("input[name*='_destroy']").val("1");
        medications_removed_tr_html = jQuery(this).parents('.treatmentmedications').wrap('<p/>').parent().html();
        jQuery(this).parents('.treatmentmedications').unwrap();
        jQuery('.medication-table-body-removed').append(medications_removed_tr_html);
        jQuery(this).parents('.treatmentmedications').remove();
        _renumber_id_after_remove("tbody.medication-table-body-added", "div.medication-table-body-removed");
    } else {
        jQuery(this).parents('.treatmentmedications').remove();
        _renumber_id_after_remove("tbody.medication-table-body-added", "div.medication-table-body-removed");
    }
  });
  function _renumber_id_after_remove(added, removed) {
    var counter = 0;
    jQuery(added).find(".treatmentmedications").each(function() {
      jQuery(this).find("input").each(function(index, element) {
        var nameattr, idattr;
        nameattr = element.name.replace(/\[[0-9]+\]/g, '['+counter+']');
        idattr = element.id.replace(/\_[0-9]+\_/g, '_'+counter+'_');
        jQuery(this).attr('name', nameattr);
        jQuery(this).attr('id', idattr);
      });
      jQuery(this).find("select").each(function(index, element) {
        var nameattr, idattr;
        nameattr = element.name.replace(/\[[0-9]+\]/g, '['+counter+']');
        idattr = element.id.replace(/\_[0-9]+\_/g, '_'+counter+'_');
        jQuery(this).attr('name', nameattr);
        jQuery(this).attr('id', idattr);
      });
      jQuery(this).find("a").each(function(index, element) {
        var idattr;
        idattr = element.id.replace(/[0-9]/g, counter);
        jQuery(this).attr('id', idattr);
      });
      counter++;
    });
    jQuery(removed).find(".treatmentmedications").each(function() {
      jQuery(this).find("input").each(function(index, element) {
        var nameattr, idattr;
        nameattr = element.name.replace(/\[[0-9]+\]/g, '['+counter+']');
        idattr = element.id.replace(/\_[0-9]+\_/g, '_'+counter+'_');
        jQuery(this).attr('name', nameattr);
        jQuery(this).attr('id', idattr);
      });
      jQuery(this).find("select").each(function(index, element) {
        var nameattr, idattr;
        nameattr = element.name.replace(/\[[0-9]+\]/g, '['+counter+']');
        idattr = element.id.replace(/\_[0-9]+\_/g, '_'+counter+'_');
        jQuery(this).attr('name', nameattr);
        jQuery(this).attr('id', idattr);
      });
      jQuery(this).find("a").each(function(index, element) {
        var idattr;
        idattr = element.id.replace(/[0-9]/g, counter);
        jQuery(this).attr('id', idattr);
      });
      counter++;
    });
    _add_button_at_last()
  }
</script>