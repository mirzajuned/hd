<!--remove-->

<% @items.each do |item| %>
  <tr>
    <td><%= item.item_code %></td>
    <!-- <td>Category</td> -->
    <td><%= item.description %></td>
    <td><%= item.brand %></td>
    <td><%= item.color %></td>
    <td><%= item.gender %></td>
    <%item_oldest_lots= item.lots.where('stock' => {'$gte' => 1},is_deleted: false).order(created_at: "ASC")[0]%>
    <% if item_oldest_lots.try(:list_price) %>
      <td class="text-right">&#x20B9 <%= item_oldest_lots.list_price.round(2) %></td>
    <% else %>
      <td class="text-right">NA</td>
    <% end %>
    <td><%= item.stock %></td>
    <td>
      <% if @current_inventory == '334046963' %>
        <a href="/inventory/items/<%=item.id%>" data-remote="true" class="btn btn-primary btn-xs"> Details</a>
      <% else %>
        <a href="/inventory/department/items/<%=item.id%>" data-remote="true" class="btn btn-primary btn-xs"> Details</a>
      <% end %>
      <% if @current_inventory == '50121007' || @current_inventory == '284748001' %>
        <% if item.stock.present? && item.stock > 0 %>
          <%if item.in_cart == false%>
              <button class="btn btn-xs btn-primary btnItemToFreeInvoice btnAddItemToFreeInvoice" data-model="<%= item.id %>" id=""><i class="fa fa-plus"></i> Free Receipt</button>
          <%else%>
              <button class="btn btn-xs btn-warning btnItemToFreeInvoice btnRemoveItemToFreeInvoice" data-model="<%= item.id %>" id=""><i class="fa fa-minus"></i> Free Receipt</button>
          <%end%>
        <% else %>
          <button class="btn btn-xs btn-primary" disabled="disabled" data-model="<%= item.id %>" id="">Out of Stock</button>
        <% end %>
      <% else %>
        <% if item.checkoutable %>
          <% if item.stock.present? && item.stock > 0 %>
            <%if item.in_cart == false%>
                <button class="btn btn-xs btn-primary btnItemToCart btnAddItemToCart" data-model="<%= item.id %>" id=""><i class="fa fa-plus"></i> Cart</button>
            <%else%>
                <button class="btn btn-xs btn-warning btnItemToCart btnRemoveItemFromCart" data-model="<%= item.id %>" id=""><i class="fa fa-minus"></i> Cart</button>
            <%end%>            
          <% else %>
            <button class="btn btn-xs btn-primary" disabled="disabled" data-model="<%= item.id %>" id="">Out of Stock</button>
          <% end %>
        <% end %>
      <% end %>
    </td>
  </tr>
<% end %>
<script>
$(".btnItemToFreeInvoice").unbind();
$(".btnItemToFreeInvoice").on("click",function(){
  var item_id = $(this).attr("data-model")
  var department_id = $('#inventory_controller_department').val()
  var in_cart
  if ($(this).hasClass("btnAddItemToFreeInvoice")) {
    in_cart = "true"
  }
  else {
    in_cart = "false"
  }
  $.ajax({
    type: "GET",
    data: {
      item_id: item_id,
      in_cart: in_cart,
      department_id: department_id
    },
    url: "/inventory/department/item/update_cart",
    success: function(data) {
      $("#free_invoice_item_count").text(data.cart_count)
    }
  })
  $(this).toggleClass("btnAddItemToFreeInvoice btnRemoveItemToFreeInvoice");
  $(this).find('i').toggleClass('fa-plus fa-minus')
  $(this).toggleClass("btn-primary btn-warning")

})
</script>