$("#receive-report-modal").html("<%= escape_javascript(render 'report.html.erb') %>")

$('.receive-report-timepicker').timepicker({minuteStep: 5});

$('.receive-report-start-datepicker').datepicker({
  dateFormat: "yy/mm/dd"
});
$('.receive-report-end-datepicker').datepicker({
  dateFormat: "yy/mm/dd"
});


function get_concerned_person() {
  $(".receive-report-concerned-person").on('change', function() {
    var received_by = $('#receive_report_user_name').val()
    var start_date = $('#receive_report_start_date').val()
    var start_time = $('#receive_report_start_time').val()
    var end_date = $('#receive_report_end_date').val()
    var end_time = $('#receive_report_end_time').val()

    var receive_data = `&received_by=${received_by}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}`

    var download_report_setting = $(".download_report_setting");
    for (var i = download_report_setting.length - 1; i >= 0; i--) {
      var receive_setting = $(download_report_setting[i]).attr('href');
      $(download_report_setting[i]).attr('href', receive_setting + receive_data)
    }
  }).trigger('change')
}

$("#receive_report_start_date").on('change', function() {
  if ($('input[name="receive_report[user_type]"]:checked').val() == 'include_user') {
    var received_by = $('#receive_report_user_name').val()
  }
  var start_date = $('#receive_report_start_date').val()
  var start_time = $('#receive_report_start_time').val()
  var end_date = $('#receive_report_end_date').val()
  var end_time = $('#receive_report_end_time').val()

  var receive_data = `&received_by=${received_by}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var receive_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', receive_setting + receive_data)
  }
}).trigger('change')

$("#receive_report_start_time").on('change', function() {
  if ($('input[name="receive_report[user_type]"]:checked').val() == 'include_user') {
    var received_by = $('#receive_report_user_name').val()
  }
  var start_date = $('#receive_report_start_date').val()
  var start_time = $('#receive_report_start_time').val()
  var end_date = $('#receive_report_end_date').val()
  var end_time = $('#receive_report_end_time').val()

  var receive_data = `&received_by=${received_by}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var receive_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', receive_setting + receive_data)
  }
}).trigger('change')

$("#receive_report_end_date").on('change', function() {
  if ($('input[name="receive_report[user_type]"]:checked').val() == 'include_user') {
    var received_by = $('#receive_report_user_name').val()
  }
  var start_date = $('#receive_report_start_date').val()
  var start_time = $('#receive_report_start_time').val()
  var end_date = $('#receive_report_end_date').val()
  var end_time = $('#receive_report_end_time').val()

  var receive_data = `&received_by=${received_by}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var receive_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', receive_setting + receive_data)
  }
}).trigger('change')

$("#receive_report_end_time").on('change', function() {
  if ($('input[name="receive_report[user_type]"]:checked').val() == 'include_user') {
    var received_by = $('#receive_report_user_name').val()
  }
  var start_date = $('#receive_report_start_date').val()
  var start_time = $('#receive_report_start_time').val()
  var end_date = $('#receive_report_end_date').val()
  var end_time = $('#receive_report_end_time').val()

  var receive_data = `&received_by=${received_by}&start_date=${start_date}&start_time=${start_time}&end_date=${end_date}&end_time=${end_time}`

  var download_report_setting = $(".download_report_setting");
  for (var i = download_report_setting.length - 1; i >= 0; i--) {
    var receive_setting = $(download_report_setting[i]).attr('href');
    $(download_report_setting[i]).attr('href', receive_setting + receive_data)
  }
}).trigger('change')

function check_user_type() {
  var user_type = $('input[name="receive_report[user_type]"]:checked').val()
  if (user_type == 'exclude_user') {
    $('.user-list').hide();
  } else {
    $('.user-list').show();
  }
}

$('#receive_report_user_type_exclude_user').on('click', function() {
  check_user_type()
})

$('#receive_report_user_type_include_user').on('click', function() {
  check_user_type()
  get_concerned_person()
})

check_user_type()

$('.download_report_setting').on('click', function() {
  $("#receive-report-modal").modal('hide')
})
