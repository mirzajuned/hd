<% if (current_facility.specialty_ids & current_user.specialty_ids).include?('309988001') %>
  <div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="col-md-5 col-sm-5 col-xs-5">
        <div class="tiitle">
          <h5 style="color: #444;font-size: 17px;">Ophthalmic History<b class="astrick" style="color: red;">*</b></h5>
        </div>
      </div>
    </div>
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="col-md-2 col-sm-2 speciality_histories_checkbox">
        <div class="ckbox ckbox-success col-md-12">
          <%= f.check_box :no_opthalmic_history_advised, {class: "speciality_histories_advised_button", :value => patient_data.read_attribute(:no_opthalmic_history_advised)}, "true", "false" %>
          <label for="<%= commen_form %>_no_opthalmic_history_advised">NIL</label>
        </div>
        <span class="opthalmic_history_msg" style="color: #f54b4b;font-size: 11px;display: none;">No ophthalmic history selected</span>
      </div>
      <div class="col-md-1 col-sm-1">OR</div>
      <% speciality_histories_list=[["Glaucoma","glaucoma"],["Retinal Detachment","retinal_detachment"],["Glass","glasses"],["Eye Disease","eye_disease"],["Eye Surgery","eye_surgery"],["Uveitis","uveitis"],["Retinal laser","retinal_laser"],["Contact lens","contact_lens"]] %>
      <%= f.input  :speciality_histories, wrapper_html: {:class=>"col-md-9"}, collection: speciality_histories_list, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype speciality_button', style: "width:14% !important;",  :input_html => {:name => commen_form+"[speciality_histories]" }, :checked => patient_data.checkboxes_checked(patient_data.speciality_histories.to_s) %>
    </div>
    <div class="row ophthalmic_history_title_f speciality_histories_details" style="display:block;">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="col-md-2 col-sm-2 col-sx-2">
          <h5 class="Opth_his_name">Name</h5>
        </div>
        <div class="col-md-3 col-sm-3 col-sx-3">
          <div class="col-md-6 col-sm-6 col-xs-6">
            <h5 class="Opth_his_name">Right duration</h5>
          </div>
          <div class="col-md-6 col-sm-6 col-xs-6">
            <h5 class="Opth_his_name">Right duration Unit</h5>
          </div>
        </div>
        <div class="col-md-1 col-sm-1 col-xs-1">
          <h5 class="Opth_his_name">Copy</h5>
        </div>
        <div class="col-md-3 col-sm-3 col-sx-3">
          <div class="col-md-6 col-sm-6 col-xs-6">
            <h5 class="Opth_his_name">Left duration</h5>
          </div>
          <div class="col-md-6 col-sm-6 col-xs-6">
            <h5 class="Opth_his_name">Left duration Unit</h5>
          </div>
        </div>
        <div class="col-md-3 col-sm-3 col-sx-3">
          <h5 class="Opth_his_name">Comments</h5>
        </div>
      </div>
    </div>
    <div class="col-md-12 col-sm-12 col-xs-12 speciality_histories_details">
      <%#= f.fields_for :speciality_history_records do |ff| %>
        <fieldset>
          <div class="fields" id="speciality_fields_add">
              <% patient_data.speciality_history_records.each_with_index do |complaint, i|%>
              <div class="col-md-12 col-sm-12 col-xs-12 complaint_name  specility_field_row <%= complaint.name %>_fields ">
                <div class="col-md-2 col-sm-2 col-xs-2">
                  <h5 class="complaint_title">
                    <%= hidden_field_tag commen_form+"[speciality_history_records_attributes][#{i}][_destroy]", "",class: "form-control  "+complaint.name+"_destroy", value: 0 %>
                    <%= complaint.name.split("_").map(&:capitalize).join(" ") %>
                    <%= hidden_field_tag commen_form+"[speciality_history_records_attributes][#{i}][name]", "", value: complaint.name %>
                    <% l_hidden_duration, l_duration, l_duration_unit, r_hidden_duration, r_duration, r_duration_unit  = complaint.l_r_set_duration %>
                    <%= hidden_field_tag commen_form+"[speciality_history_records_attributes][#{i}][r_hidden_duration]", "",value: r_hidden_duration, class:"r_hidden_duration" %>
                    <%= hidden_field_tag commen_form+"[speciality_history_records_attributes][#{i}][l_hidden_duration]", "",value: l_hidden_duration,  class:"l_hidden_duration" %>
                    <% if params[:action] == "edit" && today == "no" %>
                      <% r_duration = complaint.r_duration %>
                      <% r_duration_unit = complaint.r_duration_unit %>
                      <% l_duration = complaint.l_duration %>
                      <% l_duration_unit = complaint.l_duration_unit %>
                      <%= hidden_field_tag commen_form+"[speciality_history_records_attributes][#{i}][_id]", "",  value: complaint._id %>
                    <% elsif params[:action] == "edit" && today == "yes" %>
                      <% r_duration = r_duration %>
                      <% r_duration_unit = r_duration_unit %>
                      <% l_duration = l_duration %>
                      <% l_duration_unit = l_duration_unit %>
                    <% else %>
                      <% r_duration = r_duration %>
                      <% r_duration_unit = r_duration_unit %>
                      <% l_duration = l_duration %>
                      <% l_duration_unit = l_duration_unit %>
                    <% end %>
                  </h5>
                </div>
                <div class="col-md-3 col-sm-3 col-xs-3">
                  <div class="complaint_title col-md-6 col-sm-6 col-xs-6">
                  <% duration_time = 1..40 %>
                    <%= select_tag commen_form+"[speciality_history_records_attributes][#{i}][r_duration]", options_for_select(duration_time, r_duration), prompt: "Please Select", class:"form-control speciality_fields_add_fields speciality_r_duration r_duration_field" %>
                  </div>
                  <div class="complaint_title col-md-6 col-sm-6 col-xs-6">
                    <%= select_tag commen_form+"[speciality_history_records_attributes][#{i}][r_duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], r_duration_unit), prompt: "Please Select", class:"form-control speciality_fields_add_fields speciality_r_duration_unit r_duration_unit" %>
                  </div>
                </div>
                <div class="col-md-1 col-sm-1 col-xs-1 speciality_history_row">
                  <div class="col-md-12 ccl-sm-12 col-xs-12">
                    <center>
                      <div class="complaint_title copy_arrow_button">
                        <i class="fa fa-arrow-right " aria-hidden="true" style="color: #46b8da;"></i>
                      </div>
                    </center>
                  </div>
                </div>
                <div class="col-md-3 col-sm-3 col-xs-3 left_side_value">
                  <div class="complaint_title col-md-6 col-sm-6 col-xs-6">
                    <% duration_time = 1..40 %>
                    <%= select_tag commen_form+"[speciality_history_records_attributes][#{i}][l_duration]", options_for_select(duration_time, l_duration), prompt: "Please Select", class:"form-control speciality_fields_add_fields speciality_l_duration l_duration_field" %>
                  </div>
                  <div class="complaint_title col-md-6 col-sm-6 col-xs-6">
                    <%= select_tag commen_form+"[speciality_history_records_attributes][#{i}][l_duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], l_duration_unit), prompt: "Please Select", class:"form-control speciality_fields_add_fields speciality_l_duration_unit l_duration_unit" %>
                  </div>
                </div>
                <div class="col-md-3 col-sm-3 col-xs-3">
                  <div class="complaint_title">
                      <%= text_field_tag  commen_form+"[speciality_history_records_attributes][#{i}][comment]", "",class: "form-control speciality_field_add_comment", placeholder: "Comment ....", value: complaint.comment%>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </fieldset>
      <%# end %>
    </div>
    <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top: 20px;">
      <div class="col-md-2 col-sm-2 col-xs-2">
        <h5 class="complaint_main_comment">Comments</h5>
      </div>
      <div class="col-md-10 col-sm-10 col-xs-10">
        <%= f.input :opthal_history_comment, wrapper_html: {:class=>"col-md-12 col-sm-12 col-xs-12"}, as: :text,  :label => false, :required => false, :input_html => {:class => "form-control", :rows => 2, :style => 'width:96%;', :required => false, :name => commen_form+"[opthal_history_comment]", :value => patient_data.read_attribute(:opthal_history_comment) } %>
      </div>
    </div>
  </div>
<% end %>
<div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="col-md-5 col-sm-5 col-xs-5">
      <div class="tiitle">
        <h5 style="color: #444;font-size: 17px;">Systemic History<b class="astrick" style="color: red;">*</b></h5>
      </div>
    </div>
  </div>
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="col-md-2 col-sm-2 personal_histories_checkbox">
      <div class="ckbox ckbox-success col-md-12">
        <%= f.check_box :no_systemic_history_advised, {class: "personal_histories_advised_button", :value => patient_data.read_attribute(:no_systemic_history_advised)}, "true", "false" %>
        <label for="<%= commen_form %>_no_systemic_history_advised">NIL</label>
      </div>
      <span class="systemic_history_msg" style="color: #f54b4b;font-size: 11px;display: none;">No systemic history selected</span>
    </div>
    <div class="col-md-1 col-sm-1">OR</div>
    <% personal_histories_list=[["Diabetes","diabetes"],["Hypertension", "hypertension"],["Alcoholism","alcoholism"],["Smoking Tobacco","smoking_tobacco"],["Cardiac Disorder","cardiac_disorder"],["Steroid Intake","steroid_intake"],[ "Drug Abuse","drug_abuse"], ["Hiv Aids","hiv_aids"],[ "Cancer Tumor","cancer_tumor"], ["Tuberculosis","tuberculosis"], ["Asthma", "asthma"], ["Cns Disorder Stroke", "cns_disorder_stroke"],[ "Hypothyroidism","hypothyroidism"], ["Hyperthyroidism","hyperthyroidism"], ["Hepatitis Cirrhosis","hepatitis_cirrhosis"], ["Renal Disorder","renal_disorder"], ["Acidity","acidity"], ["On insulin","on_insulin"], ["On Aspirin Blood Thinners","on_aspirin_blood_thinners"], ["Consanguinity","consanguinity"], ["Thyroid Disorder", "thyroid_disorder"], ["Chewing Tobacco", "chewing_tobacco"], ["Rheumatoid Arthritis", "rheumatoid_arthritis"], ["Benign Prostatic Hyperplasia(BPH)", "benign_prostatic_hyperplasia"]] %>
    <%= f.input  :personal_histories, wrapper_html: {:class=>"col-md-9"}, collection: personal_histories_list, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype personal_button', style: "width:14% !important;",:input_html => {:name => commen_form+"[personal_histories]" }, :checked => patient_data.checkboxes_checked(patient_data.personal_histories.to_s) %>
  </div>
  <div class="row personal_histories_details">
    <div class="col-md-12 col-sm-12 col-xs-12 symentic_allergies_title_f" style='display:block'>
      <div class="col-md-2 col-sm2 col-xs-2">
        <h5 class="Opth_his_name">Name</h5>
      </div>
      <div class="col-md-2 col-sm-2 col-xs-2">
        <h5 class="Opth_his_name">Duration</h5>
      </div>
      <div class="col-md-2 col-sm-2 col-xs-2">
        <h5 class="Opth_his_name">Duration Unit</h5>
      </div>
      <div class="col-md-4 col-sm-6 col-xs-6">
        <h5 class="Opth_his_name">Comments</h5>
      </div>
    </div>
  </div>
  <div class="col-md-12 col-sm-12 col-xs-12 personal_histories_details">
    <%#= f.fields_for :personal_history_records do |ff| %>
      <fieldset>
        <div class="fields" id="personal_fields_add">
          <% patient_data.personal_history_records.each_with_index do |complaint, i| %>
            <div class="col-md-12 col-sm-12 col-xs-12 complaint_name personal_field_row <%= complaint.name %>_fields ">
              <div class="col-md-2 col-sm-2 col-xs-2">
                <h5 class="complaint_title">
                  <%= hidden_field_tag commen_form+"[personal_history_records_attributes][#{i}][_destroy]", "", class:"form-control "+complaint.name+"_destroy", value: 0 %>
                  <%= complaint.name.split("_").map(&:capitalize).join(" ") %>
                  <%= hidden_field_tag commen_form+"[personal_history_records_attributes][#{i}][name]", "", value: complaint.name %>
                  <% hidden_duration, duration, duration_unit = complaint.set_duration %>
                  <%= hidden_field_tag commen_form+"[personal_history_records_attributes][#{i}][hidden_duration]", "",value: hidden_duration, class:"hidden_duration" %>
                  <% if params[:action] != "new" && today == "no" %>
                    <% duration = complaint.duration %>
                    <% duration_unit = complaint.duration_unit %>
                    <%= hidden_field_tag commen_form+"[personal_history_records_attributes][#{i}][_id]", "", value: complaint._id %>
                  <% elsif params[:action] != "new" && today == "yes" %>
                    <% duration = duration %>
                    <% duration_unit = duration_unit %>
                  <% else %>
                    <% duration = duration %>
                    <% duration_unit = duration_unit %>
                  <% end %>
                </h5>
              </div>
              <div class="col-md-2 col-sm-2 col-xs-2">
                <div class="complaint_title">
                  <% duration_time = 1..40 %>
                  <%= select_tag commen_form+"[personal_history_records_attributes][#{i}][duration]", options_for_select(duration_time, duration), prompt: "Please Select", class:"form-control personal_fields_add_fields duration_field" %>
                </div>
              </div>
              <div class="col-md-2 col-sm-2 col-xs-2">
                <div class="complaint_title">
                  <%= select_tag commen_form+"[personal_history_records_attributes][#{i}][duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], duration_unit), prompt: "Please Select", class:"form-control personal_fields_add_fields duration_unit" %>
                </div>
              </div>
              <div class="col-md-6 col-sm-6 col-xs-6">
                <div class="complaint_title">
                  <%= text_field_tag  commen_form+"[personal_history_records_attributes][#{i}][comment]", "",class: "form-control personal_field_add_comment", placeholder: "Comment ....", value: complaint.comment %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </fieldset>
    <%# end %>
  </div>
  <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top: 20px;">
    <div class="col-md-2 col-sm-2 col-xs-2">
      <h5 class="complaint_main_comment">Comments</h5>
    </div>
    <div class="col-md-10 col-sm-10 col-xs-10">
      <%= f.input :history_comment, wrapper_html: {:class=>"col-md-12 col-sm-12 col-xs-12"}, as: :text,  :label => false, :required => false, :input_html => {:class => "form-control", :rows => 2, :style => 'width:96%;', :required => false, :name => commen_form+"[history_comment]", :value => patient_data.read_attribute(:history_comment) } %>
    </div>
  </div>
</div>
<div class="" style="margin-top:20px;">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <%#= f.fields_for :other_history do |ff| %>
      <fieldset>
        <div class="row">
          <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="col-md-6 col-sm-6 col-xs-6">
              <div class="row">
                <div class="col-md-3 col-sm-3 col-xs-3">
                  <h5 class="" style="color:#444">Family History</h5>
                </div>
                <div class="col-md-9 col-sm-9 col-xs-p">
                  <%= text_field_tag :family_history,"", name: commen_form+"[other_history_attributes][family_history]", class:"personal_field_add_comment", placeholder: "Family History",  value: patient_data.other_history.family_history %>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-sm-6 col-xs-6">
              <div class="row">
                <div class="col-md-3 col-sm-3 col-xs-3">
                  <h5 class="" style="color:#444">Medical History</h5>
                </div>
                <div class="col-md-9 col-sm-9 col-xs-9">
                  <%= text_field_tag :medical_history,"",  name: commen_form+"[other_history_attributes][medical_history]", placeholder: "Medical History", class:"personal_field_add_comment", value: patient_data.other_history.medical_history%>
                </div>
              </div>
            </div>
            <% if patient_data.try(:gender).to_s == 'Female' %>
              <div class="col-md-6 col-sm-6 col-xs-6" style="margin-top:20px">
                <div class="row patient-special-status">
                  <div class="col-md-3 col-sm-3 col-xs-3">
                    <h5 class="control-label" style="color:#444">
                      <label class="control-label">Special Status <small style="cursor: pointer;color: rgb(66, 139, 202); display: none; border: 1px solid rgb(66, 139, 202); border-radius: 2px;" id="clear_special_status">clear</small></label>
                    </h5>
                  </div>
                  <div class="col-md-9 col-sm-9 col-xs-9">
                    <div class="row">
                      <div class="">
                          <%= f.input :specialstatus, wrapper_html: {:class=>"col-md-12"}, collection: ['Breastfeeding', 'Pregnant'], :as => :hg_radio_button,:label => false, :required => false,:class => 'btn btn-xs btn-white specialstatus_buttons', :input_html => {:name => commen_form+"[other_history_attributes][specialstatus]" }, :checked => patient_data.other_history.try(:specialstatus)%>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </fieldset>
    <%# end %>
  </div>
</div>
<div class="" style="margin-bottom:20px;">
    <%#= f.fields_for :allergy_histories do |ff| %>
    <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top:20px;">
      <h5 style="font-size: 16px;color: #444;">All Allergies<b class="astrick" style="color: red;">*</b></h5>
    </div>
    <div class="col-md-12 col-sm-12 col-xs-12 all_allergies">
      <div class="col-md-2 col-sm-2 allergies_checkbox">
        <div class="ckbox ckbox-success col-md-12">
          <%= f.check_box :no_allergy_advised, {class: "all_allergies_checkbox", :value => patient_data.read_attribute(:no_allergy_advised)}, "true", "false" %>
          <label for="<%= commen_form %>_no_allergy_advised">NIL</label>
        </div>
        <span class="all_allergies_msg" style="color: #f54b4b;font-size: 11px;display: none;">No allergy selected</span>
      </div>
      <div class="col-md-1 col-sm-1">OR</div>
    <div class="col-md-9 col-sm-9 col-xs-9">
      <fieldset>
        <div class="drug_allergies_section">
          <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top:-9px;">
            <h5 style="font-size: 16px;color: #444;">Drug Allergies<b class="astrick" style="color: red;">*</b></h5>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12">
            <% drug_allergies =[["Antimicrobial Agents","antimicrobial_agents"],["Antifungal Agents","antifungal_agents"],["Antiviral Agents","antiviral_agents"],["Nsaids","nsaids"],["Eye Drops","eye_drops"]] %>
            <%= f.input  :drug_allergies, wrapper_html: {:class=>"col-md-9"}, collection: drug_allergies, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype allergies_button', style: "width:14% !important;",:input_html => {:name => commen_form+"[drug_allergies]" }, :checked => patient_data.checkboxes_checked(patient_data.drug_allergies.to_s) %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 antimicrobial_agents_check" style="display:none">
            <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top:5px;">
              <h5 style="font-size: 16px;color: #444;">Antimicrobial agents</h5>
            </div>
            <% antimicrobial_agents =[["Ampicillin","ampicillin"],["Amoxicillin","amoxicillin"],["Ceftriaxone","ceftriaxone"],["Ciprofloxacin","ciprofloxacin"],["Clarithromycin","clarithromycin"], ["Co Trimoxazole","co_trimoxazole"], ["Ethambutol", "ethambutol"], ["Isoniazid", "isoniazid"], ["Metronidazole", "metronidazole"], ["Penicillin", "penicillin"], ["Rifampicin", "rifampicin"], ["Streptomycin", "streptomycin"]] %>
            <%= f.input  :antimicrobial_agents, wrapper_html: {:class=>"col-md-12"}, collection: antimicrobial_agents, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype antimicrobial_agents_button drug_agents_button', style: "width:14% !important;",:input_html => {:name => commen_form+"[antimicrobial_agents]", class: "record_antimicrobial_agents" }, :checked => patient_data.checkboxes_checked(patient_data.antimicrobial_agents.to_s) %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 antimicrobial_agents_title_f" style="display:none;">
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Name</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration Units</h5>
            </div>
            <div class="col-md-4 col-sm-6 col-xs-6">
              <h5 class="Opth_his_name">Comments</h5>
            </div>
          </div>
          <div class="fields" id="antimicrobial_agents_button_main_hide">
            <% patient_data.allergy_histories.each_with_index do |complaint, i| %>
              <% if complaint.name == "ampicillin" || complaint.name == "amoxicillin" || complaint.name == "ceftriaxone" || complaint.name == "ciprofloxacin" || complaint.name == "clarithromycin" || complaint.name == "co_trimoxazole" || complaint.name == "ethambutol" || complaint.name == "isoniazid" || complaint.name == "metronidazole" || complaint.name == "penicillin" || complaint.name == "rifampicin" || complaint.name == "streptomycin" %>
                <div class="col-md-12 col-sm-12 col-xs-12 complaint_name allergies_fields_row_count <%= complaint.name %>_fields antimicrobial_agents_hide ">
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <h5 class="complaint_title">
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_destroy]", "", class:"form-control "+complaint.name+"_destroy antimicrobial_agents_destroy", value: 0 %>
                      <%= complaint.name.split("_").map(&:capitalize).join(" ") %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][name]", "", value: complaint.name %>
                      <% @allergy_hidden_duration, @allergy_duration, @allergy_duration_unit  = complaint.allergy_started %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][hidden_duration]", "", value: @allergy_hidden_duration, class:"allergy_hidden_duration" %>
                      <% if params[:action] != "new" && today == "no"  %>
                        <% aller_duration = complaint.duration %>
                        <% aller_duration_unit = complaint.duration_unit %>
                        <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_id]", "", value: complaint._id %>
                      <% elsif params[:action] != "new" && today == "yes" %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% else %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% end %>
                    </h5>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <% duration_time = 1..40 %>
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration]", options_for_select(duration_time, aller_duration), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration" %>
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], aller_duration_unit), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration_unit" %>
                    </div>
                  </div>
                  <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="complaint_title">
                      <%= text_field_tag  commen_form+"[allergy_histories_attributes][#{i}][comment]", "",class: "form-control personal_field_add_comment", placeholder: "Comment ....", value: complaint.comment %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_type]",  "", class: "form-control", value: complaint.allergy_type %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_subtype]",  "", class: "form-control", value: complaint.allergy_subtype %>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 antifungal_agents_check" style="display:none">
            <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top:5px;">
              <h5 style="font-size: 16px;color: #444;">Antifungal agents</h5>
            </div>
            <% antifungal_agents =[["Ketoconazole","ketoconazole" ],["Fluconazole","fluconazole"],["Itraconazole","itraconazole"]] %>
            <%= f.input  :antifungal_agents, wrapper_html: {:class=>"col-md-12"}, collection: antifungal_agents, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype antifungal_agents_button drug_agents_button', style: "width:14% !important;",:input_html => {:name => commen_form+"[antifungal_agents]", class:"record_antifungal_agents" }, :checked => patient_data.checkboxes_checked(patient_data.antifungal_agents.to_s)  %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 antifungal_agents_title_f" style="display:none;">
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Name</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration Units</h5>
            </div>
            <div class="col-md-4 col-sm-6 col-xs-6">
              <h5 class="Opth_his_name">Comments</h5>
            </div>
          </div>
          <div class="fields" id="antifungal_agents_main_hide">
            <% patient_data.allergy_histories.each_with_index do |complaint, i| %>
              <% if complaint.name == "ketoconazole" || complaint.name == "fluconazole" || complaint.name == "itraconazole" %>
                <div class="col-md-12 col-sm-12 col-xs-12 complaint_name allergies_fields_row_count <%= complaint.name %>_fields antifungal_agents_hide ">
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <h5 class="complaint_title">
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_destroy]", "", class:"form-control "+complaint.name+"_destroy antifungal_agents_destroy", value: 0 %>
                      <%= complaint.name.split("_").map(&:capitalize).join(" ") %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][name]", "", value: complaint.name %>
                      <% @allergy_hidden_duration, @allergy_duration, @allergy_duration_unit  = complaint.allergy_started %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][hidden_duration]", "", value: @allergy_hidden_duration, class:"allergy_hidden_duration" %>
                      <% if params[:action] != "new" && today == "no"  %>
                        <% aller_duration = complaint.duration %>
                        <% aller_duration_unit = complaint.duration_unit %>
                        <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_id]", "", value: complaint._id %>
                      <% elsif params[:action] != "new" && today == "yes" %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% else %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% end %>
                    </h5>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <% duration_time = 1..40 %>
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration]", options_for_select(duration_time, aller_duration), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration" %>
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], aller_duration_unit), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration_unit" %>
                    </div>
                  </div>
                  <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="complaint_title">
                      <%= text_field_tag  commen_form+"[allergy_histories_attributes][#{i}][comment]", "",class: "form-control personal_field_add_comment", placeholder: "Comment ....", value: complaint.comment %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_type]", "", class: "form-control", value: complaint.allergy_type %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_subtype]", "", class: "form-control", value: complaint.allergy_subtype %>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 antiviral_agents_check" style="display:none">
            <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top:5px;">
              <h5 style="font-size: 16px;color: #444;">Antiviral Agents</h5>
            </div>
            <% antiviral_agents =[["Acyclovir","acyclovir"],["Efavirenz", "efavirenz"],["Enfuvirtide", "enfuvirtide"],["Nelfinavir", "nelfinavir"],["Nevirapine", "nevirapine"], ["Zidovudine", "zidovudine"]] %>
            <%= f.input  :antiviral_agents, wrapper_html: {:class=>"col-md-12"}, collection: antiviral_agents, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype antiviral_agents_button drug_agents_button', style: "width:14% !important;" ,:input_html => {:name => commen_form+"[antiviral_agents]" , class: "record_antiviral_agents"}, :checked => patient_data.checkboxes_checked(patient_data.antiviral_agents.to_s)%>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 antiviral_agents_title_f" style="display:none;">
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Name</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration Units</h5>
            </div>
            <div class="col-md-4 col-sm-6 col-xs-6">
              <h5 class="Opth_his_name">Comments</h5>
            </div>
          </div>
          <div class="fields" id="antiviral_agents_main_hide">
            <% patient_data.allergy_histories.each_with_index do |complaint, i| %>
              <% if complaint.name == "acyclovir" || complaint.name == "efavirenz" || complaint.name == "enfuvirtide" || complaint.name == "nelfinavir" || complaint.name == "nevirapine" || complaint.name == "zidovudine"  %>
                <div class="col-md-12 col-sm-12 col-xs-12 complaint_name allergies_fields_row_count <%= complaint.name %>_fields antiviral_agents_hide ">
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <h5 class="complaint_title">
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_destroy]", "", class:"form-control "+complaint.name+"_destroy antiviral_agents_destroy", value: 0 %>
                      <%= complaint.name.split("_").map(&:capitalize).join(" ") %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][name]", "", value: complaint.name %>
                      <% @allergy_hidden_duration, @allergy_duration, @allergy_duration_unit  = complaint.allergy_started %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][hidden_duration]", "", value: @allergy_hidden_duration, class:"allergy_hidden_duration" %>
                      <% if params[:action] != "new" && today == "no"  %>
                        <% aller_duration = complaint.duration %>
                        <% aller_duration_unit = complaint.duration_unit %>
                        <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_id]", "", value: complaint._id %>
                      <% elsif params[:action] != "new" && today == "yes" %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% else %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% end %>
                    </h5>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <% duration_time = 1..40 %>
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration]", options_for_select(duration_time, aller_duration), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration" %>
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], aller_duration_unit), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration_unit" %>
                    </div>
                  </div>
                  <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="complaint_title">
                      <%= text_field_tag  commen_form+"[allergy_histories_attributes][#{i}][comment]", "",class: "form-control personal_field_add_comment", placeholder: "Comment ....", value: complaint.comment %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_type]",  "", class: "form-control", value: complaint.allergy_type %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_subtype]", "",class: "form-control", value: complaint.allergy_subtype %>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 nsaids_check" style="display:none">
            <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top:5px;">
              <h5 style="font-size: 16px;color: #444;">Nsaids</h5>
            </div>
            <% nsaids =[["Aspirin", "aspirin"],["Paracetamol", "paracetamol"],["Ibuprofen", "ibuprofen"],["Diclofenac", "diclofenac"],["Aceclofenac", "aceclofenac"], ["Naproxen", "naproxen"]] %>
            <%= f.input  :nsaids, wrapper_html: {:class=>"col-md-12"}, collection: nsaids, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype nsaids_button drug_agents_button', style: "width:14% !important;",:input_html => {:name => commen_form+"[nsaids]",class: "record_nsaids" }, :checked => patient_data.checkboxes_checked(patient_data.nsaids.to_s) %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 nsaids_title_f" style="display:none;">
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Name</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration Units</h5>
            </div>
            <div class="col-md-4 col-sm-6 col-xs-6">
              <h5 class="Opth_his_name">Comments</h5>
            </div>
          </div>
          <div class="fields" id="nsaids_main_hide">
            <% patient_data.allergy_histories.each_with_index do |complaint, i| %>
              <% if complaint.name == "aspirin" || complaint.name == "paracetamol" || complaint.name == "ibuprofen" || complaint.name == "diclofenac" || complaint.name == "aceclofenac" || complaint.name == "naproxen" %>
                <div class="col-md-12 col-sm-12 col-xs-12 complaint_name allergies_fields_row_count <%= complaint.name %>_fields nsaids_hide ">
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <h5 class="complaint_title">
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_destroy]", "", class:"form-control "+complaint.name+"_destroy nsaids_destroy", value: 0 %>
                      <%= complaint.name.split("_").map(&:capitalize).join(" ") %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][name]", "", value: complaint.name %>
                      <% @allergy_hidden_duration, @allergy_duration, @allergy_duration_unit  = complaint.allergy_started %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][hidden_duration]", "", value: @allergy_hidden_duration, class:"allergy_hidden_duration" %>
                      <% if params[:action] != "new" && today == "no"  %>
                        <% aller_duration = complaint.duration %>
                        <% aller_duration_unit = complaint.duration_unit %>
                        <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_id]", "", value: complaint._id %>
                      <% elsif params[:action] != "new" && today == "yes" %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% else %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% end %>
                    </h5>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <% duration_time = 1..40 %>
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration]", options_for_select(duration_time, aller_duration), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration" %>
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], aller_duration_unit), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration_unit" %>
                    </div>
                  </div>
                  <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="complaint_title">
                      <%= text_field_tag  commen_form+"[allergy_histories_attributes][#{i}][comment]", "",class: "form-control personal_field_add_comment", placeholder: "Comment ....", value: complaint.comment %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_type]", "", class: "form-control", value: complaint.allergy_type %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_subtype]",  "", class: "form-control", value: complaint.allergy_subtype %>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 eye_drops_check" style="display:none">
            <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top:5px;">
              <h5 style="font-size: 16px;color: #444;">Eye Drops</h5>
            </div>
            <% eye_drops =[["Tropicamide_P","tropicamide_p" ],["Tropicamide", "tropicamide"],["Timolol", "timolol"],["Homide", "homide"],["Latanoprost", "latanoprost"], ["Brimonidine","brimonidine"], ["Travoprost","travoprost"], ["Tobramycin", "tobramycin"], ["Moxifloxacin","moxifloxacin"], ["Homatropine", "homatropine"], ["Pilocarpine", "pilocarpine"], ["Cyclopentolate","cyclopentolate"], ["Atropine", "atropine"], ["Phenylephrine", "phenylephrine"],["Tropicacyl",  "tropicacyl"],[ "Paracain",  "paracain"], ["Ciplox", "ciplox"], ["Tropicamide P + Distilled Water","tropicamide_p_distilled_water" ], ["Tropicamide P + Lubrex","tropicamide_p_lubrex" ]]%>
            <%= f.input  :eye_drops, wrapper_html: {:class=>"col-md-12"}, collection: eye_drops, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype eye_drops_button drug_agents_button', style: "width:14% !important;",:input_html => {:name => commen_form+"[eye_drops]",class: "record_eye_drops" }, :checked => patient_data.checkboxes_checked(patient_data.eye_drops.to_s) %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 eye_drops_title_f" style="display:none;">
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Name</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration Units</h5>
            </div>
            <div class="col-md-6 col-sm-6 col-xs-6">
              <h5 class="Opth_his_comment">Comments</h5>
            </div>
          </div>
          <div class="fields" id="eye_drops_main_hide">
            <% patient_data.allergy_histories.each_with_index do |complaint, i| %>
              <% if complaint.name == "tropicamide_p" || complaint.name == "tropicamide" || complaint.name == "timolol" || complaint.name == "moxifloxacin" || complaint.name == "homide" || complaint.name == "latanoprost" || complaint.name == "brimonidine" || complaint.name == "travoprost" || complaint.name == "tobramycin" || complaint.name == "homatropine" || complaint.name == "pilocarpine" || complaint.name == "cyclopentolate" || complaint.name == "atropine" || complaint.name == "phenylephrine"  || complaint.name == "tropicacyl"  || complaint.name == "paracain" || complaint.name == "ciplox" || complaint.name == "tropicamide_p_distilled_water" || complaint.name == "tropicamide_p_lubrex" %>
                <div class="col-md-12 col-sm-12 col-xs-12 complaint_name allergies_fields_row_count <%= complaint.name %>_fields eye_drops_hide ">
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <h5 class="complaint_title">
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_destroy]", "", class:"form-control "+complaint.name+"_destroy eye_drops_destroy", value: 0 %>
                      <%= complaint.name.split("_").map(&:capitalize).join(" ") %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][name]", "", value: complaint.name %>
                      <% @allergy_hidden_duration, @allergy_duration, @allergy_duration_unit  = complaint.allergy_started %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][hidden_duration]", "", value: @allergy_hidden_duration, class:"allergy_hidden_duration" %>
                      <% if params[:action] != "new" && today == "no"  %>
                        <% aller_duration = complaint.duration %>
                        <% aller_duration_unit = complaint.duration_unit %>
                        <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_id]", "", value: complaint._id %>
                      <% elsif params[:action] != "new" && today == "yes" %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% else %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% end %>
                    </h5>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <% duration_time = 1..40 %>
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration]", options_for_select(duration_time, aller_duration), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration" %>
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], aller_duration_unit), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration_unit" %>
                    </div>
                  </div>
                  <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="complaint_title">
                      <%= text_field_tag  commen_form+"[allergy_histories_attributes][#{i}][comment]", "",class: "form-control personal_field_add_comment", placeholder: "Comment ....", value: complaint.comment %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_type]", "", class: "form-control", value: complaint.allergy_type %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_subtype]", "", class: "form-control", value: complaint.allergy_subtype %>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12">
            <%= f.input :drug_allergies_comment, wrapper_html: {:class=>"col-md-12 col-sm-12 col-xs-12"}, as: :text,  :label => false, :required => false, :input_html => {:class => "form-control drug_allergies_comment", :rows => 2, :style => 'width:96%;', :required => false, :name => commen_form+"[drug_allergies_comment]", :value => patient_data.read_attribute(:drug_allergies_comment), placeholder: "Drug Allergies Comment"} %>
          </div>
        </div>

        <div class="contact_allergies_section">
          <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top:20px;">
            <h5 style="font-size: 16px;color: #444;">Contact Allergies<b class="astrick" style="color: red;">*</b></h5>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12">
            <% contact_allergies =[["Alcohol" , "alcohol"],["Latex", "latex"],["Betadine", "betadine"],["Adhesive Tape", "adhesive_tape"],["Tegaderm", "tegaderm"], ["Transpore", "transpore"]] %>
            <%= f.input  :contact_allergies, wrapper_html: {:class=>"col-md-9"}, collection: contact_allergies, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype contact_allergies_button drug_agents_button', style: "width:14% !important;",:input_html => {:name => commen_form+"[contact_allergies]" }, :checked => patient_data.checkboxes_checked(patient_data.contact_allergies.to_s) %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 contact_allergies_title_f contact_allergies_details" style="display:block;">
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Name</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration Units</h5>
            </div>
            <div class="col-md-4 col-sm-6 col-xs-6">
              <h5 class="Opth_his_name">Comments</h5>
            </div>
          </div>
          <div class="fields" id="contact_allergies_main_hide">
            <% patient_data.allergy_histories.each_with_index do |complaint, i| %>
              <% if complaint.name == "alcohol" || complaint.name == "latex" || complaint.name == "betadine" ||  complaint.name == "adhesive_tape" || complaint.name == "tegaderm" ||complaint.name == "transpore"%>
                <div class="col-md-12 col-sm-12 col-xs-12 complaint_name allergies_fields_row_count <%= complaint.name %>_fields contact_allergies_hide ">
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <h5 class="complaint_title">
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_destroy]", "", class:"form-control "+complaint.name+"_destroy contact_allergies_destroy", value: 0 %>
                      <%= complaint.name.split("_").map(&:capitalize).join(" ") %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][name]", "", value: complaint.name %>
                      <% @allergy_hidden_duration, @allergy_duration, @allergy_duration_unit  = complaint.allergy_started %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][hidden_duration]", "", value: @allergy_hidden_duration, class:"allergy_hidden_duration" %>
                      <% if params[:action] != "new" && today == "no"  %>
                        <% aller_duration = complaint.duration %>
                        <% aller_duration_unit = complaint.duration_unit %>
                        <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_id]", "", value: complaint._id %>
                      <% elsif params[:action] != "new" && today == "yes" %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% else %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% end %>
                    </h5>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <% duration_time = 1..40 %>
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration]", options_for_select(duration_time, aller_duration), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration" %>
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], aller_duration_unit), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration_unit" %>
                    </div>
                  </div>
                  <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="complaint_title">
                      <%= text_field_tag  commen_form+"[allergy_histories_attributes][#{i}][comment]", "",class: "form-control personal_field_add_comment", placeholder: "Comment ....", value: complaint.comment %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_type]",  "",class: "form-control", value: complaint.allergy_type %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_subtype]", "", class: "form-control", value: complaint.allergy_subtype %>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12">
            <%= f.input :contact_allergies_comment, wrapper_html: {:class=>"col-md-12 col-sm-12 col-xs-12"}, as: :text,  :label => false, :required => false, :input_html => {:class => "form-control contact_allergies_comment", :rows => 2, :style => 'width:96%;', :required => false, :name => commen_form+"[contact_allergies_comment]", :value => patient_data.read_attribute(:contact_allergies_comment), placeholder: "Contact Allergies Comment"} %>
          </div>
        </div>
        <div class="food_allergies_section">
          <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top:20px;">
            <h5 style="font-size: 16px;color: #444;">Food Allergies<b class="astrick" style="color: red;">*</b></h5>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12">
            <% food_allergies =[["All Seafood", "all_seafood" ],["Corn", "corn"],["Egg", "egg"],["Milk Proteins", "milk_proteins"],["Peanuts", "peanuts"], [ "Shellfish Only","shellfish_only"], ["Soy Protein", "soy_protein"], ["Lactose", "lactose"], ["Mushroom", "mushroom"]] %>
            <%= f.input  :food_allergies, wrapper_html: {:class=>""}, collection: food_allergies, :as => :hg_checkbox,:label => false, :required => false,:class => 'btn btn-sm btn-white checkuptype food_allergies_button drug_agents_button', style: "width:14% !important;", :input_html => {:name => commen_form+"[food_allergies]" }, :checked => patient_data.checkboxes_checked(patient_data.food_allergies.to_s)%>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12 food_allergies_title_f food_allergies_details" style="display:block;">
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Name</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration</h5>
            </div>
            <div class="col-md-2 col-sm-2 col-xs-2">
              <h5 class="Opth_his_name">Duration Units</h5>
            </div>
            <div class="col-md-4 col-sm-6 col-xs-6">
              <h5 class="Opth_his_name">Comments</h5>
            </div>
          </div>
          <div class="fields" id="food_allergies_main_hide">
            <% patient_data.allergy_histories.each_with_index do |complaint, i| %>
              <% if complaint.name == "all_seafood" || complaint.name == "corn" || complaint.name == "egg" ||  complaint.name == "milk_proteins" || complaint.name == "peanuts" || complaint.name == "shellfish_only" || complaint.name == "soy_protein" || complaint.name == "lactose" || complaint.name == "mushroom" %>
                <div class="col-md-12 col-sm-12 col-xs-12 complaint_name allergies_fields_row_count <%= complaint.name %>_fields food_allergies_hide ">
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <h5 class="complaint_title">
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_destroy]", "", class:"form-control "+complaint.name+"_destroy food_allergies_destroy", value: 0 %>
                      <%= complaint.name.split("_").map(&:capitalize).join(" ") %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][name]", "", value: complaint.name %>
                      <% @allergy_hidden_duration, @allergy_duration, @allergy_duration_unit  = complaint.allergy_started %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][hidden_duration]", "", value: @allergy_hidden_duration, class:"allergy_hidden_duration" %>
                      <% if params[:action] != "new" && today == "no"  %>
                        <% aller_duration = complaint.duration %>
                        <% aller_duration_unit = complaint.duration_unit %>
                        <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][_id]", "", value: complaint._id %>
                      <% elsif params[:action] != "new" && today == "yes" %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% else %>
                        <% aller_duration = @allergy_duration %>
                        <% aller_duration_unit = @allergy_duration_unit %>
                      <% end %>
                    </h5>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <% duration_time = 1..40 %>
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration]", options_for_select(duration_time, aller_duration), prompt: "Please Select", class:"form-control allergy_fields_add_field allergy_duration" %>
                    </div>
                  </div>
                  <div class="col-md-2 col-sm-2 col-xs-2">
                    <div class="complaint_title">
                      <%= select_tag commen_form+"[allergy_histories_attributes][#{i}][duration_unit]", options_for_select([["Days","days"],["Weeks","weeks"],["Months","months"],["Years","years"]], aller_duration_unit), prompt: "Please Select", class:"form-control personal_fields_add_fields allergy_duration_unit" %>
                    </div>
                  </div>
                  <div class="col-md-6 col-sm-6 col-xs-6">
                    <div class="complaint_title">
                      <%= text_field_tag  commen_form+"[allergy_histories_attributes][#{i}][comment]", "",class: "form-control personal_field_add_comment", placeholder: "Comment ....", value: complaint.comment %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_type]",  "",class: "form-control", value: complaint.allergy_type %>
                      <%= hidden_field_tag commen_form+"[allergy_histories_attributes][#{i}][allergy_subtype]", "", class: "form-control", value: complaint.allergy_subtype %>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
          <div class="col-md-12 col-sm-12 col-xs-12">
            <%= f.input :food_allergies_comment, wrapper_html: {:class=>"col-md-12 col-sm-12 col-xs-12"}, as: :text,  :label => false, :required => false, :input_html => {:class => "form-control food_allergies_comment", :rows => 2, :style => 'width:96%;', :required => false, :name => commen_form+"[food_allergies_comment]", :value => patient_data.read_attribute(:food_allergies_comment), placeholder: "Food Allergies Comment"} %>
          </div>
        </div>
      </fieldset>
    </div>
  </div>
    <%# end %>
</div>
<div class="col-md-12 col-sm-12 col-xs-12" style="margin-top: 20px;">
  <div class="col-md-2 col-ms-2 col-xs-2">
    <h5 class="">Other</h5>
  </div>
  <div class="col-md-10 col-sm-10 col-xs-10">
    <%= text_field_tag commen_form+"[others_allergies]","",name: commen_form+"[others_allergies]", value: patient_data.others_allergies, class:"",id:"opdrecord_others_allergies", style:"padding-left: 10px; padding-left: 10px; height: 37px; width: 60%;" %>
  </div>
</div>

<script>
  if("<%= commen_form %>" == 'inpatient_ipd_record'){
    $('.astrick').hide()
  } else{
    $('.astrick').show()
  }

  var special_status = $("#<%= commen_form %>_specialstatus").val()
  if(special_status != "" && special_status != null){

    $("#clear_special_status").css("display", "inherit");
  }

  $("#clear_special_status").on('click', function(){
      $("#<%= commen_form %>_specialstatus").val("");
      $("#<%= commen_form %>_specialstatus").parent().prev().children().removeClass("btn-brown");
      $("#clear_special_status").css("display", "none")
  })
</script>

<script>
  $(".specialstatus_buttons").on('click', function(){
     $("#clear_special_status").css("display", "inherit");
  })
</script>
<script>
  $(".speciality_button").on('click', function(){
    var name_field = $(this).attr('data-value');
    var length = $(".specility_field_row").length;
    var name = name_field.split("_").join(" ").toString();
    var fields_line = "<div class='col-md-12 col-sm-12 col-xs-12 complaint_name specility_field_row "+name_field+"_fields '><div class='col-md-2 col-sm-2 col-xs-2'><h5 class='complaint_title'>"+ name.replace(/\b\w/g, l => l.toUpperCase())+"<input type='hidden' class='form-control "+name_field+"_destroy' name='<%= commen_form %>[speciality_history_records_attributes]["+length+"][_destroy]'> <input type='hidden' name='<%= commen_form %>[speciality_history_records_attributes]["+length+"][name]' value="+name_field+"><input type='hidden' name='<%= commen_form %>[speciality_history_records_attributes]["+length+"][l_hidden_duration]' class='l_hidden_duration'><input type='hidden' name='<%= commen_form %>[speciality_history_records_attributes]["+length+"][r_hidden_duration]' class='r_hidden_duration' ></h5></div><div class='col-md-3 col-sm-3 col-xs-3 left_side_value'><div class='complaint_title col-md-6 col-sm-6 col-xs-6'><select name='<%= commen_form %>[speciality_history_records_attributes]["+length+"][r_duration]' class='form-control personal_field_add_field speciality_r_duration r_duration_field'><option value=''>Please Select</option><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option><option value='13'>13</option><option value='14'>14</option><option value='15'>15</option><option value='16'>16</option><option value='17'>17</option><option value='18'>18</option><option value='19'>19</option><option value='20'>20</option><option value='21'>21</option><option value='22'>22</option><option value='23'>23</option><option value='24'>24</option><option value='25'>25</option><option value='26'>26</option><option value='27'>27</option><option value='28'>28</option><option value='29'>29</option><option value='30'>30</option><option value='31'>31</option><option value='32'>32</option><option value='33'>33</option><option value='34'>34</option><option value='35'>35</option><option value='36'>36</option><option value='21'>21</option><option value='37'>37</option><option value='38'>38</option><option value='39'>39</option><option value='40'>40</option></select></div><div class='complaint_title col-md-6 col-sm-6 col-xs-6'><select name='<%= commen_form %>[speciality_history_records_attributes]["+length+"][r_duration_unit]' class='form-control personal_field_add_field speciality_r_duration_unit r_duration_unit'><option value=''>Please Select</option><option value='days'>Days</option><option value='weeks'>Weeks</option><option value='months'>Months</option><option value='years'>Years</option></select></div></div><div class='col-md-1 col-sm-1 col-xs-1 speciality_history_row'><div class='col-md-12 ccl-sm-12 col-xs-12'><center><div class='complaint_title copy_arrow_button'><i class='fa fa-arrow-right ' aria-hidden='true' style='color: #46b8da;'></i></div></center></div></div><div class='col-md-3 col-sm-3 col-xs-3 left_side_value'><div class='complaint_title col-md-6 col-sm-6 col-xs-6'><select name='<%= commen_form %>[speciality_history_records_attributes]["+length+"][l_duration]' class='form-control personal_field_add_field speciality_l_duration l_duration_field'><option value=''>Please Select</option><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option><option value='13'>13</option><option value='14'>14</option><option value='15'>15</option><option value='16'>16</option><option value='17'>17</option><option value='18'>18</option><option value='19'>19</option><option value='20'>20</option><option value='21'>21</option><option value='22'>22</option><option value='23'>23</option><option value='24'>24</option><option value='25'>25</option><option value='26'>26</option><option value='27'>27</option><option value='28'>28</option><option value='29'>29</option><option value='30'>30</option><option value='31'>31</option><option value='32'>32</option><option value='33'>33</option><option value='34'>34</option><option value='35'>35</option><option value='36'>36</option><option value='21'>21</option><option value='37'>37</option><option value='38'>38</option><option value='39'>39</option><option value='40'>40</option></select></div><div class='complaint_title col-md-6 col-sm-6 col-xs-6'><select name='<%= commen_form %>[speciality_history_records_attributes]["+length+"][l_duration_unit]' class='form-control personal_field_add_field speciality_l_duration_unit l_duration_unit'><option value=''>Please Select</option><option value='days'>Days</option><option value='weeks'>Weeks</option><option value='months'>Months</option><option value='years'>Years</option></select></div></div><div class='col-md-3 col-sm-3 col-xs-3'><div class='complaint_title'><input type='text' class='form-control personal_field_add_field' name='<%= commen_form %>[speciality_history_records_attributes]["+length+"][comment]' placeholder='Comment...' style='width:100%;'></div></div></div>"
    var count_class= $('.'+name_field+'_fields').length;
    if(count_class == 1){
      $('.'+name_field+'_fields').toggle(0.5, function(){
        if($('.'+name_field+'_fields').is(":visible")){
          $('.'+name_field+'_destroy').val("0");
        }else{
          $('.'+name_field+'_destroy').val("1");
        }
      });
    }else{
      $(fields_line).appendTo("#speciality_fields_add").fadeIn('slow');

    }
  })

  $(".personal_button").on('click', function(){
    var name_field = $(this).attr('data-value');
    var length = $(".personal_field_row").length;
    var name = name_field.split("_").join(" ").toString();
     var fields_line = "<div class='col-md-12 col-sm-12 col-xs-12 complaint_name personal_field_row "+name_field+"_fields '><div class='col-md-2 col-sm-2 col-xs-2'><h5 class='complaint_title'><input type='hidden' class='form-control "+name_field+"_destroy'  name='<%= commen_form %>[personal_history_records_attributes]["+length+"][_destroy]'> "+name.replace(/\b\w/g, l => l.toUpperCase())+"<input type='hidden'name='<%= commen_form %>[personal_history_records_attributes]["+length+"][name]', value='"+name_field+"'><input type='hidden'name='<%= commen_form %>[personal_history_records_attributes]["+length+"][hidden_duration]' class='hidden_duration'></h5></div><div class='col-md-2 col-sm-2 col-xs-2'><div class='complaint_title'><select name='<%= commen_form %>[personal_history_records_attributes]["+length+"][duration]' class='form-control personal_field_add_field   duration_field'><option value=''>Please Select</option><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option><option value='13'>13</option><option value='14'>14</option><option value='15'>15</option><option value='16'>16</option><option value='17'>17</option><option value='18'>18</option><option value='19'>19</option><option value='20'>20</option><option value='21'>21</option><option value='22'>22</option><option value='23'>23</option><option value='24'>24</option><option value='25'>25</option><option value='26'>26</option><option value='27'>27</option><option value='28'>28</option><option value='29'>29</option><option value='30'>30</option><option value='31'>31</option><option value='32'>32</option><option value='33'>33</option><option value='34'>34</option><option value='35'>35</option><option value='36'>36</option><option value='21'>21</option><option value='37'>37</option><option value='38'>38</option><option value='39'>39</option><option value='40'>40</option></select></div></div><div class='col-md-2 col-sm-2 col-xs-2'><div class='complaint_title'><select name='<%= commen_form %>[personal_history_records_attributes]["+length+"][duration_unit]' class='form-control personal_field_add_field duration_unit'><option value=''>Please Select</option><option value='days'>Days</option><option value='weeks'>Weeks</option><option value='months'>Months</option><option value='years'>Years</option></select></div></div><div class='col-md-6 col-sm-6 col-xs-6'><div class='complaint_title'><input type='text', class='form-control personal_field_add_comment' name='<%= commen_form %>[personal_history_records_attributes]["+length+"][comment]'  placeholder='Comment...'><input type='hidden' name='<%= commen_form %>[personal_history_records_attributes]["+length+"][history_started]' class='history_started_persnoal' >"
    var count_class= $('.'+name_field+'_fields').length;
    if(count_class == 1){
      $('.'+name_field+'_fields').toggle(0.5, function(){
        if($('.'+name_field+'_fields').is(":visible")){
          $('.'+name_field+'_destroy').val("0");
        }else{
          $('.'+name_field+'_destroy').val("1");
        }
      });
    }else{
      $(fields_line).appendTo("#personal_fields_add").fadeIn('slow');

    }
  })

  $(".allergies_button").on('click', function(){
    var name_field = $(this).attr('data-value');

    $('.'+name_field+'_check').toggle(0.5, function(){
      if($('.'+name_field+'_check').is(":visible")){
        $('.'+name_field+'_title_f').css("display", "block");
      }else{
        $("#<%= commen_form %>_"+name_field).val("");
        $("."+name_field+"_button").removeClass("btn-darkblue");
        $("."+name_field+"_hide").css("display", "none");
        $("."+name_field+"_destroy").val("1");
        $('.'+name_field+'_title_f').css("display", "none");
      }
    });

  })

  $(".drug_agents_button").on('click', function(){
    var name_field =  $(this).attr('data-value');
     var destroy_name = $(this).attr('name')
    var length = $(".allergies_fields_row_count").length
    var name = name_field.split("_").join(" ").toString();

    if(name_field == "ampicillin" || name_field== "amoxicillin" || name_field == "ceftriaxone" || name_field == "ciprofloxacin" || name_field == "clarithromycin" || name_field == "co_trimoxazole" ||  name_field == "ethambutol" || name_field == "isoniazid" || name_field == "metronidazole" || name_field == "penicillin" || name_field == "rifampicin" || name_field == "streptomycin"){
      var allergy_type = "drug_allergies"
      var allergy_subtype = $(this).attr('name');
    }else if(name_field == "ketoconazole" || name_field == "fluconazole" || name_field == "itraconazole"){
      var allergy_type = "drug_allergies"
      var allergy_subtype = $(this).attr('name');
    }else if(name_field == "acyclovir" || name_field == "efavirenz" || name_field == "enfuvirtide" || name_field == "nelfinavir" || name_field == "nevirapine" || name_field == "zidovudine" ){
      var allergy_type = "drug_allergies"
      var allergy_subtype = $(this).attr('name');
    }else if(name_field == "aspirin" || name_field == "paracetamol" || name_field == "ibuprofen" || name_field == "diclofenac" || name_field == "aceclofenac" || name_field == "naproxen"){
      var allergy_type = "drug_allergies"
      var allergy_subtype = $(this).attr('name');
    }else if(name_field == "tropicamide_p" || name_field == "tropicamide" || name_field == "timolol" || name_field == "moxifloxacin" || name_field == "homide" || name_field == "latanoprost" || name_field == "brimonidine" || name_field == "travoprost" || name_field == "tobramycin" || name_field == "homatropine" || name_field == "pilocarpine" || name_field == "cyclopentolate" || name_field == "atropine" || name_field == "phenylephrine"  || name_field == "tropicacyl"  || name_field == "paracain" || name_field == "ciplox" || name_field == "tropicamide_p_distilled_water" || name_field == "tropicamide_p_lubrex" ){
      var allergy_type = "drug_allergies"
      var allergy_subtype = $(this).attr('name');
    }else if(name_field == "alcohol" || name_field == "latex" || name_field == "betadine" ||  name_field == "adhesive_tape" || name_field == "tegaderm" ||name_field == "transpore" ){
      var allergy_type = "contact_allergies"
      var allergy_subtype = ""
    }else if(name_field == "all_seafood" || name_field == "corn" || name_field == "egg" ||  name_field == "milk_proteins" || name_field == "peanuts" || name_field == "shellfish_only" || name_field == "soy_protein" || name_field == "lactose" || name_field == "mushroom" ){
      var allergy_type = "food_allergies"
      var allergy_subtype = ""
    }

    var fields_line = "<div class='col-md-12 col-sm-12 col-xs-12 complaint_name allergies_fields_row_count "+name_field+"_fields "+destroy_name+"_hide'><div class='col-md-2 col-sm-2 col-xs-2'><h5 class='complaint_title'><input type='hidden' class='form-control "+name_field+"_destroy "+destroy_name+"_destroy'  name='<%= commen_form %>[allergy_histories_attributes]["+length+"][_destroy]'> "+name.replace(/\b\w/g, l => l.toUpperCase())+"<input type='hidden'name='<%= commen_form %>[allergy_histories_attributes]["+length+"][name]', value='"+name_field+"'><input type='hidden'name='<%= commen_form %>[allergy_histories_attributes]["+length+"][hidden_duration]' class='allergy_hidden_duration'></h5></div><div class='col-md-2 col-sm-2 col-xs-2'><div class='complaint_title'><select name='<%= commen_form %>[allergy_histories_attributes]["+length+"][duration]' class='form-control allergy_fields_add_field allergy_duration'><option value=''>Please Select</option><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option><option value='13'>13</option><option value='14'>14</option><option value='15'>15</option><option value='16'>16</option><option value='17'>17</option><option value='18'>18</option><option value='19'>19</option><option value='20'>20</option><option value='21'>21</option><option value='22'>22</option><option value='23'>23</option><option value='24'>24</option><option value='25'>25</option><option value='26'>26</option><option value='27'>27</option><option value='28'>28</option><option value='29'>29</option><option value='30'>30</option><option value='31'>31</option><option value='32'>32</option><option value='33'>33</option><option value='34'>34</option><option value='35'>35</option><option value='36'>36</option><option value='21'>21</option><option value='37'>37</option><option value='38'>38</option><option value='39'>39</option><option value='40'>40</option></select></div></div><div class='col-md-2 col-sm-2 col-xs-2'><div class='complaint_title'><select name='<%= commen_form %>[allergy_histories_attributes]["+length+"][duration_unit]' class='form-control allergy_fields_add_field allergy_duration_unit'><option value=''>Please Select</option><option value='days'>Days</option><option value='weeks'>Weeks</option><option value='months'>Months</option><option value='years'>Years</option></select></div></div><div class='col-md-6 col-sm-6 col-xs-6'><div class='complaint_title'><input type='text', class='form-control personal_field_add_comment' name='<%= commen_form %>[allergy_histories_attributes]["+length+"][comment]'  placeholder='Comment...'><input type='hidden' class='form-control' name='<%= commen_form %>[allergy_histories_attributes]["+length+"][allergy_type]' value= "+allergy_type+" ><input type='hidden' class='form-control' name='<%= commen_form %>[allergy_histories_attributes]["+length+"][allergy_subtype]' value= "+allergy_subtype+">"
    var count_class= $('.'+name_field+'_fields').length;
    if(count_class == 1){
      $('.'+name_field+'_fields').toggle(0.5, function(){
        if($('.'+name_field+'_fields').is(":visible")){
          $('.'+name_field+'_destroy').val("0");
        }else{
          $('.'+name_field+'_destroy').val("1");
        }
      });
    }else{
      if(name_field == "ampicillin" || name_field== "amoxicillin" || name_field == "ceftriaxone" || name_field == "ciprofloxacin" || name_field == "clarithromycin" || name_field == "co_trimoxazole" ||  name_field == "ethambutol" || name_field == "isoniazid" || name_field == "metronidazole" || name_field == "penicillin" || name_field == "rifampicin" || name_field == "streptomycin"){
        $(fields_line).appendTo("#antimicrobial_agents_button_main_hide").fadeIn('slow');
      }else if(name_field == "ketoconazole" || name_field == "fluconazole" || name_field == "itraconazole"){
        $(fields_line).appendTo("#antifungal_agents_main_hide").fadeIn('slow');
      }else if(name_field == "acyclovir" || name_field == "efavirenz" || name_field == "enfuvirtide" || name_field == "nelfinavir" || name_field == "nevirapine" || name_field == "zidovudine" ){
          $(fields_line).appendTo("#antiviral_agents_main_hide").fadeIn('slow');
      }else if(name_field == "aspirin" || name_field == "paracetamol" || name_field == "ibuprofen" || name_field == "diclofenac" || name_field == "aceclofenac" || name_field == "naproxen"){
        $(fields_line).appendTo("#nsaids_main_hide").fadeIn('slow');
      }else if(name_field == "tropicamide_p" || name_field == "tropicamide" || name_field == "timolol" || name_field == "moxifloxacin" || name_field == "homide" || name_field == "latanoprost" || name_field == "brimonidine" || name_field == "travoprost" || name_field == "tobramycin" || name_field == "homatropine" || name_field == "pilocarpine" || name_field == "cyclopentolate" || name_field == "atropine" || name_field == "phenylephrine"  || name_field == "tropicacyl"  || name_field == "paracain"  || name_field ==  "ciplox" || name_field == "tropicamide_p_distilled_water" || name_field == "tropicamide_p_lubrex"){
        $(fields_line).appendTo("#eye_drops_main_hide").fadeIn('slow');
      }else if(name_field == "alcohol" || name_field == "latex" || name_field == "betadine" ||  name_field == "adhesive_tape" || name_field == "tegaderm" ||name_field == "transpore" ){
        $(fields_line).appendTo("#contact_allergies_main_hide").fadeIn('slow');
      }else if(name_field == "all_seafood" || name_field == "corn" || name_field == "egg" ||  name_field == "milk_proteins" || name_field == "peanuts" || name_field == "shellfish_only" || name_field == "soy_protein" || name_field == "lactose" || name_field == "mushroom" ){
        $(fields_line).appendTo("#food_allergies_main_hide").fadeIn('slow');
      }
    }
  })
  </script>
  <script>
    $("#speciality_fields_add").on('click', '.copy_arrow_button', function(){
      r_duration = $(this).parent().parent().parent().prev().children().find(".r_duration_field").val();
      r_duration_unit = $(this).parent().parent().parent().prev().children().find(".r_duration_unit").val();
      l_duration = $(this).parent().parent().parent().next().children().find(".l_duration_field").val(r_duration);
      l_duration_unit = $(this).parent().parent().parent().next().children().find(".l_duration_unit").val(r_duration_unit);
      if(r_duration != "" && r_duration_unit != ""){
        l_hidden_duration =   $(this).parent().parent().parent().prev().prev().children().children(".l_hidden_duration").val(r_duration+"."+r_duration_unit);
      }else{
        l_hidden_duration =   $(this).parent().parent().parent().prev().prev().children().children(".l_hidden_duration").val("");
      }
    });
  </script>
  <script>


    var drug_antifungal = $(".record_antifungal_agents").val();
    if (drug_antifungal != "" && drug_antifungal != null){
      $(".antifungal_agents_check").css("display", "block");
    }
    var antiviral_agents = $(".record_antiviral_agents").val();
    if (antiviral_agents != "" && antiviral_agents != null){
      $(".antiviral_agents_check").css("display", "block");
    }
    var drug_opdrecord_nsaids = $(".record_nsaids").val();
    if (drug_opdrecord_nsaids != "" && drug_opdrecord_nsaids != null){
      $(".nsaids_check").css("display", "block");
    }
    var drug_eye_drops = $(".record_eye_drops").val();
    if (drug_eye_drops != ""  && drug_eye_drops != null ){
      $(".eye_drops_check").css("display", "block");
    }

    var drug_allergies_v = $("#<%= commen_form%>_drug_allergies").val()
    if (drug_allergies_v != "" && drug_allergies_v != null ){
        drug_aller_array = drug_allergies_v.split(",")
      if (drug_aller_array.includes("antimicrobial_agents")){
        $(".antimicrobial_agents_check").css("display", "block");
      }
      if (drug_aller_array.includes("antifungal_agents")){
        $(".antifungal_agents_check").css("display", "block");
      }
      if (drug_aller_array.includes("antiviral_agents")){
        $(".antiviral_agents_check").css("display", "block");
      }
      if( drug_aller_array.includes("nsaids")){
        $(".nsaids_check").css("display", "block");
      }
      if (drug_aller_array.includes("eye_drops")){
        $(".eye_drops_check").css("display", "block");
      }

    }
  </script>
<style type="text/css">
    .control-label {
        margin-bottom: 0px !important;
    }
    .addressline1, .addressline2 {
        margin-bottom: 11px;
    }

    .ckbox label, .rdio label {
      padding-left: 10px;
      cursor: pointer;
      margin-bottom: 8px !important;
    }
    .history_select{
      padding: 0px;
    }

    .rdio-primary input[type="radio"]:checked + label.changed:before {
        border-color: #bbb;
    }

    .rdio-primary input[type="radio"]:checked + label.changed:after {
        background-color: #FFF;
    }
    .allergies_fields_row_count{
      margin-bottom: 10px;
    }

</style>
<script>

  $(".history_checked_unchecked").each(function(e){
    if ($(this).prop("checked")== true){
      $(this).parents("span").next("span").show()
    }
    else {
      $(this).parents("span").next("span").hide()
    }
  })

  $(".history_checked_unchecked").on("click",function(){
    if ($(this).prop("checked")== true){
      $(this).parents("span").next("span").show()
    }
    else {
      $(this).parents("span").next("span").hide()
    }
  })

  jQuery("#patient_patient_history_attributes_patientpersonalhistory_attributes_problems, #patient_patient_history_attributes_patientallergyhistory_attributes_antimicrobialagents, #patient_patient_history_attributes_patientallergyhistory_attributes_antifungalagents, #patient_patient_history_attributes_patientallergyhistory_attributes_antiviralagents, #patient_patient_history_attributes_patientallergyhistory_attributes_contact, #patient_patient_history_attributes_patientallergyhistory_attributes_food,#patient_patient_history_attributes_patientallergyhistory_attributes_nsaids,#patient_patient_history_attributes_patientallergyhistory_attributes_eyedrops").select2({
      tags: true,
      tokenSeparators: [',', ';'],
      theme: "bootstrap",
      multiple: true
  });
</script>
<script>
  $("#personal_fields_add").on('change', '.duration_field', function(e){
    var duration = $(this).val();
    var duration_unit = $(this).parent().parent().next().children().children().val();
    if (duration_unit != "" && duration != ""){
      data = duration+'.'+duration_unit
      $(this).parent().parent().prev().children().children(".hidden_duration").val(data);
    }else{
      $(this).parent().parent().prev().children().children(".hidden_duration").val("");
    }
  })

  $("#personal_fields_add").on('change', '.duration_unit', function(){
    var duration_unit = $(this).val();
    var duration = $(this).parent().parent().prev().children().children().val();
    if(duration != "" && duration_unit != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().prev().children().children(".hidden_duration").val(data);
    }else{
       $(this).parent().parent().prev().prev().children().children(".hidden_duration").val("");
    }
  })
</script>

<script>
  $("#speciality_fields_add").on('change', '.l_duration_field', function(){
    var l_duration = $(this).val();
    var l_duration_unit = $(this).parent().next().children().val();
    if(l_duration_unit != "" && l_duration != ""){
      data  = l_duration+"."+l_duration_unit
      a = $(this).parent().parent().prev().prev().prev().children().children(".l_hidden_duration").val(data);
    }else{
      a = $(this).parent().parent().prev().prev().prev().children().children(".l_hidden_duration").val("");
    }
  })

  $("#speciality_fields_add").on('change', '.l_duration_unit', function(){
    var l_duration_unit = $(this).val();
    var l_duration = $(this).parent().prev().children().val();
    if(l_duration != "" && l_duration_unit != ""){
      data = l_duration+"."+l_duration_unit
      a = $(this).parent().parent().prev().prev().prev().children().children(".l_hidden_duration").val(data);
    }else{
       a = $(this).parent().parent().prev().prev().prev().children().children(".l_hidden_duration").val("");
    }
  })

  $("#speciality_fields_add").on('change', '.r_duration_field', function(){
    var r_duration = $(this).val();
    var r_duration_unit = $(this).parent().next().children().val();
    if(r_duration_unit != "" && r_duration != ""){
      var r_data = r_duration+"."+r_duration_unit;
      $(this).parent().parent().prev().children().children(".r_hidden_duration").val(r_data);
    }else{
      $(this).parent().parent().prev().children().children(".r_hidden_duration").val("");
    }
  })

  $("#speciality_fields_add").on('change', '.r_duration_unit', function(){
    var r_duration_unit = $(this).val();
    var r_duration = $(this).parent().prev().children().val();
    if(r_duration != "" && r_duration_unit != ""){
      var r_data = r_duration+"."+r_duration_unit
      $(this).parent().parent().prev().children().children(".r_hidden_duration").val(r_data);
    }else{
      $(this).parent().parent().prev().children().children(".r_hidden_duration").val("");
    }
  })
</script>

<script>
$('.readonlyjm').on('focus',function(){
  $(this).trigger('blur');
});
</script>

<script>
  $("#eye_drops_main_hide").on('change', '.allergy_duration', function(){
    var duration = $(this).val();
    var duration_unit = $(this).parent().parent().next().children().children().val();
    if(duration_unit != "" && duration != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val(data);
    }else{
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val("");
    }
  })

  $("#eye_drops_main_hide").on('change', '.allergy_duration_unit', function(){
    var duration_unit = $(this).val();
    var duration = $(this).parent().parent().prev().children().children().val();
    if(duration != "" && duration_unit != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val(data);
    }else{
       $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val("");
    }
  })
</script>

<script>
  $("#nsaids_main_hide").on('change', '.allergy_duration', function(){
    var duration = $(this).val();
    var duration_unit = $(this).parent().parent().next().children().children().val();
    if(duration_unit != "" && duration != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val(data);
    }else{
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val("");
    }
  })

  $("#nsaids_main_hide").on('change', '.allergy_duration_unit', function(){
    var duration_unit = $(this).val();
    var duration = $(this).parent().parent().prev().children().children().val();
    if(duration != "" && duration_unit != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val(data)
    }else{
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val("")
    }
  })
</script>
<script>
  $("#antiviral_agents_main_hide").on('change', '.allergy_duration', function(){
    var duration = $(this).val();
    var duration_unit = $(this).parent().parent().next().children().children().val();
    if(duration_unit != "" && duration != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val(data);
    }else{
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val("");
    }
  })

  $("#antiviral_agents_main_hide").on('change', '.allergy_duration_unit', function(){
    var duration_unit = $(this).val();
    var duration = $(this).parent().parent().prev().children().children().val();
    if(duration != "" && duration_unit != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val(data)
    }else{
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val("")
    }
  })
</script>

<script>
  $("#antifungal_agents_main_hide").on('change', '.allergy_duration', function(){
    var duration = $(this).val();
    var duration_unit = $(this).parent().parent().next().children().children().val();
    if(duration_unit != "" && duration != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val(data);
    }else{
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val("");
    }
  })

  $("#antifungal_agents_main_hide").on('change', '.allergy_duration_unit', function(){
    var duration_unit = $(this).val();
    var duration = $(this).parent().parent().prev().children().children().val();
    if(duration != "" && duration_unit != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val(data)
    }else{
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val("")
    }
  })
</script>

<script>
  $("#antimicrobial_agents_button_main_hide").on('change', '.allergy_duration', function(){
    var duration = $(this).val();
    var duration_unit = $(this).parent().parent().next().children().children().val();
    if(duration_unit != "" && duration != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val(data);
    }else{
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val("");
    }
  })

  $("#antimicrobial_agents_button_main_hide").on('change', '.allergy_duration_unit', function(){
    var duration_unit = $(this).val();
    var duration = $(this).parent().parent().prev().children().children().val();
    if(duration != "" && duration_unit != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val(data)
    }else{
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val("")
    }
  })
</script>

<script>
  $("#contact_allergies_main_hide").on('change', '.allergy_duration', function(){
    var duration = $(this).val();
    var duration_unit = $(this).parent().parent().next().children().children().val();
    if(duration_unit != "" && duration != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val(data);
    }else{
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val("");
    }
  })

  $("#contact_allergies_main_hide").on('change', '.allergy_duration_unit', function(){
    var duration_unit = $(this).val();
    var duration = $(this).parent().parent().prev().children().children().val();
    if(duration != "" && duration_unit != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val(data)
    }else{
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val("")
    }
  })
</script>

<script>
  $("#food_allergies_main_hide").on('change', '.allergy_duration', function(){
    var duration = $(this).val();
    var duration_unit = $(this).parent().parent().next().children().children().val();
    if(duration_unit != "" && duration != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val(data);
    }else{
      $(this).parent().parent().prev().children().children(".allergy_hidden_duration").val("");
    }
  })

  $("#food_allergies_main_hide").on('change', '.allergy_duration_unit', function(){
    var duration_unit = $(this).val();
    var duration = $(this).parent().parent().prev().children().children().val();
    if(duration != "" && duration_unit != ""){
      data = duration+"."+duration_unit
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val(data)
    }else{
      $(this).parent().parent().prev().prev().children().children(".allergy_hidden_duration").val("")
    }
  })
</script>
<style>
  .cc_border
  {
    width: 98%;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-top: 15px;
    margin-left: 12px;
  }
  .cc_label
  {
    top: -10px;
  }

  .ckbox label, .rdio label {
    padding-left: 10px;
    cursor: pointer;
    margin-bottom: 8px !important;
  }
  .copy_arrow_button{
    color: #46b8da;
    cursor: pointer;
  }
  .table>tbody>tr>th{
    border-top: 0px solid #ddd;
  }
  .complaint_main_comment{
    font-size: 18px;
    color: #444;
    margin-left: 20px;
  }

  .complaint_title{
    color: #444;
    font-size: 15px;

  }
  .personal_field_add_field{
    height: 30px !important;
    border: 1px solid #ccc !important;
    padding: 0px !important;
    color: #666 !important;
    width: 100% !important;
    padding-left: 10px;
  }
  .allergy_fields_add_field{
    height: 30px !important;
    border: 1px solid #ccc !important;
    color: #666 !important;
    padding: 0px !important;
    width: 100% !important;
  }
  .speciality_fields_add_fields{
    height: 30px;
    border: 1px solid #ccc;
    color: #666;
    width: 100% !important;
    padding: 0px !important;
  }
  .complaint_field_add_comment{
    width: 100% !important;
    border: 1px solid #ccc;
    border-radius: 3px;
    height: 30px;
    color: #666;
  }
  .speciality_field_add_comment{
    width: 100% !important;
    border: 1px solid #ccc;
    border-radius: 3px;
    height: 30px;
    padding-left:10px !important;
    color: #666;
  }
  .counter_rows{
    margin-bottom: 10px;
  }
  #opdrecord_chiefcomplaint_comments{
    width: 98%;
    height: 90px;
    margin-top: 20px;
    margin-bottom: 20px;
  }
  #opdrecord_paediatrics_histories_antenatal_maternal_vaccination{
    margin: 0px 0px 5px 0px;
    width: 100%;
    height: 35px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  #opdrecord_paediatrics_histories_antenatal_maternal_infection{
     margin: 0px 0px 5px 0px;
    width: 100%;
    height: 35px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  #opdrecord_antenatal_maternal_infection{
    margin: 0px 0px 5px 0px;
    width: 100% !important;
    height: 35px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  #opdrecord_natal_birth_weight{
    margin: 0px 0px 5px 0px;
    width: 100% !important;
    height: 35px;
    border: 1px solid #ccc;
    border-radius: 4PX;
  }
  #opdrecord_lens_history_comment{
    margin: 0px 0px 5px 0px !important;
    width: 101% !important;
    height: 90px !important;
    margin-left: -15px !important;
    margin-bottom: 20px !important;
  }
  #opdrecord_other_histories_family_history{
    width: 100%;
    height: 35px;
    margin-left: -51px;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding-left: 10px;
  }
  #opdrecord_opthal_history_comment{
    width: 101%;
    height: 90px !important;
    margin-left: -10px;
  }
  .specility_field_row{
    margin-bottom: 10px;
  }
  .personal_field_row{
    margin-bottom: 10px;
  }
  .personal_fields_add_fields{
    width: 100% !important;
    height: 35px;
    border: 1px solid #ccc;
    color: #666;
    padding: 0px !important;
  }
  #opdrecord_history_comment{
    width: 100%;
    height: 90px;
    border: 1px solid #ccc;
    border-radius: 4px;
    color: #666;
  }
  .personal_field_add_comment{
    width: 60% !important;
    border: 1px solid #ccc;
    border-radius: 3px;
    height: 30px;
    color: #666;
    padding-left: 10px;
  }
  #opdrecord_other_histories_medical_history{
   width: 100%;
    height: 35px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-left: -55px;
    padding-left: 10px;
  }
  #opdrecord_lens_histories_lens_history_comment{
    width: 95%;
    margin-left: -6px !important;
    height: 90px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 20px !important;

  }
  .lens_histories_fields{
    width: 88% !important;
    padding: 6px;
    border: 1px solid #ccc;
    height: 35px;
    border-radius: 4px;
    margin-left: -6px !important;
    padding: 0px !important;
  }
  #opdrecord_lens_histories_comfort_level_time{
    padding: 5px 0px;
    height: 35px;
    width: 50%;
  }
  .lens_select_button{
    padding: 5px 0px;
    height: 35px;
    margin-left: -10px;
  }
  .f_complaint{
    text-align: center;
    color: #444;
  }
  #opdrecord_checkuptypecomments{
    height: 30px !important;
  }
  .Opth_his_name{
    text-align: center;
    color: #444;
    font-size: 13px;
  }
  #opdrecord_others_allergies{
        width: 97%;
    height: 90px;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  .complaint_button{
    height:33px !important;
    font-size: 12px;
  }
</style>
<script>
  $(".edit-history-btn").on('click', function(e){
    e.preventDefault();
    $(".visit-row").toggle()
    $(".eye-edit-row").toggle()
    $(".general-row").toggle()
    $(".show-history-view").toggle()
    $(".edit-history-btn-row").hide()
  })
</script>
<script>
  var eyedrops = $("#<%= commen_form %>_eye_drops").val();
  if(eyedrops != ""){
    $(".eye_drops_title_f").css("display", "block")
  }

  var nsaids = $("#<%= commen_form %>_nsaids").val();
  if(nsaids != ""){
    $(".nsaids_title_f").css("display", "block")
  }

  var antiviral_agents = $("#<%= commen_form %>_antiviral_agents").val();
  if(antiviral_agents != ""){
    $(".antiviral_agents_title_f").css("display", "block");
  }

  var antifungal_agents = $("#<%= commen_form %>_antifungal_agents").val();
  if(antifungal_agents != ""){
    $(".antifungal_agents_title_f").css("display", "block");
  }

  var antimicrobial_agents = $("#<%= commen_form %>_antimicrobial_agents").val();
  if(antimicrobial_agents != ""){
    $(".antimicrobial_agents_title_f").css("display", "block");
  }
</script>
