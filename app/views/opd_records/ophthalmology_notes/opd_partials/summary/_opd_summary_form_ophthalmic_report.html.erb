<% r_intraocularpressure_counter = 0 %>
<% r_intraocularpressure_op = '' %>
<% r_intraocularpressure = '' %>
<% r_intraocularpressure_time = '' %>
<% r_iop_method = '' %>
<% r_iop_comment = '' %>
<% r_intraocularpressure_comments = '' %>

<% if opdrecord.r_intraocularpressure.present? %>
  <% r_intraocularpressure = "#{opdrecord.read_attribute(:r_intraocularpressure)} mmHG" %>
  <% r_intraocularpressure_op = "#{r_intraocularpressure_op}#{r_intraocularpressure}" %>
  <% r_intraocularpressure_counter += 1 %>
<% end %>

<% if opdrecord.r_intraocularpressure.present? && opdrecord.r_intraocularpressure_time.present? %>
  <% r_intraocularpressure_time = opdrecord.read_attribute(:r_intraocularpressure_time).to_s %>
  <% r_intraocularpressure_op = "#{r_intraocularpressure_op} at #{r_intraocularpressure_time}" %>
  <% r_intraocularpressure_counter += 1 %>
<% end %>

<% if opdrecord.r_iop_method.present? %>
  <% r_iop_method = opdrecord.read_attribute(:r_iop_method).to_s %>
  <% r_intraocularpressure_op = "#{r_intraocularpressure_op} with #{r_iop_method}" %>
  <% r_intraocularpressure_counter += 1 %>
<% end %>

<% if opdrecord.r_intraocularpressure_comments.present? %>
  <% r_intraocularpressure_comments = opdrecord.read_attribute(:r_intraocularpressure_comments).to_s %>
  <% r_intraocularpressure_counter += 1 %>
<% end %>
<% if opdrecord.r_iop_comments.present? && opdrecord.r_iop_comments != "<br>" %>
  <% r_iop_comments = opdrecord.read_attribute(:r_iop_comments).to_s %>
  <% if r_intraocularpressure_comments.present? %>
      <% r_intraocularpressure_comments = "#{r_intraocularpressure_comments}, " %>
  <% end %>
  <% r_intraocularpressure_comments = "#{r_intraocularpressure_comments}#{r_iop_comments}".html_safe %>
  <% r_intraocularpressure_counter += 1 %>
<% end %>

<% l_intraocularpressure_counter = 0 %>
<% l_intraocularpressure_op = '' %>
<% l_intraocularpressure = '' %>
<% l_intraocularpressure_time = '' %>
<% l_iop_method = '' %>
<% l_iop_comment = '' %>
<% l_intraocularpressure_comments = '' %>

<% if opdrecord.l_intraocularpressure.present? %>
  <% l_intraocularpressure = "#{opdrecord.read_attribute(:l_intraocularpressure)} mmHG" %>
  <% l_intraocularpressure_op = "#{l_intraocularpressure_op}#{l_intraocularpressure}" %>
  <% l_intraocularpressure_counter += 1 %>
<% end %>
<% if opdrecord.l_intraocularpressure.present? && opdrecord.l_intraocularpressure_time.present? %>
  <% l_intraocularpressure_time = opdrecord.read_attribute(:l_intraocularpressure_time).to_s %>
  <% l_intraocularpressure_op = "#{l_intraocularpressure_op} at #{l_intraocularpressure_time}" %>
  <% l_intraocularpressure_counter += 1 %>
<% end %>
<% if opdrecord.l_iop_method.present? %>
  <% l_iop_method = opdrecord.read_attribute(:l_iop_method).to_s %>
  <% l_intraocularpressure_op = "#{l_intraocularpressure_op} with #{l_iop_method}" %>
  <% l_intraocularpressure_counter += 1 %>
<% end %>
<% if opdrecord.l_intraocularpressure_comments.present? %>
  <% l_intraocularpressure_comments = opdrecord.read_attribute(:l_intraocularpressure_comments).to_s %>
  <% l_intraocularpressure_counter += 1 %>
<% end %>

<% if opdrecord.l_iop_comments.present? && opdrecord.l_iop_comments != "<br>" %>
  <% l_iop_comments = opdrecord.read_attribute(:l_iop_comments).to_s %>
  <% if l_intraocularpressure_comments.present? %>
      <% l_intraocularpressure_comments = "#{l_intraocularpressure_comments}, " %>
  <% end %>
  <% l_intraocularpressure_comments = "#{l_intraocularpressure_comments}#{l_iop_comments}".html_safe %>
  <% l_intraocularpressure_counter += 1 %>
<% end %>
<!--============================================-->

<% r_visualacuity_counter = 0 %>
<% r_visualacuity_op = '' %>

<% r_visualacuity_unaided = '' %>
<% r_visualacuity_unaided_p = '' %>
<% r_visualacuity_pinhole = '' %>
<% r_visualacuity_pinhole_p = '' %>
<% r_visualacuity_pinhole_ni = '' %>
<% r_visualacuity_glasses = '' %>
<% r_visualacuity_glasses_p = '' %>
<% r_visualacuity_near = '' %>
<% r_visualacuity_ua_s = '' %>
<% r_visualacuity_ua_n = '' %>
<% r_visualacuity_ua_i = '' %>
<% r_visualacuity_ua_t = '' %>
<% r_visualacuity_near_p = '' %>
<% r_visualacuity_ua_near = '' %>
<% r_visualacuity_ua_near_p = '' %>

<% if opdrecord.read_attribute(:r_visualacuity_unaided_p).present? %>
  <% r_visualacuity_unaided_p = "(#{opdrecord.read_attribute(:r_visualacuity_unaided_p)})" %>
<% end %>
<% unless opdrecord.r_visualacuity_unaided.blank? %>
  <% r_visualacuity_unaided = "UCVA - #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:r_visualacuity_unaided))}#{r_visualacuity_unaided_p}" %>
  <% r_visualacuity_op = r_visualacuity_unaided.to_s %>
  <% r_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.read_attribute(:r_visualacuity_ua_near_p).present? %>
  <% r_visualacuity_ua_near_p = "(#{opdrecord.read_attribute(:r_visualacuity_ua_near_p)})" %>
<% end %>
<% unless opdrecord.r_visualacuity_ua_near.blank? %>
  <% r_visualacuity_ua_near = "UCVA Near- #{opdrecord.read_attribute(:r_visualacuity_ua_near)}#{r_visualacuity_ua_near_p}" %>
  <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_ua_near}" %>
  <% r_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.r_visualacuity_ua_s.present? %>
  <% r_visualacuity_ua_s = "S#{opdrecord.read_attribute(:r_visualacuity_ua_s)}" %>
  <% r_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.r_visualacuity_ua_i.present? %>
  <% r_visualacuity_ua_i = "I#{opdrecord.read_attribute(:r_visualacuity_ua_i)}" %>
  <% r_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.r_visualacuity_ua_n.present? %>
  <% r_visualacuity_ua_n = "N#{opdrecord.read_attribute(:r_visualacuity_ua_n)}" %>
  <% r_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.r_visualacuity_ua_t.present? %>
  <% r_visualacuity_ua_t = "T#{opdrecord.read_attribute(:r_visualacuity_ua_t)}" %>
  <% r_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.read_attribute(:r_visualacuity_pinhole_p).present? %>
  <% r_visualacuity_pinhole_p = "(#{opdrecord.read_attribute(:r_visualacuity_pinhole_p)})" %>
<% end %>
<% if opdrecord.read_attribute(:r_visualacuity_pinhole_ni).present? %>
  <% r_visualacuity_pinhole_ni = "(#{opdrecord.read_attribute(:r_visualacuity_pinhole_ni)})" %>
<% end %>
<% unless opdrecord.r_visualacuity_pinhole.blank? %>
  <% r_visualacuity_pinhole = "PH- #{opdrecord.read_attribute(:r_visualacuity_pinhole)}#{r_visualacuity_pinhole_p}#{r_visualacuity_pinhole_ni}" %>
  <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_pinhole}" %>
  <% r_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.read_attribute(:r_visualacuity_glasses_p).present? %>
  <% r_visualacuity_glasses_p = "(#{opdrecord.read_attribute(:r_visualacuity_glasses_p)})" %>
<% end %>
<% unless opdrecord.r_visualacuity_glasses.blank? %>
  <% r_visualacuity_glasses = "Glasses- #{opdrecord.read_attribute(:r_visualacuity_glasses)}#{r_visualacuity_glasses_p}" %>
  <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_glasses}" %>
  <% r_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.read_attribute(:r_visualacuity_near_p).present? %>
  <% r_visualacuity_near_p = "(#{opdrecord.read_attribute(:r_visualacuity_near_p)})" %>
<% end %>
<% unless opdrecord.r_visualacuity_near.blank? %>
  <% r_visualacuity_near = "Glasses Near- #{opdrecord.read_attribute(:r_visualacuity_near)}#{r_visualacuity_near_p}" %>
  <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_near}" %>
  <% r_visualacuity_counter += 1 %>
<% end %>

<% l_visualacuity_counter = 0 %>
<% l_visualacuity_op = '' %>
<% l_visualacuity_unaided = '' %>
<% l_visualacuity_unaided_p = '' %>
<% l_visualacuity_pinhole = '' %>
<% l_visualacuity_pinhole_p = '' %>
<% l_visualacuity_pinhole_ni = '' %>
<% l_visualacuity_glasses = '' %>
<% l_visualacuity_glasses_p = '' %>
<% l_visualacuity_near = '' %>
<% l_visualacuity_ua_s = '' %>
<% l_visualacuity_ua_n = '' %>
<% l_visualacuity_ua_i = '' %>
<% l_visualacuity_ua_t = '' %>
<% l_visualacuity_near_p = '' %>
<% l_visualacuity_ua_near = '' %>
<% l_visualacuity_ua_near_p = '' %>

<% if opdrecord.read_attribute(:l_visualacuity_unaided_p).present? %>
  <% l_visualacuity_unaided_p = "(#{opdrecord.read_attribute(:l_visualacuity_unaided_p)})" %>
<% end %>
<% unless opdrecord.l_visualacuity_unaided.blank? %>
    <% l_visualacuity_unaided = "UCVA - #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:l_visualacuity_unaided))}#{l_visualacuity_unaided_p}" %>
    <% l_visualacuity_op = l_visualacuity_unaided.to_s %>
    <% l_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.read_attribute(:l_visualacuity_ua_near_p).present? %>
    <% l_visualacuity_ua_near_p = "(#{opdrecord.read_attribute(:l_visualacuity_ua_near_p)})" %>
<% end %>
<% unless opdrecord.l_visualacuity_ua_near.blank? %>
    <% l_visualacuity_ua_near = "UCVA Near- #{opdrecord.read_attribute(:l_visualacuity_ua_near)}#{l_visualacuity_ua_near_p}" %>
    <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_ua_near}" %>
    <% l_visualacuity_counter += 1 %>
<% end %>

<% if opdrecord.l_visualacuity_ua_s.present? %>
    <% l_visualacuity_ua_s = "S#{opdrecord.read_attribute(:l_visualacuity_ua_s)}" %>
    <% l_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.l_visualacuity_ua_i.present? %>
    <% l_visualacuity_ua_i = "I#{opdrecord.read_attribute(:l_visualacuity_ua_i)}" %>
    <% l_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.l_visualacuity_ua_n.present? %>
    <% l_visualacuity_ua_n = "N#{opdrecord.read_attribute(:l_visualacuity_ua_n)}" %>
    <% l_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.l_visualacuity_ua_t.present? %>
    <% l_visualacuity_ua_t = "T#{opdrecord.read_attribute(:l_visualacuity_ua_t)}" %>
    <% l_visualacuity_counter += 1 %>
<% end %>

<% if opdrecord.read_attribute(:l_visualacuity_pinhole_p).present? %>
    <% l_visualacuity_pinhole_p = "(#{opdrecord.read_attribute(:l_visualacuity_pinhole_p)})" %>
<% end %>
<% if opdrecord.read_attribute(:l_visualacuity_pinhole_ni).present? %>
    <% l_visualacuity_pinhole_ni = "(#{opdrecord.read_attribute(:l_visualacuity_pinhole_ni)})" %>
<% end %>
<% unless opdrecord.l_visualacuity_pinhole.blank? %>
    <% l_visualacuity_pinhole = "PH- #{opdrecord.read_attribute(:l_visualacuity_pinhole)}#{l_visualacuity_pinhole_p}#{l_visualacuity_pinhole_ni}" %>
    <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_pinhole}" %>
    <% l_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.read_attribute(:l_visualacuity_glasses_p).present? %>
    <% l_visualacuity_glasses_p = "(#{opdrecord.read_attribute(:l_visualacuity_glasses_p)})" %>
<% end %>
<% unless opdrecord.l_visualacuity_glasses.blank? %>
    <% l_visualacuity_glasses = "Glasses- #{opdrecord.read_attribute(:l_visualacuity_glasses)}#{l_visualacuity_glasses_p}" %>
    <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_glasses}" %>
    <% l_visualacuity_counter += 1 %>
<% end %>
<% if opdrecord.read_attribute(:l_visualacuity_near_p).present? %>
    <% l_visualacuity_near_p = "(#{opdrecord.read_attribute(:l_visualacuity_near_p)})" %>
<% end %>
<% unless opdrecord.l_visualacuity_near.blank? %>
    <% l_visualacuity_near = "Glasses Near- #{opdrecord.read_attribute(:l_visualacuity_near)}#{l_visualacuity_near_p}" %>
    <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_near}" %>
    <% l_visualacuity_counter += 1 %>
<% end %>

<!--===============================================================-->
<% r_appearance_counter = 0 %>
<% r_appearance_op = '' %>
<% r_appearance_phthisisbulbi = '' %>
<% r_appearance_anophthalmos = '' %>
<% r_appearance_micropththalmos = '' %>
<% r_appearance_artificial = '' %>
<% r_appearance_proptosis = '' %>
<% r_appearance_dystopia = '' %>
<% r_appearance_injured = '' %>
<% r_appearance_swollen = '' %>
<% r_appearance_comments = '' %>

<% r_scleracommon_counter = 0 %>
<% r_scleracommon_comments = '' %>

<% r_trauma_counter = 0 %>
<% r_trauma_op = '' %>
<% r_trauma_comment = 0 %>

<% r_extraocularmovements_counter = 0 %>
<% r_extraocularmovements_op = '' %>
<% r_extraocularmovements_comments_op = '' %>
<% r_extraocularmovements_comments = '' %>
<% r_extraocularmovements_uniocular = '' %>
<% r_extraocularmovements_binocular = '' %>
<% r_extraocularmovements_prism = '' %>
<% r_extraocularmovements_squint = '' %>
<% r_extraocularmovements_squint_tropia = '' %>
<% r_extraocularmovements_squint_tropia_horizontal = '' %>
<% r_extraocularmovements_squint_tropia_horizontal_esotropia = '' %>
<% r_extraocularmovements_squint_tropia_horizontal_exotropia = '' %>
<% r_extraocularmovements_squint_tropia_vertical = '' %>
<% r_extraocularmovements_squint_tropia_paralytic = '' %>
<% r_extraocularmovements_squint_phoria = '' %>

<% r_appendages_counter = 0 %>
<% r_appendages_op = '' %>
<% r_appendages_comments = 0 %>
<% r_eyelid_counter = 0 %>
<% r_eyelsahes_counter = 0 %>
<% r_lacrimar_counter = 0 %>
<% r_syringing_counter = 0 %>

<% r_conjunctiva_counter = 0 %>
<% r_conjunctiva_op = '' %>
<% r_conjunctiva_congestion = '' %>
<% r_conjunctiva_conjunctivitis = '' %>
<% r_conjunctiva_episcleritis = '' %>
<% r_conjunctiva_tear = '' %>
<% r_conjunctiva_subconjunctival_haemorrhage = '' %>
<% r_conjunctiva_foreign_body = '' %>
<% r_conjunctiva_follicles = '' %>
<% r_conjunctiva_papillae = '' %>
<% r_conjunctiva_pinguecula = '' %>
<% r_conjunctiva_pterygium = '' %>
<% r_conjunctiva_phlycten = '' %>
<% r_conjunctiva_discharge = '' %>

<% r_cornea_counter = 0 %>
<% r_cornea_op = '' %>
<% r_cornea_size = '' %>
<% r_cornea_shape = '' %>
<% r_cornea_surface = '' %>
<% r_cornea_schirmer_test = '' %>
<% r_cornea_comments_op = '' %>
<% r_cornea_comments = '' %>

<% r_anteriorchamber_counter = 0 %>
<% r_anteriorchamber_op = '' %>
<% r_anteriorchamber_comments_op = '' %>
<% r_anteriorchamber_comments = '' %>
<% r_anteriorchamber_depth = '' %>
<% r_anteriorchamber_reaction = '' %>
<% r_anteriorchamber_cells = '' %>
<% r_anteriorchamber_flare = '' %>
<% r_anteriorchamber_hyphema = '' %>
<% r_anteriorchamber_hypopyon = '' %>
<% r_anteriorchamber_foreignbody = '' %>

<% r_anteriorchamber_depth_comment = '' %>
<% r_anteriorchamber_reaction_comment = '' %>
<% r_anteriorchamber_cells_comment = '' %>
<% r_anteriorchamber_flare_comment = '' %>
<% r_anteriorchamber_hyphema_comment = '' %>
<% r_anteriorchamber_hypopyon_comment = '' %>
<% r_anteriorchamber_foreignbody_comment = '' %>

<% r_pupil_counter = 0 %>
<% r_pupil_op = '' %>
<% r_pupil_comments_op = '' %>
<% r_pupil_comments = '' %>
<% r_pupil_shape = '' %>
<% r_pupil_reaction_to_light_direct = '' %>
<% r_pupil_reaction_to_light_consensual = '' %>
<% r_pupil_rapd = '' %>

<% r_iris_counter = 0 %>
<% r_iris_op = '' %>
<% r_iris_comments_op = '' %>
<% r_iris_comments = '' %>
<% r_iris_shape = '' %>
<% r_iris_neovascularisation = '' %>
<% r_iris_synechiae = '' %>

<% r_lens_counter = 0 %>
<% r_lens_op = '' %>
<% r_lens_comments_op = '' %>
<% r_lens_comments = '' %>
<% r_lens_nature = '' %>
<% r_lens_position = '' %>
<% r_lens_size = '' %>
<% r_lens_grading_no = '' %>
<% r_lens_grading_nc = '' %>
<% r_lens_grading_c = '' %>
<% r_lens_grading_p = '' %>

<% unless opdrecord.r_appearance.blank? %>
  <% unless opdrecord.r_appearance == "Normal" %>
      <% unless opdrecord.r_appearance_phthisisbulbi == "No" %>
          <% r_appearance_phthisisbulbi = 'Phthisis Bulbi,' %>
          <% r_appearance_op = r_appearance_phthisisbulbi.to_s %>
          <% r_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appearance_anophthalmos == "No" %>
          <% r_appearance_anophthalmos = 'Anophthalmos,' %>
          <% r_appearance_op = "#{r_appearance_op} #{r_appearance_anophthalmos}" %>
          <% r_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appearance_micropththalmos == "No" %>
          <% r_appearance_micropththalmos = 'Micropththalmos,' %>
          <% r_appearance_op = "#{r_appearance_op} #{r_appearance_micropththalmos}" %>
          <% r_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appearance_artificial == "No" %>
          <% r_appearance_artificial = 'Artificial,' %>
          <% r_appearance_op = "#{r_appearance_op} #{r_appearance_artificial}" %>
          <% r_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appearance_proptosis == "No" %>
          <% r_appearance_proptosis = 'Proptosis,' %>
          <% r_appearance_op = "#{r_appearance_op} #{r_appearance_proptosis}" %>
          <% r_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appearance_dystopia == "No" %>
          <% r_appearance_dystopia = 'Dystopia,' %>
          <% r_appearance_op = "#{r_appearance_op} #{r_appearance_dystopia}" %>
          <% r_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appearance_injured == "No" %>
          <% r_appearance_injured = 'Injured,' %>
          <% r_appearance_op = "#{r_appearance_op} #{r_appearance_injured}" %>
          <% r_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appearance_swollen == "No" %>
          <% r_appearance_swollen = 'Swollen,' %>
          <% r_appearance_op = "#{r_appearance_op} #{r_appearance_swollen}" %>
          <% r_appearance_counter += 1 %>
      <% end %>
      <% if opdrecord.r_appearance_comments.present? && opdrecord.r_appearance_comments != "<br>" %>
          <% r_appearance_comments = opdrecord.read_attribute(:r_appearance_comments).to_s %>
          <% r_appearance_comments_op = " #{r_appearance_comments}" %>
          <% r_appearance_counter += 1 %>
      <% end %>
      <!-- Code to Remove The Last Comma -->
      <% unless r_appearance_op.blank? %>
          <% r_appearance_op = r_appearance_op.split('') %>
          <% r_appearance_op_count = r_appearance_op.count %>
          <% if r_appearance_op_count > 0 %>
              <% r_appearance_op = (r_appearance_op.first r_appearance_op_count - 1).join %>
          <% end %>
      <% end %>
  <% end %>
<% end %>

<% unless opdrecord.r_scleracommon.blank? %>
  <% if opdrecord.r_scleracommon_comments.present? && opdrecord.r_scleracommon_comments != "<br>" %>
    <% r_scleracommon_comments = " #{opdrecord.read_attribute(:r_scleracommon_comments).to_s}" %>
    <% r_scleracommon_counter += 1 %>
  <% end %>
  <!-- Code to Remove The Last Comma -->
<% end %>

<% unless opdrecord.r_ocular_trauma.blank? %>
  <% if opdrecord.r_ocular_trauma == "Abnormal" %>
    <% unless opdrecord.r_ocular_trauma_injury.blank? %>
      <% r_trauma_counter += 1 %>
      <% trauma_result = opdrecord.r_ocular_trauma_injury %>
      <% if opdrecord.r_ocular_trauma_injury.downcase == "local" %>
        <% unless opdrecord.r_ocular_trauma_local.blank? %>
          <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_local.capitalize}" %>
          <% if opdrecord.r_ocular_trauma_local.downcase == "non mechanical" %>
            <% unless opdrecord.r_ocular_trauma_nonmechanical.blank? %>
              <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_nonmechanical.split(',').join(', ')}" %>
            <% end %>
          <% elsif opdrecord.r_ocular_trauma_local.downcase == "mechanical" %>
            <% unless opdrecord.r_ocular_trauma_mechanical.blank? %>
              <%# trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_mechanical}" %>
              <% if opdrecord.r_ocular_trauma_mechanical.downcase == "adnexal" %>
                <% unless opdrecord.r_ocular_trauma_adnexal.blank? %>
                  <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_adnexal.split(',').join(', ')}" %>
                <% end %>
              <% elsif opdrecord.r_ocular_trauma_mechanical.downcase == "global" %>
                <% unless opdrecord.r_ocular_trauma_global.blank? %>
                  <%# trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_global}"%>
                  <% if opdrecord.r_ocular_trauma_global.downcase == "structural" %>
                    <% unless opdrecord.r_ocular_trauma_structural.blank? %>
                      <%# trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_structural}"%>
                      <% if opdrecord.r_ocular_trauma_structural.downcase == "ant segment" %>
                        <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_antsegment.split(',').join(', ')} " %>
                      <% elsif opdrecord.r_ocular_trauma_structural.downcase == "post segment" %>
                        <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_postsegment.split(',').join(', ')}" %>
                      <% end %>
                    <% end %>
                  <% elsif opdrecord.r_ocular_trauma_global.downcase == "pathological" %>
                    <% unless opdrecord.r_ocular_trauma_pathological.blank? %>
                      <%# trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_pathological}"%>
                      <% if opdrecord.r_ocular_trauma_pathological.downcase == "open globe" %>
                        <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_openglobe.split(',').join(', ')}" %>
                      <% elsif opdrecord.r_ocular_trauma_pathological.downcase == "closed globe" %>
                        <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_closedglobe.split(',').join(', ')}" %>
                      <% elsif opdrecord.r_ocular_trauma_pathological.downcase == "destructive globe" %>
                        <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_destructiveglobe.split(',').join(', ')}" %>
                       <% end %>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% elsif opdrecord.r_ocular_trauma_injury.downcase == "associational" %>
        <% unless opdrecord.r_ocular_trauma_associational.blank? %>
          <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_associational}" %>
        <% end %>
      <% elsif opdrecord.r_ocular_trauma_injury.downcase == "environmental" %>
        <% unless opdrecord.r_ocular_trauma_associational.blank? %>
          <% trauma_result = "#{trauma_result}, #{opdrecord.r_ocular_trauma_environmental}" %>
        <% end %>
      <% end %>
    <% end %>
    <% end %>
  <% end %>
  <% unless opdrecord.r_trauma_comment.blank? %>
      <% r_trauma_comment += 1 %>
  <% trauma_comment_right = opdrecord.r_trauma_comment.html_safe %>
<% end %>

<% if opdrecord.r_appendages == "Abnormal" %>
  <% unless opdrecord.r_appendages_tests.blank? %>
    <% if opdrecord.r_appendages_tests.include?"eyelids" %>
      <% unless opdrecord.r_appendages_eyelids_chalazion == "No" %>
        <% r_eyelid_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelids_fb == "No" %>
        <% r_eyelid_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelids_ptosis == "No" %>
        <% r_eyelid_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelids_swelling == "No" %>
        <% r_eyelid_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelids_entropion == "No" %>
        <% r_eyelid_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelids_ectropion == "No" %>
        <% r_eyelid_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelids_mass== "No" %>
        <% r_eyelid_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelids_meibomitis== "No" %>
        <% r_eyelid_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelashes_laceration == "No" %>
          <% r_eyelid_counter += 1 %>
          <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelids_contusion == "No" %>
          <% r_eyelid_counter += 1 %>
          <% r_appendages_counter += 1 %>
      <% end %>
    <% end %>
    <% if opdrecord.r_appendages_tests.include?"eyelashes" %>
      <% unless opdrecord.r_appendages_eyelashes_trichiasis == "No" %>
        <% r_eyelsahes_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_eyelashes_dystrichiasis == "No" %>
        <% r_eyelsahes_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
    <% end %>
    <% if opdrecord.r_appendages_tests.include?"lacrimalsac" %>
      <% unless opdrecord.r_appendages_lacrimalsac_swelling == "No" %>
        <% r_lacrimar_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_appendages_lacrimalsac_regurgitation == "No" %>
        <% r_lacrimar_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
    <% end %>
    <% if opdrecord.r_appendages_tests.include?"syringing" %>
      <% unless opdrecord.r_appendages_syringing == "Patent" %>
        <% r_syringing_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% else %>
        <% r_syringing_counter += 1 %>
        <% r_appendages_counter += 1 %>
      <% end %>
    <% end %>
  <% end %>
  <% unless params[:action] == "print_opd_record" %>
    <% if opdrecord.r_appendages_diagram_present== "Y" %>
      <% r_appendages_counter += 1 %>
    <% end %>
  <% end %>
  <% if opdrecord.r_appendages_comments.present? && opdrecord.r_appendages_comments != "<br>" %>
    <% r_appendages_comments = opdrecord.read_attribute(:r_appendages_comments).to_s %>
    <% r_appendages_comments_op = " #{r_appendages_comments}" %>
    <% r_appendages_counter += 1 %>
  <% end %>
<% end %>

<% unless opdrecord.r_conjunctiva.blank? %>
  <% unless opdrecord.r_conjunctiva == "Normal" %>
    <% unless opdrecord.r_conjunctiva_congestion == "No" %>
      <% if opdrecord.r_conjunctiva_congestion_lgc != "" %>
          <% r_conjunctiva_congestion_lgc = '-' + opdrecord.r_conjunctiva_congestion_lgc %>
      <% else %>
          <% r_conjunctiva_congestion_lgc = '' %>
      <% end %>
      <% r_conjunctiva_congestion = "Congestion#{r_conjunctiva_congestion_lgc}," %>
      <% r_conjunctiva_op = r_conjunctiva_congestion.to_s %>
      <% r_conjunctiva_counter += 1 %>
    <% end %>
    <% if false %>
      <% unless opdrecord.r_conjunctiva_conjunctivitis == "No" %>
        <% r_conjunctiva_conjunctivitis = 'Conjunctivitis,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_conjunctivitis}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_conjunctiva_episcleritis == "No" %>
        <% r_conjunctiva_episcleritis = 'Episcleritis,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_episcleritis}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
    <% end %>
      <% unless opdrecord.r_conjunctiva_tear == "No" %>
        <% r_conjunctiva_tear = 'Tear,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_tear}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_conjunctiva_conjuctival_blib == "No" %>
        <% r_conjunctiva_conjuctival_blib = 'Conjuctival Bleb,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_conjuctival_blib}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <% unless opdrecord.r_conjunctiva_subconjunctival_haemorrhage == "No" %>
        <% r_conjunctiva_subconjunctival_haemorrhage = 'SubConjunctival Haemorrhage,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_subconjunctival_haemorrhage}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.r_conjunctiva_foreign_body == "Yes" %>
        <% r_conjunctiva_foreign_body = 'Foreign Body,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_foreign_body}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>

      <% if opdrecord.r_conjunctiva_follicles == "Yes" %>
        <% r_conjunctiva_follicles = 'Follicles,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_follicles}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.r_conjunctiva_papillae == "Yes" %>
        <% r_conjunctiva_papillae = 'Papillae,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_papillae}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.r_conjunctiva_pinguecula == "Yes" %>
        <% r_conjunctiva_pinguecula = 'Pinguecula,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_pinguecula}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.r_conjunctiva_pterygium == "Yes" %>
        <% r_conjunctiva_pterygium = 'Pterygium,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_pterygium}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.r_conjunctiva_phlycten == "Yes" %>
        <% r_conjunctiva_phlycten = 'Phlycten,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_phlycten}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.r_conjunctiva_discharge == "Yes" %>
        <% r_conjunctiva_discharge = 'Discharge,' %>
        <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_discharge}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>

      <% if opdrecord.r_conjunctiva_comments.present? && opdrecord.r_conjunctiva_comments != "<br>" %>
        <% r_conjunctiva_comments = opdrecord.read_attribute(:r_conjunctiva_comments).to_s %>
        <% r_conjunctiva_comments_op = " #{r_conjunctiva_comments}" %>
        <% r_conjunctiva_counter += 1 %>
      <% end %>
      <!-- Code to Remove The Last Comma -->
      <% unless r_conjunctiva_op.blank? %>
        <% r_conjunctiva_op = r_conjunctiva_op.split('') %>
        <% r_conjunctiva_op_count = r_conjunctiva_op.count %>
        <% if r_conjunctiva_op_count > 0 %>
            <% r_conjunctiva_op = (r_conjunctiva_op.first r_conjunctiva_op_count - 1).join %>
        <% end %>
      <% end %>
  <% end %>
<% end %>

<% unless opdrecord.r_cornea.blank? %>
    <% unless opdrecord.r_cornea == "Normal" && opdrecord.r_cornea_normal != "normal" %>
        <% unless opdrecord.r_cornea_size == "Normal" && opdrecord.r_cornea_normal != "normal" %>
            <% r_cornea_size = "Size- #{opdrecord.read_attribute(:r_cornea_size)}," %>
            <% r_cornea_op = r_cornea_size.to_s %>
            <% r_cornea_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_cornea_shape == "Normal" && opdrecord.r_cornea_normal != "normal" %>
            <% r_cornea_shape = "Shape- #{opdrecord.read_attribute(:r_cornea_shape)}," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_cornea_shape}" %>
            <% r_cornea_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_cornea_surface == "Normal" && opdrecord.r_cornea_normal != "normal" %>
            <% r_cornea_surface = "Surface- #{opdrecord.read_attribute(:r_cornea_surface)}," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_cornea_surface}" %>
            <% r_cornea_counter += 1 %>
        <% end %>
        <% if opdrecord.r_cornea_schirmer_dimension1.present? || opdrecord.r_cornea_schirmer_time1.present? %>
            <% r_cornea_schirmer_dimension1 = (opdrecord.r_cornea_schirmer_dimension1 if opdrecord.r_cornea_schirmer_dimension1.present?) || ' - ' %>
            <% r_cornea_schirmer_time1 = (opdrecord.r_cornea_schirmer_time1 if opdrecord.r_cornea_schirmer_time1.present?) || ' - ' %>
            <% opdrecord.r_cornea_schirmer_dimension1 = r_cornea_schirmer_dimension1 %>
            <% opdrecord.r_cornea_schirmer_time1 = r_cornea_schirmer_time1 %>
            <% r_cornea_schirmer_test1 = "Schirmer Test-1 (#{opdrecord.read_attribute(:r_cornea_schirmer_dimension1)}mm in #{opdrecord.read_attribute(:r_cornea_schirmer_time1)} min)," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_cornea_schirmer_test1}" %>
            <% r_cornea_counter += 1 %>
        <% end %>

        <% if opdrecord.r_cornea_schirmer_dimension2.present? || opdrecord.r_cornea_schirmer_time2.present? %>
            <% r_cornea_schirmer_dimension2 = (opdrecord.r_cornea_schirmer_dimension2 if opdrecord.r_cornea_schirmer_dimension2.present?) || ' - ' %>
            <% r_cornea_schirmer_time2 = (opdrecord.r_cornea_schirmer_time2 if opdrecord.r_cornea_schirmer_time2.present?) || ' - ' %>
            <% opdrecord.r_cornea_schirmer_dimension2 = r_cornea_schirmer_dimension2 %>
            <% opdrecord.r_cornea_schirmer_time2 = r_cornea_schirmer_time2 %>
            <% r_cornea_schirmer_test2 = "Schirmer Test-2 (#{opdrecord.read_attribute(:r_cornea_schirmer_dimension2)}mm in #{opdrecord.read_attribute(:r_cornea_schirmer_time2)} min)," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_cornea_schirmer_test2}" %>
            <% r_cornea_counter += 1 %>
        <% end %>
        <% if opdrecord.r_cornea_comments != "<br>" %>
            <% r_cornea_comments = opdrecord.read_attribute(:r_cornea_comments).to_s %>
            <% r_cornea_comments_op = " #{r_cornea_comments}" %>
            <% r_cornea_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless r_cornea_op.blank? %>
          <% r_cornea_op = r_cornea_op.split('') %>
          <% r_cornea_op_count = r_cornea_op.count %>
          <% if r_cornea_op_count > 0 %>
              <% r_cornea_op = (r_cornea_op.first r_cornea_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% unless opdrecord.r_anteriorchamber.blank? %>
    <% unless opdrecord.r_anteriorchamber == "Normal" %>
        <% unless opdrecord.r_anteriorchamber_depth == "Normal" %>
            <% r_anteriorchamber_depth = "Depth- #{opdrecord.read_attribute(:r_anteriorchamber_depth)} #{opdrecord.read_attribute(:r_anteriorchamber_depth_comment)}," %>
            <% r_anteriorchamber_op = r_anteriorchamber_depth.to_s %>
            <% r_anteriorchamber_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_anteriorchamber_cells == "No" %>
            <% r_anteriorchamber_cells = "Cells #{opdrecord.read_attribute(:r_anteriorchamber_cells_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_cells}" %>
            <% r_anteriorchamber_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_anteriorchamber_flare == "No" %>
            <% r_anteriorchamber_flare = "Flare #{opdrecord.read_attribute(:r_anteriorchamber_flare_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_flare}" %>
            <% r_anteriorchamber_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_anteriorchamber_hyphema == "No" %>
            <% r_anteriorchamber_hyphema = "Hyphema #{opdrecord.read_attribute(:r_anteriorchamber_hyphema_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_hyphema}" %>
            <% r_anteriorchamber_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_anteriorchamber_hypopyon == "No" %>
            <% r_anteriorchamber_hypopyon = "Hypopyon #{opdrecord.read_attribute(:r_anteriorchamber_hypopyon_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_hypopyon}" %>
            <% r_anteriorchamber_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_anteriorchamber_foreignbody == "No" %>
            <% r_anteriorchamber_foreignbody = "Foreign Body #{opdrecord.read_attribute(:r_anteriorchamber_foreignbody_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_foreignbody}" %>
            <% r_anteriorchamber_counter += 1 %>
        <% end %>
        <% if opdrecord.r_anteriorchamber_comments != "<br>" %>
            <% r_anteriorchamber_comments = opdrecord.read_attribute(:r_anteriorchamber_comments).to_s %>
            <% r_anteriorchamber_comments_op = r_anteriorchamber_comments.to_s %>
            <% r_anteriorchamber_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless r_anteriorchamber_op.blank? %>
          <% r_anteriorchamber_op = r_anteriorchamber_op.split('') %>
          <% r_anteriorchamber_op_count = r_anteriorchamber_op.count %>
          <% if r_anteriorchamber_op_count > 0 %>
              <% r_anteriorchamber_op = (r_anteriorchamber_op.first r_anteriorchamber_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% if opdrecord.r_pupil.present? %>
    <% unless opdrecord.r_pupil == "Normal" && opdrecord.r_pupil_normal != "normal" %>
        <% if opdrecord.r_pupil_shape.length > 0 %>
            <% r_pupil_shape = "Shape- #{opdrecord.read_attribute(:r_pupil_shape)}," %>
            <% r_pupil_op = r_pupil_shape.to_s %>
            <% r_pupil_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_pupil_reaction_to_light_direct == "Normal" && opdrecord.r_pupil_normal != "normal" %>
            <% r_pupil_reaction_to_light_direct = "Reaction to light Direct- #{opdrecord.read_attribute(:r_pupil_reaction_to_light_direct)}," %>
            <% r_pupil_op = "#{r_pupil_op} #{r_pupil_reaction_to_light_direct}" %>
            <% r_pupil_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_pupil_reaction_to_light_consensual == "Normal" && opdrecord.r_pupil_normal != "normal" %>
            <% r_pupil_reaction_to_light_consensual = "Reaction to light Consensual- #{opdrecord.read_attribute(:r_pupil_reaction_to_light_consensual)}," %>
            <% r_pupil_op = "#{r_pupil_op} #{r_pupil_reaction_to_light_consensual}" %>
            <% r_pupil_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_pupil_rapd == "No" %>
            <% r_pupil_rapd = 'RAPD,' %>
            <% r_pupil_op = "#{r_pupil_op} #{r_pupil_rapd}" %>
            <% r_pupil_counter += 1 %>
        <% end %>
        <% if opdrecord.r_pupil_comments != "<br>" %>
            <% r_pupil_comments = opdrecord.read_attribute(:r_pupil_comments).to_s %>
            <% r_pupil_comments_op = r_pupil_comments.to_s %>
            <% r_pupil_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless r_pupil_op.blank? %>
          <% r_pupil_op = r_pupil_op.split('') %>
          <% r_pupil_op_count = r_pupil_op.count %>
          <% if r_pupil_op_count > 0 %>
              <% r_pupil_op = (r_pupil_op.first r_pupil_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% unless opdrecord.r_iris.blank? %>
    <% unless opdrecord.r_iris == "Normal" %>
        <% unless opdrecord.r_iris_shape == "Normal" %>
            <% r_iris_shape = "Shape- #{opdrecord.read_attribute(:r_iris_shape)}, " %>
            <% r_iris_op = r_iris_shape.to_s %>
            <% r_iris_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_iris_neovascularisation == "No" %>
            <% r_iris_neovascularisation = 'Neovascularisation, ' %>
            <% r_iris_op = "#{r_iris_op}#{r_iris_neovascularisation}" %>
            <% r_iris_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_iris_synechiae == "No" %>
            <% r_iris_synechiae = "Synechiae- #{opdrecord.read_attribute(:r_iris_synechiae)}," %>
            <% r_iris_op = "#{r_iris_op}#{r_iris_synechiae}" %>
            <% r_iris_counter += 1 %>
        <% end %>
        <% if opdrecord.r_iris_comments != "<br>" %>
            <% r_iris_comments = opdrecord.read_attribute(:r_iris_comments).to_s %>
            <% r_iris_comments_op = r_iris_comments.to_s %>
            <% r_iris_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless r_iris_op.blank? %>
          <% r_iris_op = r_iris_op.split('') %>
          <% r_iris_op_count = r_iris_op.count %>
          <% if r_iris_op_count > 0 %>
              <% r_iris_op = (r_iris_op.first r_iris_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% unless opdrecord.r_lens.blank? %>
    <% unless opdrecord.r_lens == "Normal" %>
        <% unless opdrecord.r_lens_nature == "Clear" %>
            <% r_lens_nature = "Nature- #{opdrecord.read_attribute(:r_lens_nature)}," %>
            <% r_lens_op = r_lens_nature.to_s %>
            <% r_lens_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_lens_position == "Central" %>
            <% r_lens_position = "Position- #{opdrecord.read_attribute(:r_lens_position)}," %>
            <% r_lens_op = "#{r_lens_op} #{r_lens_position}" %>
            <% r_lens_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_lens_size == "Normal" %>
            <% r_lens_size = "Lens Size- #{opdrecord.read_attribute(:r_lens_size)}," %>
            <% r_lens_op = "#{r_lens_op} #{r_lens_size}" %>
            <% r_lens_counter += 1 %>
        <% end %>

        <% if  opdrecord.r_lens_grading_no.present? %>
            <% r_lens_grading_no = "NS:#{opdrecord.read_attribute(:r_lens_grading_no)}" %>
        <% end %>
        <% if  opdrecord.r_lens_grading_nc.present? %>
            <% r_lens_grading_nc = "NC:#{opdrecord.read_attribute(:r_lens_grading_nc)}" %>
        <% end %>
        <% if  opdrecord.r_lens_grading_c.present? %>
            <% r_lens_grading_c = "C:#{opdrecord.read_attribute(:r_lens_grading_c)}" %>
        <% end %>
        <% if  opdrecord.r_lens_grading_p.present? %>
            <% r_lens_grading_p = "P:#{opdrecord.read_attribute(:r_lens_grading_p)}" %>
        <% end %>

        <% if opdrecord.r_lens_grading_no.present? || opdrecord.r_lens_grading_nc.present? || opdrecord.r_lens_grading_c.present? || opdrecord.r_lens_grading_p.present? %>
            <% r_lens_grading = "Lens Grading- #{r_lens_grading_no} #{r_lens_grading_nc} #{r_lens_grading_c} #{r_lens_grading_p}," %>
            <% r_lens_op = "#{r_lens_op} #{r_lens_grading}" %>
            <% r_lens_counter += 1 %>
        <% end %>

        <% if opdrecord.r_lens_comments != "<br>" %>
            <% r_lens_comments = opdrecord.read_attribute(:r_lens_comments).to_s %>
            <% r_lens_comments_op = r_lens_comments.to_s %>
            <% r_lens_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless r_lens_op.blank? %>
          <% r_lens_op = r_lens_op.split('') %>
          <% r_lens_op_count = r_lens_op.count %>
          <% if r_lens_op_count > 0 %>
              <% r_lens_op = (r_lens_op.first r_lens_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% unless opdrecord.r_extraocularmovements.blank? %>
    <% unless opdrecord.r_extraocularmovements == "Normal" %>
        <% unless opdrecord.r_extraocularmovements_uniocular == "Full" %>
            <% r_extraocularmovements_uniocular = "Uniocular- #{opdrecord.read_attribute(:r_extraocularmovements_uniocular)}," %>
            <% r_extraocularmovements_op = r_extraocularmovements_uniocular.to_s %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_extraocularmovements_binocular == "Full" %>
            <% r_extraocularmovements_binocular = "Binocular- #{opdrecord.read_attribute(:r_extraocularmovements_binocular)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_binocular}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% if opdrecord.r_extraocularmovements_prism.length > 0 %>
            <% r_extraocularmovements_prism = "Prism- #{opdrecord.read_attribute(:r_extraocularmovements_prism)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_prism}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_extraocularmovements_squint.blank? %>
            <% r_extraocularmovements_squint = "Squint- #{opdrecord.read_attribute(:r_extraocularmovements_squint)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_extraocularmovements_squint_tropia.blank? %>
            <% r_extraocularmovements_squint_tropia = "Tropia- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_extraocularmovements_squint_tropia_horizontal.blank? %>
            <% r_extraocularmovements_squint_tropia_horizontal = "Horizontal- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_horizontal)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_horizontal}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_extraocularmovements_squint_tropia_horizontal_esotropia.blank? %>
            <% r_extraocularmovements_squint_tropia_horizontal_esotropia = "Esotropia- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_horizontal_esotropia)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_horizontal_esotropia}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_extraocularmovements_squint_tropia_horizontal_exotropia.blank? %>
            <% r_extraocularmovements_squint_tropia_horizontal_exotropia = "Exotropia- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_horizontal_exotropia)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_horizontal_exotropia}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_extraocularmovements_squint_tropia_vertical.blank? %>
            <% r_extraocularmovements_squint_tropia_vertical = "Vertical- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_vertical)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_vertical}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_extraocularmovements_squint_tropia_paralytic.blank? %>
            <% r_extraocularmovements_squint_tropia_paralytic = "Paralytic- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_paralytic)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_paralytic}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_extraocularmovements_squint_phoria.blank? %>
            <% r_extraocularmovements_squint_phoria = "Phoria- #{opdrecord.read_attribute(:r_extraocularmovements_squint_phoria)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_phoria}" %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <% if opdrecord.r_extraocularmovements_comments != "<br>" %>
            <% r_extraocularmovements_comments = opdrecord.read_attribute(:r_extraocularmovements_comments).to_s %>
            <% r_extraocularmovements_comments_op = r_extraocularmovements_comments.to_s %>
            <% r_extraocularmovements_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless r_extraocularmovements_op.blank? %>
            <% r_extraocularmovements_op = r_extraocularmovements_op.split('') %>
            <% r_extraocularmovements_op_count = r_extraocularmovements_op.count %>
            <% if r_extraocularmovements_op_count > 0 %>
                <% r_extraocularmovements_op = (r_extraocularmovements_op.first r_extraocularmovements_op_count - 1).join %>
            <% end %>
        <% end %>
    <% end %>
<% end %>

<% l_appearance_counter = 0 %>
<% l_appearance_op = '' %>
<% l_appearance_phthisisbulbi = '' %>
<% l_appearance_anophthalmos = '' %>
<% l_appearance_micropththalmos = '' %>
<% l_appearance_artificial = '' %>
<% l_appearance_proptosis = '' %>
<% l_appearance_dystopia = '' %>
<% l_appearance_injured = '' %>
<% l_appearance_swollen = '' %>
<% l_appearance_comments = '' %>

<% l_scleracommon_counter = 0 %>
<% l_scleracommon_comments = '' %>

<% l_trauma_counter = 0 %>
<% l_trauma_op = '' %>
<% l_trauma_comment = 0 %>

<% l_conjunctiva_counter = 0 %>
<% l_conjunctiva_op = '' %>
<% l_conjunctiva_congestion = '' %>
<% l_conjunctiva_conjunctivitis = '' %>
<% l_conjunctiva_episcleritis = '' %>
<% l_conjunctiva_tear = '' %>
<% l_conjunctiva_subconjunctival_haemorrhage = '' %>
<% l_conjunctiva_foreign_body = '' %>

<% l_conjunctiva_follicles = '' %>
<% l_conjunctiva_papillae = '' %>
<% l_conjunctiva_pinguecula = '' %>
<% l_conjunctiva_pterygium = '' %>
<% l_conjunctiva_phlycten = '' %>
<% l_conjunctiva_discharge = '' %>

<% l_conjunctiva_conjuctival_blib = '' %>
<% l_conjunctiva_comments = '' %>

<% l_extraocularmovements_counter = 0 %>
<% l_extraocularmovements_op = '' %>
<% l_extraocularmovements_comments_op = '' %>
<% l_extraocularmovements_comments = '' %>
<% l_extraocularmovements_uniocular = '' %>
<% l_extraocularmovements_binocular = '' %>
<% l_extraocularmovements_prism = '' %>
<% l_extraocularmovements_squint = '' %>
<% l_extraocularmovements_squint_tropia = '' %>
<% l_extraocularmovements_squint_tropia_horizontal = '' %>
<% l_extraocularmovements_squint_tropia_horizontal_esotropia = '' %>
<% l_extraocularmovements_squint_tropia_horizontal_exotropia = '' %>
<% l_extraocularmovements_squint_tropia_vertical = '' %>
<% l_extraocularmovements_squint_tropia_paralytic = '' %>
<% l_extraocularmovements_squint_phoria = '' %>

<% l_appendages_counter = 0 %>
<% l_appendages_op = '' %>
<% l_appendages_comments = 0 %>
<% l_eyelid_counter = 0 %>
<% l_eyelsahes_counter = 0 %>
<% l_lacrimal_counter = 0 %>
<% l_syringing_counter = 0 %>

<% l_cornea_counter = 0 %>
<% l_cornea_op = '' %>
<% l_cornea_size = '' %>
<% l_cornea_shape = '' %>
<% l_cornea_schirmer_test = '' %>

<% l_cornea_surface = '' %>
<% l_cornea_comments_op = '' %>
<% l_cornea_comments = '' %>

<% l_anteriorchamber_counter = 0 %>
<% l_anteriorchamber_op = '' %>
<% l_anteriorchamber_comments_op = '' %>
<% l_anteriorchamber_comments = '' %>
<% l_anteriorchamber_depth = '' %>
<% l_anteriorchamber_reaction = '' %>
<% l_anteriorchamber_cells = '' %>
<% l_anteriorchamber_flare = '' %>
<% l_anteriorchamber_hyphema = '' %>
<% l_anteriorchamber_hypopyon = '' %>
<% l_anteriorchamber_foreignbody = '' %>

<% l_anteriorchamber_depth_comment = '' %>
<% l_anteriorchamber_reaction_comment = '' %>
<% l_anteriorchamber_cells_comment = '' %>
<% l_anteriorchamber_flare_comment = '' %>
<% l_anteriorchamber_hyphema_comment = '' %>
<% l_anteriorchamber_hypopyon_comment = '' %>
<% l_anteriorchamber_foreignbody_comment = '' %>

<% l_pupil_counter = 0 %>
<% l_pupil_op = '' %>
<% l_pupil_comments_op = '' %>
<% l_pupil_comments = '' %>
<% l_pupil_shape = '' %>
<% l_pupil_reaction_to_light_direct = '' %>
<% l_pupil_reaction_to_light_consensual = '' %>
<% l_pupil_rapd = '' %>

<% l_iris_counter = 0 %>
<% l_iris_op = '' %>
<% l_iris_comments_op = '' %>
<% l_iris_comments = '' %>
<% l_iris_shape = '' %>
<% l_iris_neovascularisation = '' %>
<% l_iris_synechiae = '' %>

<% l_lens_counter = 0 %>
<% l_lens_op = '' %>
<% l_lens_comments_op = '' %>
<% l_lens_comments = '' %>
<% l_lens_nature = '' %>
<% l_lens_position = '' %>
<% l_lens_size = '' %>
<% l_lens_grading_no = '' %>
<% l_lens_grading_nc = '' %>
<% l_lens_grading_c = '' %>
<% l_lens_grading_p = '' %>

<% unless opdrecord.l_appearance.blank? %>
  <% unless opdrecord.l_appearance == "Normal" %>
      <% unless opdrecord.l_appearance_phthisisbulbi == "No" %>
          <% l_appearance_phthisisbulbi = 'Phthisis Bulbi,' %>
          <% l_appearance_op = l_appearance_phthisisbulbi.to_s %>
          <% l_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_appearance_anophthalmos == "No" %>
          <% l_appearance_anophthalmos = 'Anophthalmos,' %>
          <% l_appearance_op = "#{l_appearance_op} #{l_appearance_anophthalmos}" %>
          <% l_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_appearance_micropththalmos == "No" %>
          <% l_appearance_micropththalmos = 'Micropththalmos,' %>
          <% l_appearance_op = "#{l_appearance_op} #{l_appearance_micropththalmos}" %>
          <% l_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_appearance_artificial == "No" %>
          <% l_appearance_artificial = 'Artificial,' %>
          <% l_appearance_op = "#{l_appearance_op} #{l_appearance_artificial}" %>
          <% l_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_appearance_proptosis == "No" %>
          <% l_appearance_proptosis = 'Proptosis,' %>
          <% l_appearance_op = "#{l_appearance_op} #{l_appearance_proptosis}" %>
          <% l_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_appearance_dystopia == "No" %>
          <% l_appearance_dystopia = 'Dystopia,' %>
          <% l_appearance_op = "#{l_appearance_op} #{l_appearance_dystopia}" %>
          <% l_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_appearance_injured == "No" %>
          <% l_appearance_injured = 'Injured,' %>
          <% l_appearance_op = "#{l_appearance_op} #{l_appearance_injured}" %>
          <% l_appearance_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_appearance_swollen == "No" %>
          <% l_appearance_swollen = 'Swollen,' %>
          <% l_appearance_op = "#{l_appearance_op} #{l_appearance_swollen}" %>
          <% l_appearance_counter += 1 %>
      <% end %>
      <% if opdrecord.l_appearance_comments.present? && opdrecord.l_appearance_comments != "<br>" %>
          <% l_appearance_comments = opdrecord.read_attribute(:l_appearance_comments).to_s %>
          <% l_appearance_comments_op = " #{l_appearance_comments}" %>
          <% l_appearance_counter += 1 %>
      <% end %>
      <!-- Code to Remove The Last Comma -->
      <% unless l_appearance_op.blank? %>
          <% l_appearance_op = l_appearance_op.split('') %>
          <% l_appearance_op_count = l_appearance_op.count %>
          <% if l_appearance_op_count > 0 %>
              <% l_appearance_op = (l_appearance_op.first l_appearance_op_count - 1).join %>
          <% end %>
      <% end %>
  <% end %>
<% end %>

<% unless opdrecord.l_scleracommon.blank? %>
  <% if opdrecord.l_scleracommon_comments.present? && opdrecord.l_scleracommon_comments != "<br>" %>
      <% l_scleracommon_comments = " #{opdrecord.read_attribute(:l_scleracommon_comments).to_s}" %>
      <% l_scleracommon_counter += 1 %>
  <% end %>
  <!-- Code to Remove The Last Comma -->
<% end %>

<% unless opdrecord.l_ocular_trauma.blank? %>
    <% if opdrecord.l_ocular_trauma == "Abnormal" %>

        <% unless opdrecord.l_ocular_trauma_injury.blank? %>
            <% l_trauma_counter += 1 %>
            <% trauma_result_l = opdrecord.l_ocular_trauma_injury %>
            <% if opdrecord.l_ocular_trauma_injury.downcase == "local" %>
                <% unless opdrecord.l_ocular_trauma_local.blank? %>
                    <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_local.capitalize}" %>
                    <% if opdrecord.l_ocular_trauma_local.downcase == "non mechanical" %>
                        <% unless opdrecord.l_ocular_trauma_nonmechanical.blank? %>
                            <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_nonmechanical.split(',').join(', ')}" %>
                        <% end %>
                    <% elsif opdrecord.l_ocular_trauma_local.downcase == "mechanical" %>
                        <% unless opdrecord.l_ocular_trauma_mechanical.blank? %>
                            <%# trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_mechanical}" %>
                            <% if opdrecord.l_ocular_trauma_mechanical.downcase == "adnexal" %>
                                <% unless opdrecord.l_ocular_trauma_adnexal.blank? %>
                                    <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_adnexal.split(',').join(', ')}" %>
                                <% end %>
                            <% elsif opdrecord.l_ocular_trauma_mechanical.downcase == "global" %>
                                <% unless opdrecord.l_ocular_trauma_global.blank? %>
                                    <%# trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_global}"%>
                                    <% if opdrecord.l_ocular_trauma_global.downcase == "structural" %>
                                        <% unless opdrecord.l_ocular_trauma_structural.blank? %>
                                            <%# trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_structural}"%>
                                            <% if opdrecord.l_ocular_trauma_structural.downcase == "ant segment" %>
                                                <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_antsegment.split(',').join(', ')} " %>
                                            <% elsif opdrecord.l_ocular_trauma_structural.downcase == "post segment" %>
                                                <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_postsegment.split(',').join(', ')}" %>
                                            <% end %>
                                        <% end %>
                                    <% elsif opdrecord.l_ocular_trauma_global.downcase == "pathological" %>
                                        <% unless opdrecord.l_ocular_trauma_pathological.blank? %>
                                            <%# trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_pathological}"%>
                                            <% if opdrecord.l_ocular_trauma_pathological.downcase == "open globe" %>
                                                <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_openglobe.split(',').join(', ')}" %>
                                            <% elsif opdrecord.l_ocular_trauma_pathological.downcase == "closed globe" %>
                                                <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_closedglobe.split(',').join(', ')}" %>
                                            <% elsif opdrecord.l_ocular_trauma_pathological.downcase == "destructive globe" %>
                                                <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_destructiveglobe.split(',').join(', ')}" %>
                                            <% end %>
                                        <% end %>
                                    <% end %>
                                <% end %>
                            <% end %>
                        <% end %>
                    <% end %>
                <% end %>
            <% elsif opdrecord.l_ocular_trauma_injury.downcase == "associational" %>
                <% unless opdrecord.l_ocular_trauma_associational.blank? %>
                    <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_associational}" %>
                <% end %>
            <% elsif opdrecord.l_ocular_trauma_injury.downcase == "environmental" %>
                <% unless opdrecord.l_ocular_trauma_environmental.blank? %>
                    <% trauma_result_l = "#{trauma_result_l}, #{opdrecord.l_ocular_trauma_environmental}" %>
                <% end %>
            <% end %>
        <% end %>
    <% end %>
    <% end %>
    <% unless opdrecord.l_trauma_comment.blank? %>

    <% l_trauma_comment += 1 %>
    <% trauma_comment_left = opdrecord.l_trauma_comment.html_safe %>
<% end %>
<% if opdrecord.l_appendages == "Abnormal" %>
    <% unless opdrecord.l_appendages_tests.blank? %>
        <% if opdrecord.l_appendages_tests.include?"eyelids" %>
            <% unless opdrecord.l_appendages_eyelids_chalazion == "No" %>
                <% l_eyelid_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_fb == "No" %>
                <% l_eyelid_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_ptosis == "No" %>
                <% l_eyelid_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_swelling == "No" %>
                <% l_eyelid_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_entropion == "No" %>
                <% l_eyelid_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_ectropion == "No" %>
                <% l_eyelid_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_mass== "No" %>
                <% l_eyelid_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_meibomitis== "No" %>
            <% l_eyelid_counter += 1 %>
            <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelashes_laceration == "No" %>
            <% l_eyelid_counter += 1 %>
            <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_contusion == "No" %>
            <% l_eyelid_counter += 1 %>
            <% l_appendages_counter += 1 %>
            <% end %>
        <% end %>
        <% if opdrecord.l_appendages_tests.include?"eyelashes" %>
            <% unless opdrecord.l_appendages_eyelashes_trichiasis == "No" %>
                <% l_eyelsahes_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelashes_dystrichiasis == "No" %>
                <% l_eyelsahes_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
        <% end %>
        <% if opdrecord.l_appendages_tests.include?"lacrimalsac" %>

            <% unless opdrecord.l_appendages_lacrimalsac_swelling == "No" %>
                <% l_lacrimal_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_lacrimalsac_regurgitation == "No" %>
                <% l_lacrimal_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>
        <% end %>
        <% if opdrecord.l_appendages_tests.include?"syringing" %>

            <% unless opdrecord.l_appendages_syringing == "Patent" %>
                <% l_syringing_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% else %>
                <% l_syringing_counter += 1 %>
                <% l_appendages_counter += 1 %>
            <% end %>

        <% end %>
    <% end %>
    <% unless params[:action] == "print_opd_record" %>
        <% if opdrecord.l_appendages_diagram_present== "Y" %>
            <% l_appendages_counter += 1 %>
        <% end %>
    <% end %>
    <% if opdrecord.l_appendages_comments.present? && opdrecord.l_appendages_comments != "<br>" %>
        <% l_appendages_comments = opdrecord.read_attribute(:l_appendages_comments).to_s %>
        <% l_appendages_comments_op = " #{l_appendages_comments}" %>
        <% l_appendages_counter += 1 %>
<% end %>
<% end %>

<% unless opdrecord.l_conjunctiva.blank? %>
  <% unless opdrecord.l_conjunctiva == "Normal" %>
      <% unless opdrecord.l_conjunctiva_congestion == "No" %>
          <% if opdrecord.l_conjunctiva_congestion_lgc != "" %>
              <% l_conjunctiva_congestion_lgc = '-' + opdrecord.l_conjunctiva_congestion_lgc %>
          <% else %>
              <% l_conjunctiva_congestion_lgc = '' %>
          <% end %>
          <% l_conjunctiva_congestion = "Congestion#{l_conjunctiva_congestion_lgc}," %>
          <% l_conjunctiva_op = l_conjunctiva_congestion.to_s %>
          <% l_conjunctiva_counter += 1 %>
          <% l_conjunctiva_congestion_lgc = opdrecord.l_conjunctiva_congestion_lgc %>
      <% end %>
      <% if false %>
          <% unless opdrecord.l_conjunctiva_conjunctivitis == "No" %>
              <% l_conjunctiva_conjunctivitis = 'Conjunctivitis,' %>
              <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_conjunctivitis}" %>
              <% l_conjunctiva_counter += 1 %>

          <% end %>
          <% unless opdrecord.l_conjunctiva_episcleritis == "No" %>
              <% l_conjunctiva_episcleritis = 'Episcleritis,' %>
              <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_episcleritis}" %>
              <% l_conjunctiva_counter += 1 %>

          <% end %>
      <% end %>
      <% unless opdrecord.l_conjunctiva_tear == "No" %>
          <% l_conjunctiva_tear = 'Tear,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_tear}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_conjunctiva_conjuctival_blib == "No" %>
          <% l_conjunctiva_conjuctival_blib = 'Conjuctival Bleb,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_conjuctival_blib}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_conjunctiva_subconjunctival_haemorrhage == "No" %>
          <% l_conjunctiva_subconjunctival_haemorrhage = 'SubConjunctival Haemorrhage,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_subconjunctival_haemorrhage}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.l_conjunctiva_foreign_body == "Yes" %>
          <% l_conjunctiva_foreign_body = 'Foreign Body,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_foreign_body}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>

      <% if opdrecord.l_conjunctiva_follicles == "Yes" %>
          <% l_conjunctiva_follicles = 'Follicles,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_follicles}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.l_conjunctiva_papillae == "Yes" %>
          <% l_conjunctiva_papillae = 'Papillae,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_papillae}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.l_conjunctiva_pinguecula == "Yes" %>
          <% l_conjunctiva_pinguecula = 'Pinguecula,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_pinguecula}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.l_conjunctiva_pterygium == "Yes" %>
          <% l_conjunctiva_pterygium = 'Pterygium,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_pterygium}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.l_conjunctiva_phlycten == "Yes" %>
          <% l_conjunctiva_phlycten = 'Phlycten,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_phlycten}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>
      <% if opdrecord.l_conjunctiva_discharge == "Yes" %>
          <% l_conjunctiva_discharge = 'Discharge,' %>
          <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_discharge}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>

      <% if opdrecord.l_conjunctiva_comments.present? && opdrecord.l_conjunctiva_comments != "<br>" %>
          <% l_conjunctiva_comments = opdrecord.read_attribute(:l_conjunctiva_comments).to_s %>
          <% l_conjunctiva_comments_op = " #{l_conjunctiva_comments}" %>
          <% l_conjunctiva_counter += 1 %>
      <% end %>
      <!-- Code to Remove The Last Comma -->
      <% unless l_conjunctiva_op.blank? %>
          <% l_conjunctiva_op = l_conjunctiva_op.split('') %>
          <% l_conjunctiva_op_count = l_conjunctiva_op.count %>
          <% if l_conjunctiva_op_count > 0 %>
              <% l_conjunctiva_op = (l_conjunctiva_op.first l_conjunctiva_op_count - 1).join %>
          <% end %>
      <% end %>
  <% end %>
<% end %>

<% unless opdrecord.l_cornea.blank? %>
    <% unless opdrecord.l_cornea == "Normal" && opdrecord.l_cornea_normal != "normal" %>
        <% unless opdrecord.l_cornea_size == "Normal" && opdrecord.l_cornea_normal != "normal" %>
            <% l_cornea_size = "Size- #{opdrecord.read_attribute(:l_cornea_size)}," %>
            <% l_cornea_op = l_cornea_size.to_s %>
            <% l_cornea_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_cornea_shape == "Normal" && opdrecord.l_cornea_normal != "normal" %>
            <% l_cornea_shape = "Shape- #{opdrecord.read_attribute(:l_cornea_shape)}," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_cornea_shape}" %>
            <% l_cornea_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_cornea_surface == "Normal" && opdrecord.l_cornea_normal != "normal" %>
            <% l_cornea_surface = "Surface- #{opdrecord.read_attribute(:l_cornea_surface)}," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_cornea_surface}" %>
            <% l_cornea_counter += 1 %>
        <% end %>
        <% if opdrecord.l_cornea_schirmer_dimension1.present? || opdrecord.l_cornea_schirmer_time1.present? %>
            <% l_cornea_schirmer_dimension1 = (opdrecord.l_cornea_schirmer_dimension1 if opdrecord.l_cornea_schirmer_dimension1.present?) || ' - ' %>
            <% l_cornea_schirmer_time1 = (opdrecord.l_cornea_schirmer_time1 if opdrecord.l_cornea_schirmer_time1.present?) || ' - ' %>
            <% opdrecord.l_cornea_schirmer_dimension1 = l_cornea_schirmer_dimension1 %>
            <% opdrecord.l_cornea_schirmer_time1 = l_cornea_schirmer_time1 %>
            <% l_cornea_schirmer_test1 = "Schirmer Test-1 (#{opdrecord.read_attribute(:l_cornea_schirmer_dimension1)}mm in #{opdrecord.read_attribute(:l_cornea_schirmer_time1)} min)," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_cornea_schirmer_test1}" %>
            <% l_cornea_counter += 1 %>
        <% end %>

        <% if opdrecord.l_cornea_schirmer_dimension2.present? || opdrecord.l_cornea_schirmer_time2.present? %>
            <% l_cornea_schirmer_dimension2 = (opdrecord.l_cornea_schirmer_dimension2 if opdrecord.l_cornea_schirmer_dimension2.present?) || ' - ' %>
            <% l_cornea_schirmer_time2 = (opdrecord.l_cornea_schirmer_time2 if opdrecord.l_cornea_schirmer_time2.present?) || ' - ' %>
            <% opdrecord.l_cornea_schirmer_dimension2 = l_cornea_schirmer_dimension2 %>
            <% opdrecord.l_cornea_schirmer_time2 = l_cornea_schirmer_time2 %>
            <% l_cornea_schirmer_test2 = "Schirmer Test-2 (#{opdrecord.read_attribute(:l_cornea_schirmer_dimension2)}mm in #{opdrecord.read_attribute(:l_cornea_schirmer_time2)} min)," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_cornea_schirmer_test2}" %>
            <% l_cornea_counter += 1 %>
        <% end %>
        <% if opdrecord.l_cornea_comments != "<br>" %>
            <% l_cornea_comments = opdrecord.read_attribute(:l_cornea_comments).to_s %>
            <% l_cornea_comments_op = l_cornea_comments.to_s %>
            <% l_cornea_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless l_cornea_op.blank? %>
          <% l_cornea_op = l_cornea_op.split('') %>
          <% l_cornea_op_count = l_cornea_op.count %>
          <% if l_cornea_op_count > 0 %>
              <% l_cornea_op = (l_cornea_op.first l_cornea_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% unless opdrecord.l_anteriorchamber.blank? %>
    <% unless opdrecord.l_anteriorchamber == "Normal" %>
        <% unless opdrecord.l_anteriorchamber_depth == "Normal" %>
            <% l_anteriorchamber_depth = "Depth- #{opdrecord.read_attribute(:l_anteriorchamber_depth)} #{opdrecord.read_attribute(:l_anteriorchamber_depth_comment)}," %>
            <% l_anteriorchamber_op = l_anteriorchamber_depth.to_s %>
            <% l_anteriorchamber_counter += 1 %>
        <% end %>

        <% unless opdrecord.l_anteriorchamber_cells == "No" %>
            <% l_anteriorchamber_cells = "Cells #{opdrecord.read_attribute(:l_anteriorchamber_cells_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_cells}," %>
            <% l_anteriorchamber_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_anteriorchamber_flare == "No" %>
            <% l_anteriorchamber_flare = "Flare #{opdrecord.read_attribute(:l_anteriorchamber_flare_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_flare}," %>
            <% l_anteriorchamber_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_anteriorchamber_hyphema == "No" %>
            <% l_anteriorchamber_hyphema = "Hyphema #{opdrecord.read_attribute(:l_anteriorchamber_hyphema_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_hyphema}," %>
            <% l_anteriorchamber_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_anteriorchamber_hypopyon == "No" %>
            <% l_anteriorchamber_hypopyon = "Hypopyon #{opdrecord.read_attribute(:l_anteriorchamber_hypopyon_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_hypopyon}," %>
            <% l_anteriorchamber_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_anteriorchamber_foreignbody == "No" %>
            <% l_anteriorchamber_foreignbody = "Foreign Body #{opdrecord.read_attribute(:l_anteriorchamber_foreignbody_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_foreignbody}," %>
            <% l_anteriorchamber_counter += 1 %>
        <% end %>
        <% if opdrecord.l_anteriorchamber_comments != "<br>" %>
            <% l_anteriorchamber_comments = opdrecord.read_attribute(:l_anteriorchamber_comments).to_s %>
            <% l_anteriorchamber_comments_op = l_anteriorchamber_comments.to_s %>
            <% l_anteriorchamber_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless l_anteriorchamber_op.blank? %>
          <% l_anteriorchamber_op = l_anteriorchamber_op.split('') %>
          <% l_anteriorchamber_op_count = l_anteriorchamber_op.count %>
          <% if l_anteriorchamber_op_count > 0 %>
              <% l_anteriorchamber_op = (l_anteriorchamber_op.first l_anteriorchamber_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% unless opdrecord.l_pupil.blank? %>
    <% unless opdrecord.l_pupil == "Normal" && opdrecord.l_pupil_normal != "normal" %>
        <% if opdrecord.l_pupil_shape.length > 0 %>
            <% l_pupil_shape = "Shape- #{opdrecord.read_attribute(:l_pupil_shape)}," %>
            <% l_pupil_op = l_pupil_shape.to_s %>
            <% l_pupil_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_pupil_reaction_to_light_direct == "Normal" && opdrecord.l_pupil_normal != "normal" %>
            <% l_pupil_reaction_to_light_direct = "Reaction to light Direct- #{opdrecord.read_attribute(:l_pupil_reaction_to_light_direct)}," %>
            <% l_pupil_op = "#{l_pupil_op} #{l_pupil_reaction_to_light_direct}" %>
            <% l_pupil_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_pupil_reaction_to_light_consensual == "Normal" && opdrecord.l_pupil_normal != "normal" %>
            <% l_pupil_reaction_to_light_consensual = "Reaction to light consensual- #{opdrecord.read_attribute(:l_pupil_reaction_to_light_consensual)}," %>
            <% l_pupil_op = "#{l_pupil_op} #{l_pupil_reaction_to_light_consensual}" %>
            <% l_pupil_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_pupil_rapd == "No" %>
            <% l_pupil_rapd = 'RAPD,' %>
            <% l_pupil_op = "#{l_pupil_op} #{l_pupil_rapd}" %>
            <% l_pupil_counter += 1 %>
        <% end %>
        <% if opdrecord.l_pupil_comments != "<br>" %>
            <% l_pupil_comments = opdrecord.read_attribute(:l_pupil_comments).to_s %>
            <% l_pupil_comments_op = l_pupil_comments.to_s %>
            <% l_pupil_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless l_pupil_op.blank? %>
          <% l_pupil_op = l_pupil_op.split('') %>
          <% l_pupil_op_count = l_pupil_op.count %>
          <% if l_pupil_op_count > 0 %>
              <% l_pupil_op = (l_pupil_op.first l_pupil_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% unless opdrecord.l_iris.blank? %>
    <% unless opdrecord.l_iris == "Normal" %>
        <% unless opdrecord.l_iris_shape == "Normal" %>
            <% l_iris_shape = "Shape- #{opdrecord.read_attribute(:l_iris_shape)}, " %>
            <% l_iris_op = l_iris_shape.to_s %>
            <% l_iris_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_iris_neovascularisation == "No" %>
            <% l_iris_neovascularisation = 'Neovascularisation, ' %>
            <% l_iris_op = "#{l_iris_op}#{l_iris_neovascularisation}" %>
            <% l_iris_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_iris_synechiae == "No" %>
            <% l_iris_synechiae = "Synechiae- #{opdrecord.read_attribute(:l_iris_synechiae)}," %>
            <% l_iris_op = "#{l_iris_op}#{l_iris_synechiae}" %>
            <% l_iris_counter += 1 %>
        <% end %>
        <% if opdrecord.l_iris_comments != "<br>" %>
            <% l_iris_comments = opdrecord.read_attribute(:l_iris_comments).to_s %>
            <% l_iris_comments_op = l_iris_comments.to_s %>
            <% l_iris_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless l_iris_op.blank? %>
          <% l_iris_op = l_iris_op.split('') %>
          <% l_iris_op_count = l_iris_op.count %>
          <% if l_iris_op_count > 0 %>
              <% l_iris_op = (l_iris_op.first l_iris_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% unless opdrecord.l_lens.blank? %>
    <% unless opdrecord.l_lens == "Normal" %>
        <% unless opdrecord.l_lens_nature == "Clear" %>
            <% l_lens_nature = "Nature- #{opdrecord.read_attribute(:l_lens_nature)}," %>
            <% l_lens_op = l_lens_nature.to_s %>
            <% l_lens_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_lens_position == "Central" %>
            <% l_lens_position = "Position- #{opdrecord.read_attribute(:l_lens_position)}," %>
            <% l_lens_op = "#{l_lens_op} #{l_lens_position}" %>
            <% l_lens_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_lens_size == "Normal" %>
            <% l_lens_size = "Lens Size- #{opdrecord.read_attribute(:l_lens_size)}," %>
            <% l_lens_op = "#{l_lens_op} #{l_lens_size}" %>
            <% l_lens_counter += 1 %>
        <% end %>
        <% if  opdrecord.l_lens_grading_no.present? %>
            <% l_lens_grading_no = "NS:#{opdrecord.read_attribute(:l_lens_grading_no)}" %>
        <% end %>
        <% if  opdrecord.l_lens_grading_nc.present? %>
            <% l_lens_grading_nc = "NC:#{opdrecord.read_attribute(:l_lens_grading_nc)}" %>
        <% end %>
        <% if  opdrecord.l_lens_grading_c.present? %>
            <% l_lens_grading_c = "C:#{opdrecord.read_attribute(:l_lens_grading_c)}" %>
        <% end %>
        <% if  opdrecord.l_lens_grading_p.present? %>
            <% l_lens_grading_p = "P:#{opdrecord.read_attribute(:l_lens_grading_p)}" %>
        <% end %>

        <% if opdrecord.l_lens_grading_no.present? || opdrecord.l_lens_grading_nc.present? || opdrecord.l_lens_grading_c.present? || opdrecord.l_lens_grading_p.present? %>
            <% l_lens_grading = "Lens Grading- #{l_lens_grading_no} #{l_lens_grading_nc} #{l_lens_grading_c} #{l_lens_grading_p}," %>
            <% l_lens_op = "#{l_lens_op} #{l_lens_grading}" %>
            <% l_lens_counter += 1 %>
        <% end %>
        <% if opdrecord.l_lens_comments != "<br>" %>
            <% l_lens_comments = opdrecord.read_attribute(:l_lens_comments).to_s %>
            <% l_lens_comments_op = l_lens_comments.to_s %>
            <% l_lens_counter += 1 %>
        <% end %>
        <!-- Code to Remove The Last Comma -->
        <% unless l_lens_op.blank? %>
          <% l_lens_op = l_lens_op.split('') %>
          <% l_lens_op_count = l_lens_op.count %>
          <% if l_lens_op_count > 0 %>
              <% l_lens_op = (l_lens_op.first l_lens_op_count - 1).join %>
          <% end %>
        <% end %>
    <% end %>
<% end %>

<% unless opdrecord.l_extraocularmovements.blank? %>
  <% unless opdrecord.l_extraocularmovements == "Normal" %>
      <% unless opdrecord.l_extraocularmovements_uniocular == "Full" %>
          <% l_extraocularmovements_uniocular = "Uniocular- #{opdrecord.read_attribute(:l_extraocularmovements_uniocular)}," %>
          <% l_extraocularmovements_op = l_extraocularmovements_uniocular.to_s %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_extraocularmovements_binocular == "Full" %>
          <% l_extraocularmovements_binocular = "Binocular- #{opdrecord.read_attribute(:l_extraocularmovements_binocular)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_binocular}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% if opdrecord.l_extraocularmovements_prism.length > 0 %>
          <% l_extraocularmovements_prism = "Prism- #{opdrecord.read_attribute(:l_extraocularmovements_prism)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_prism}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_extraocularmovements_squint.blank? %>
          <% l_extraocularmovements_squint = "Squint- #{opdrecord.read_attribute(:l_extraocularmovements_squint)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_extraocularmovements_squint_tropia.blank? %>
          <% l_extraocularmovements_squint_tropia = "Tropia- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_extraocularmovements_squint_tropia_horizontal.blank? %>
          <% l_extraocularmovements_squint_tropia_horizontal = "Horizontal- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_horizontal)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_horizontal}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_extraocularmovements_squint_tropia_horizontal_esotropia.blank? %>
          <% l_extraocularmovements_squint_tropia_horizontal_esotropia = "Esotropia- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_horizontal_esotropia)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_horizontal_esotropia}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_extraocularmovements_squint_tropia_horizontal_exotropia.blank? %>
          <% l_extraocularmovements_squint_tropia_horizontal_exotropia = "Exotropia- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_horizontal_exotropia)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_horizontal_exotropia}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_extraocularmovements_squint_tropia_vertical.blank? %>
          <% l_extraocularmovements_squint_tropia_vertical = "Vertical- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_vertical)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_vertical}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_extraocularmovements_squint_tropia_paralytic.blank? %>
          <% l_extraocularmovements_squint_tropia_paralytic = "Paralytic- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_paralytic)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_paralytic}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% unless opdrecord.l_extraocularmovements_squint_phoria.blank? %>
          <% l_extraocularmovements_squint_phoria = "Phoria- #{opdrecord.read_attribute(:l_extraocularmovements_squint_phoria)}," %>
          <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_phoria}" %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <% if opdrecord.l_extraocularmovements_comments != "<br>" %>
          <% l_extraocularmovements_comments = opdrecord.read_attribute(:l_extraocularmovements_comments).to_s %>
          <% l_extraocularmovements_comments_op = l_extraocularmovements_comments.to_s %>
          <% l_extraocularmovements_counter += 1 %>
      <% end %>
      <!-- Code to Remove The Last Comma -->
      <% unless l_extraocularmovements_op.blank? %>
          <% l_extraocularmovements_op = l_extraocularmovements_op.split('') %>
          <% l_extraocularmovements_op_count = l_extraocularmovements_op.count %>
          <% if l_extraocularmovements_op_count > 0 %>
              <% l_extraocularmovements_op = (l_extraocularmovements_op.first l_extraocularmovements_op_count - 1).join %>
          <% end %>
      <% end %>
  <% end %>
<% end %>
<div style="<%= heading_font_size %>">
    <% @initial_referral_type = PatientReferralType.where(patient_id: @patient.try(:id), is_deleted: false).order(created_at: :asc)[0]
       @patient_referral_type = PatientReferralType.find_by(appointment_id: @appointment.id, is_deleted: false) %>
    <% if ( @patient_referral_type.present? || @initial_referral_type.present? ) %>
      <% if @patient_referral_type.present? && (@initial_referral_type.try(:appointment_id) != @patient_referral_type.try(:appointment_id)) %>
        <%= @patient_referral_type&.referral_type.name.to_s.titleize %> - <%= @patient_referral_type&.sub_referral_type&.name&.to_s&.titleize %>
        <% else %>
        <%= @initial_referral_type&.referral_type&.name&.to_s&.titleize %> - <%= @initial_referral_type&.sub_referral_type&.name&.to_s&.titleize %>
      <% end %>
      <br>
    <% end %>
</div>
<br>
<div class="<%= 'print_text_font_size' if  @print_setting %>" style="<%= text_font_size %>">
  <% if r_intraocularpressure_counter > 0 || l_intraocularpressure_counter > 0 || r_visualacuity_counter > 0 || l_visualacuity_counter > 0 %>
    <div class="row mb5">
      <span><b>ON EXAMINATION</b></span>
      <div class="summary-line-border"></div>
    </div>

    <div class="row mb10 check_font">
      <table class="table table-bordered">
        <thead>
        <tr>
          <th></th>
          <th>Right Eye</th>
          <th>Left Eye</th>
        </tr>
        </thead>
        <tbody>

            <tr>
              <td><b>UVA</b></td>
              <td><b>
                <%= "#{r_visualacuity_unaided} #{r_visualacuity_ua_near}" %>
                <% if r_visualacuity_ua_s.present? || r_visualacuity_ua_i.present? || r_visualacuity_ua_n.present? || r_visualacuity_ua_t.present? %>
                    PR(UCVA): <%= r_visualacuity_ua_s %> <%= r_visualacuity_ua_i %> <%= r_visualacuity_ua_n %> <%= r_visualacuity_ua_t %>
                <% end %>
              </b></td>
              <td><b>
                <%= "#{l_visualacuity_unaided} #{l_visualacuity_ua_near}" %>
                <% if l_visualacuity_ua_s.present? || l_visualacuity_ua_i.present? || l_visualacuity_ua_n.present? || l_visualacuity_ua_t.present? %>
                    PR(UCVA): <%= l_visualacuity_ua_s %> <%= l_visualacuity_ua_i %> <%= l_visualacuity_ua_n %> <%= l_visualacuity_ua_t %>
                <% end %>
              </b></td>
            </tr>
            <tr>
              <td><b>BCVA</b></td>
              <td><b>
                <%= "#{r_visualacuity_pinhole} #{r_visualacuity_glasses} #{r_visualacuity_near}" %>
              </b></td>
              <td><b>
                <%= "#{l_visualacuity_pinhole} #{l_visualacuity_glasses} #{l_visualacuity_near}" %>
              </b></td>
            </tr>
            <tr>
              <td><b>IOP</b></td>
              <td><b>
                <% if r_intraocularpressure_counter > 0 %>
                  <% if r_intraocularpressure_op.to_i >= 0 && r_intraocularpressure_op.to_i < 19 %>
                    <%= r_intraocularpressure_op %>
                  <% elsif r_intraocularpressure_op.to_i >= 19 %>
                    <span class="abnormal-highlight">
                      <%= r_intraocularpressure_op %>
                    </span>
                  <% end %>
                  <% if r_intraocularpressure_comments.present? %>
                    <ul><li><%= r_intraocularpressure_comments %></li></ul>
                  <% end %>
                <% end %>
              </b></td>
              <td><b>
                <% if l_intraocularpressure_counter > 0 %>
                  <% if l_intraocularpressure_op.to_i >= 0 && l_intraocularpressure_op.to_i < 19 %>
                      <%= l_intraocularpressure_op %>
                  <% elsif l_intraocularpressure_op.to_i >= 19 %>
                    <span class="abnormal-highlight">
                      <%= l_intraocularpressure_op %>
                    </span>
                  <% end %>
                  <% if l_intraocularpressure_comments.present? %>
                    <ul><li><%= l_intraocularpressure_comments %></li></ul>
                  <% end %>
                <% end %>
              </b></td>
            </tr>

        </tbody>
      </table>
    </div>
  <% end %>

  <% if l_trauma_comment > 0 || r_trauma_comment > 0 || l_trauma_counter > 0 || r_trauma_counter > 0 || r_scleracommon_counter > 0 || r_appearance_counter > 0 || l_scleracommon_counter > 0 || l_appearance_counter > 0 || r_appendages_counter > 0 || l_appendages_counter > 0 || r_cornea_counter > 0 || l_cornea_counter > 0 || r_anteriorchamber_counter > 0 || l_anteriorchamber_counter > 0 || r_pupil_counter > 0 || l_pupil_counter > 0 || r_iris_counter > 0 || l_iris_counter > 0  || r_lens_counter > 0 || l_lens_counter > 0 || opdrecord.r_local_examination_normal == "normal" || opdrecord.l_local_examination_normal == "normal" %>

    <div class="row mb5">
      <span><b>ANTERIOR SEGMENT EXAMINATION</b></span>
      <div class="summary-line-border"></div>
    </div>

    <div class="row mb5">
    <div class="col-md-6">
      <div class="text-center" style="background-color:#ddd;">R/OD</div>
    </div><!-- col-md-6  -->
    <div class="col-md-6">
      <div class="text-center" style="background-color:#ddd;">L/OS</div>
    </div><!-- col-md-6  -->

    <div class="col-md-6">
      <% if r_appearance_counter > 0 %>
        <b>Appearance: </b><% unless r_appearance_op ==[] %><%= r_appearance_op %><% end %>
        <% if r_appearance_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= r_appearance_comments_op.html_safe %> </span> </div>
        <% end %>
        <div class="examination_non_tabular">
        </div>
      <% end %>
      <% if r_scleracommon_counter > 0 %>
        <span class="abnormal-highlight">
          <b>Sclera: </b>
          <% if r_scleracommon_comments.present? %><div><span style="display: list-item;margin-left: 4%"><%= r_scleracommon_comments.html_safe %> </span> </div>
          <% end %>
          <div class="examination_non_tabular">
          </div>
        </span>
      <% end %>
      <% if trauma_result.present? || trauma_comment_right.present? %>

          <span class="abnormal-highlight">
          <b>Ocular Trauma:</b>
          <% unless trauma_result.blank? %>
              <span><%= trauma_result %> Injury</span>
              <br>
          <% end %>
          <% unless trauma_comment_right.blank? %>
              <span style="display: list-item;margin-left: 4%"> <%= trauma_comment_right.html_safe %></span>
          <% end %>
          </span>
          <div class="examination_non_tabular"></div>

      <% end %>
      <% if r_appendages_counter > 0 %>
        <span class="abnormal-highlight">
          <b>Appendages: </b>

          <% if r_eyelid_counter>0 %>
              <% if opdrecord.r_appendages_tests.include?"eyelids" %>

                  <b>Eyelids:</b>
                  <% if opdrecord.r_appendages_eyelids_chalazion.present? %>
                      <% unless opdrecord.r_appendages_eyelids_chalazion == "No" %>
                          Chalazion,
                      <% end %>
                  <% end %>
                  <% if opdrecord.r_appendages_eyelids_fb.present? %>
                      <% unless opdrecord.r_appendages_eyelids_fb == "No" %>
                          F.B,
                      <% end %>
                  <% end %>
                  <% if opdrecord.r_appendages_eyelashes_laceration.present? %>
                      <% unless opdrecord.r_appendages_eyelashes_laceration == "No" %>
                          Laceration,
                      <% end %>
                  <% end %>
                  <% if opdrecord.r_appendages_eyelids_contusion.present? %>
                      <% unless opdrecord.r_appendages_eyelids_contusion == "No" %>
                          Contusion,
                      <% end %>
                  <% end %>
                  <% unless opdrecord.r_appendages_eyelids_ptosis == "No" %>
                      Ptosis,
                  <% end %>
                  <% unless opdrecord.r_appendages_eyelids_swelling == "No" %>
                      Swelling,
                  <% end %>
                  <% unless opdrecord.r_appendages_eyelids_entropion    == "No" %>
                      Entropion,
                  <% end %>
                  <% unless opdrecord.r_appendages_eyelids_ectropion == "No" %>
                      Ectropion,
                  <% end %>
                  <% unless opdrecord.r_appendages_eyelids_mass == "No" %>
                      Eyelids mass,
                  <% end %>
                  <% if opdrecord.r_appendages_eyelids_meibomitis.present? %>
                      <% unless opdrecord.r_appendages_eyelids_meibomitis == "No" %>
                          Meibomitis,
                      <% end %>
                  <% end %>
              <% end %>
          <% end %>
          <% if  r_eyelsahes_counter > 0 %>
              <% if opdrecord.r_appendages_tests.include?"eyelashes" %>
                <b>Eyelashes:</b>
                <% unless opdrecord.r_appendages_eyelashes_trichiasis == "No" %>
                    Trichiasis,
                <% end %>
                <% unless opdrecord.r_appendages_eyelashes_dystrichiasis == "No" %>
                    Dystrichiasis,
                <% end %>
              <% end %>
          <% end %>
          <% if r_lacrimar_counter > 0 %>
              <% if opdrecord.r_appendages_tests.include?"lacrimalsac" %>
                  <b>Lacrimal sac:</b>
                  <% unless opdrecord.r_appendages_lacrimalsac_swelling == "No" %>
                      Swelling,
                  <% end %>
                  <% unless opdrecord.r_appendages_lacrimalsac_regurgitation == "No" %>
                      Roplas-positive,
                  <% end %>
              <% end %>
          <% end %>
          <% if r_syringing_counter > 0 %>
              <% if opdrecord.r_appendages_tests.include?"syringing" %>
                  <b>Syringing:</b>
                  <% unless opdrecord.r_appendages_syringing == "Patent" %>
                      Blocked
                  <% else %>
                      Patent
                  <% end %>
              <% end %>
          <% end %>

          <% unless params[:action] == "print_opd_record" %>
            <div class="row">
              <% if opdrecord['r_appendages_diagram_present'] == "Y" %>
                  <div class="col-md-4">
                    <% appendages_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.r_appendages_temp_asset_id).try(:asset_path) %>
                    <% eyeside = 'r' %>
                    <% temp_asset_id = opdrecord.id %>
                    <% diagram_type = 'appendages' %>
                    <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                      <%= image_tag appendages_image_url_thumb.to_s, height: '90', width: '90' %>
                     <% end %>
                    <div>
                      Appendages
                    </div>
                  </div>
              <% end %>
            </div>
          <% end %>
          <% if r_appendages_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= r_appendages_comments_op.html_safe %> </span> </div>
          <% end %>
        </span>
          <div class="examination_non_tabular">
          </div>
      <% end %>

      <% if r_conjunctiva_counter > 0 %>
        <b>Conjunctiva: </b><% unless r_conjunctiva_op ==[] %><%= r_conjunctiva_op %><% end %>
        <% if r_conjunctiva_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= r_conjunctiva_comments_op.html_safe %> </span> </div>
        <% end %>
        <div class="examination_non_tabular">
      </div>
      <% end %>

      <% if r_cornea_counter > 0 %>
          <b>Cornea: </b><% unless r_cornea_op ==[] %><%= r_cornea_op %><% end %>

          <% if r_cornea_comments_op.present? %><div><span style="display: list-item;margin-left: 6%"><%= r_cornea_comments_op.html_safe %> </span> </div>
          <% end %>
          <div class="examination_non_tabular">
          </div>

      <% elsif opdrecord.r_local_examination_normal == "normal" %>
          <b>Cornea: </b>Size/Shape/Surface Normal
          <div class="examination_non_tabular"></div>
      <% end %>

      <% if r_anteriorchamber_counter > 0 %>
          <p class="examination_non_tabular"><b>Anterior Chamber: </b><%= r_anteriorchamber_op %> <% if r_anteriorchamber_comments_op.present? %><br> <span style="display: list-item;margin-left: 6%"><%= r_anteriorchamber_comments_op.html_safe %> </span> <% end %></p>
      <% elsif opdrecord.r_local_examination_normal == "normal" %>
        <b>Anterior Chamber: </b>Within Normal Limits
        <div class="examination_non_tabular"></div>
      <% end %>

      <% if r_pupil_counter > 0 %>
          <p class="examination_non_tabular"><b>Pupil: </b><%= r_pupil_op.html_safe %> <% if r_pupil_comments_op.present? %><br> <span style="display: list-item;margin-left: 6%"><%= r_pupil_comments_op.html_safe %> </span> <% end %></p>
      <% elsif opdrecord.r_local_examination_normal == "normal" %>
        <b>Pupil: </b>Within Normal Limits
        <div class="examination_non_tabular"></div>
     <% end %>
      <% if r_iris_counter > 0 %>
          <p class="examination_non_tabular"><b>Iris: </b><%= r_iris_op %> <% if r_iris_comments_op.present? %><br> <span style="display: list-item;margin-left: 6%"><%= r_iris_comments_op.html_safe %> </span> <% end %></p>
      <% elsif opdrecord.r_local_examination_normal == "normal" %>
          <b>Iris: </b>Within Normal Limits
          <div class="examination_non_tabular"></div>
      <% end %>
      <% if r_lens_counter > 0 %>
          <p class="examination_non_tabular"><b>Lens: </b><%= r_lens_op %> <% if r_lens_comments_op.present? %><br> <span style="display: list-item;margin-left: 6%"><%= r_lens_comments_op.html_safe %><% end %> </span> </p>
      <% elsif opdrecord.r_local_examination_normal == "normal" %>
          <b>Lens: </b>Within Normal Limits
          <div class="examination_non_tabular"></div>
      <% end %>

      <% if r_extraocularmovements_counter > 0 %>
        <p class="examination_non_tabular"><b>Extra Ocular Movements: </b><%= r_extraocularmovements_op %> <% if r_extraocularmovements_comments_op.present? %><br> <span style="display: list-item;margin-left: 4%"><%= r_extraocularmovements_comments_op.html_safe %> </span> <% end %></p>
      <div class="examination_non_tabular"></div>
      <% end %>

  <% if opdrecord.read_attribute(:r_gonioscopy) == "Abnormal" %>
    <% if opdrecord.read_attribute(:r_gonioscopy_eye_superior_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_superior_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_superior_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d3) != "" %>
    <span class="abnormal-highlight">
      <div class="row">
        <div class="col-md-12"><b>Gonioscopy: </b></div>
        <div class="col-md-12 text-center" style="margin-bottom:10px;">
          <span><b>Superior:</b></span>
          <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_superior_d1) != "" %>Grade <%= opdrecord.read_attribute(:r_gonioscopy_eye_superior_d1) %>,<% else %>-<% end %></span>
          <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_superior_d2) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_superior_d2) %>, <% else %>-<% end %></span>
          <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_superior_d3) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_superior_d3) %><% else %>-<% end %></span>
        </div>
        <div class="col-md-4" style="margin-top:5%;">
          <b>Temporal:</b><br>
          <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d1) != "" %>Grade <%= opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d1) %>,<% else %>-<% end %></span>
          <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d2) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d2) %>, <% else %>-<% end %></span>
          <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d3) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d3) %><% else %>-<% end %></span>
        </div>
        <div class="col-md-4 text-center">
          <div class="circle wide" style="margin-left:-20px;"><p class="centralize">X</p></div>
        </div>
        <div class="col-md-4" style="margin-top:5%;">
          <b>Nasal:</b><br>
          <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d1) != "" %>Grade <%= opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d1) %>,<% else %>-<% end %></span>
          <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d2) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d2) %>, <% else %>-<% end %></span>
          <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d3) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d3) %><% else %>-<% end %></span>
        </div>
        <div class="col-md-12 text-center mb10">
          <div class="col-md-12 text-center" style="margin-top:5px;">
            <span><b>Inferior:</b></span>
            <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d1) != "" %>Grade <%= opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d1) %>,<% else %>-<% end %></span>
            <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d2) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d2) %>, <% else %>-<% end %></span>
            <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d3) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d3) %><% else %>-<% end %></span>
          </div>
        </div>
        <div class="col-md-12">
          <% if opdrecord.read_attribute(:r_gonioscopy_comment) != "" || opdrecord.read_attribute(:r_gonioscopy_comment) != nil %>
              <p class="examination_non_tabular"><span style="display: list-item;margin-left: 4%"><%= opdrecord.read_attribute(:r_gonioscopy_comment).html_safe %></span> </p>
          <% end %>
        </div>
      </div>
    </span>
    <% end %>
  <% end %>
    </div>

    <div class="col-md-6">
      <% if l_appearance_counter > 0 %>
        <b>Appearance:</b><% unless l_appearance_op ==[] %> <%= l_appearance_op %><% end %>
        <% if l_appearance_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= l_appearance_comments_op.html_safe %> </span> </div>
        <% end %>
        <div class="examination_non_tabular">
        </div>
      <% end %>
      <% if l_scleracommon_counter > 0 %>
        <span class="abnormal-highlight">
          <b>Sclera:</b>
          <% if l_scleracommon_comments.present? %><div><span style="display: list-item;margin-left: 4%"><%= l_scleracommon_comments.html_safe %> </span> </div>
          <% end %>
          <div class="examination_non_tabular">
          </div>
        </span>
      <% end %>
      <% if trauma_result_l.present?   || trauma_comment_left.present? %>
          <span class="abnormal-highlight">
          <b>Ocular Trauma:</b>
          <% unless trauma_result_l.blank? %>
            <span><%= trauma_result_l %> Injury</span>
          <% end %>
          <br>
          <% unless trauma_comment_left.blank? %>
              <span style="display: list-item;margin-left: 4%"> <%= trauma_comment_left.html_safe %></span>
          <% end %>
          </span>
          <div class="examination_non_tabular"></div>
      <% end %>
      <% if l_appendages_counter > 0 %>
        <span class="abnormal-highlight">
          <b>Appendages: </b>
          <% if l_eyelid_counter > 0 %>
              <% if opdrecord.l_appendages_tests.include?"eyelids" %>
                  <b>Eyelids:</b>
                  <% if opdrecord.l_appendages_eyelids_chalazion.present? %>
                      <% unless opdrecord.l_appendages_eyelids_chalazion == "No" %>
                          Chalazion,
                      <% end %>
                  <% end %>
                  <% if  opdrecord.l_appendages_eyelids_fb.present? %>
                      <% unless opdrecord.l_appendages_eyelids_fb == "No" %>
                          F.B,
                      <% end %>
                  <% end %>
                  <% if opdrecord.l_appendages_eyelashes_laceration.present? %>
                      <% unless opdrecord.l_appendages_eyelashes_laceration == "No" %>
                          Laceration,
                      <% end %>
                  <% end %>
                  <% if opdrecord.l_appendages_eyelids_contusion.present? %>
                      <% unless opdrecord.l_appendages_eyelids_contusion == "No" %>
                          contusion,
                      <% end %>
                  <% end %>
                  <% unless opdrecord.l_appendages_eyelids_ptosis == "No" %>
                      Ptosis,
                  <% end %>
                  <% unless opdrecord.l_appendages_eyelids_swelling == "No" %>
                      Swelling,
                  <% end %>
                  <% unless opdrecord.l_appendages_eyelids_entropion == "No" %>
                      Entropion,
                  <% end %>
                  <% unless opdrecord.l_appendages_eyelids_ectropion == "No" %>
                      Ectropion,
                  <% end %>
                  <% unless opdrecord.l_appendages_eyelids_mass== "No" %>
                      Eyelids mass,
                  <% end %>
                  <% if opdrecord.l_appendages_eyelids_meibomitis.present? %>
                      <% unless opdrecord.l_appendages_eyelids_meibomitis == "No" %>
                          Meibomitis,
                      <% end %>
                  <% end %>
              <% end %>
          <% end %>
          <% if l_eyelsahes_counter > 0 %>
              <% if opdrecord.l_appendages_tests.include?"eyelashes" %>
                  <b>Eyelashes:</b>
                  <% unless opdrecord.l_appendages_eyelashes_trichiasis == "No" %>
                      Trichiasis,
                  <% end %>
                  <% unless opdrecord.l_appendages_eyelashes_dystrichiasis == "No" %>
                      Dystrichiasis,
                  <% end %>
              <% end %>
          <% end %>
          <% if l_lacrimal_counter> 0 %>
              <% if opdrecord.l_appendages_tests.include?"lacrimalsac" %>
                  <b>Lacrimal sac:</b>
                  <% unless opdrecord.l_appendages_lacrimalsac_swelling == "No" %>
                      Swelling,
                  <% end %>
                  <% unless opdrecord.l_appendages_lacrimalsac_regurgitation == "No" %>
                      Roplas-positive,
                  <% end %>
              <% end %>
          <% end %>
          <% if l_syringing_counter > 0 %>
              <% if opdrecord.l_appendages_tests.include?"syringing" %>
                  <b>Syringing:</b>
                  <% unless opdrecord.l_appendages_syringing == "Patent" %>
                      Blocked,
                  <% else %>
                      Patent
                  <% end %>
              <% end %>
          <% end %>
          <% unless params[:action] == "print_opd_record" %>
            <div class="row">
              <% if opdrecord['l_appendages_diagram_present'] == "Y" %>
                  <div class="col-md-4">
                    <% appendages_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.l_appendages_temp_asset_id).try(:asset_path) %>
                    <% eyeside = 'l' %>
                    <% temp_asset_id = opdrecord.id %>
                    <% diagram_type = 'appendages' %>
                    <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                      <%= image_tag appendages_image_url_thumb.to_s, height: '90', width: '90' %>
                     <% end %>
                    <div>
                      Appendages
                    </div>
                  </div>
              <% end %>
            </div>
          <% end %>
          <% if l_appendages_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= l_appendages_comments_op.html_safe %> </span> </div>
          <% end %>
        </span>
          <div class="examination_non_tabular">
          </div>
      <% end %>

      <% if l_conjunctiva_counter > 0 %>
        <b>Conjunctiva:</b><% unless l_conjunctiva_op ==[] %> <%= l_conjunctiva_op %><% end %>
        <% if l_conjunctiva_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= l_conjunctiva_comments_op.html_safe %> </span> </div>
        <% end %>
        <div class="examination_non_tabular">
        </div>
      <% end %>

      <% if l_cornea_counter > 0 %>
          <b>Cornea: </b><% unless l_cornea_op ==[] %><%= l_cornea_op %><% end %>
          <% if l_cornea_comments_op.present? %><div><span style="display: list-item;margin-left: 6%"><%= l_cornea_comments_op.html_safe %> </span> </div>
          <% end %>
          <div class="examination_non_tabular">
          </div>

      <% elsif opdrecord.l_local_examination_normal == "normal" %>
          <b>Cornea: </b>Size/Shape/Surface Normal
          <div class="examination_non_tabular"></div>
      <% end %>

      <% if l_anteriorchamber_counter > 0 %>
          <p class="examination_non_tabular"><b>Anterior Chamber:</b> <%= l_anteriorchamber_op %><% if l_anteriorchamber_comments_op.present? %><br> <span style="display: list-item;margin-left: 6%"><%= l_anteriorchamber_comments_op.html_safe %> </span> <% end %></p>
      <% elsif opdrecord.l_local_examination_normal == "normal" %>
          <b>Anterior Chamber: </b>Within Normal Limits
          <div class="examination_non_tabular"></div>
      <% end %>

      <% if l_pupil_counter > 0 %>
          <p class="examination_non_tabular"><b>Pupil:</b> <%= l_pupil_op.html_safe %> <% if l_pupil_comments_op.present? %> <br><span style="display: list-item;margin-left: 6%"><%= l_pupil_comments_op.html_safe %> </span>  <% end %></p>
      <% elsif opdrecord.l_local_examination_normal == "normal" %>
          <b>Pupil: </b>Within Normal Limits
          <div class="examination_non_tabular"></div>
      <% end %>
      <% if l_iris_counter > 0 %>
          <p class="examination_non_tabular"><b>Iris:</b> <%= l_iris_op %> <% if l_iris_comments_op.present? %> <br><span style="display: list-item;margin-left: 6%"><%= l_iris_comments_op.html_safe %> </span>  <% end %></p>
      <% elsif opdrecord.l_local_examination_normal == "normal" %>
          <b>Iris: </b>Within Normal Limits
          <div class="examination_non_tabular"></div>
      <% end %>
      <% if l_lens_counter > 0 %>
          <p class="examination_non_tabular"><b>Lens:</b> <%= l_lens_op %> <% if l_lens_comments_op.present? %> <br><span style="display: list-item;margin-left: 6%"><%= l_lens_comments_op.html_safe %> </span>  <% end %></p>
      <% elsif opdrecord.l_local_examination_normal == "normal" %>
          <b>Lens: </b>Within Normal Limits
          <div class="examination_non_tabular"></div>
      <% end %>

      <% if l_extraocularmovements_counter > 0 %>
          <p class="examination_non_tabular"><b>Extra Ocular Movements:</b> <%= l_extraocularmovements_op %> <% if l_extraocularmovements_comments_op.present? %> <br><span style="display: list-item;margin-left: 4%"><%= l_extraocularmovements_comments_op.html_safe %> </span> <% end %></p>
          <div class="examination_non_tabular"></div>
      <% end %>

      <% if opdrecord.read_attribute(:l_gonioscopy) == "Abnormal" %>
        <% if opdrecord.read_attribute(:l_gonioscopy_eye_superior_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_superior_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_superior_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d3) != "" %>
        <span class="abnormal-highlight">
          <div class="row">
            <div class="col-md-12"><b>Gonioscopy: </b></div>
            <div class="col-md-12 text-center" style="margin-bottom:10px;">
              <span><b>Superior:</b></span>

              <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_superior_d1) != "" %>Grade <%= opdrecord.read_attribute(:l_gonioscopy_eye_superior_d1) %>, <% else %>-<% end %></span>
              <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_superior_d2) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_superior_d2) %>, <% else %>-<% end %></span>
              <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_superior_d3) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_superior_d3) %><% else %>-<% end %></span>
            </div>
            <div class="col-md-4" style="margin-top:5%;">
              <b>Nasal:</b><br>
              <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d1) != "" %>Grade <%= opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d1) %>, <% else %>-<% end %></span>
              <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d2) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d2) %>, <% else %>-<% end %></span>
              <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d3) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d3) %><% else %>-<% end %></span>
            </div>
            <div class="col-md-4 text-center">
              <div class="circle wide" style="margin-left:-20px;"><p class="centralize">X</p></div>
            </div>
            <div class="col-md-4" style="margin-top:5%;">
              <b>Temporal:</b><br>
              <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d1) != "" %>Grade <%= opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d1) %>, <% else %>-<% end %></span>
              <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d2) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d2) %>, <% else %>-<% end %></span>
              <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d3) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d3) %><% else %>-<% end %></span>
            </div>
            <div class="col-md-12 text-center mb10">
              <div class="col-md-12 text-center" style="margin-top:5px;">
                <span><b>Inferior:</b></span>
                <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d1) != "" %>Grade <%= opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d1) %>, <% else %>-<% end %></span>
                <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d2) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d2) %>, <% else %>-<% end %></span>
                <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d3) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d3) %><% else %>-<% end %></span>
              </div>
            </div>
          </div>
          <div class="col-md-12">
            <% if opdrecord.read_attribute(:l_gonioscopy_comment) != "" || opdrecord.read_attribute(:l_gonioscopy_comment) != nil %>
                <p class="examination_non_tabular"><span style="display: list-item;margin-left: 4%"><%= opdrecord.read_attribute(:l_gonioscopy_comment).html_safe %></span> </p>
            <% end %>
          </div>
        </span>
        <% end %>
    <% end %>
    </div>

  </div>

  <% end %>

  <% r_fundus_counter = 0 %>
  <% r_fundus_op = '' %>
  <% r_fundus_comments_op = '' %>
  <% r_fundus_comments = '' %>

  <% r_fundus_media_select = '' %>
  <% r_fundus_macula_fovealreflex = '' %>
  <% r_fundus_media_comment = '' %>
  <% r_fundus_pvd_select = '' %>
  <% r_fundus_optdiscsize_select = '' %>
  <% r_fundus_cupratio_comment = '' %>
  <% r_fundus_opticdisc_comment = '' %>
  <% r_fundus_bloodvessel_comment = '' %>
  <% r_fundus_macula_comment = '' %>
  <% r_fundustext_comment = '' %>

  <% r_color_vision_counter = 0 %>

  <% unless opdrecord.r_fundus.blank? %>
      <% unless opdrecord.r_fundus == "Normal" %>
          <% unless opdrecord.r_fundus_media_select == "" %>
              <% if opdrecord.r_fundus_media_comment.present? %>
                  <% r_fundus_media_select = "Media-#{opdrecord.read_attribute(:r_fundus_media_select)}(#{opdrecord.read_attribute(:r_fundus_media_comment)})," %>
              <% else %>
                  <% r_fundus_media_select = "Media-#{opdrecord.read_attribute(:r_fundus_media_select)}," %>
              <% end %>

              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_media_select}" %>
              <% r_fundus_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_fundus_pvd_select == "" %>
              <% r_fundus_pvd_select = "PVD-#{opdrecord.read_attribute(:r_fundus_pvd_select)}," %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_pvd_select}" %>
              <% r_fundus_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_fundus_optdiscsize_select == "" %>
              <% r_fundus_optdiscsize_select = "OptDiscSize-#{opdrecord.read_attribute(:r_fundus_optdiscsize_select)}," %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_optdiscsize_select}" %>
              <% r_fundus_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_fundus_cupratio_comment == "" %>
              <% r_fundus_cupratio_comment = "CupRatio-#{opdrecord.read_attribute(:r_fundus_cupratio_comment)}," %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_cupratio_comment}" %>
              <% r_fundus_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_fundus_opticdisc_comment == "" %>
              <% r_fundus_opticdisc_comment = "OpticDisc-#{opdrecord.read_attribute(:r_fundus_opticdisc_comment)}," %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_opticdisc_comment}" %>
              <% r_fundus_counter += 1 %>
          <% end %>

          <% if opdrecord.r_fundus_bloodvessel_comment.present? && opdrecord.r_fundus_bloodvessel_select.present? %>
              <% r_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:r_fundus_bloodvessel_select)}-#{opdrecord.read_attribute(:r_fundus_bloodvessel_comment)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_bloodvessel}" %>
              <% r_fundus_counter += 1 %>
          <% elsif opdrecord.r_fundus_bloodvessel_comment.blank? && opdrecord.r_fundus_bloodvessel_select.present? %>
              <% r_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:r_fundus_bloodvessel_select)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_bloodvessel}" %>
              <% r_fundus_counter += 1 %>
          <% elsif opdrecord.r_fundus_bloodvessel_comment.present? && opdrecord.r_fundus_bloodvessel_select.blank? %>
              <% r_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:r_fundus_bloodvessel_comment)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_bloodvessel}" %>
              <% r_fundus_counter += 1 %>
          <% end %>

          <% if opdrecord.r_fundus_macula_comment.present? && opdrecord.r_fundus_macula_select.present? %>
              <% r_fundus_macula = "Macula-#{opdrecord.read_attribute(:r_fundus_macula_select)}-#{opdrecord.read_attribute(:r_fundus_macula_comment)}," %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_macula}" %>
              <% r_fundus_counter += 1 %>
          <% elsif opdrecord.r_fundus_macula_comment.blank? && opdrecord.r_fundus_macula_select.present? %>
              <% r_fundus_macula = "Macula-#{opdrecord.read_attribute(:r_fundus_macula_select)}," %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_macula}" %>
              <% r_fundus_counter += 1 %>
          <% elsif opdrecord.r_fundus_macula_comment.present? && opdrecord.r_fundus_macula_select.blank? %>
              <% r_fundus_macula = "Macula-#{opdrecord.read_attribute(:r_fundus_macula_comment)}," %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_macula}" %>
              <% r_fundus_counter += 1 %>
          <% end %>
          <% if opdrecord.r_fundus_macula_select.present? &&  opdrecord.r_fundus_macula_select&.split(',')[0] == "Foveal Reflex" %>
            <% r_fundus_macula_fovealreflex = "Foveal Reflex- #{opdrecord.read_attribute(:r_fundus_macula_fovealreflex).to_s}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_macula_fovealreflex}" %>
            <% r_fundus_counter += 1 %>
          <% end %>
          <% if opdrecord.r_fundus_vitreous_comment.present? && opdrecord.r_fundus_vitreous_select.present? %>
              <% r_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:r_fundus_vitreous_select)}-#{opdrecord.read_attribute(:r_fundus_vitreous_comment)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_vitreous}" %>
              <% r_fundus_counter += 1 %>
          <% elsif opdrecord.r_fundus_vitreous_comment.blank? && opdrecord.r_fundus_vitreous_select.present? %>
              <% r_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:r_fundus_vitreous_select)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_vitreous}" %>
              <% r_fundus_counter += 1 %>
          <% elsif opdrecord.r_fundus_vitreous_comment.present? && opdrecord.r_fundus_vitreous_select.blank? %>
              <% r_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:r_fundus_vitreous_comment)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_vitreous}" %>
              <% r_fundus_counter += 1 %>
          <% end %>

          <% if opdrecord.r_fundus_retinal_detachment_comment.present? && opdrecord.r_fundus_retinal_detachment_select.present? %>
              <% r_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:r_fundus_retinal_detachment_select)}-#{opdrecord.read_attribute(:r_fundus_retinal_detachment_comment)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_retinal_detachment}" %>
              <% r_fundus_counter += 1 %>
          <% elsif opdrecord.r_fundus_retinal_detachment_comment.blank? && opdrecord.r_fundus_retinal_detachment_select.present? %>
              <% r_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:r_fundus_retinal_detachment_select)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_retinal_detachment}" %>
              <% r_fundus_counter += 1 %>
          <% elsif opdrecord.r_fundus_retinal_detachment_comment.present? && opdrecord.r_fundus_retinal_detachment_select.blank? %>
              <% r_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:r_fundus_retinal_detachment_comment)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_retinal_detachment}" %>
              <% r_fundus_counter += 1 %>
          <% end %>

          <% if opdrecord.r_fundus_lattice_degeneration_select.present? %>
              <% if opdrecord.r_fundus_peripheral_lesions_comment.present? %>
                  <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:r_fundus_lattice_degeneration_select)}-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_comment)}" %>
                  <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
                  <% r_fundus_counter += 1 %>
              <% else %>
                  <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:r_fundus_lattice_degeneration_select)}" %>
                  <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
                  <% r_fundus_counter += 1 %>
              <% end %>
          <% else %>
              <% if opdrecord.r_fundus_peripheral_lesions_comment.present? && opdrecord.r_fundus_peripheral_lesions_select.present? %>
                  <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_comment)}" %>
                  <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
                  <% r_fundus_counter += 1 %>
              <% elsif opdrecord.r_fundus_peripheral_lesions_comment.blank? && opdrecord.r_fundus_peripheral_lesions_select.present? %>
                  <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_select)}" %>
                  <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
                  <% r_fundus_counter += 1 %>
              <% elsif opdrecord.r_fundus_peripheral_lesions_comment.present? && opdrecord.r_fundus_peripheral_lesions_select.blank? %>
                  <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_comment)}" %>
                  <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
                  <% r_fundus_counter += 1 %>
              <% end %>
          <% end %>

          <% unless opdrecord.r_fundustext_comment == "" %>
              <% r_fundustext_comment = "Fundus-#{opdrecord.read_attribute(:r_fundustext_comment)}," %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundustext_comment}" %>
              <% r_fundus_counter += 1 %>
          <% end %>
          <% if opdrecord.r_fundus_comments != "<br>" %>
              <% r_fundus_comments = opdrecord.read_attribute(:r_fundus_comments).to_s %>
              <% r_fundus_comments_op = r_fundus_comments.to_s %>
              <% r_fundus_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_fundus_op.blank? %>
            <% r_fundus_op = r_fundus_op.split('') %>
            <% r_fundus_op_count = r_fundus_op.count %>
            <% if r_fundus_op_count > 0 %>
                <% r_fundus_op = (r_fundus_op.first r_fundus_op_count).join %>
            <% end %>
          <% end %>
      <% end %>
  <% end %>

  <% unless opdrecord.r_color_vision.blank? %>
      <% if opdrecord.r_color_vision.length > 0 %>
          <% r_color_vision = opdrecord.read_attribute(:r_color_vision).to_s %>
          <% r_color_vision_counter += 1 %>
      <% end %>
  <% end %>

  <% l_fundus_counter = 0 %>
  <% l_fundus_op = '' %>
  <% l_fundus_comments_op = '' %>
  <% l_fundus_comments = '' %>

  <% l_fundus_media_select = '' %>
  <% l_fundus_macula_fovealreflex = '' %>
  <% l_fundus_media_comment = '' %>
  <% l_fundus_pvd_select = '' %>
  <% l_fundus_optdiscsize_select = '' %>
  <% l_fundus_cupratio_comment = '' %>
  <% l_fundus_opticdisc_comment = '' %>
  <% l_fundus_bloodvessel_comment = '' %>
  <% l_fundus_macula_comment = '' %>
  <% l_fundustext_comment = '' %>

  <% l_color_vision_counter = 0 %>

  <% unless opdrecord.l_fundus.blank? %>
      <% unless opdrecord.l_fundus == "Normal" %>
          <% unless opdrecord.l_fundus_media_select == "" %>
              <% if opdrecord.l_fundus_media_comment.present? %>
                  <% l_fundus_media_select = "Media-#{opdrecord.read_attribute(:l_fundus_media_select)}(#{opdrecord.read_attribute(:l_fundus_media_comment)})," %>
              <% else %>
                  <% l_fundus_media_select = "Media-#{opdrecord.read_attribute(:l_fundus_media_select)}," %>
              <% end %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_media_select}" %>
              <% l_fundus_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_fundus_pvd_select == "" %>
              <% l_fundus_pvd_select = "PVD-#{opdrecord.read_attribute(:l_fundus_pvd_select)}," %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_pvd_select}" %>
              <% l_fundus_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_fundus_optdiscsize_select == "" %>
              <% l_fundus_optdiscsize_select = "OptDiscSize-#{opdrecord.read_attribute(:l_fundus_optdiscsize_select)}," %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_optdiscsize_select}" %>
              <% l_fundus_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_fundus_cupratio_comment == "" %>
              <% l_fundus_cupratio_comment = "CupRatio-#{opdrecord.read_attribute(:l_fundus_cupratio_comment)}," %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_cupratio_comment}" %>
              <% l_fundus_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_fundus_opticdisc_comment == "" %>
              <% l_fundus_opticdisc_comment = "OpticDisc-#{opdrecord.read_attribute(:l_fundus_opticdisc_comment)}," %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_opticdisc_comment}" %>
              <% l_fundus_counter += 1 %>
          <% end %>

          <% if opdrecord.l_fundus_bloodvessel_comment.present? && opdrecord.l_fundus_bloodvessel_select.present? %>
              <% l_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:l_fundus_bloodvessel_select)}-#{opdrecord.read_attribute(:l_fundus_bloodvessel_comment)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_bloodvessel}" %>
              <% l_fundus_counter += 1 %>
          <% elsif opdrecord.l_fundus_bloodvessel_comment.blank? && opdrecord.l_fundus_bloodvessel_select.present? %>
              <% l_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:l_fundus_bloodvessel_select)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_bloodvessel}" %>
              <% l_fundus_counter += 1 %>
          <% elsif opdrecord.l_fundus_bloodvessel_comment.present? && opdrecord.l_fundus_bloodvessel_select.blank? %>
              <% l_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:l_fundus_bloodvessel_comment)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_bloodvessel}" %>
              <% l_fundus_counter += 1 %>
          <% end %>

          <% if opdrecord.l_fundus_macula_comment.present? && opdrecord.l_fundus_macula_select.present? %>
              <% l_fundus_macula = "Macula-#{opdrecord.read_attribute(:l_fundus_macula_select)}-#{opdrecord.read_attribute(:l_fundus_macula_comment)}," %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_macula}" %>
              <% l_fundus_counter += 1 %>
          <% elsif opdrecord.l_fundus_macula_comment.blank? && opdrecord.l_fundus_macula_select.present? %>
              <% l_fundus_macula = "Macula-#{opdrecord.read_attribute(:l_fundus_macula_select)}," %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_macula}" %>
              <% l_fundus_counter += 1 %>
          <% elsif opdrecord.l_fundus_macula_comment.present? && opdrecord.l_fundus_macula_select.blank? %>
              <% l_fundus_macula = "Macula-#{opdrecord.read_attribute(:l_fundus_macula_comment)}," %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_macula}" %>
              <% l_fundus_counter += 1 %>
          <% end %>
          <% if opdrecord.l_fundus_macula_select.present? &&  opdrecord.l_fundus_macula_select&.split(',')[0] == "Foveal Reflex" %>
            <% l_fundus_macula_fovealreflex = "Foveal Reflex- #{opdrecord.read_attribute(:l_fundus_macula_fovealreflex).to_s}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_macula_fovealreflex}" %>
            <% l_fundus_counter += 1 %>
          <% end %>
          <% if opdrecord.l_fundus_vitreous_comment.present? && opdrecord.l_fundus_vitreous_select.present? %>
              <% l_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:l_fundus_vitreous_select)}-#{opdrecord.read_attribute(:l_fundus_vitreous_comment)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_vitreous}" %>
              <% l_fundus_counter += 1 %>
          <% elsif opdrecord.l_fundus_vitreous_comment.blank? && opdrecord.l_fundus_vitreous_select.present? %>
              <% l_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:l_fundus_vitreous_select)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_vitreous}" %>
              <% l_fundus_counter += 1 %>
          <% elsif opdrecord.l_fundus_vitreous_comment.present? && opdrecord.l_fundus_vitreous_select.blank? %>
              <% l_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:l_fundus_vitreous_comment)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_vitreous}" %>
              <% l_fundus_counter += 1 %>
          <% end %>

          <% if opdrecord.l_fundus_retinal_detachment_comment.present? && opdrecord.l_fundus_retinal_detachment_select.present? %>
              <% l_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:l_fundus_retinal_detachment_select)}-#{opdrecord.read_attribute(:l_fundus_retinal_detachment_comment)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_retinal_detachment}" %>
              <% l_fundus_counter += 1 %>
          <% elsif opdrecord.l_fundus_retinal_detachment_comment.blank? && opdrecord.l_fundus_retinal_detachment_select.present? %>
              <% l_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:l_fundus_retinal_detachment_select)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_retinal_detachment}" %>
              <% l_fundus_counter += 1 %>
          <% elsif opdrecord.l_fundus_retinal_detachment_comment.present? && opdrecord.l_fundus_retinal_detachment_select.blank? %>
              <% l_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:l_fundus_retinal_detachment_comment)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_retinal_detachment}" %>
              <% l_fundus_counter += 1 %>
          <% end %>

          <% if opdrecord.l_fundus_lattice_degeneration_select.present? %>
              <% if opdrecord.l_fundus_peripheral_lesions_comment.present? %>
                  <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:l_fundus_lattice_degeneration_select)}-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_comment)}" %>
                  <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
                  <% l_fundus_counter += 1 %>
              <% else %>
                  <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:l_fundus_lattice_degeneration_select)}" %>
                  <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
                  <% l_fundus_counter += 1 %>
              <% end %>
          <% else %>
              <% if opdrecord.l_fundus_peripheral_lesions_comment.present? && opdrecord.l_fundus_peripheral_lesions_select.present? %>
                  <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_comment)}" %>
                  <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
                  <% l_fundus_counter += 1 %>
              <% elsif opdrecord.l_fundus_peripheral_lesions_comment.blank? && opdrecord.l_fundus_peripheral_lesions_select.present? %>
                  <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_select)}" %>
                  <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
                  <% l_fundus_counter += 1 %>
              <% elsif opdrecord.l_fundus_peripheral_lesions_comment.present? && opdrecord.l_fundus_peripheral_lesions_select.blank? %>
                  <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_comment)}" %>
                  <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
                  <% l_fundus_counter += 1 %>
              <% end %>
          <% end %>

          <% unless opdrecord.l_fundustext_comment == "" %>
              <% l_fundustext_comment = "Fundus-#{opdrecord.read_attribute(:l_fundustext_comment)}," %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundustext_comment}" %>
              <% l_fundus_counter += 1 %>
          <% end %>
          <% if opdrecord.l_fundus_comments != "<br>" %>
              <% l_fundus_comments = opdrecord.read_attribute(:l_fundus_comments).to_s %>
              <% l_fundus_comments_op = l_fundus_comments.to_s %>
              <% l_fundus_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_fundus_op.blank? %>
            <% l_fundus_op = l_fundus_op.split('') %>
            <% l_fundus_op_count = l_fundus_op.count %>
            <% if l_fundus_op_count > 0 %>
                <% l_fundus_op = (l_fundus_op.first l_fundus_op_count).join %>
            <% end %>
          <% end %>
      <% end %>
  <% end %>

  <% unless opdrecord.l_color_vision.blank? %>
      <% if opdrecord.l_color_vision.length > 0 %>
          <% l_color_vision = opdrecord.read_attribute(:l_color_vision).to_s %>
          <% l_color_vision_counter += 1 %>
      <% end %>
  <% end %>

  <% if r_fundus_counter > 0 || l_fundus_counter > 0 %>
    <div class="row">
      <span><b>FUNDUS EXAMINATION</b></span>
      <div class="summary-line-border"></div>
    </div>

    <div class="mb5">
      <% if r_fundus_counter > 0 %>
        <% if r_fundus_op == " Media-Clear, PVD-Absent, OptDiscSize-Medium, CupRatio-0.3, OpticDisc-healthy, Bloodvessel-normal, Macula-Foveal Reflex, Fundus-within normal limits" && r_fundus_comments_op.blank? %>
          <div style="margin-left: 2%"><b>Right Eye:</b> Within Normal Limits</div>
        <% else %>
          <div style="margin-left: 2%"><b>Right Eye: </b><% unless r_fundus_op ==[] %><%= r_fundus_op %><% end %></div>
          <% if r_fundus_comments_op.present? %><div> <span style="display: list-item;margin-left: 5%"><%= r_fundus_comments_op.html_safe %> </span> </div><% end %>
          <div class="examination_non_tabular">
          </div>
        <% end %>
    <% elsif opdrecord.r_local_examination_normal == "normal" %>
        <!--<b>Fundus: </b>Media-Clear, OpticDisc-Normal, CDR-0.3:1, Macula-Normal-->
        <!--<div class="examination_non_tabular"></div>-->
    <% end %>

      <% if l_fundus_counter > 0 %>
        <% if l_fundus_op == " Media-Clear, PVD-Absent, OptDiscSize-Medium, CupRatio-0.3, OpticDisc-healthy, Bloodvessel-normal, Macula-Foveal Reflex, Fundus-within normal limits" && l_fundus_comments_op.blank? %>
          <div style="margin-left: 2%"><b>Left Eye:</b> Within Normal Limits</div>
        <% else %>
          <div style="margin-left: 2%"><b>Left Eye: </b><% unless l_fundus_op ==[] %><%= l_fundus_op %><% end %></div>
          <% if l_fundus_comments_op.present? %><div> <span style="display: list-item;margin-left: 5%"><%= l_fundus_comments_op.html_safe %> </span> </div><% end %>
          <div class="examination_non_tabular">
          </div>
        <% end %>
    <% elsif opdrecord.l_local_examination_normal == "normal" %>
        <!--<b>Fundus: </b>Media-Clear, OpticDisc-Normal, CDR-0.3:1, Macula-Normal-->
        <!--<div class="examination_non_tabular"></div>-->
    <% end %>
    </div>
  <% end %>

  <% if r_color_vision_counter > 0 || l_color_vision_counter > 0 %>
    <div class="row mb5">
      <strong>COLOR VISION EXAMINATION</strong>
      <div class="summary-line-border"></div>
    </div>

    <div class="col-md-6">
      <div class="text-center" style="background-color:#ddd;">R/OD</div>
    </div><!-- col-md-6  -->
    <div class="col-md-6">
      <div class="text-center" style="background-color:#ddd;">L/OS</div>
    </div><!-- col-md-6  -->
    <div class="row mb5">
      <div class="col-md-6">
        <% if r_color_vision_counter > 0 %>
          <p style="margin-bottom:0px;"><b>Color Vision:</b> <%= r_color_vision %></p>
        <% end %>
      </div>
       <div class="col-md-6">
        <% if l_color_vision_counter > 0 %>
          <p style="margin-bottom:0px;"><b>Color Vision:</b> <%= l_color_vision %></p>
        <% end %>
      </div>
    </div>
  <% end %>
  <!--If we don't need investigation then comment below and comment above.-->
  <%= render partial: 'opd_records/ophthalmology_notes/opd_partials/summary/opd_summary_form_assessment.html', locals: { specalityfoldername: @speciality_folder_name, specalityid: @specalityid, opdrecord: @opdrecord, templatetype: @templatetype, templateid: @templateid, opdspeciality: @opdspeciality, mail_job: mail_job } %>

  <%= render partial: 'opd_records/ophthalmology_notes/opd_partials/summary/opd_summary_form_procedure.html', locals: { specalityfoldername: @speciality_folder_name, specalityid: @specalityid, opdrecord: @opdrecord, templatetype: @templatetype, templateid: @templateid, opdspeciality: @opdspeciality } %>

  <%= render partial: 'opd_records/ophthalmology_notes/opd_partials/summary/opd_summary_form_glassesprescriptions.html', locals: { patient: @patient, appointment: @appointment, specalityfoldername: @speciality_folder_name, specalityid: @specalityid, opdrecord: @opdrecord, templatetype: @templatetype, templateid: @templateid, opdspeciality: @opdspeciality, mail_job: false } %>

  <%= render partial: 'opd_records/ophthalmology_notes/opd_partials/summary/opd_summary_form_medication.html', locals: { patient: @patient, appointment: @appointment, specalityfoldername: @speciality_folder_name, specalityid: @specalityid, opdrecord: @opdrecord, templatetype: @templatetype, templateid: @templateid, opdspeciality: @opdspeciality, mail_job: false, medication_groups: @medication_groups, translated_language: @translated_language } %>

  <div class="advice" id="advice" style="<%= text_font_size %>">
    <%= render partial: 'opd_records/ophthalmology_notes/opd_partials/summary/opd_summary_form_advice.html', locals: { specalityfoldername: @speciality_folder_name, specalityid: @specalityid, opdrecord: @opdrecord, advice: @opdrecord.advice, templatetype: @templatetype, templateid: @templateid, opdspeciality: @opdspeciality } %>
  </div>
</div>

<style type="text/css">

  .check_font table tr th {
    padding: 2px 5px;
  }

  .check_font table tr td {
    padding: 2px 5px;
  }
  thead, tfoot {
    display: table-row-group
  }
  tr {
    page-break-inside: avoid
  }
  .circle {
    border-radius: 50%;
    width: 40px;
    height: 40px;
    box-sizing: border-box;
    border-width: 5px;
    border-style: solid;
    border-color: #888 #aaa #888 #aaa;
    transform: rotate(0deg);
  }
  .centralize {
    margin-top: 35%;
    font-size: 28px;
  }
  .wide {
    width: 100px;
    height: 100px;
  }
  .abnormal-highlight{
    color: red;
  }
</style>
