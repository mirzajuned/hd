<div class="<%= 'print_text_font_size' if  @print_setting %>" style="<%= text_font_size %>">
  <% if opdrecord.send("#{@flag}_examination_flag") == "1" %>
    <div class="examination mb5" id="examination">
      <% examination_counter = 0 %>
      <% diagram_counter = 0 %>
      <% general_examination_counter = 0 %>
      <% generalexaminationcomments_counter = 0 %>
      <% generalexaminationcomments = '' %>
      <% generalexaminationcomments_op = '' %>
      <% generalexaminationcommoncomments_counter = 0 %>
      <% generalexaminationcommoncomments = '' %>
      <% generalexaminationcommoncomments_op = '' %>

      <% unless opdrecord.generalexamination.blank? %>
        <% if opdrecord.generalexaminationcommoncomments.present? && opdrecord.generalexaminationcommoncomments.length > 0 %>
          <% generalexaminationcommoncomments = "Comments- #{opdrecord.read_attribute(:generalexaminationcommoncomments)}" %>
          <% generalexaminationcommoncomments_op = generalexaminationcommoncomments.to_s %>
          <% generalexaminationcommoncomments_counter += 1 %>
          <% general_examination_counter += 1 %>
        <% end %>

        <% unless opdrecord.generalexamination == "Normal" %>
          <% if opdrecord.generalexaminationcomments.present? %>
            <% generalexaminationcomments = "General Comments- #{opdrecord.read_attribute(:generalexaminationcomments)}" %>
            <% generalexaminationcomments_op = generalexaminationcomments.to_s %>
            <% generalexaminationcomments_counter += 1 %>
            <% general_examination_counter += 1 %>
          <% end %>
        <% end %>
      <% end %>

      <%# if opdrecord.one_eyed == 'Yes' %>
        <%# one_eyed = "One Eyed - #{opdrecord.read_attribute(:"one_eyed")}" %>
        <%# general_examination_counter = general_examination_counter + 1 %>
      <%# end %>

      <% if @templatetype == "paediatrics" %>
        <% if opdrecord.paediatric_height.present? %>
          <% general_examination_counter += 1 %>
        <% end %>
        <% if opdrecord.paediatric_weight.present? %>
          <% general_examination_counter += 1 %>
        <% end %>
        <% if opdrecord.paediatric_general_appearance.present? %>
          <% general_examination_counter += 1 %>
        <% end %>
        <% if opdrecord.paediatric_head_posture.present? %>
          <% general_examination_counter += 1 %>
        <% end %>
        <% if opdrecord.paediatric_nutritional_status.present? %>
          <% general_examination_counter += 1 %>
        <% end %>
      <% end %>

      <% r_visualacuity_counter = 0 %>
      <% r_visualacuity_op = '' %>
      <% r_visualacuity_unaided = '' %>
      <% r_visualacuity_unaided_p = '' %>
      <% r_visualacuity_pinhole = '' %>
      <% r_visualacuity_pinhole_p = '' %>
      <% r_visualacuity_pinhole_ni = '' %>
      <% r_visualacuity_glasses = '' %>
      <% r_visualacuity_glasses_p = '' %>
      <% r_visualacuity_lens = '' %>
      <% r_visualacuity_lens_p = '' %>
      <% r_visualacuity_near = '' %>
      <% r_visualacuity_near_p = '' %>
      <% r_visualacuity_ua_near = '' %>
      <% r_visualacuity_ua_s = '' %>
      <% r_visualacuity_ua_n = '' %>
      <% r_visualacuity_ua_i = '' %>
      <% r_visualacuity_ua_t = '' %>
      <% r_visualacuity_ua_near_p = '' %>
      <% r_intraocularpressure_counter = 0 %>
      <% r_intraocularpressure_op = '' %>
      <% r_intraocularpressure = '' %>
      <% r_intraocularpressure_time = '' %>
      <% r_iop_method = '' %>
      <% r_iop_comment = '' %>
      <% r_intraocularpressure_comments = '' %>

      <% r_appearance_counter = 0 %>
      <% r_appearance_op = '' %>
      <% r_appearance_phthisisbulbi = '' %>
      <% r_appearance_anophthalmos = '' %>
      <% r_appearance_micropththalmos = '' %>
      <% r_appearance_artificial = '' %>
      <% r_appearance_proptosis = '' %>
      <% r_appearance_dystopia = '' %>
      <% r_appearance_injured = '' %>
      <% r_appearance_swollen = '' %>
      <% r_appearance_comments = '' %>

      <% r_scleracommon_counter = 0 %>
      <% r_scleracommon_comments = '' %>

      <% r_appendages_counter = 0 %>
      <% r_appendages_op = '' %>
      <% r_appendages_comments = 0 %>
      <% r_eyelid_counter = 0 %>
      <% r_eyelsahes_counter = 0 %>
      <% r_lacrimar_counter = 0 %>
      <% r_syringing_counter = 0 %>

      <% r_conjunctiva_counter = 0 %>
      <% r_conjunctiva_op = '' %>
      <% r_conjunctiva_congestion = '' %>
      <% r_conjunctiva_conjunctivitis = '' %>
      <% r_conjunctiva_episcleritis = '' %>
      <% r_conjunctiva_tear = '' %>
      <% r_conjunctiva_subconjunctival_haemorrhage = '' %>
      <% r_conjunctiva_foreign_body = '' %>
      <% r_conjunctiva_follicles = '' %>
      <% r_conjunctiva_papillae = '' %>
      <% r_conjunctiva_pinguecula = '' %>
      <% r_conjunctiva_pterygium = '' %>
      <% r_conjunctiva_phlycten = '' %>
      <% r_conjunctiva_discharge = '' %>
      <% r_conjunctiva_conjuctival_blib = '' %>
      <% r_conjunctiva_comments = '' %>
      <% r_conjunctiva_comments_op = '' %>

      <% r_cornea_counter = 0 %>
      <% r_corneaslit_counter = 0 %>
      <% r_cornea_op = '' %>
      <% r_cornea_size = '' %>
      <% r_cornea_shape = '' %>
      <% r_cornea_surface = '' %>
      <% r_fluorescein_staining = '' %>
      <% r_corneal_sensation = '' %>
      <% r_cornea_schirmer_dimension1 = '' %>
      <% r_cornea_schirmer_time1 = '' %>
      <% r_cornea_schirmer_dimension2 = '' %>
      <% r_cornea_schirmer_time2 = '' %>
      <% r_cornea_comments_op = '' %>
      <% r_cornea_comments = '' %>

      <% r_anteriorchamber_counter = 0 %>
      <% r_anteriorchamber_op = '' %>
      <% r_anteriorchamber_comments_op = '' %>
      <% r_anteriorchamber_comments = '' %>
      <% r_anteriorchamber_depth = '' %>
      <% r_anteriorchamber_reaction = '' %>
      <% r_anteriorchamber_cells = '' %>
      <% r_anteriorchamber_flare = '' %>
      <% r_anteriorchamber_hyphema = '' %>
      <% r_anteriorchamber_hypopyon = '' %>
      <% r_anteriorchamber_foreignbody = '' %>
      <% r_anteriorchamber_depth_comment = '' %>
      <% r_anteriorchamber_reaction_comment = '' %>
      <% r_anteriorchamber_cells_comment = '' %>
      <% r_anteriorchamber_flare_comment = '' %>
      <% r_anteriorchamber_hyphema_comment = '' %>
      <% r_anteriorchamber_hypopyon_comment = '' %>
      <% r_anteriorchamber_foreignbody_comment = '' %>

      <% r_pupil_counter = 0 %>
      <% r_pupil_op = '' %>
      <% r_pupil_comments_op = '' %>
      <% r_pupil_comments = '' %>
      <% r_pupil_shape = '' %>
      <% r_pupilsize = '' %>
      <% r_pupil_reaction_to_light_direct = '' %>
      <% r_pupil_reaction_to_light_consensual = '' %>
      <% r_pupil_rapd = '' %>

      <% r_iris_counter = 0 %>
      <% r_iris_op = '' %>
      <% r_iris_comments_op = '' %>
      <% r_iris_comments = '' %>
      <% r_iris_shape = '' %>
      <% r_iris_neovascularisation = '' %>
      <% r_iris_synechiae = '' %>
      <% r_iris_peripheraliridotomy = '' %>

      <% r_lens_counter = 0 %>
      <% r_lens_op = '' %>
      <% r_lens_comments_op = '' %>
      <% r_lens_comments = '' %>
      <% r_lens_nature = '' %>
      <% r_lens_position = '' %>
      <% r_lens_size = '' %>
      <% r_lens_grading_no = '' %>
      <% r_lens_grading_nc = '' %>
      <% r_lens_grading_c = '' %>
      <% r_lens_grading_p = '' %>

      <% r_extraocularmovements_counter = 0 %>
      <% r_extraocularmovements_op = '' %>
      <% r_extraocularmovements_comments_op = '' %>
      <% r_extraocularmovements_comments = '' %>
      <% r_extraocularmovements_uniocular = '' %>
      <% r_extraocularmovements_binocular = '' %>
      <% r_extraocularmovements_prism = '' %>
      <% r_extraocularmovements_squint = '' %>
      <% r_extraocularmovements_squint_tropia = '' %>
      <% r_extraocularmovements_squint_tropia_horizontal = '' %>
      <% r_extraocularmovements_squint_tropia_horizontal_esotropia = '' %>
      <% r_extraocularmovements_squint_tropia_horizontal_exotropia = '' %>
      <% r_extraocularmovements_squint_tropia_vertical = '' %>
      <% r_extraocularmovements_squint_tropia_paralytic = '' %>
      <% r_extraocularmovements_squint_phoria = '' %>

      <% r_fundus_counter = 0 %>
      <% r_fundus_op = '' %>
      <% r_fundus_comments_op = '' %>
      <% r_fundus_comments = '' %>
      <% r_fundus_macula_select = '' %>
      <% r_fundus_macula_fovealreflex = '' %>
      <% r_fundus_bloodvessel_select = '' %>
      <% r_fundus_vitreous_select = '' %>
      <% r_fundus_retinal_detachment_select = '' %>
      <% r_fundus_peripheral_lesions_select = '' %>
      <% r_fundus_lattice_degeneration_select = '' %>
      <% r_fundus_media_select = '' %>
      <% r_fundus_media_comment = '' %>
      <% r_fundus_pvd_select = '' %>
      <% r_fundus_optdiscsize_select = '' %>
      <% r_fundus_cupratio_comment = '' %>
      <% r_fundus_cup_disc_ratio_select = '' %>
      <% r_fundus_opticdisc_comment = '' %>
      <% r_fundus_bloodvessel_comment = '' %>
      <% r_fundus_macula_comment = '' %>
      <% r_fundus_vitreous_comment = '' %>
      <% r_fundus_retinal_detachment_comment = '' %>
      <% r_fundus_peripheral_lesions_comment = '' %>
      <% r_fundustext_comment = '' %>

      <% r_color_vision_counter = 0 %>
      <% r_orthoptics_counter = 0 %>
      <% r_contrastsensitivity_counter = 0 %>

      <% r_objectivecomments_counter = 0 %>
      <% r_objectivecomments_op = '' %>
      <% r_objectivecomments_comments_op = '' %>
      <% r_objectivecomments = '' %>

      <% orthoptics_heading_counter = 0 %>
      <% r_orthoptics_template_counter = 0 %>
      <% r_ocular_diagram_counter = 0 %>
      <% head_posture = '' %>
      <% face_turn = '' %>
      <% head_tilt = '' %>
      <% r_hirschberg_test = '' %>
      <% r_cover_test = '' %>
      <% r_alternate_cover_test = '' %>
      <% r_patterns = '' %>
      <% r_prism_bar_cover_test = '' %>
      <% r_prism_bar_reflex_test = '' %>
      <% r_ocular_movement1 = '-' %>
      <% r_ocular_movement2 = '-' %>
      <% r_ocular_movement3 = '-' %>
      <% r_ocular_movement4 = '-' %>
      <% r_ocular_movement5 = '-' %>
      <% r_ocular_movement6 = '-' %>
      <% r_nystagmus = '' %>
      <% r_maddox_test = '' %>
      <% r_worth_four_dot_test = '' %>
      <% r_stereopsis = '' %>
      <% r_hess_screen_test = '' %>

      <% if mail_job == false %>
        <% unless params[:action] == "print_opd_record" %>
          <% diagram_counter = 0 %>
          <% if opdrecord['r_cornea_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord['r_corneaslit_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord['r_fundus_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord['r_appendages_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord['l_cornea_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord['l_corneaslit_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord['l_fundus_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord['l_lens_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord['r_lens_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord['l_appendages_diagram_present'] == "Y" %>
            <% diagram_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
        <% end %>
      <% end %>

      <% if opdrecord.head_posture.present? %>
        <% head_posture = "Head Posture: #{opdrecord.read_attribute(:head_posture)}" %>
        <% orthoptics_heading_counter += 1 %>
      <% end %>

      <% if opdrecord.face_turn.present? %>
        <% face_turn = "Face turn: #{opdrecord.read_attribute(:face_turn)}" %>
        <% orthoptics_heading_counter += 1 %>
      <% end %>

      <% if opdrecord.head_tilt.present? %>
        <% head_tilt = "Head Tilt: #{opdrecord.read_attribute(:head_tilt)}" %>
        <% orthoptics_heading_counter += 1 %>
      <% end %>

      <% if opdrecord.r_hirschberg_test.present? %>
        <% r_hirschberg_test = opdrecord.read_attribute(:r_hirschberg_test).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.r_cover_test.present? %>
        <% r_cover_test = opdrecord.read_attribute(:r_cover_test).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.r_alternate_cover_test.present? %>
        <% r_alternate_cover_test = opdrecord.read_attribute(:r_alternate_cover_test).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.r_patterns.present? %>
        <% r_patterns = opdrecord.read_attribute(:r_patterns).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.r_prism_bar_cover_test.present? %>
        <% r_prism_bar_cover_test = opdrecord.read_attribute(:r_prism_bar_cover_test).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.r_prism_bar_reflex_test.present? %>
        <% r_prism_bar_reflex_test = opdrecord.read_attribute(:r_prism_bar_reflex_test).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_ocular_movement1).blank? %>
        <% r_ocular_movement1 = opdrecord.read_attribute(:r_ocular_movement1).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% r_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_ocular_movement2).blank? %>
        <% r_ocular_movement2 = opdrecord.read_attribute(:r_ocular_movement2).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% r_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_ocular_movement3).blank? %>
        <% r_ocular_movement3 = opdrecord.read_attribute(:r_ocular_movement3).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% r_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_ocular_movement4).blank? %>
        <% r_ocular_movement4 = opdrecord.read_attribute(:r_ocular_movement4).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% r_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_ocular_movement5).blank? %>
        <% r_ocular_movement5 = opdrecord.read_attribute(:r_ocular_movement5).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% r_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_ocular_movement6).blank? %>
        <% r_ocular_movement6 = opdrecord.read_attribute(:r_ocular_movement6).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% r_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_nystagmus).blank? %>
        <% r_nystagmus = opdrecord.read_attribute(:r_nystagmus).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_maddox_test).blank? %>
        <% r_maddox_test = opdrecord.read_attribute(:r_maddox_test).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_worth_four_dot_test).blank? %>
        <% r_worth_four_dot_test = opdrecord.read_attribute(:r_worth_four_dot_test).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_stereopsis).blank? %>
        <% r_stereopsis = opdrecord.read_attribute(:r_stereopsis).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:r_hess_screen_test).blank? %>
        <% r_hess_screen_test = opdrecord.read_attribute(:r_hess_screen_test).to_s %>
        <% r_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if @current_facility.country_id != "VN_254" %>
        <% if opdrecord.read_attribute(:r_visualacuity_unaided_p).present? %>
          <% r_visualacuity_unaided_p = "(#{opdrecord.read_attribute(:r_visualacuity_unaided_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_unaided_comments).to_s.length > 0 %>
          <% r_visualacuity_unaided_comments = " (#{opdrecord.read_attribute(:r_visualacuity_unaided_comments)})" %>
        <% end %>
        <% unless opdrecord.r_visualacuity_unaided.blank? %>
          <% r_visualacuity_unaided = "UCVA - #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:r_visualacuity_unaided))}#{r_visualacuity_unaided_p}#{r_visualacuity_unaided_comments}" %>
          <% r_visualacuity_op = r_visualacuity_unaided.to_s %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_pinhole_p).present? %>
          <% r_visualacuity_pinhole_p = "(#{opdrecord.read_attribute(:r_visualacuity_pinhole_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_pinhole_ni).present? %>
          <% r_visualacuity_pinhole_ni = "(#{opdrecord.read_attribute(:r_visualacuity_pinhole_ni)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_ua_near_p).present? %>
          <% r_visualacuity_ua_near_p = "(#{opdrecord.read_attribute(:r_visualacuity_ua_near_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_ua_near_comments).to_s.length > 0 %>
          <% r_visualacuity_ua_near_comments = " (#{opdrecord.read_attribute(:r_visualacuity_ua_near_comments)})" %>
        <% end %>
        <% unless opdrecord.r_visualacuity_ua_near.blank? %>
          <% r_visualacuity_ua_near = "UCVA Near- #{opdrecord.read_attribute(:r_visualacuity_ua_near)}#{r_visualacuity_ua_near_p}#{r_visualacuity_ua_near_comments}" %>
          <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_ua_near}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
         <% if opdrecord.r_visualacuity_ua_s.present? %>
          <% r_visualacuity_ua_s = "S#{opdrecord.read_attribute(:r_visualacuity_ua_s)}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.r_visualacuity_ua_i.present? %>
          <% r_visualacuity_ua_i = "I#{opdrecord.read_attribute(:r_visualacuity_ua_i)}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.r_visualacuity_ua_n.present? %>
          <% r_visualacuity_ua_n = "N#{opdrecord.read_attribute(:r_visualacuity_ua_n)}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.r_visualacuity_ua_t.present? %>
          <% r_visualacuity_ua_t = "T#{opdrecord.read_attribute(:r_visualacuity_ua_t)}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_pinhole_comments).to_s.length > 0 %>
          <% r_visualacuity_pinhole_comments = " (#{opdrecord.read_attribute(:r_visualacuity_pinhole_comments)})" %>
        <% end %>
        <% unless opdrecord.r_visualacuity_pinhole.blank? %>
          <% r_visualacuity_pinhole = "PH- #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:r_visualacuity_pinhole))}#{r_visualacuity_pinhole_p}#{r_visualacuity_pinhole_ni}#{r_visualacuity_pinhole_comments}" %>
          <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_pinhole}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_glasses_p).present? %>
          <% r_visualacuity_glasses_p = "(#{opdrecord.read_attribute(:r_visualacuity_glasses_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_glasses_comments).to_s.length > 0 %>
          <% r_visualacuity_glasses_comments = " (#{opdrecord.read_attribute(:r_visualacuity_glasses_comments)})" %>
        <% end %>
        <% unless opdrecord.r_visualacuity_glasses.blank? %>
          <% r_visualacuity_glasses = "Glasses- #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:r_visualacuity_glasses))}#{r_visualacuity_glasses_p}#{r_visualacuity_glasses_comments}" %>
          <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_glasses}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_lens_p).present? %>
          <% r_visualacuity_lens_p = "(#{opdrecord.read_attribute(:r_visualacuity_lens_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_lens_comments).to_s.length > 0 %>
          <% r_visualacuity_lens_comments = " (#{opdrecord.read_attribute(:r_visualacuity_lens_comments)})" %>
        <% end %>
        <% unless opdrecord.r_visualacuity_lens.blank? %>
          <% r_visualacuity_lens = "Contact Lens- #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:r_visualacuity_lens))}#{r_visualacuity_lens_p}#{r_visualacuity_lens_comments}" %>
          <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_lens}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_near_p).present? %>
          <% r_visualacuity_near_p = "(#{opdrecord.read_attribute(:r_visualacuity_near_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:r_visualacuity_near_comments).to_s.length > 0 %>
          <% r_visualacuity_near_comments = " (#{opdrecord.read_attribute(:r_visualacuity_near_comments)})" %>
        <% end %>
        <% unless opdrecord.r_visualacuity_near.blank? %>
          <% r_visualacuity_near = "Glasses Near- #{opdrecord.read_attribute(:r_visualacuity_near)}#{r_visualacuity_near_p}#{r_visualacuity_near_comments}" %>
          <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_near}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% unless opdrecord.r_visualacuity_comments.blank? %>
          <% r_visualacuity_comments = " Comments- #{opdrecord.read_attribute(:r_visualacuity_comments)}" %>
          <% r_visualacuity_op = "#{r_visualacuity_op} #{r_visualacuity_comments}" %>
          <% r_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
      <% end %>

      <% if opdrecord.r_intraocularpressure.present? %>
        <% r_intraocularpressure = opdrecord.read_attribute(:r_intraocularpressure).to_s %>
        <% r_intraocularpressure_op = "#{r_intraocularpressure_op}#{r_intraocularpressure}" %>
        <% r_intraocularpressure_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>
      <% if opdrecord.r_intraocularpressure.present? && opdrecord.r_intraocularpressure_time.present? %>
        <% r_intraocularpressure_time = opdrecord.read_attribute(:r_intraocularpressure_time).to_s %>
        <% r_intraocularpressure_op = "#{r_intraocularpressure_op} at #{r_intraocularpressure_time}" %>
        <%# r_intraocularpressure_counter = r_intraocularpressure_counter + 1 %>
        <%# examination_counter = examination_counter + 1 %>
      <% end %>
      <% if opdrecord.r_iop_method.present? %>
        <% r_iop_method = opdrecord.read_attribute(:r_iop_method).to_s %>
        <% r_intraocularpressure_op = "#{r_intraocularpressure_op} with #{r_iop_method}" %>
        <% r_intraocularpressure_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>
      <% if opdrecord.r_intraocularpressure_comments.present? %>
        <% r_intraocularpressure_comments = opdrecord.read_attribute(:r_intraocularpressure_comments).to_s %>
        <% r_intraocularpressure_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>
      <% if opdrecord.r_iop_comments.present? && opdrecord.r_iop_comments != "<br>" %>
        <% r_iop_comments = opdrecord.read_attribute(:r_iop_comments).to_s %>
        <% if r_intraocularpressure_comments.present? %>
          <% r_intraocularpressure_comments = "#{r_intraocularpressure_comments}, " %>
        <% end %>
        <% r_intraocularpressure_comments = "#{r_intraocularpressure_comments}#{r_iop_comments}".html_safe %>
        <% r_intraocularpressure_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.r_appearance.blank? %>
        <% unless opdrecord.r_appearance == "Normal" %>
          <% unless opdrecord.r_appearance_phthisisbulbi == "No" %>
            <% r_appearance_phthisisbulbi = 'Phthisis Bulbi,' %>
            <% r_appearance_op = r_appearance_phthisisbulbi.to_s %>
            <% r_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_appearance_anophthalmos == "No" %>
            <% r_appearance_anophthalmos = 'Anophthalmos,' %>
            <% r_appearance_op = "#{r_appearance_op} #{r_appearance_anophthalmos}" %>
            <% r_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_appearance_micropththalmos == "No" %>
            <% r_appearance_micropththalmos = 'Micropththalmos,' %>
            <% r_appearance_op = "#{r_appearance_op} #{r_appearance_micropththalmos}" %>
            <% r_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_appearance_artificial == "No" %>
            <% r_appearance_artificial = 'Artificial,' %>
            <% r_appearance_op = "#{r_appearance_op} #{r_appearance_artificial}" %>
            <% r_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_appearance_proptosis == "No" %>
            <% r_appearance_proptosis = 'Proptosis,' %>
            <% r_appearance_op = "#{r_appearance_op} #{r_appearance_proptosis}" %>
            <% r_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_appearance_dystopia == "No" %>
            <% r_appearance_dystopia = 'Dystopia,' %>
            <% r_appearance_op = "#{r_appearance_op} #{r_appearance_dystopia}" %>
            <% r_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_appearance_injured == "No" %>
            <% r_appearance_injured = 'Injured,' %>
            <% r_appearance_op = "#{r_appearance_op} #{r_appearance_injured}" %>
            <% r_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_appearance_swollen == "No" %>
            <% r_appearance_swollen = 'Swollen,' %>
            <% r_appearance_op = "#{r_appearance_op} #{r_appearance_swollen}" %>
            <% r_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_appearance_comments.present? && opdrecord.r_appearance_comments != "<br>" %>
            <% r_appearance_comments = opdrecord.read_attribute(:r_appearance_comments).to_s %>
            <% r_appearance_comments_op = " #{r_appearance_comments}" %>
            <% r_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_appearance_op.blank? %>
            <% r_appearance_op = r_appearance_op.split('') %>
            <% r_appearance_op_count = r_appearance_op.count %>
            <% if r_appearance_op_count > 0 %>
              <% r_appearance_op = (r_appearance_op.first r_appearance_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.r_scleracommon.blank? %>
        <% unless opdrecord.r_scleracommon == "Normal" %>
          <% if opdrecord.r_scleracommon_comments.present? && opdrecord.r_scleracommon_comments != "<br>" %>
            <% r_scleracommon_comments = opdrecord.read_attribute(:r_scleracommon_comments).to_s %>
            <% r_scleracommon_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
        <% end %>
      <% end %>

      <% unless opdrecord.r_conjunctiva.blank? %>
        <% unless opdrecord.r_conjunctiva == "Normal" %>
          <% unless opdrecord.r_conjunctiva_congestion == "No" %>
            <% if opdrecord.r_conjunctiva_congestion_lgc != "" %>
              <% r_conjunctiva_congestion_lgc = '-' + opdrecord.r_conjunctiva_congestion_lgc %>
            <% else %>
              <% r_conjunctiva_congestion_lgc = '' %>
            <% end %>
            <% r_conjunctiva_congestion = "Congestion#{r_conjunctiva_congestion_lgc}," %>
            <% r_conjunctiva_op = r_conjunctiva_congestion.to_s %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if false %>
            <% unless opdrecord.r_conjunctiva_conjunctivitis == "No" %>
              <% r_conjunctiva_conjunctivitis = 'Conjunctivitis,' %>
              <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_conjunctivitis}" %>
              <% r_conjunctiva_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.r_conjunctiva_episcleritis == "No" %>
              <% r_conjunctiva_episcleritis = 'Episcleritis,' %>
              <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_episcleritis}" %>
              <% r_conjunctiva_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% unless opdrecord.r_conjunctiva_tear == "No" %>
            <% r_conjunctiva_tear = 'Tear,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_tear}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_conjunctiva_conjuctival_blib == "No" %>
            <% r_conjunctiva_conjuctival_blib = 'Conjuctival Bleb,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_conjuctival_blib}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_conjunctiva_subconjunctival_haemorrhage == "No" %>
            <% r_conjunctiva_subconjunctival_haemorrhage = 'SubConjunctival Haemorrhage,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_subconjunctival_haemorrhage}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_conjunctiva_foreign_body == "Yes" %>
            <% r_conjunctiva_foreign_body = 'Foreign Body,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_foreign_body}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_conjunctiva_follicles == "Yes" %>
            <% r_conjunctiva_follicles = 'Follicles,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_follicles}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_conjunctiva_papillae == "Yes" %>
            <% r_conjunctiva_papillae = 'Papillae,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_papillae}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_conjunctiva_pinguecula == "Yes" %>
            <% r_conjunctiva_pinguecula = 'Pinguecula,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_pinguecula}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_conjunctiva_pterygium == "Yes" %>
            <% r_conjunctiva_pterygium = 'Pterygium,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_pterygium}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_conjunctiva_phlycten == "Yes" %>
            <% r_conjunctiva_phlycten = 'Phlycten,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_phlycten}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_conjunctiva_discharge == "Yes" %>
            <% r_conjunctiva_discharge = 'Discharge,' %>
            <% r_conjunctiva_op = "#{r_conjunctiva_op} #{r_conjunctiva_discharge}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_conjunctiva_comments.present? && opdrecord.r_conjunctiva_comments != "<br>" %>
            <% r_conjunctiva_comments = opdrecord.read_attribute(:r_conjunctiva_comments).to_s %>
            <% r_conjunctiva_comments_op = " #{r_conjunctiva_comments}" %>
            <% r_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_conjunctiva_op.blank? %>
            <% r_conjunctiva_op = r_conjunctiva_op.split('') %>
            <% r_conjunctiva_op_count = r_conjunctiva_op.count %>
            <% if r_conjunctiva_op_count > 0 %>
              <% r_conjunctiva_op = (r_conjunctiva_op.first r_conjunctiva_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.r_cornea.blank? %>
        <% unless opdrecord.r_cornea == "Normal" && opdrecord.r_cornea_normal != "normal" %>
          <% unless opdrecord.r_cornea_size == "Normal" && opdrecord.r_cornea_normal != "normal" %>
            <% r_cornea_size = "Size- #{opdrecord.read_attribute(:r_cornea_size)}," %>
            <% r_cornea_op = r_cornea_size.to_s %>
            <% r_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_cornea_shape == "Normal" && opdrecord.r_cornea_normal != "normal" %>
            <% r_cornea_shape = "Shape- #{opdrecord.read_attribute(:r_cornea_shape)}," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_cornea_shape}" %>
            <% r_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_cornea_surface == "Normal" && opdrecord.r_cornea_normal != "normal" %>
            <% r_cornea_surface = "Surface- #{opdrecord.read_attribute(:r_cornea_surface)}," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_cornea_surface}" %>
            <% r_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_fluorescein_staining == 'Negative' && opdrecord.r_cornea_normal != "normal" %>
            <% r_fluorescein_staining = "Fluorescein Staining- #{opdrecord.read_attribute(:r_fluorescein_staining)}," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_fluorescein_staining}" %>
            <% r_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_corneal_sensation == "Normal" && opdrecord.r_cornea_normal != "normal" %>
            <% r_corneal_sensation = "Corneal Sensation- #{opdrecord.read_attribute(:r_corneal_sensation)}," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_corneal_sensation}" %>
            <% r_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_cornea_schirmer_dimension1.present? || opdrecord.r_cornea_schirmer_time1.present? %>
            <% r_cornea_schirmer_dimension1 = (opdrecord.r_cornea_schirmer_dimension1 if opdrecord.r_cornea_schirmer_dimension1.present?) || ' - ' %>
            <% r_cornea_schirmer_time1 = (opdrecord.r_cornea_schirmer_time1 if opdrecord.r_cornea_schirmer_time1.present?) || ' - ' %>
            <% opdrecord.r_cornea_schirmer_dimension1 = r_cornea_schirmer_dimension1 %>
            <% opdrecord.r_cornea_schirmer_time1 = r_cornea_schirmer_time1 %>
            <% r_cornea_schirmer_test1 = "Schirmer Test-1 (#{opdrecord.read_attribute(:r_cornea_schirmer_dimension1)}mm in #{opdrecord.read_attribute(:r_cornea_schirmer_time1)} min)," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_cornea_schirmer_test1}" %>
            <% r_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_cornea_schirmer_dimension2.present? || opdrecord.r_cornea_schirmer_time2.present? %>
            <% r_cornea_schirmer_dimension2 = (opdrecord.r_cornea_schirmer_dimension2 if opdrecord.r_cornea_schirmer_dimension2.present?) || ' - ' %>
            <% r_cornea_schirmer_time2 = (opdrecord.r_cornea_schirmer_time2 if opdrecord.r_cornea_schirmer_time2.present?) || ' - ' %>
            <% opdrecord.r_cornea_schirmer_dimension2 = r_cornea_schirmer_dimension2 %>
            <% opdrecord.r_cornea_schirmer_time2 = r_cornea_schirmer_time2 %>
            <% r_cornea_schirmer_test2 = "Schirmer Test-2 (#{opdrecord.read_attribute(:r_cornea_schirmer_dimension2)}mm in #{opdrecord.read_attribute(:r_cornea_schirmer_time2)} min)," %>
            <% r_cornea_op = "#{r_cornea_op} #{r_cornea_schirmer_test2}" %>
            <% r_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if mail_job == false %>
            <% unless params[:action] == "print_opd_record" %>
              <% if opdrecord.r_cornea_diagram_present== "Y" %>
                <% r_cornea_counter += 1 %>
                <% examination_counter += 1 %>
              <% end %>
              <% if opdrecord.r_corneaslit_diagram_present== "Y" %>
                <% r_corneaslit_counter += 1 %>
                <% examination_counter += 1 %>
              <% end %>
            <% end %>
          <% end %>
          <% if opdrecord.r_cornea_comments.present? && opdrecord.r_cornea_comments != "<br>" %>
            <% r_cornea_comments = opdrecord.read_attribute(:r_cornea_comments).to_s %>
            <% r_cornea_comments_op = " #{r_cornea_comments}" %>
            <% r_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_cornea_op.blank? %>
            <% r_cornea_op = r_cornea_op.split('') %>
            <% r_cornea_op_count = r_cornea_op.count %>
            <% if r_cornea_op_count > 0 %>
              <% r_cornea_op = (r_cornea_op.first r_cornea_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.r_anteriorchamber.blank? %>
        <% unless opdrecord.r_anteriorchamber == "Normal" %>
          <% unless opdrecord.r_anteriorchamber_depth == "Normal" %>
            <% r_anteriorchamber_depth = "Depth- #{opdrecord.read_attribute(:r_anteriorchamber_depth)} #{opdrecord.read_attribute(:r_anteriorchamber_depth_comment)}," %>
            <% r_anteriorchamber_op = r_anteriorchamber_depth.to_s %>
            <% r_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_anteriorchamber_cells == "No" %>
            <% r_anteriorchamber_cells = "Cells #{opdrecord.read_attribute(:r_anteriorchamber_cells_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_cells}" %>
            <% r_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_anteriorchamber_flare == "No" %>
            <% r_anteriorchamber_flare = "Flare #{opdrecord.read_attribute(:r_anteriorchamber_flare_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_flare}" %>
            <% r_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_anteriorchamber_hyphema == "No" %>
            <% r_anteriorchamber_hyphema = "Hyphema #{opdrecord.read_attribute(:r_anteriorchamber_hyphema_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_hyphema}" %>
            <% r_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_anteriorchamber_hypopyon == "No" %>
            <% r_anteriorchamber_hypopyon = "Hypopyon #{opdrecord.read_attribute(:r_anteriorchamber_hypopyon_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_hypopyon}" %>
            <% r_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_anteriorchamber_foreignbody == "No" %>
            <% r_anteriorchamber_foreignbody = "Foreign Body #{opdrecord.read_attribute(:r_anteriorchamber_foreignbody_comment)}," %>
            <% r_anteriorchamber_op = "#{r_anteriorchamber_op} #{r_anteriorchamber_foreignbody}" %>
            <% r_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_anteriorchamber_comments.present? && opdrecord.r_anteriorchamber_comments != "<br>" %>
            <% r_anteriorchamber_comments = opdrecord.read_attribute(:r_anteriorchamber_comments).to_s %>
            <% r_anteriorchamber_comments_op = r_anteriorchamber_comments.to_s %>
            <% r_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_anteriorchamber_op.blank? %>
            <% r_anteriorchamber_op = r_anteriorchamber_op.split('') %>
            <% r_anteriorchamber_op_count = r_anteriorchamber_op.count %>
            <% if r_anteriorchamber_op_count > 0 %>
              <% r_anteriorchamber_op = (r_anteriorchamber_op.first r_anteriorchamber_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% if opdrecord.r_pupil.present? %>
        <% unless opdrecord.r_pupil == "Normal" && opdrecord.r_pupil_normal != "normal" %>
          <% if opdrecord.r_pupil_shape.present? %>
            <% r_pupil_shape = "Shape- #{opdrecord.read_attribute(:r_pupil_shape)}," %>
            <% r_pupil_op = r_pupil_shape.to_s %>
            <% r_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_pupilsize.present? %>
            <% r_pupilsize = "Size- #{opdrecord.read_attribute(:r_pupilsize)} mm," %>
            <% r_pupil_op = "#{r_pupil_op} #{r_pupilsize}" %>
            <% r_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_pupil_reaction_to_light_direct == "Normal" && opdrecord.r_pupil_normal != "normal" %>
            <% r_pupil_reaction_to_light_direct = "Reaction to light Direct- #{opdrecord.read_attribute(:r_pupil_reaction_to_light_direct)}," %>
            <% r_pupil_op = "#{r_pupil_op} #{r_pupil_reaction_to_light_direct}" %>
            <% r_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_pupil_reaction_to_light_consensual == "Normal" && opdrecord.r_pupil_normal != "normal" %>
            <% r_pupil_reaction_to_light_consensual = "Reaction to light Consensual- #{opdrecord.read_attribute(:r_pupil_reaction_to_light_consensual)}," %>
            <% r_pupil_op = "#{r_pupil_op} #{r_pupil_reaction_to_light_consensual}" %>
            <% r_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_pupil_rapd == "No" %>
            <% r_pupil_rapd = 'RAPD,' %>
            <% r_pupil_op = "#{r_pupil_op} #{r_pupil_rapd}" %>
            <% r_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_pupil_comments.present? && opdrecord.r_pupil_comments != "<br>" %>
            <% r_pupil_comments = opdrecord.read_attribute(:r_pupil_comments).to_s %>
            <% r_pupil_comments_op = r_pupil_comments.to_s %>
            <% r_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_pupil_op.blank? %>
            <% r_pupil_op = r_pupil_op.split('') %>
            <% r_pupil_op_count = r_pupil_op.count %>
            <% if r_pupil_op_count > 0 %>
              <% r_pupil_op = (r_pupil_op.first r_pupil_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.r_iris.blank? %>
        <% unless opdrecord.r_iris == "Normal" %>
          <% unless opdrecord.r_iris_shape == "Normal" %>
            <% r_iris_shape = "Shape- #{opdrecord.read_attribute(:r_iris_shape)}," %>
            <% r_iris_op = r_iris_shape.to_s %>
            <% r_iris_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_iris_neovascularisation == "No" %>
            <% r_iris_neovascularisation = 'Neovascularisation,' %>
            <% r_iris_op = "#{r_iris_op}#{r_iris_neovascularisation}" %>
            <% r_iris_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_iris_synechiae == "No" %>
            <% r_iris_synechiae = "Synechiae- #{opdrecord.read_attribute(:r_iris_synechiae)}," %>
            <% r_iris_op = "#{r_iris_op}#{r_iris_synechiae}" %>
            <% r_iris_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_iris_peripheraliridotomy == "No"
               r_iris_peripheraliridotomy = 'Peripheral Iridotomy,'
               r_iris_op = "#{r_iris_op}#{r_iris_peripheraliridotomy}"
               r_iris_counter += 1
               examination_counter += 1
             end %>
          <% if opdrecord.r_iris_comments.present? && opdrecord.r_iris_comments != "<br>" %>
            <% r_iris_comments = opdrecord.read_attribute(:r_iris_comments).to_s %>
            <% r_iris_comments_op = r_iris_comments.to_s %>
            <% r_iris_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_iris_op.blank? %>
            <% r_iris_op = r_iris_op.split('') %>
            <% r_iris_op_count = r_iris_op.count %>
            <% if r_iris_op_count > 0 %>
              <% r_iris_op = (r_iris_op.first r_iris_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.r_lens.blank? %>
        <% unless opdrecord.r_lens == "Normal" %>
          <% unless opdrecord.r_lens_nature == "Clear" %>
            <% r_lens_nature = "Nature- #{opdrecord.read_attribute(:r_lens_nature)}," %>
            <% r_lens_op = r_lens_nature.to_s %>
            <% r_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_lens_position == "Central" %>
            <% r_lens_position = "Position- #{opdrecord.read_attribute(:r_lens_position)}," %>
            <% r_lens_op = "#{r_lens_op} #{r_lens_position}" %>
            <% r_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_lens_size == "Normal" %>
            <% r_lens_size = "Lens Size- #{opdrecord.read_attribute(:r_lens_size)}," %>
            <% r_lens_op = "#{r_lens_op} #{r_lens_size}" %>
            <% r_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if  opdrecord.r_lens_grading_no.present? %>
            <% r_lens_grading_no = "NS:#{opdrecord.read_attribute(:r_lens_grading_no)}" %>
          <% end %>
          <% if  opdrecord.r_lens_grading_nc.present? %>
            <% r_lens_grading_nc = "NC:#{opdrecord.read_attribute(:r_lens_grading_nc)}" %>
          <% end %>
          <% if  opdrecord.r_lens_grading_c.present? %>
            <% r_lens_grading_c = "C:#{opdrecord.read_attribute(:r_lens_grading_c)}" %>
          <% end %>
          <% if  opdrecord.r_lens_grading_p.present? %>
            <% r_lens_grading_p = "P:#{opdrecord.read_attribute(:r_lens_grading_p)}" %>
          <% end %>
          <% if opdrecord.r_lens_grading_no.present? || opdrecord.r_lens_grading_nc.present? || opdrecord.r_lens_grading_c.present? || opdrecord.r_lens_grading_p.present? %>
            <% r_lens_grading = "Lens Grading- #{r_lens_grading_no} #{r_lens_grading_nc} #{r_lens_grading_c} #{r_lens_grading_p}," %>
            <% r_lens_op = "#{r_lens_op} #{r_lens_grading}" %>
            <% r_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_lens_comments.present? && opdrecord.r_lens_comments != "<br>" %>
            <% r_lens_comments = opdrecord.read_attribute(:r_lens_comments).to_s %>
            <% r_lens_comments_op = r_lens_comments.to_s %>
            <% r_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if mail_job == false %>
            <% unless params[:action] == "print_opd_record" %>
              <% if opdrecord.r_lens_diagram_present== "Y" %>
                <% r_lens_counter += 1 %>
                <% examination_counter += 1 %>
              <% end %>
            <% end %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_lens_op.blank? %>
            <% r_lens_op = r_lens_op.split('') %>
            <% r_lens_op_count = r_lens_op.count %>
            <% if r_lens_op_count > 0 %>
              <% r_lens_op = (r_lens_op.first r_lens_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.r_extraocularmovements.blank? %>
        <% unless opdrecord.r_extraocularmovements == "Normal" %>
          <% unless opdrecord.r_extraocularmovements_uniocular == "Full" %>
            <% r_extraocularmovements_uniocular = "Uniocular- #{opdrecord.read_attribute(:r_extraocularmovements_uniocular)}," %>
            <% r_extraocularmovements_op = r_extraocularmovements_uniocular.to_s %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_extraocularmovements_binocular == "Full" %>
            <% r_extraocularmovements_binocular = "Binocular- #{opdrecord.read_attribute(:r_extraocularmovements_binocular)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_binocular}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_extraocularmovements_prism.present? %>
            <% r_extraocularmovements_prism = "Prism- #{opdrecord.read_attribute(:r_extraocularmovements_prism)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_prism}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_extraocularmovements_squint.blank? %>
            <% r_extraocularmovements_squint = "Squint- #{opdrecord.read_attribute(:r_extraocularmovements_squint)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_extraocularmovements_squint_tropia.blank? %>
            <% r_extraocularmovements_squint_tropia = "Tropia- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_extraocularmovements_squint_tropia_horizontal.blank? %>
            <% r_extraocularmovements_squint_tropia_horizontal = "Horizontal- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_horizontal)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_horizontal}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_extraocularmovements_squint_tropia_horizontal_esotropia.blank? %>
            <% r_extraocularmovements_squint_tropia_horizontal_esotropia = "Esotropia- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_horizontal_esotropia)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_horizontal_esotropia}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_extraocularmovements_squint_tropia_horizontal_exotropia.blank? %>
            <% r_extraocularmovements_squint_tropia_horizontal_exotropia = "Exotropia- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_horizontal_exotropia)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_horizontal_exotropia}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_extraocularmovements_squint_tropia_vertical.blank? %>
            <% r_extraocularmovements_squint_tropia_vertical = "Vertical- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_vertical)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_vertical}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_extraocularmovements_squint_tropia_paralytic.blank? %>
            <% r_extraocularmovements_squint_tropia_paralytic = "Paralytic- #{opdrecord.read_attribute(:r_extraocularmovements_squint_tropia_paralytic)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_tropia_paralytic}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_extraocularmovements_squint_phoria.blank? %>
            <% r_extraocularmovements_squint_phoria = "Phoria- #{opdrecord.read_attribute(:r_extraocularmovements_squint_phoria)}," %>
            <% r_extraocularmovements_op = "#{r_extraocularmovements_op} #{r_extraocularmovements_squint_phoria}" %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_extraocularmovements_comments.present? && opdrecord.r_extraocularmovements_comments != "<br>" %>
            <% r_extraocularmovements_comments = opdrecord.read_attribute(:r_extraocularmovements_comments).to_s %>
            <% r_extraocularmovements_comments_op = r_extraocularmovements_comments.to_s %>
            <% r_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_extraocularmovements_op.blank? %>
            <% r_extraocularmovements_op = r_extraocularmovements_op.split('') %>
            <% r_extraocularmovements_op_count = r_extraocularmovements_op.count %>
            <% if r_extraocularmovements_op_count > 0 %>
              <% r_extraocularmovements_op = (r_extraocularmovements_op.first r_extraocularmovements_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.r_fundus.blank? %>
        <% unless opdrecord.r_fundus == "Normal" %>
          <% unless opdrecord.r_fundus_media_select == "" %>
            <% if opdrecord.r_fundus_media_comment.present? %>
              <% r_fundus_media_select = "Media-#{opdrecord.read_attribute(:r_fundus_media_select)}(#{opdrecord.read_attribute(:r_fundus_media_comment)})" %>
            <% else %>
              <% r_fundus_media_select = "Media-#{opdrecord.read_attribute(:r_fundus_media_select)}" %>
            <% end %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_media_select}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_fundus_pvd_select == "" %>
            <% r_fundus_pvd_select = "PVD-#{opdrecord.read_attribute(:r_fundus_pvd_select)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_pvd_select}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_fundus_optdiscsize_select == "" %>
            <% r_fundus_optdiscsize_select = "OptDiscSize-#{opdrecord.read_attribute(:r_fundus_optdiscsize_select)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_optdiscsize_select}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.r_fundus_cup_disc_ratio_select == "" %>
            <% if opdrecord.r_fundus_cupratio_comment.present? %>
              <% r_fundus_cup_disc_ratio_select = "CupRatio-#{opdrecord.read_attribute(:r_fundus_cup_disc_ratio_select)}(#{opdrecord.read_attribute(:r_fundus_cupratio_comment)})" %>
            <% else %>
              <% r_fundus_cup_disc_ratio_select = "CupRatio-#{opdrecord.read_attribute(:r_fundus_cup_disc_ratio_select)}" %>
            <% end %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_cup_disc_ratio_select}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_fundus_opticdisc_comment.present? %>
            <% r_fundus_opticdisc_comment = "OpticDisc-#{opdrecord.read_attribute(:r_fundus_opticdisc_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_opticdisc_comment}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_fundus_bloodvessel_comment.present? && opdrecord.r_fundus_bloodvessel_select.present? %>
            <% r_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:r_fundus_bloodvessel_select)}-#{opdrecord.read_attribute(:r_fundus_bloodvessel_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_bloodvessel}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.r_fundus_bloodvessel_comment.blank? && opdrecord.r_fundus_bloodvessel_select.present? %>
            <% r_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:r_fundus_bloodvessel_select)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_bloodvessel}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.r_fundus_bloodvessel_comment.present? && opdrecord.r_fundus_bloodvessel_select.blank? %>
            <% r_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:r_fundus_bloodvessel_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_bloodvessel}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_fundus_macula_comment.present? && opdrecord.r_fundus_macula_select.present? %>
            <% r_fundus_macula = "Macula-#{opdrecord.read_attribute(:r_fundus_macula_select)&.split(',')&.join(", ").to_s}-#{opdrecord.read_attribute(:r_fundus_macula_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_macula}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.r_fundus_macula_comment.blank? && opdrecord.r_fundus_macula_select.present? %>
            <% r_fundus_macula = "Macula-#{opdrecord.read_attribute(:r_fundus_macula_select)&.split(',')&.join(", ").to_s}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_macula}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.r_fundus_macula_comment.present? && opdrecord.r_fundus_macula_select.blank? %>
            <% r_fundus_macula = "Macula-#{opdrecord.read_attribute(:r_fundus_macula_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_macula}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_fundus_macula_select.present? %>
            <% if opdrecord.r_fundus_macula_select.include? "Foveal Reflex" %>
              <% r_fundus_macula_fovealreflex = "Foveal Reflex- #{opdrecord.read_attribute(:r_fundus_macula_fovealreflex).to_s}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_macula_fovealreflex}" %>
              <% r_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% if opdrecord.r_fundus_vitreous_comment.present? && opdrecord.r_fundus_vitreous_select.present? %>
            <% r_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:r_fundus_vitreous_select)}-#{opdrecord.read_attribute(:r_fundus_vitreous_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_vitreous}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.r_fundus_vitreous_comment.blank? && opdrecord.r_fundus_vitreous_select.present? %>
            <% r_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:r_fundus_vitreous_select)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_vitreous}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.r_fundus_vitreous_comment.present? && opdrecord.r_fundus_vitreous_select.blank? %>
            <% r_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:r_fundus_vitreous_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_vitreous}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_fundus_retinal_detachment_comment.present? && opdrecord.r_fundus_retinal_detachment_select.present? %>
            <% r_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:r_fundus_retinal_detachment_select)}-#{opdrecord.read_attribute(:r_fundus_retinal_detachment_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_retinal_detachment}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.r_fundus_retinal_detachment_comment.blank? && opdrecord.r_fundus_retinal_detachment_select.present? %>
            <% r_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:r_fundus_retinal_detachment_select)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_retinal_detachment}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.r_fundus_retinal_detachment_comment.present? && opdrecord.r_fundus_retinal_detachment_select.blank? %>
            <% r_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:r_fundus_retinal_detachment_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundus_retinal_detachment}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.r_fundus_lattice_degeneration_select.present? %>
            <% if opdrecord.r_fundus_peripheral_lesions_comment.present? %>
              <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:r_fundus_lattice_degeneration_select)}-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_comment)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
              <% r_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% else %>
              <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:r_fundus_lattice_degeneration_select)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
              <% r_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% else %>
            <% if opdrecord.r_fundus_peripheral_lesions_comment.present? && opdrecord.r_fundus_peripheral_lesions_select.present? %>
              <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_comment)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
              <% r_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% elsif opdrecord.r_fundus_peripheral_lesions_comment.blank? && opdrecord.r_fundus_peripheral_lesions_select.present? %>
              <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_select)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
              <% r_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% elsif opdrecord.r_fundus_peripheral_lesions_comment.present? && opdrecord.r_fundus_peripheral_lesions_select.blank? %>
              <% r_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:r_fundus_peripheral_lesions_comment)}" %>
              <% r_fundus_op = "#{r_fundus_op} #{r_fundus_peripheral_lesions}" %>
              <% r_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% unless opdrecord.r_fundustext_comment == "" %>
            <% r_fundustext_comment = "Fundus-#{opdrecord.read_attribute(:r_fundustext_comment)}" %>
            <% r_fundus_op = "#{r_fundus_op} #{r_fundustext_comment}" %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if mail_job == false %>
            <% unless params[:action] == "print_opd_record" %>
              <% if opdrecord.r_fundus_diagram_present== "Y" %>
                <% r_fundus_counter += 1 %>
                <% examination_counter += 1 %>
              <% end %>
            <% end %>
          <% end %>
          <% if opdrecord.r_fundus_comments.present? && opdrecord.r_fundus_comments != "<br>" %>
            <% r_fundus_comments = opdrecord.read_attribute(:r_fundus_comments).to_s %>
            <% r_fundus_comments_op = r_fundus_comments.to_s %>
            <% r_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless r_fundus_op.blank? %>
            <% r_fundus_op = r_fundus_op.split('') %>
            <% r_fundus_op_count = r_fundus_op.count %>
            <% if r_fundus_op_count > 0 %>
              <% r_fundus_op = (r_fundus_op.first r_fundus_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% l_visualacuity_counter = 0 %>
      <% l_visualacuity_op = '' %>
      <% l_visualacuity_unaided = '' %>
      <% l_visualacuity_unaided_p = '' %>
      <% l_visualacuity_pinhole = '' %>
      <% l_visualacuity_pinhole_p = '' %>
      <% l_visualacuity_pinhole_ni = '' %>
      <% l_visualacuity_glasses = '' %>
      <% l_visualacuity_glasses_p = '' %>
      <% l_visualacuity_lens = '' %>
      <% l_visualacuity_lens_p = '' %>
      <% l_visualacuity_near = '' %>
      <% l_visualacuity_ua_s = '' %>
      <% l_visualacuity_ua_n = '' %>
      <% l_visualacuity_ua_i = '' %>
      <% l_visualacuity_ua_t = '' %>
      <% l_visualacuity_near_p = '' %>
      <% l_visualacuity_ua_near = '' %>
      <% l_visualacuity_ua_near_p = '' %>

      <% l_intraocularpressure_counter = 0 %>
      <% l_intraocularpressure_op = '' %>
      <% l_intraocularpressure = '' %>
      <% l_intraocularpressure_time = '' %>
      <% l_iop_method = '' %>
      <% l_iop_comment = '' %>
      <% l_intraocularpressure_comments = '' %>

      <% l_appearance_counter = 0 %>
      <% l_appearance_op = '' %>
      <% l_appearance_phthisisbulbi = '' %>
      <% l_appearance_anophthalmos = '' %>
      <% l_appearance_micropththalmos = '' %>
      <% l_appearance_artificial = '' %>
      <% l_appearance_proptosis = '' %>
      <% l_appearance_dystopia = '' %>
      <% l_appearance_injured = '' %>
      <% l_appearance_swollen = '' %>
      <% l_appearance_comments = '' %>

      <% l_scleracommon_counter = 0 %>
      <% l_scleracommon_comments = '' %>

      <% l_appendages_counter = 0 %>
      <% l_appendages_op = '' %>
      <% l_appendages_comments = 0 %>
      <% l_eyelid_counter = 0 %>
      <% l_eyelsahes_counter = 0 %>
      <% l_lacrimal_counter = 0 %>
      <% l_syringing_counter = 0 %>

      <% l_conjunctiva_counter = 0 %>
      <% l_conjunctiva_op = '' %>
      <% l_conjunctiva_congestion = '' %>
      <% l_conjunctiva_conjunctivitis = '' %>
      <% l_conjunctiva_episcleritis = '' %>
      <% l_conjunctiva_tear = '' %>
      <% l_conjunctiva_subconjunctival_haemorrhage = '' %>
      <% l_conjunctiva_foreign_body = '' %>
      <% l_conjunctiva_follicles = '' %>
      <% l_conjunctiva_papillae = '' %>
      <% l_conjunctiva_pinguecula = '' %>
      <% l_conjunctiva_pterygium = '' %>
      <% l_conjunctiva_phlycten = '' %>
      <% l_conjunctiva_discharge = '' %>
      <% l_conjunctiva_conjuctival_blib = '' %>
      <% l_conjunctiva_comments = '' %>

      <% l_cornea_counter = 0 %>
      <% l_corneaslit_counter = 0 %>
      <% l_cornea_op = '' %>
      <% l_cornea_size = '' %>
      <% l_cornea_shape = '' %>
      <% l_cornea_schirmer_dimension1 = '' %>
      <% l_cornea_schirmer_time1 = '' %>
      <% l_cornea_schirmer_dimension2 = '' %>
      <% l_cornea_schirmer_time2 = '' %>
      <% l_cornea_surface = '' %>
      <% l_fluorescein_staining = '' %>
      <% l_corneal_sensation = '' %>
      <% l_cornea_comments_op = '' %>
      <% l_cornea_comments = '' %>

      <% l_anteriorchamber_counter = 0 %>
      <% l_anteriorchamber_op = '' %>
      <% l_anteriorchamber_comments_op = '' %>
      <% l_anteriorchamber_comments = '' %>
      <% l_anteriorchamber_depth = '' %>
      <% l_anteriorchamber_reaction = '' %>
      <% l_anteriorchamber_cells = '' %>
      <% l_anteriorchamber_flare = '' %>
      <% l_anteriorchamber_hyphema = '' %>
      <% l_anteriorchamber_hypopyon = '' %>
      <% l_anteriorchamber_foreignbody = '' %>
      <% l_anteriorchamber_depth_comment = '' %>
      <% l_anteriorchamber_reaction_comment = '' %>
      <% l_anteriorchamber_cells_comment = '' %>
      <% l_anteriorchamber_flare_comment = '' %>
      <% l_anteriorchamber_hyphema_comment = '' %>
      <% l_anteriorchamber_hypopyon_comment = '' %>
      <% l_anteriorchamber_foreignbody_comment = '' %>

      <% l_pupil_counter = 0 %>
      <% l_pupil_op = '' %>
      <% l_pupil_comments_op = '' %>
      <% l_pupil_comments = '' %>
      <% l_pupil_shape = '' %>
      <% l_pupilsize = '' %>
      <% l_pupil_reaction_to_light_direct = '' %>
      <% l_pupil_reaction_to_light_consensual = '' %>
      <% l_pupil_rapd = '' %>

      <% l_iris_counter = 0 %>
      <% l_iris_op = '' %>
      <% l_iris_comments_op = '' %>
      <% l_iris_comments = '' %>
      <% l_iris_shape = '' %>
      <% l_iris_neovascularisation = '' %>
      <% l_iris_synechiae = '' %>
      <% l_iris_peripheraliridotomy = '' %>

      <% l_lens_counter = 0 %>
      <% l_lens_op = '' %>
      <% l_lens_comments_op = '' %>
      <% l_lens_comments = '' %>
      <% l_lens_nature = '' %>
      <% l_lens_position = '' %>
      <% l_lens_size = '' %>
      <% l_lens_grading_no = '' %>
      <% l_lens_grading_nc = '' %>
      <% l_lens_grading_c = '' %>
      <% l_lens_grading_p = '' %>

      <% l_extraocularmovements_counter = 0 %>
      <% l_extraocularmovements_op = '' %>
      <% l_extraocularmovements_comments_op = '' %>
      <% l_extraocularmovements_comments = '' %>
      <% l_extraocularmovements_uniocular = '' %>
      <% l_extraocularmovements_binocular = '' %>
      <% l_extraocularmovements_prism = '' %>
      <% l_extraocularmovements_squint = '' %>
      <% l_extraocularmovements_squint_tropia = '' %>
      <% l_extraocularmovements_squint_tropia_horizontal = '' %>
      <% l_extraocularmovements_squint_tropia_horizontal_esotropia = '' %>
      <% l_extraocularmovements_squint_tropia_horizontal_exotropia = '' %>
      <% l_extraocularmovements_squint_tropia_vertical = '' %>
      <% l_extraocularmovements_squint_tropia_paralytic = '' %>
      <% l_extraocularmovements_squint_phoria = '' %>

      <% l_fundus_counter = 0 %>
      <% l_fundus_op = '' %>
      <% l_fundus_comments_op = '' %>
      <% l_fundus_comments = '' %>
      <% l_fundus_macula_select = '' %>
      <% l_fundus_macula_fovealreflex = '' %>
      <% l_fundus_bloodvessel_select = '' %>
      <% l_fundus_vitreous_select = '' %>
      <% l_fundus_retinal_detachment_select = '' %>
      <% l_fundus_peripheral_lesions_select = '' %>
      <% l_fundus_media_select = '' %>
      <% l_fundus_media_comment = '' %>
      <% l_fundus_pvd_select = '' %>
      <% l_fundus_optdiscsize_select = '' %>
      <% l_fundus_cupratio_comment = '' %>
      <% l_fundus_cup_disc_ratio_select = '' %>
      <% l_fundus_opticdisc_comment = '' %>
      <% l_fundus_bloodvessel_comment = '' %>
      <% l_fundus_vitreous_comment = '' %>
      <% l_fundus_retinal_detachment_comment = '' %>
      <% l_fundus_peripheral_lesions_comment = '' %>
      <% l_fundus_macula_comment = '' %>
      <% l_fundustext_comment = '' %>

      <% l_color_vision_counter = 0 %>
      <% l_orthoptics_counter = 0 %>
      <% l_contrastsensitivity_counter = 0 %>

      <% l_objectivecomments_counter = 0 %>
      <% l_objectivecomments_op = '' %>
      <% l_objectivecomments_comments_op = '' %>
      <% l_objectivecomments = '' %>

      <% l_orthoptics_template_counter = 0 %>
      <% l_ocular_diagram_counter = 0 %>
      <% l_hirschberg_test = '' %>
      <% l_cover_test = '' %>
      <% l_alternate_cover_test = '' %>
      <% l_patterns = '' %>
      <% l_prism_bar_cover_test_select = '' %>
      <% l_prism_bar_cover_test = '' %>
      <% l_prism_bar_reflex_test_select = '' %>
      <% l_prism_bar_reflex_test = '' %>
      <% l_ocular_movement1 = '-' %>
      <% l_ocular_movement2 = '-' %>
      <% l_ocular_movement3 = '-' %>
      <% l_ocular_movement4 = '-' %>
      <% l_ocular_movement5 = '-' %>
      <% l_ocular_movement6 = '-' %>
      <% l_nystagmus = '' %>
      <% l_maddox_test = '' %>
      <% l_worth_four_dot_test = '' %>
      <% l_stereopsis = '' %>
      <% l_hess_screen_test = '' %>

      <% if opdrecord.l_hirschberg_test.present? %>
        <% l_hirschberg_test = opdrecord.read_attribute(:l_hirschberg_test).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.l_cover_test.present? %>
        <% l_cover_test = opdrecord.read_attribute(:l_cover_test).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.l_alternate_cover_test.present? %>
        <% l_alternate_cover_test = opdrecord.read_attribute(:l_alternate_cover_test).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.l_patterns.present? %>
        <% l_patterns = opdrecord.read_attribute(:l_patterns).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.l_prism_bar_cover_test.present? %>
        <% l_prism_bar_cover_test = opdrecord.read_attribute(:l_prism_bar_cover_test).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if opdrecord.l_prism_bar_reflex_test.present? %>
        <% l_prism_bar_reflex_test = opdrecord.read_attribute(:l_prism_bar_reflex_test).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_ocular_movement1).blank? %>
        <% l_ocular_movement1 = opdrecord.read_attribute(:l_ocular_movement1).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% l_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_ocular_movement2).blank? %>
        <% l_ocular_movement2 = opdrecord.read_attribute(:l_ocular_movement2).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% l_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_ocular_movement3).blank? %>
        <% l_ocular_movement3 = opdrecord.read_attribute(:l_ocular_movement3).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% l_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_ocular_movement4).blank? %>
        <% l_ocular_movement4 = opdrecord.read_attribute(:l_ocular_movement4).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% l_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_ocular_movement5).blank? %>
        <% l_ocular_movement5 = opdrecord.read_attribute(:l_ocular_movement5).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% l_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_ocular_movement6).blank? %>
        <% l_ocular_movement6 = opdrecord.read_attribute(:l_ocular_movement6).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% l_ocular_diagram_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_nystagmus).blank? %>
        <% l_nystagmus = opdrecord.read_attribute(:l_nystagmus).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_maddox_test).blank? %>
        <% l_maddox_test = opdrecord.read_attribute(:l_maddox_test).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_worth_four_dot_test).blank? %>
        <% l_worth_four_dot_test = opdrecord.read_attribute(:l_worth_four_dot_test).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_stereopsis).blank? %>
        <% l_stereopsis = opdrecord.read_attribute(:l_stereopsis).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.read_attribute(:l_hess_screen_test).blank? %>
        <% l_hess_screen_test = opdrecord.read_attribute(:l_hess_screen_test).to_s %>
        <% l_orthoptics_template_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% if @current_facility.country_id != "VN_254" %>
        <% if opdrecord.read_attribute(:l_visualacuity_unaided_p).present? %>
          <% l_visualacuity_unaided_p = "(#{opdrecord.read_attribute(:l_visualacuity_unaided_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_unaided_comments).to_s.length > 0 %>
          <% l_visualacuity_unaided_comments = " (#{opdrecord.read_attribute(:l_visualacuity_unaided_comments)})" %>
        <% end %>
        <% unless opdrecord.l_visualacuity_unaided.blank? %>
          <% l_visualacuity_unaided = "UCVA - #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:l_visualacuity_unaided))}#{l_visualacuity_unaided_p}#{l_visualacuity_unaided_comments}" %>
          <% l_visualacuity_op = l_visualacuity_unaided.to_s %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_ua_near_p).present? %>
          <% l_visualacuity_ua_near_p = "(#{opdrecord.read_attribute(:l_visualacuity_ua_near_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_ua_near_comments).to_s.length > 0 %>
          <% l_visualacuity_ua_near_comments = " (#{opdrecord.read_attribute(:l_visualacuity_ua_near_comments)})" %>
        <% end %>
        <% unless opdrecord.l_visualacuity_ua_near.blank? %>
          <% l_visualacuity_ua_near = "UCVA Near- #{opdrecord.read_attribute(:l_visualacuity_ua_near)}#{l_visualacuity_ua_near_p}#{l_visualacuity_ua_near_comments}" %>
          <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_ua_near}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.l_visualacuity_ua_s.present? %>
          <% l_visualacuity_ua_s = "S#{opdrecord.read_attribute(:l_visualacuity_ua_s)}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.l_visualacuity_ua_i.present? %>
          <% l_visualacuity_ua_i = "I#{opdrecord.read_attribute(:l_visualacuity_ua_i)}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.l_visualacuity_ua_n.present? %>
          <% l_visualacuity_ua_n = "N#{opdrecord.read_attribute(:l_visualacuity_ua_n)}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.l_visualacuity_ua_t.present? %>
          <% l_visualacuity_ua_t = "T#{opdrecord.read_attribute(:l_visualacuity_ua_t)}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_pinhole_p).present? %>
          <% l_visualacuity_pinhole_p = "(#{opdrecord.read_attribute(:l_visualacuity_pinhole_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_pinhole_ni).present? %>
          <% l_visualacuity_pinhole_ni = "(#{opdrecord.read_attribute(:l_visualacuity_pinhole_ni)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_pinhole_comments).to_s.length > 0 %>
          <% l_visualacuity_pinhole_comments = " (#{opdrecord.read_attribute(:l_visualacuity_pinhole_comments)})" %>
        <% end %>
        <% unless opdrecord.l_visualacuity_pinhole.blank? %>
          <% l_visualacuity_pinhole = "PH- #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:l_visualacuity_pinhole))}#{l_visualacuity_pinhole_p}#{l_visualacuity_pinhole_ni}#{l_visualacuity_pinhole_comments}" %>
          <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_pinhole}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_glasses_p).present? %>
          <% l_visualacuity_glasses_p = "(#{opdrecord.read_attribute(:l_visualacuity_glasses_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_glasses_comments).to_s.length > 0 %>
          <% l_visualacuity_glasses_comments = " (#{opdrecord.read_attribute(:l_visualacuity_glasses_comments)})" %>
        <% end %>
        <% unless opdrecord.l_visualacuity_glasses.blank? %>
          <% l_visualacuity_glasses = "Glasses- #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:l_visualacuity_glasses))}#{l_visualacuity_glasses_p}#{l_visualacuity_glasses_comments}" %>
          <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_glasses}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_lens_p).present? %>
          <% l_visualacuity_lens_p = "(#{opdrecord.read_attribute(:l_visualacuity_lens_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_lens_comments).to_s.length > 0 %>
          <% l_visualacuity_lens_comments = " (#{opdrecord.read_attribute(:l_visualacuity_lens_comments)})" %>
        <% end %>
        <% unless opdrecord.l_visualacuity_lens.blank? %>
          <% l_visualacuity_lens = "Contact Lens- #{OpdRecordsHelper.visualacuity_unaided(opdrecord.read_attribute(:l_visualacuity_lens))}#{l_visualacuity_lens_p}#{l_visualacuity_lens_comments}" %>
          <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_lens}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_near_p).present? %>
          <% l_visualacuity_near_p = "(#{opdrecord.read_attribute(:l_visualacuity_near_p)})" %>
        <% end %>
        <% if opdrecord.read_attribute(:l_visualacuity_near_comments).to_s.length > 0 %>
          <% l_visualacuity_near_comments = " (#{opdrecord.read_attribute(:l_visualacuity_near_comments)})" %>
        <% end %>
        <% unless opdrecord.l_visualacuity_near.blank? %>
          <% l_visualacuity_near = "Glasses Near- #{opdrecord.read_attribute(:l_visualacuity_near)}#{l_visualacuity_near_p}#{l_visualacuity_near_comments}" %>
          <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_near}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
        <% unless opdrecord.l_visualacuity_comments.blank? %>
          <% l_visualacuity_comments = " Comments- #{opdrecord.read_attribute(:l_visualacuity_comments)}" %>
          <% l_visualacuity_op = "#{l_visualacuity_op} #{l_visualacuity_comments}" %>
          <% l_visualacuity_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
      <% end %>

      <% if opdrecord.l_intraocularpressure.present? %>
        <% l_intraocularpressure = opdrecord.read_attribute(:l_intraocularpressure).to_s %>
        <% l_intraocularpressure_op = "#{l_intraocularpressure_op}#{l_intraocularpressure}" %>
        <% l_intraocularpressure_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>
      <% if opdrecord.l_intraocularpressure.present? && opdrecord.l_intraocularpressure_time.present? %>
        <% l_intraocularpressure_time = opdrecord.read_attribute(:l_intraocularpressure_time).to_s %>
        <% l_intraocularpressure_op = "#{l_intraocularpressure_op} at #{l_intraocularpressure_time}" %>
        <%# l_intraocularpressure_counter = l_intraocularpressure_counter + 1 %>
        <%# examination_counter = examination_counter + 1 %>
      <% end %>
      <% if opdrecord.l_iop_method.present? %>
        <% l_iop_method = opdrecord.read_attribute(:l_iop_method).to_s %>
        <% l_intraocularpressure_op = "#{l_intraocularpressure_op} with #{l_iop_method}" %>
        <% l_intraocularpressure_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>
      <% if opdrecord.l_intraocularpressure_comments.present? %>
        <% l_intraocularpressure_comments = opdrecord.read_attribute(:l_intraocularpressure_comments).to_s %>
        <% l_intraocularpressure_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>
      <% if opdrecord.l_iop_comments.present? && opdrecord.l_iop_comments != "<br>" %>
        <% l_iop_comments = opdrecord.read_attribute(:l_iop_comments).to_s %>
        <% if l_intraocularpressure_comments.present? %>
          <% l_intraocularpressure_comments = "#{l_intraocularpressure_comments}, " %>
        <% end %>
        <% l_intraocularpressure_comments = "#{l_intraocularpressure_comments}#{l_iop_comments}".html_safe %>
        <% l_intraocularpressure_counter += 1 %>
        <% examination_counter += 1 %>
      <% end %>

      <% unless opdrecord.l_appearance.blank? %>
        <% unless opdrecord.l_appearance == "Normal" %>
          <% unless opdrecord.l_appearance_phthisisbulbi == "No" %>
            <% l_appearance_phthisisbulbi = 'Phthisis Bulbi,' %>
            <% l_appearance_op = l_appearance_phthisisbulbi.to_s %>
            <% l_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_appearance_anophthalmos == "No" %>
            <% l_appearance_anophthalmos = 'Anophthalmos,' %>
            <% l_appearance_op = "#{l_appearance_op} #{l_appearance_anophthalmos}" %>
            <% l_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_appearance_micropththalmos == "No" %>
            <% l_appearance_micropththalmos = 'Micropththalmos,' %>
            <% l_appearance_op = "#{l_appearance_op} #{l_appearance_micropththalmos}" %>
            <% l_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_appearance_artificial == "No" %>
            <% l_appearance_artificial = 'Artificial,' %>
            <% l_appearance_op = "#{l_appearance_op} #{l_appearance_artificial}" %>
            <% l_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_appearance_proptosis == "No" %>
            <% l_appearance_proptosis = 'Proptosis,' %>
            <% l_appearance_op = "#{l_appearance_op} #{l_appearance_proptosis}" %>
            <% l_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_appearance_dystopia == "No" %>
            <% l_appearance_dystopia = 'Dystopia,' %>
            <% l_appearance_op = "#{l_appearance_op} #{l_appearance_dystopia}" %>
            <% l_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_appearance_injured == "No" %>
            <% l_appearance_injured = 'Injured,' %>
            <% l_appearance_op = "#{l_appearance_op} #{l_appearance_injured}" %>
            <% l_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_appearance_swollen == "No" %>
            <% l_appearance_swollen = 'Swollen,' %>
            <% l_appearance_op = "#{l_appearance_op} #{l_appearance_swollen}" %>
            <% l_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_appearance_comments.present? && opdrecord.l_appearance_comments != "<br>" %>
            <% l_appearance_comments = opdrecord.read_attribute(:l_appearance_comments).to_s %>
            <% l_appearance_comments_op = " #{l_appearance_comments}" %>
            <% l_appearance_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_appearance_op.blank? %>
            <% l_appearance_op = l_appearance_op.split('') %>
            <% l_appearance_op_count = l_appearance_op.count %>
            <% if l_appearance_op_count > 0 %>
              <% l_appearance_op = (l_appearance_op.first l_appearance_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.l_scleracommon.blank? %>
        <% unless opdrecord.l_scleracommon == "Normal" %>
          <% if opdrecord.l_scleracommon_comments.present? && opdrecord.l_scleracommon_comments != "<br>" %>
            <% l_scleracommon_comments = opdrecord.read_attribute(:l_scleracommon_comments).to_s %>
            <% l_scleracommon_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
        <% end %>
      <% end %>

      <% if opdrecord.l_appendages == "Abnormal" %>
        <% unless opdrecord.l_appendages_tests.blank? %>
          <% if opdrecord.l_appendages_tests.include?"eyelids" %>
            <% unless opdrecord.l_appendages_eyelids_chalazion == "No" %>
              <% l_eyelid_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_ptosis == "No" %>
              <% l_eyelid_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_swelling == "No" %>
              <% l_eyelid_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_entropion == "No" %>
              <% l_eyelid_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_ectropion == "No" %>
              <% l_eyelid_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_mass== "No" %>
              <% l_eyelid_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelids_meibomitis== "No" %>
              <% l_eyelid_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% if opdrecord.l_appendages_tests.include?"eyelashes" %>
            <% unless opdrecord.l_appendages_eyelashes_trichiasis == "No" %>
              <% l_eyelsahes_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_eyelashes_dystrichiasis == "No" %>
              <% l_eyelsahes_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% if opdrecord.l_appendages_tests.include?"lacrimalsac" %>
            <% unless opdrecord.l_appendages_lacrimalsac_swelling == "No" %>
              <% l_lacrimal_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_appendages_lacrimalsac_regurgitation == "No" %>
              <% l_lacrimal_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% if opdrecord.l_appendages_tests.include?"syringing" %>
            <% unless opdrecord.l_appendages_syringing == "Patent" %>
              <% l_syringing_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% else %>
              <% l_syringing_counter += 1 %>
              <% l_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
        <% end %>
        <% if mail_job == false %>
          <% unless params[:action] == "print_opd_record" %>
          <% if opdrecord.l_appendages_diagram_present== "Y" %>
            <% l_appendages_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% end %>
        <% end %>
        <% if opdrecord.l_appendages_comments.present? && opdrecord.l_appendages_comments != "<br>" %>
          <% l_appendages_comments = opdrecord.read_attribute(:l_appendages_comments).to_s %>
          <% l_appendages_comments_op = " #{l_appendages_comments}" %>
          <% l_appendages_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
      <% end %>

      <% if opdrecord.r_appendages == "Abnormal" %>
        <% unless opdrecord.r_appendages_tests.blank? %>
          <% if opdrecord.r_appendages_tests.include?"eyelids" %>
            <% unless opdrecord.r_appendages_eyelids_chalazion == "No" %>
              <% r_eyelid_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.r_appendages_eyelids_ptosis == "No" %>
              <% r_eyelid_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.r_appendages_eyelids_swelling == "No" %>
              <% r_eyelid_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.r_appendages_eyelids_entropion == "No" %>
              <% r_eyelid_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.r_appendages_eyelids_ectropion == "No" %>
              <% r_eyelid_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.r_appendages_eyelids_mass== "No" %>
              <% r_eyelid_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.r_appendages_eyelids_meibomitis== "No" %>
              <% r_eyelid_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% if opdrecord.r_appendages_tests.include?"eyelashes" %>
            <% unless opdrecord.r_appendages_eyelashes_trichiasis == "No" %>
              <% r_eyelsahes_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.r_appendages_eyelashes_dystrichiasis == "No" %>
              <% r_eyelsahes_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% if opdrecord.r_appendages_tests.include?"lacrimalsac" %>
            <% unless opdrecord.r_appendages_lacrimalsac_swelling == "No" %>
              <% r_lacrimar_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.r_appendages_lacrimalsac_regurgitation == "No" %>
              <% r_lacrimar_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% if opdrecord.r_appendages_tests.include?"syringing" %>
            <% unless opdrecord.r_appendages_syringing == "Patent" %>
              <% r_syringing_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% else %>
              <% r_syringing_counter += 1 %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
        <% end %>
        <% if mail_job == false %>
          <% unless params[:action] == "print_opd_record" %>
            <% if opdrecord.r_appendages_diagram_present== "Y" %>
              <% r_appendages_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
        <% end %>
        <% if opdrecord.r_appendages_comments.present? && opdrecord.r_appendages_comments != "<br>" %>
          <% r_appendages_comments = opdrecord.read_attribute(:r_appendages_comments).to_s %>
          <% r_appendages_comments_op = " #{r_appendages_comments}" %>
          <% r_appendages_counter += 1 %>
          <% examination_counter += 1 %>
        <% end %>
      <% end %>

      <% unless opdrecord.l_conjunctiva.blank? %>
        <% unless opdrecord.l_conjunctiva == "Normal" %>
          <% unless opdrecord.l_conjunctiva_congestion == "No" %>
            <% if opdrecord.l_conjunctiva_congestion_lgc != "" %>
              <% l_conjunctiva_congestion_lgc = '-' + opdrecord.l_conjunctiva_congestion_lgc %>
            <% else %>
              <% l_conjunctiva_congestion_lgc = '' %>
            <% end %>
            <% l_conjunctiva_congestion = "Congestion#{l_conjunctiva_congestion_lgc}," %>
            <% l_conjunctiva_op = l_conjunctiva_congestion.to_s %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
            <% l_conjunctiva_congestion_lgc = opdrecord.l_conjunctiva_congestion_lgc %>
          <% end %>
          <% if false %>
            <% unless opdrecord.l_conjunctiva_conjunctivitis == "No" %>
              <% l_conjunctiva_conjunctivitis = 'Conjunctivitis,' %>
              <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_conjunctivitis}" %>
              <% l_conjunctiva_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
            <% unless opdrecord.l_conjunctiva_episcleritis == "No" %>
              <% l_conjunctiva_episcleritis = 'Episcleritis,' %>
              <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_episcleritis}" %>
              <% l_conjunctiva_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% unless opdrecord.l_conjunctiva_tear == "No" %>
            <% l_conjunctiva_tear = 'Tear,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_tear}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_conjunctiva_conjuctival_blib == "No" %>
            <% l_conjunctiva_conjuctival_blib = 'Conjuctival Bleb,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_conjuctival_blib}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_conjunctiva_subconjunctival_haemorrhage == "No" %>
            <% l_conjunctiva_subconjunctival_haemorrhage = 'SubConjunctival Haemorrhage,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_subconjunctival_haemorrhage}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_conjunctiva_foreign_body == "Yes" %>
            <% l_conjunctiva_foreign_body = 'Foreign Body,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_foreign_body}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_conjunctiva_follicles == "Yes" %>
            <% l_conjunctiva_follicles = 'Follicles,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_follicles}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_conjunctiva_papillae == "Yes" %>
            <% l_conjunctiva_papillae = 'Papillae,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_papillae}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_conjunctiva_pinguecula == "Yes" %>
            <% l_conjunctiva_pinguecula = 'Pinguecula,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_pinguecula}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_conjunctiva_pterygium == "Yes" %>
            <% l_conjunctiva_pterygium = 'Pterygium,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_pterygium}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_conjunctiva_phlycten == "Yes" %>
            <% l_conjunctiva_phlycten = 'Phlycten,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_phlycten}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_conjunctiva_discharge == "Yes" %>
            <% l_conjunctiva_discharge = 'Discharge,' %>
            <% l_conjunctiva_op = "#{l_conjunctiva_op} #{l_conjunctiva_discharge}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_conjunctiva_comments.present? && opdrecord.l_conjunctiva_comments != "<br>" %>
            <% l_conjunctiva_comments = opdrecord.read_attribute(:l_conjunctiva_comments).to_s %>
            <% l_conjunctiva_comments_op = " #{l_conjunctiva_comments}" %>
            <% l_conjunctiva_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_conjunctiva_op.blank? %>
            <% l_conjunctiva_op = l_conjunctiva_op.split('') %>
            <% l_conjunctiva_op_count = l_conjunctiva_op.count %>
            <% if l_conjunctiva_op_count > 0 %>
              <% l_conjunctiva_op = (l_conjunctiva_op.first l_conjunctiva_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.l_cornea.blank? %>
        <% unless opdrecord.l_cornea == "Normal" && opdrecord.l_cornea_normal != "normal" %>
          <% unless opdrecord.l_cornea_size == "Normal" && opdrecord.l_cornea_normal != "normal" %>
            <% l_cornea_size = "Size- #{opdrecord.read_attribute(:l_cornea_size)}," %>
            <% l_cornea_op = l_cornea_size.to_s %>
            <% l_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_cornea_shape == "Normal" && opdrecord.l_cornea_normal != "normal" %>
            <% l_cornea_shape = "Shape- #{opdrecord.read_attribute(:l_cornea_shape)}," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_cornea_shape}" %>
            <% l_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_cornea_surface == "Normal" && opdrecord.l_cornea_normal != "normal" %>
            <% l_cornea_surface = "Surface- #{opdrecord.read_attribute(:l_cornea_surface)}," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_cornea_surface}" %>
            <% l_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_fluorescein_staining == 'Negative' && opdrecord.l_cornea_normal != "normal" %>
            <% l_fluorescein_staining = "Fluorescein Staining- #{opdrecord.read_attribute(:l_fluorescein_staining)}," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_fluorescein_staining}" %>
            <% l_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_corneal_sensation == "Normal" && opdrecord.l_cornea_normal != "normal" %>
            <% l_corneal_sensation = "Corneal Sensation- #{opdrecord.read_attribute(:l_corneal_sensation)}," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_corneal_sensation}" %>
            <% l_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_cornea_schirmer_dimension1.present? || opdrecord.l_cornea_schirmer_time1.present? %>
            <% l_cornea_schirmer_dimension1 = (opdrecord.l_cornea_schirmer_dimension1 if opdrecord.l_cornea_schirmer_dimension1.present?) || ' - ' %>
            <% l_cornea_schirmer_time1 = (opdrecord.l_cornea_schirmer_time1 if opdrecord.l_cornea_schirmer_time1.present?) || ' - ' %>
            <% opdrecord.l_cornea_schirmer_dimension1 = l_cornea_schirmer_dimension1 %>
            <% opdrecord.l_cornea_schirmer_time1 = l_cornea_schirmer_time1 %>
            <% l_cornea_schirmer_test1 = "Schirmer Test-1 (#{opdrecord.read_attribute(:l_cornea_schirmer_dimension1)}mm in #{opdrecord.read_attribute(:l_cornea_schirmer_time1)} min)," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_cornea_schirmer_test1}" %>
            <% l_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_cornea_schirmer_dimension2.present? || opdrecord.l_cornea_schirmer_time2.present? %>
            <% l_cornea_schirmer_dimension2 = (opdrecord.l_cornea_schirmer_dimension2 if opdrecord.l_cornea_schirmer_dimension2.present?) || ' - ' %>
            <% l_cornea_schirmer_time2 = (opdrecord.l_cornea_schirmer_time2 if opdrecord.l_cornea_schirmer_time2.present?) || ' - ' %>
            <% opdrecord.l_cornea_schirmer_dimension2 = l_cornea_schirmer_dimension2 %>
            <% opdrecord.l_cornea_schirmer_time2 = l_cornea_schirmer_time2 %>
            <% l_cornea_schirmer_test2 = "Schirmer Test-2 (#{opdrecord.read_attribute(:l_cornea_schirmer_dimension2)}mm in #{opdrecord.read_attribute(:l_cornea_schirmer_time2)} min)," %>
            <% l_cornea_op = "#{l_cornea_op} #{l_cornea_schirmer_test2}" %>
            <% l_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if mail_job == false %>
            <% unless params[:action] == "print_opd_record" %>
              <% if opdrecord.l_cornea_diagram_present== "Y" %>
                <% l_cornea_counter += 1 %>
                <% examination_counter += 1 %>
              <% end %>
              <% if opdrecord.l_corneaslit_diagram_present== "Y" %>
                <% l_corneaslit_counter += 1 %>
                <% examination_counter += 1 %>
              <% end %>
            <% end %>
          <% end %>
          <% if opdrecord.l_cornea_comments.present? && opdrecord.l_cornea_comments != "<br>" %>
            <% l_cornea_comments = opdrecord.read_attribute(:l_cornea_comments).to_s %>
            <% l_cornea_comments_op = l_cornea_comments.to_s %>
            <% l_cornea_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_cornea_op.blank? %>
            <% l_cornea_op = l_cornea_op.split('') %>
            <% l_cornea_op_count = l_cornea_op.count %>
            <% if l_cornea_op_count > 0 %>
              <% l_cornea_op = (l_cornea_op.first l_cornea_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.l_anteriorchamber.blank? %>
        <% unless opdrecord.l_anteriorchamber == "Normal" %>
          <% unless opdrecord.l_anteriorchamber_depth == "Normal" %>
            <% l_anteriorchamber_depth = "Depth- #{opdrecord.read_attribute(:l_anteriorchamber_depth)} #{opdrecord.read_attribute(:l_anteriorchamber_depth_comment)}," %>
            <% l_anteriorchamber_op = l_anteriorchamber_depth.to_s %>
            <% l_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_anteriorchamber_cells == "No" %>
            <% l_anteriorchamber_cells = "Cells #{opdrecord.read_attribute(:l_anteriorchamber_cells_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_cells}," %>
            <% l_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_anteriorchamber_flare == "No" %>
            <% l_anteriorchamber_flare = "Flare #{opdrecord.read_attribute(:l_anteriorchamber_flare_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_flare}," %>
            <% l_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_anteriorchamber_hyphema == "No" %>
            <% l_anteriorchamber_hyphema = "Hyphema #{opdrecord.read_attribute(:l_anteriorchamber_hyphema_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_hyphema}," %>
            <% l_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_anteriorchamber_hypopyon == "No" %>
            <% l_anteriorchamber_hypopyon = "Hypopyon #{opdrecord.read_attribute(:l_anteriorchamber_hypopyon_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_hypopyon}," %>
            <% l_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_anteriorchamber_foreignbody == "No" %>
            <% l_anteriorchamber_foreignbody = "Foreign Body #{opdrecord.read_attribute(:l_anteriorchamber_foreignbody_comment)}" %>
            <% l_anteriorchamber_op = "#{l_anteriorchamber_op} #{l_anteriorchamber_foreignbody}," %>
            <% l_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_anteriorchamber_comments.present? && opdrecord.l_anteriorchamber_comments != "<br>" %>
            <% l_anteriorchamber_comments = opdrecord.read_attribute(:l_anteriorchamber_comments).to_s %>
            <% l_anteriorchamber_comments_op = l_anteriorchamber_comments.to_s %>
            <% l_anteriorchamber_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_anteriorchamber_op.blank? %>
            <% l_anteriorchamber_op = l_anteriorchamber_op.split('') %>
            <% l_anteriorchamber_op_count = l_anteriorchamber_op.count %>
            <% if l_anteriorchamber_op_count > 0 %>
              <% l_anteriorchamber_op = (l_anteriorchamber_op.first l_anteriorchamber_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.l_pupil.blank? %>
        <% unless opdrecord.l_pupil == "Normal" && opdrecord.l_pupil_normal != "normal" %>
          <% if opdrecord.l_pupil_shape.present? %>
            <% l_pupil_shape = "Shape- #{opdrecord.read_attribute(:l_pupil_shape)}," %>
            <% l_pupil_op = l_pupil_shape.to_s %>
            <% l_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_pupilsize.present? %>
            <% l_pupilsize = "Size- #{opdrecord.read_attribute(:l_pupilsize)} mm," %>
            <% l_pupil_op = "#{l_pupil_op} #{l_pupilsize}" %>
            <% l_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_pupil_reaction_to_light_direct == "Normal" && opdrecord.l_pupil_normal != "normal" %>
            <% l_pupil_reaction_to_light_direct = "Reaction to light Direct- #{opdrecord.read_attribute(:l_pupil_reaction_to_light_direct)}," %>
            <% l_pupil_op = "#{l_pupil_op} #{l_pupil_reaction_to_light_direct}" %>
            <% l_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_pupil_reaction_to_light_consensual == "Normal" && opdrecord.l_pupil_normal != "normal" %>
            <% l_pupil_reaction_to_light_consensual = "Reaction to light consensual- #{opdrecord.read_attribute(:l_pupil_reaction_to_light_consensual)}," %>
            <% l_pupil_op = "#{l_pupil_op} #{l_pupil_reaction_to_light_consensual}" %>
            <% l_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_pupil_rapd == "No" %>
            <% l_pupil_rapd = 'RAPD,' %>
            <% l_pupil_op = "#{l_pupil_op} #{l_pupil_rapd}" %>
            <% l_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_pupil_comments.present? && opdrecord.l_pupil_comments != "<br>" %>
            <% l_pupil_comments = opdrecord.read_attribute(:l_pupil_comments).to_s %>
            <% l_pupil_comments_op = l_pupil_comments.to_s %>
            <% l_pupil_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_pupil_op.blank? %>
            <% l_pupil_op = l_pupil_op.split('') %>
            <% l_pupil_op_count = l_pupil_op.count %>
            <% if l_pupil_op_count > 0 %>
              <% l_pupil_op = (l_pupil_op.first l_pupil_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.l_iris.blank? %>
        <% unless opdrecord.l_iris == "Normal" %>
          <% unless opdrecord.l_iris_shape == "Normal" %>
            <% l_iris_shape = "Shape- #{opdrecord.read_attribute(:l_iris_shape)}," %>
            <% l_iris_op = l_iris_shape.to_s %>
            <% l_iris_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_iris_neovascularisation == "No" %>
            <% l_iris_neovascularisation = 'Neovascularisation,' %>
            <% l_iris_op = "#{l_iris_op}#{l_iris_neovascularisation}" %>
            <% l_iris_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_iris_synechiae == "No" %>
            <% l_iris_synechiae = "Synechiae- #{opdrecord.read_attribute(:l_iris_synechiae)}," %>
            <% l_iris_op = "#{l_iris_op}#{l_iris_synechiae}" %>
            <% l_iris_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_iris_peripheraliridotomy == "No"
              l_iris_peripheraliridotomy = 'Peripheral Iridotomy,'
              l_iris_op = "#{l_iris_op}#{l_iris_peripheraliridotomy}"
              l_iris_counter += 1
              examination_counter += 1
            end %>
          <% if opdrecord.l_iris_comments.present? && opdrecord.l_iris_comments != "<br>" %>
            <% l_iris_comments = opdrecord.read_attribute(:l_iris_comments).to_s %>
            <% l_iris_comments_op = l_iris_comments.to_s %>
            <% l_iris_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_iris_op.blank? %>
            <% l_iris_op = l_iris_op.split('') %>
            <% l_iris_op_count = l_iris_op.count %>
            <% if l_iris_op_count > 0 %>
              <% l_iris_op = (l_iris_op.first l_iris_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.l_lens.blank? %>
        <% unless opdrecord.l_lens == "Normal" %>
          <% unless opdrecord.l_lens_nature == "Clear" %>
            <% l_lens_nature = "Nature- #{opdrecord.read_attribute(:l_lens_nature)}," %>
            <% l_lens_op = l_lens_nature.to_s %>
            <% l_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_lens_position == "Central" %>
            <% l_lens_position = "Position- #{opdrecord.read_attribute(:l_lens_position)}," %>
            <% l_lens_op = "#{l_lens_op} #{l_lens_position}" %>
            <% l_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_lens_size == "Normal" %>
            <% l_lens_size = "Lens Size- #{opdrecord.read_attribute(:l_lens_size)}," %>
            <% l_lens_op = "#{l_lens_op} #{l_lens_size}" %>
            <% l_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if  opdrecord.l_lens_grading_no.present? %>
            <% l_lens_grading_no = "NS:#{opdrecord.read_attribute(:l_lens_grading_no)}" %>
          <% end %>
          <% if  opdrecord.l_lens_grading_nc.present? %>
            <% l_lens_grading_nc = "NC:#{opdrecord.read_attribute(:l_lens_grading_nc)}" %>
          <% end %>
          <% if  opdrecord.l_lens_grading_c.present? %>
            <% l_lens_grading_c = "C:#{opdrecord.read_attribute(:l_lens_grading_c)}" %>
          <% end %>
          <% if  opdrecord.l_lens_grading_p.present? %>
            <% l_lens_grading_p = "P:#{opdrecord.read_attribute(:l_lens_grading_p)}" %>
          <% end %>
          <% if opdrecord.l_lens_grading_no.present? || opdrecord.l_lens_grading_nc.present? || opdrecord.l_lens_grading_c.present? || opdrecord.l_lens_grading_p.present? %>
            <% l_lens_grading = "Lens Grading- #{l_lens_grading_no} #{l_lens_grading_nc} #{l_lens_grading_c} #{l_lens_grading_p}," %>
            <% l_lens_op = "#{l_lens_op} #{l_lens_grading}" %>
            <% l_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_lens_comments.present? && opdrecord.l_lens_comments != "<br>" %>
            <% l_lens_comments = opdrecord.read_attribute(:l_lens_comments).to_s %>
            <% l_lens_comments_op = l_lens_comments.to_s %>
            <% l_lens_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if mail_job == false %>
            <% unless params[:action] == "print_opd_record" %>
              <% if opdrecord.l_lens_diagram_present== "Y" %>
                <% l_lens_counter += 1 %>
                <% examination_counter += 1 %>
              <% end %>
            <% end %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_lens_op.blank? %>
            <% l_lens_op = l_lens_op.split('') %>
            <% l_lens_op_count = l_lens_op.count %>
            <% if l_lens_op_count > 0 %>
              <% l_lens_op = (l_lens_op.first l_lens_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.l_extraocularmovements.blank? %>
        <% unless opdrecord.l_extraocularmovements == "Normal" %>
          <% unless opdrecord.l_extraocularmovements_uniocular == "Full" %>
            <% l_extraocularmovements_uniocular = "Uniocular- #{opdrecord.read_attribute(:l_extraocularmovements_uniocular)}," %>
            <% l_extraocularmovements_op = l_extraocularmovements_uniocular.to_s %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_extraocularmovements_binocular == "Full" %>
            <% l_extraocularmovements_binocular = "Binocular- #{opdrecord.read_attribute(:l_extraocularmovements_binocular)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_binocular}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_extraocularmovements_prism.present? %>
            <% l_extraocularmovements_prism = "Prism- #{opdrecord.read_attribute(:l_extraocularmovements_prism)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_prism}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_extraocularmovements_squint.blank? %>
            <% l_extraocularmovements_squint = "Squint- #{opdrecord.read_attribute(:l_extraocularmovements_squint)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_extraocularmovements_squint_tropia.blank? %>
            <% l_extraocularmovements_squint_tropia = "Tropia- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_extraocularmovements_squint_tropia_horizontal.blank? %>
            <% l_extraocularmovements_squint_tropia_horizontal = "Horizontal- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_horizontal)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_horizontal}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_extraocularmovements_squint_tropia_horizontal_esotropia.blank? %>
            <% l_extraocularmovements_squint_tropia_horizontal_esotropia = "Esotropia- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_horizontal_esotropia)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_horizontal_esotropia}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_extraocularmovements_squint_tropia_horizontal_exotropia.blank? %>
            <% l_extraocularmovements_squint_tropia_horizontal_exotropia = "Exotropia- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_horizontal_exotropia)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_horizontal_exotropia}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_extraocularmovements_squint_tropia_vertical.blank? %>
            <% l_extraocularmovements_squint_tropia_vertical = "Vertical- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_vertical)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_vertical}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_extraocularmovements_squint_tropia_paralytic.blank? %>
            <% l_extraocularmovements_squint_tropia_paralytic = "Paralytic- #{opdrecord.read_attribute(:l_extraocularmovements_squint_tropia_paralytic)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_tropia_paralytic}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_extraocularmovements_squint_phoria.blank? %>
            <% l_extraocularmovements_squint_phoria = "Phoria- #{opdrecord.read_attribute(:l_extraocularmovements_squint_phoria)}," %>
            <% l_extraocularmovements_op = "#{l_extraocularmovements_op} #{l_extraocularmovements_squint_phoria}" %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_extraocularmovements_comments.present? && opdrecord.l_extraocularmovements_comments != "<br>" %>
            <% l_extraocularmovements_comments = opdrecord.read_attribute(:l_extraocularmovements_comments).to_s %>
            <% l_extraocularmovements_comments_op = l_extraocularmovements_comments.to_s %>
            <% l_extraocularmovements_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_extraocularmovements_op.blank? %>
            <% l_extraocularmovements_op = l_extraocularmovements_op.split('') %>
            <% l_extraocularmovements_op_count = l_extraocularmovements_op.count %>
            <% if l_extraocularmovements_op_count > 0 %>
              <% l_extraocularmovements_op = (l_extraocularmovements_op.first l_extraocularmovements_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% unless opdrecord.l_fundus.blank? %>
        <% unless opdrecord.l_fundus == "Normal" %>
          <% unless opdrecord.l_fundus_media_select == "" %>
            <% if opdrecord.l_fundus_media_comment.present? %>
              <% l_fundus_media_select = "Media-#{opdrecord.read_attribute(:l_fundus_media_select)}(#{opdrecord.read_attribute(:l_fundus_media_comment)})" %>
            <% else %>
              <% l_fundus_media_select = "Media-#{opdrecord.read_attribute(:l_fundus_media_select)}" %>
            <% end %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_media_select}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_fundus_pvd_select == "" %>
            <% l_fundus_pvd_select = "PVD-#{opdrecord.read_attribute(:l_fundus_pvd_select)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_pvd_select}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_fundus_optdiscsize_select == "" %>
            <% l_fundus_optdiscsize_select = "OptDiscSize-#{opdrecord.read_attribute(:l_fundus_optdiscsize_select)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_optdiscsize_select}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_fundus_cup_disc_ratio_select == "" %>
            <% if opdrecord.l_fundus_cupratio_comment.present? %>
              <% l_fundus_cup_disc_ratio_select = "CupRatio-#{opdrecord.read_attribute(:l_fundus_cup_disc_ratio_select)}(#{opdrecord.read_attribute(:l_fundus_cupratio_comment)})" %>
            <% else %>
              <% l_fundus_cup_disc_ratio_select = "CupRatio-#{opdrecord.read_attribute(:l_fundus_cup_disc_ratio_select)}" %>
            <% end %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_cup_disc_ratio_select}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% unless opdrecord.l_fundus_opticdisc_comment == "" %>
            <% l_fundus_opticdisc_comment = "OpticDisc-#{opdrecord.read_attribute(:l_fundus_opticdisc_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_opticdisc_comment}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_fundus_bloodvessel_comment.present? && opdrecord.l_fundus_bloodvessel_select.present? %>
            <% l_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:l_fundus_bloodvessel_select)}-#{opdrecord.read_attribute(:l_fundus_bloodvessel_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_bloodvessel}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.l_fundus_bloodvessel_comment.blank? && opdrecord.l_fundus_bloodvessel_select.present? %>
            <% l_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:l_fundus_bloodvessel_select)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_bloodvessel}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.l_fundus_bloodvessel_comment.present? && opdrecord.l_fundus_bloodvessel_select.blank? %>
            <% l_fundus_bloodvessel = "Bloodvessel-#{opdrecord.read_attribute(:l_fundus_bloodvessel_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_bloodvessel}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_fundus_macula_comment.present? && opdrecord.l_fundus_macula_select.present? %>
            <% l_fundus_macula = "Macula-#{opdrecord.read_attribute(:l_fundus_macula_select)&.split(',')&.join(", ").to_s}-#{opdrecord.read_attribute(:l_fundus_macula_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_macula}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.l_fundus_macula_comment.blank? && opdrecord.l_fundus_macula_select.present?  %>
            <% l_fundus_macula = "Macula-#{opdrecord.read_attribute(:l_fundus_macula_select)&.split(',')&.join(", ").to_s}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_macula}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.l_fundus_macula_comment.present? && opdrecord.l_fundus_macula_select.blank? %>
            <% l_fundus_macula = "Macula-#{opdrecord.read_attribute(:l_fundus_macula_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_macula}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_fundus_macula_select.present? %>
            <% if opdrecord.l_fundus_macula_select.include? "Foveal Reflex" %>
              <% l_fundus_macula_fovealreflex = "Foveal Reflex- #{opdrecord.read_attribute(:l_fundus_macula_fovealreflex).to_s}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_macula_fovealreflex}" %>
              <% l_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% if opdrecord.l_fundus_vitreous_comment.present? && opdrecord.l_fundus_vitreous_select.present? %>
            <% l_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:l_fundus_vitreous_select)}-#{opdrecord.read_attribute(:l_fundus_vitreous_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_vitreous}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.l_fundus_vitreous_comment.blank? && opdrecord.l_fundus_vitreous_select.present? %>
            <% l_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:l_fundus_vitreous_select)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_vitreous}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.l_fundus_vitreous_comment.present? && opdrecord.l_fundus_vitreous_select.blank? %>
            <% l_fundus_vitreous = "Vitreous-#{opdrecord.read_attribute(:l_fundus_vitreous_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_vitreous}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_fundus_retinal_detachment_comment.present? && opdrecord.l_fundus_retinal_detachment_select.present? %>
            <% l_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:l_fundus_retinal_detachment_select)}-#{opdrecord.read_attribute(:l_fundus_retinal_detachment_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_retinal_detachment}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.l_fundus_retinal_detachment_comment.blank? && opdrecord.l_fundus_retinal_detachment_select.present? %>
            <% l_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:l_fundus_retinal_detachment_select)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_retinal_detachment}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% elsif opdrecord.l_fundus_retinal_detachment_comment.present? && opdrecord.l_fundus_retinal_detachment_select.blank? %>
            <% l_fundus_retinal_detachment = "Retinal Detachment-#{opdrecord.read_attribute(:l_fundus_retinal_detachment_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundus_retinal_detachment}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if opdrecord.l_fundus_lattice_degeneration_select.present? %>
            <% if opdrecord.l_fundus_peripheral_lesions_comment.present? %>
              <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:l_fundus_lattice_degeneration_select)}-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_comment)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
              <% l_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% else %>
              <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:l_fundus_lattice_degeneration_select)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
              <% l_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% else %>
            <% if opdrecord.l_fundus_peripheral_lesions_comment.present? && opdrecord.l_fundus_peripheral_lesions_select.present? %>
              <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_select)}-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_comment)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
              <% l_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% elsif opdrecord.l_fundus_peripheral_lesions_comment.blank? && opdrecord.l_fundus_peripheral_lesions_select.present? %>
              <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_select)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
              <% l_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% elsif opdrecord.l_fundus_peripheral_lesions_comment.present? && opdrecord.l_fundus_peripheral_lesions_select.blank? %>
              <% l_fundus_peripheral_lesions = "Peripheral Lesions-#{opdrecord.read_attribute(:l_fundus_peripheral_lesions_comment)}" %>
              <% l_fundus_op = "#{l_fundus_op} #{l_fundus_peripheral_lesions}" %>
              <% l_fundus_counter += 1 %>
              <% examination_counter += 1 %>
            <% end %>
          <% end %>
          <% unless opdrecord.l_fundustext_comment == "" %>
            <% l_fundustext_comment = "Fundus-#{opdrecord.read_attribute(:l_fundustext_comment)}" %>
            <% l_fundus_op = "#{l_fundus_op} #{l_fundustext_comment}" %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <% if mail_job == false %>
            <% unless params[:action] == "print_opd_record" %>
              <% if opdrecord.l_fundus_diagram_present== "Y" %>
                <% l_fundus_counter += 1 %>
                <% examination_counter += 1 %>
              <% end %>
            <% end %>
          <% end %>
          <% if opdrecord.l_fundus_comments.present? && opdrecord.l_fundus_comments != "<br>" %>
            <% l_fundus_comments = opdrecord.read_attribute(:l_fundus_comments).to_s %>
            <% l_fundus_comments_op = l_fundus_comments.to_s %>
            <% l_fundus_counter += 1 %>
            <% examination_counter += 1 %>
          <% end %>
          <!-- Code to Remove The Last Comma -->
          <% unless l_fundus_op.blank? %>
            <% l_fundus_op = l_fundus_op.split('') %>
            <% l_fundus_op_count = l_fundus_op.count %>
            <% if l_fundus_op_count > 0 %>
              <% l_fundus_op = (l_fundus_op.first l_fundus_op_count - 1).join %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <% if opdrecord.read_attribute(:l_gonioscopy) == "Abnormal" %>
        <% examination_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_gonioscopy) == "Abnormal" %>
        <% examination_counter += 1 %>
      <% end %>

      <% if examination_counter > 0 || general_examination_counter > 0 || opdrecord.r_local_examination_normal == "normal" || opdrecord.l_local_examination_normal == "normal" || orthoptics_heading_counter > 0 %>
        <div class="row mb5">
          <strong>EXAMINATION</strong>
          <% if mail_job == false %>
            <% if params[:action] != "print_opd_record" || diagram_counter > 0 %><% end %>
          <% end %>
          <div class="summary-line-border"></div>
        </div>
        <div class="row">
          <div class="col-md-12 col-sm-12">
            <span style="white-space: pre-line"><%= generalexaminationcommoncomments_op %> </span>
          </div>
          <div class="col-md-12 col-sm-12">
            <span><%= generalexaminationcomments_op %> </span>
          </div>
          <div class="col-md-12 col-sm-12">
            <span><%= head_posture %> </span>
          </div>
          <div class="col-md-12 col-sm-12">
            <span><%= face_turn %> </span>
          </div>
          <div class="col-md-12 col-sm-12">
            <span><%= head_tilt %> </span>
          </div>
          <% if @templatetype == "paediatrics" %>
            <% if opdrecord.paediatric_height.present? || opdrecord.paediatric_weight.present? %>
              <div class="col-md-12 col-sm-12">
                <% if opdrecord.paediatric_height.present? %>
                  <span>Height </span>
                  <span><%= opdrecord.paediatric_height %> cms</span>
                  <% if opdrecord.paediatric_weight.present? %>, <% end %>
                <% end %>
                <% if opdrecord.paediatric_weight.present? %>
                  <span>Weight </span>
                  <span><%= opdrecord.paediatric_weight %> kgs </span>
                <% end %>
              </div>
            <% end %>
            <% if opdrecord.paediatric_general_appearance.present? %>
              <div class="col-md-12 col-sm-12">
                <span>General Appearance- </span>
                <span><%= opdrecord.paediatric_general_appearance %> </span>
              </div>
            <% end %>
            <% if opdrecord.paediatric_head_posture.present? %>
              <div class="col-md-12 col-sm-12">
                <span>Head Posture- </span>
                <span><%= opdrecord.paediatric_head_posture %> </span>
              </div>
            <% end %>
            <% if opdrecord.paediatric_nutritional_status.present? %>
              <div class="col-md-12 col-sm-12">
                <span>Nutritional Status- </span>
                <span><%= opdrecord.paediatric_nutritional_status %> </span>
              </div>
            <% end %>
          <% end %>
          <% if examination_counter > 0 || opdrecord.r_local_examination_normal == "normal" || opdrecord.l_local_examination_normal == "normal" %>
            <div class="col-md-6 col-sm-6">
              <div class="text-center" style="background-color:#ddd;">R/OD</div>
            </div><!-- col-md-6  -->
            <div class="col-md-6 col-sm-6">
              <div class="text-center" style="background-color:#ddd;">L/OS</div>
            </div><!-- col-md-6  -->
          <% end %>
          <div class="col-md-6 col-sm-6">
            <% if r_orthoptics_template_counter > 0 %>
              <% if r_hirschberg_test.present? %>
                <b>Hirschberg Test:</b> <%= r_hirschberg_test %>
                <br>
              <% end %>
              <% if r_cover_test.present? %>
                <b>Cover Test :</b> <%= r_cover_test %>
                <br>
              <% end %>
              <% if r_alternate_cover_test.present? %>
                <b>Alternate Cover Test :</b> <%= r_alternate_cover_test %>
                <br>
              <% end %>
              <% if r_patterns.present? %>
                <b>Patterns:</b> <%= r_patterns %>
                <br>
              <% end %>
              <% if  r_prism_bar_cover_test.present? %>
                <b>Prism bar cover test:</b>
                  <% if opdrecord.read_attribute(:r_prism_bar_cover_test_select).present? %>
                    <%= "#{opdrecord.read_attribute(:r_prism_bar_cover_test_select)} -  " %>
                  <% end %>
                  <%= r_prism_bar_cover_test %>
                <br>
              <% end %>
              <% if r_prism_bar_reflex_test.present? %>
                <b>Prism bar reflex test:</b>
                  <% if opdrecord.read_attribute(:r_prism_bar_reflex_test_select).present? %>
                    <%= "#{opdrecord.read_attribute(:r_prism_bar_reflex_test_select)} -  " %>
                  <% end %>
                  <%= r_prism_bar_reflex_test %>
                <br>
              <% end %>
              <% if r_ocular_diagram_counter > 0 %>
                <div class="row col-md-12 col-sm-12 common_margin" style="margin-bottom: 10px">
                  <b>Ocular Movements :</b>
                  <div class="text-center" style="margin-top: 10px;">
                    <div class="col-sm-12 col-sm-12">
                      <div class="col-md-1 col-sm-1"></div>
                      <div class="col-md-7 col-sm-1"> <%= r_ocular_movement1 %></div>
                      <div class="col-md-7 col-sm-7"></div>
                      <div class="col-md-7 col-sm-1"> <%= r_ocular_movement2 %></div>
                    </div>
                    <div class="col-md-12 col-sm-12">
                      <div class="col-md-1 col-sm-1"></div>
                      <div class="col-md-1 col-sm-1" style="margin-top: 18px;"><%= r_ocular_movement3 %></div>
                      <div class="col-md-7 col-sm-7">
                        <svg width="120" height="60" style="    margin-left: -2px;">
                          <line x1="0" y1="0" x2="120" y2="60" style="stroke:#636e7b;stroke-width:2" />
                          <line x1="0" y1="60" x2="120" y2="0" style="stroke:#636e7b;stroke-width:2" />
                          <line x1="0" y1="30" x2="120" y2="30" style="stroke:#636e7b;stroke-width:2" />
                          Sorry, your browser does not support inline SVG.
                        </svg>
                      </div>
                      <div class="col-md-1 col-sm-1" style="margin-top: 18px;"><%= r_ocular_movement4 %></div>
                    </div>
                    <div class="col-md-12 col-sm-12" style="margin-top: -8px;">
                      <div class="col-md-1 col-sm-1"></div>
                      <div class="col-md-1 col-sm-1"><%= r_ocular_movement5 %></div>
                      <div class="col-md-7 col-sm-7"></div>
                      <div class="col-md-1 col-sm-1"><%= r_ocular_movement6 %></div>
                    </div>
                  </div>
                </div>
              <% end %>
              <% if r_nystagmus.present? %>
                <b>Nystagmus :</b> <%= r_nystagmus %>
                <br>
              <% end %>

              <% if r_maddox_test.present? %>
                <b>Maddox Test :</b> <%= r_maddox_test %>
                <br>
              <% end %>

              <% if r_worth_four_dot_test.present? %>
                <b>Worth four dot test :</b> <%= r_worth_four_dot_test %>
                <br>
              <% end %>

              <% if r_stereopsis.present? %>
                <b>Stereopsis :</b> <%= r_stereopsis %>
                <br>
              <% end %>

              <% if r_hess_screen_test.present? %>
                <b>Hess Screen test :</b> <%= r_hess_screen_test %>
                <br>
              <% end %>
            <% end %>

            <% if @current_facility.country_id != "VN_254" %>
              <% if r_visualacuity_counter > 0 %>
                <strong>VA:</strong> <%= r_visualacuity_op %>
                <% if r_visualacuity_ua_s.present? || r_visualacuity_ua_i.present? || r_visualacuity_ua_n.present? || r_visualacuity_ua_t.present? %>
                  PR(UCVA): <%= r_visualacuity_ua_s %> <%= r_visualacuity_ua_i %> <%= r_visualacuity_ua_n %> <%= r_visualacuity_ua_t %>
                <% end %>
                <br>
              <% end %>
              <% if r_intraocularpressure_counter > 0 %>
                <% if r_intraocularpressure_op.to_i >= 0 && r_intraocularpressure_op.to_i < 19 %>
                  <strong>IOP:</strong>
                  <%= r_intraocularpressure_op %>
                <% elsif r_intraocularpressure_op.to_i >= 19 %>
                  <span class="abnormal-highlight">
                    <strong>IOP:</strong>
                    <%= r_intraocularpressure_op %>
                  </span>
                <% end %>
                <% if r_intraocularpressure_comments.present? %>
                  <ul><li><%= r_intraocularpressure_comments %></li></ul>
                <% end %>
                <br/>
              <% end %>
            <% else %>
              <% if r_intraocularpressure_counter > 0 %>
                <% if r_intraocularpressure_op.to_i >= 0 && r_intraocularpressure_op.to_i < 19 %>
                    <strong>IOP:</strong>
                    <%= r_intraocularpressure_op %>
                <% elsif r_intraocularpressure_op.to_i >= 19 %>
                  <span class="abnormal-highlight">
                    <strong>IOP:</strong>
                    <%= r_intraocularpressure_op %>
                  </span>
                <% end %>
                <% if r_intraocularpressure_comments.present? %>
                  <ul><li><%= r_intraocularpressure_comments %></li></ul>
                <% end %>
              <% end %>
            <% end %>

            <% if r_appearance_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Appearance: </b><% unless r_appearance_op ==[] %><%= r_appearance_op %><% end %>
                <% if r_appearance_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= r_appearance_comments_op.html_safe %> </span> </div>
                <% end %>
                <div class="examination_non_tabular">
                </div>
              </span>
            <% elsif opdrecord.r_local_examination_normal == "normal" %>
                <b>Appearance: </b>Normal
                <div class="examination_non_tabular"></div>
            <% end %>

            <% if r_scleracommon_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Sclera: </b>
                <% if r_scleracommon_comments.present? %><div><span style="display: list-item;margin-left: 4%"><%= r_scleracommon_comments.html_safe %> </span> </div>
                <% end %>
                <div class="examination_non_tabular">
                </div>
              </span>
            <% end %>

            <% if r_appendages_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Appendages: </b>
                <% if r_eyelid_counter > 0 %>
                  <% if opdrecord.r_appendages_tests.include?"eyelids" %>
                    <b>Eyelids:</b>
                    <% unless opdrecord.r_appendages_eyelids_chalazion == "No" %>
                      Chalazion,
                    <% end %>
                    <% unless opdrecord.r_appendages_eyelids_ptosis == "No" %>
                      Ptosis,
                    <% end %>
                    <% unless opdrecord.r_appendages_eyelids_swelling == "No" %>
                      Swelling,
                    <% end %>
                    <% unless opdrecord.r_appendages_eyelids_entropion == "No" %>
                      Entropion,
                    <% end %>
                    <% unless opdrecord.r_appendages_eyelids_ectropion == "No" %>
                      Ectropion,
                    <% end %>
                    <% unless opdrecord.r_appendages_eyelids_mass == "No" %>
                      Eyelids mass,
                    <% end %>
                    <% unless opdrecord.r_appendages_eyelids_meibomitis == "No" %>
                      Meibomitis,
                    <% end %>
                  <% end %>
                <% end %>
                <% if  r_eyelsahes_counter > 0 %>
                  <% if opdrecord.r_appendages_tests.include?"eyelashes" %>
                    <b>Eyelashes:</b>
                    <% unless opdrecord.r_appendages_eyelashes_trichiasis == "No" %>
                      Trichiasis,
                    <% end %>
                    <% unless opdrecord.r_appendages_eyelashes_dystrichiasis == "No" %>
                      Dystrichiasis,
                    <% end %>
                  <% end %>
                <% end %>
                <% if r_lacrimar_counter > 0 %>
                  <% if opdrecord.r_appendages_tests.include?"lacrimalsac" %>
                    <b>Lacrimal sac:</b>
                    <% unless opdrecord.r_appendages_lacrimalsac_swelling == "No" %>
                      Swelling,
                    <% end %>
                    <% unless opdrecord.r_appendages_lacrimalsac_regurgitation == "No" %>
                      Roplas-positive,
                    <% end %>
                  <% end %>
                <% end %>
                <% if r_syringing_counter > 0 %>
                  <% if opdrecord.r_appendages_tests.include?"syringing" %>
                    <b>Syringing:</b>
                    <% unless opdrecord.r_appendages_syringing == "Patent" %>
                      Blocked
                    <% else %>
                      Patent
                    <% end %>
                  <% end %>
                <% end %>
                <% if mail_job == false %>
                    <% unless params[:action] == "print_opd_record" %>
                      <div class="row">
                        <% if opdrecord['r_appendages_diagram_present'] == "Y" %>
                          <div class="col-md-4 col-md-4">
                            <% appendages_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.r_appendages_temp_asset_id).try(:asset_path) %>
                            <% eyeside = 'r' %>
                            <% temp_asset_id = opdrecord.id %>
                            <% diagram_type = 'appendages' %>
                            <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %><%= image_tag appendages_image_url_thumb.to_s, height: '90', width: '90' %><% end %>
                            <div>
                              Appendages
                            </div>
                          </div>
                        <% end %>
                      </div>
                    <% end %>
                  <% end %>
                  <% if r_appendages_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= r_appendages_comments_op.html_safe %> </span></div> <% end %>
              </span>
              <div class="examination_non_tabular"></div>
            <% elsif opdrecord.r_local_examination_normal == "normal" %>
              <b>Appendages: </b>Normal
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if r_conjunctiva_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Conjunctiva: </b><% unless r_conjunctiva_op ==[] %><%= r_conjunctiva_op %><% end %>
                <% if r_conjunctiva_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= r_conjunctiva_comments_op.html_safe %> </span> </div>
                <% end %>
              </span>
              <div class="examination_non_tabular"></div>
            <% elsif opdrecord.r_local_examination_normal == "normal" %>
              <b>Conjunctiva: </b>Normal
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if r_cornea_counter > 0 || r_corneaslit_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Cornea: </b><% unless r_cornea_op ==[] %><%= r_cornea_op %><% end %>
                <% if mail_job == false %>
                  <% unless params[:action] == "print_opd_record" %>
                    <div class="row">
                      <% if opdrecord['r_cornea_diagram_present'] == "Y" %>
                        <div class="col-md-4 col-sm-4">
                          <% cornea_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.r_cornea_temp_asset_id).try(:asset_path) %>
                          <% eyeside = 'r' %>
                          <% temp_asset_id = opdrecord.id %>
                          <% diagram_type = 'cornea' %>
                          <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                            <%= image_tag cornea_image_url_thumb.to_s, height: '90', width: '90' %>
                            <% end %>
                          <div>
                            Cornea
                          </div>
                        </div>
                      <% end %>
                      <% if opdrecord['r_corneaslit_diagram_present'] == "Y" %>
                        <div class="col-md-4 col-sm-4">
                          <% cornea_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.r_corneaslit_temp_asset_id).try(:asset_path) %>
                          <% diagram_type = 'corneaslit' %>
                          <% eyeside = 'r' %>
                          <% temp_asset_id = opdrecord.id %>
                          <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                            <%= image_tag cornea_image_url_thumb.to_s, height: '90', width: '90' %>
                          <% end %>
                          <div>
                            Cornea Slit
                          </div>
                        </div>
                      <% end %>
                    </div>
                  <% end %>
                <% end %>
                <% if r_cornea_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= r_cornea_comments_op.html_safe %> </span> </div>
                <% end %>
              </span>
              <div class="examination_non_tabular"></div>
            <% elsif opdrecord.r_local_examination_normal == "normal" %>
              <b>Cornea: </b>Size/Shape/Surface Normal
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if r_anteriorchamber_counter > 0 %>
              <span class="abnormal-highlight">
                <p class="examination_non_tabular"><b>Anterior Chamber: </b><%= r_anteriorchamber_op %> <% if r_anteriorchamber_comments_op.present? %><br> <span style="display: list-item;margin-left: 4%"><%= r_anteriorchamber_comments_op.html_safe %> </span> <% end %></p>
              </span>
            <% elsif opdrecord.r_local_examination_normal == "normal" %>
                <b>Anterior Chamber: </b>Normal depth, No cells/flare
                <div class="examination_non_tabular"></div>
            <% end %>

            <% if r_pupil_counter > 0 %>
              <span class="abnormal-highlight">
                <p class="examination_non_tabular"><b>Pupil: </b><%= r_pupil_op %> <% if r_pupil_comments_op.present? %><br> <span style="display: list-item;margin-left: 4%"><%= r_pupil_comments_op.html_safe %> </span> <% end %></p>
              </span>
            <% elsif opdrecord.r_local_examination_normal == "normal" %>
                <b>Pupil: </b>Round shape, Normal direct & Consensual reflex
                <div class="examination_non_tabular"></div>
            <% end %>

            <% if r_iris_counter > 0 %>
              <span class="abnormal-highlight">
                <p class="examination_non_tabular"><b>Iris:</b> <%= r_iris_op %> <% if r_iris_comments_op.present? %> <br><span style="display: list-item;margin-left: 4%"><%= r_iris_comments_op.html_safe %> </span> <% end %></p>
              </span>
            <% elsif opdrecord.r_local_examination_normal == "normal" %>
                <b>Iris: </b>Within normal Limits
                <div class="examination_non_tabular"></div>
            <% end %>

            <% if r_lens_counter > 0 %>
              <span class="abnormal-highlight">
                <p class=""><b>Lens: </b><%= r_lens_op %> <% if r_lens_comments_op.present? %><br> <span style="display: list-item;margin-left: 4%"><%= r_lens_comments_op.html_safe %><% end %> </span> </p>
              </span>
              <% if mail_job == false %>
                <% unless params[:action] == "print_opd_record" %>
                  <div class="row abnormal-highlight">
                    <% if opdrecord['r_lens_diagram_present'] == "Y" %>
                      <% r_lens_diagram_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.r_lens_temp_asset_id).try(:asset_path) %>
                          <% diagram_type = 'corneaslit' %>
                      <div class="col-md-3 col-sm-3" data-toggle='opdrecord_diagram' title="Click for Enlarge View" data-placement="bottom">
                        <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: opdrecord.id, eyeside: 'r', diagram_type: 'lens'), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                          <%= image_tag r_lens_diagram_thumb.to_s, height: '90', width: '90', style: 'border: 1px solid #000;' %>
                        <% end %>
                        <div>
                          Lens
                        </div>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
              <div class="examination_non_tabular"></div>
            <% elsif opdrecord.r_local_examination_normal == "normal" %>
              <b>Lens: </b>Clear, Crystalline, Central
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if r_extraocularmovements_counter > 0 %>
              <span class="abnormal-highlight">
                <p class="examination_non_tabular"><b>Extra Ocular Movements: </b><%= r_extraocularmovements_op %> <% if r_extraocularmovements_comments_op.present? %><br> <span style="display: list-item;margin-left: 4%"><%= r_extraocularmovements_comments_op.html_safe %> </span> <% end %></p>
              </span>
            <% elsif opdrecord.r_local_examination_normal == "normal" %>
              <b>Extra Ocular Movements: </b>Uniocular and Binocular movements full and normal
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if r_objectivecomments_counter > 0 %>
              <p class="examination_non_tabular"><span style="display: list-item;margin-left: 4%"><%= r_objectivecomments_comments_op %> </span></p>
            <% end %>

            <% if opdrecord.read_attribute(:r_gonioscopy) == "Abnormal" %>
              <% if opdrecord.read_attribute(:r_gonioscopy_eye_superior_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_superior_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_superior_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_comment) != "" || opdrecord.read_attribute(:r_gonioscopy_comment) != nil %>
                <span class="abnormal-highlight">
                  <b>Gonioscopy: </b>
                </span>
              <% end %>
              <% if opdrecord.read_attribute(:r_gonioscopy_eye_superior_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_superior_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_superior_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d3) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d1) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d2) != "" || opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d3) != "" %>
                <span class="abnormal-highlight">
                  <div class="row">
                    <div class="col-md-12 col-sm-12 text-center" style="margin-bottom:10px;">
                      <span><b>Superior:</b></span>
                      <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_superior_d1) != "" %>Grade <%= opdrecord.read_attribute(:r_gonioscopy_eye_superior_d1) %>,<% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_superior_d2) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_superior_d2) %>, <% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_superior_d3) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_superior_d3) %><% else %>-<% end %></span>
                    </div>
                    <div class="col-md-4 col-sm-4" style="margin-top:5%;">
                      <b>Temporal:</b><br>
                      <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d1) != "" %>Grade <%= opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d1) %>,<% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d2) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d2) %>, <% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d3) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_temporal_d3) %><% else %>-<% end %></span>
                    </div>
                    <div class="col-md-4 col-sm-4 text-center" style="margin-top: 20px">
                      <svg width="120" height="60" style="    margin-left: -2px;">
                        <line x1="0" y1="0" x2="60" y2="40" style="stroke:#636e7b;stroke-width:2" />
                        <line x1="0" y1="40" x2="60" y2="0" style="stroke:#636e7b;stroke-width:2" />
                        Sorry, your browser does not support inline SVG.
                      </svg>
                    </div>
                    <div class="col-md-4 col-sm-4" style="margin-top:5%;">
                      <b>Nasal:</b><br>
                      <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d1) != "" %>Grade <%= opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d1) %>,<% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d2) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d2) %>, <% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d3) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_nasal_d3) %><% else %>-<% end %></span>
                    </div>
                    <div class="col-md-12 col-sm-12 text-center mb10">
                      <div class="col-md-12 col-sm-12 text-center" style="margin-top:5px;">
                        <span><b>Inferior:</b></span>
                        <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d1) != "" %>Grade <%= opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d1) %>,<% else %>-<% end %></span>
                        <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d2) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d2) %>, <% else %>-<% end %></span>
                        <span><% if opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d3) != "" %><%= opdrecord.read_attribute(:r_gonioscopy_eye_inferior_d3) %><% else %>-<% end %></span>
                      </div>
                    </div>
                  </div>
                </span>
              <% end %>
              <% if opdrecord.read_attribute(:r_gonioscopy_comment) != "" || opdrecord.read_attribute(:r_gonioscopy_comment) != nil %>
                <span class="abnormal-highlight">
                  <div class="row">
                    <div class="col-md-12 col-sm-12">
                      <p class="examination_non_tabular"><span style="display: list-item;margin-left: 4%"><%= opdrecord.read_attribute(:r_gonioscopy_comment).html_safe %></span> </p>
                    </div>
                  </div>
                </span>
              <% end %>
            <% end %>

            <% if r_fundus_counter > 0 %>
              <span>
                <% r_fundus_opd = '' %>
                <% fundus_values = '' %>
                <% count = 0 %>
                <div class="fundus_title"><b>Fundus: </b></div>
                <% unless opdrecord.r_fundus_media_select == "" %>
                  <% if r_fundus_media_select == "Media-Clear" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundus_media_select}</span>" %>
                  <% else %>
                  <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_media_select} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.r_fundus_cup_disc_ratio_select == "" %>
                  <% if r_fundus_cup_disc_ratio_select == "CupRatio-0.3" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundus_cup_disc_ratio_select}</span>" %>
                  <% else %>
                  <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_cup_disc_ratio_select} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.r_fundus_pvd_select == "" %>
                  <% if r_fundus_pvd_select == "PVD-Absent" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundus_pvd_select}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_pvd_select} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.r_fundus_optdiscsize_select == "" %>
                  <% if r_fundus_optdiscsize_select == "OptDiscSize-Medium" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundus_optdiscsize_select}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_optdiscsize_select} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.r_fundus_opticdisc_comment == "" %>
                  <% if r_fundus_opticdisc_comment == "OpticDisc-healthy" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundus_opticdisc_comment}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_opticdisc_comment} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if r_fundus_bloodvessel.present? %>
                  <% if r_fundus_bloodvessel == "Bloodvessel-normal" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundus_bloodvessel}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_bloodvessel} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if r_fundus_macula.present? %>
                  <% if r_fundus_macula == "Macula-Foveal Reflex" || r_fundus_macula == "Macula-foveal reflex present" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% if (r_fundus_macula == "Macula-Foveal Reflex" || r_fundus_macula == "Macula-foveal reflex present") && (r_fundus_macula_fovealreflex == 'Foveal Reflex- Present') %>
                      <% fundus_values = "<span>#{r_fundus_macula} </span>" %>
                    <% else %>
                      <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_macula} </span>" %>
                    <% end %>
                  <% else %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_macula} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if r_fundus_macula_fovealreflex.present? %>
                  <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                  <% count += 1 %>
                  <% if (r_fundus_macula == "Macula-Foveal Reflex" || r_fundus_macula == "Macula-foveal reflex present") && (r_fundus_macula_fovealreflex == 'Foveal Reflex- Present') %>
                    <% fundus_values = "<span>#{r_fundus_macula_fovealreflex} </span>" %>
                  <% else %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_macula_fovealreflex} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if r_fundus_vitreous.present? %>
                  <% if r_fundus_vitreous == "" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundus_vitreous}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_vitreous} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if r_fundus_retinal_detachment.present? %>
                  <% if r_fundus_retinal_detachment == "" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundus_retinal_detachment}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_retinal_detachment} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if r_fundus_peripheral_lesions.present? %>
                  <% if r_fundus_peripheral_lesions == "" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundus_peripheral_lesions}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundus_peripheral_lesions} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.r_fundustext_comment == "" %>
                  <% if r_fundustext_comment == "Fundus-within normal limits" %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{r_fundustext_comment}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% r_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{r_fundustext_comment} </span>" %>
                  <% end %>
                  <% r_fundus_opd = r_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <%= r_fundus_opd %>
                <% if mail_job == false %>
                  <% unless params[:action] == "print_opd_record" %>
                    <div class="row">
                      <% if opdrecord['r_fundus_diagram_present'] == "Y" %>
                        <div class="col-md-2 col-sm-2">
                          <% fundus_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.r_fundus_temp_asset_id).try(:asset_path) %>
                          <% eyeside = 'r' %>
                          <% temp_asset_id = opdrecord.id %>
                          <% diagram_type = 'fundus' %>
                          <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                            <%= image_tag fundus_image_url_thumb.to_s, height: '90', width: '90' %>
                          <% end %>
                          <div>
                            Fundus
                          </div>
                        </div>
                      <% end %>
                    </div>
                  <% end %>
                <% end %>
                <% if r_fundus_comments_op.present? %><div> <span class="abnormal-highlight" style="display: list-item;margin-left: 4%"><%= r_fundus_comments_op.html_safe %> </span> </div><% end %>
                </span>
                <div class="examination_non_tabular"></div>
              <% end %>
          </div>
          <div class="col-md-6 col-sm-6">
            <% if l_orthoptics_template_counter > 0 %>
              <% if l_hirschberg_test.present? %>
                <b>Hirschberg Test:</b> <%= l_hirschberg_test %>
                <br>
              <% end %>

              <% if l_cover_test.present? %>
                <b>Cover Test :</b> <%= l_cover_test %>
                <br>
              <% end %>

              <% if l_alternate_cover_test.present? %>
                <b>Alternate Cover Test :</b> <%= l_alternate_cover_test %>
                <br>
              <% end %>

              <% if l_patterns.present? %>
                <b>Patterns:</b> <%= l_patterns %>
                <br>
              <% end %>

              <% if  l_prism_bar_cover_test.present? %>
                <b>Prism bar cover test:</b>
                  <% if opdrecord.read_attribute(:l_prism_bar_cover_test_select).present? %>
                    <%= "#{opdrecord.read_attribute(:l_prism_bar_cover_test_select)} -  " %>
                  <% end %>
                  <%= l_prism_bar_cover_test %>
                <br>
              <% end %>

              <% if l_prism_bar_reflex_test.present? %>
                <b>Prism bar reflex test:</b>
                  <% if opdrecord.read_attribute(:l_prism_bar_reflex_test_select).present? %>
                    <%= "#{opdrecord.read_attribute(:l_prism_bar_reflex_test_select)} -  " %>
                  <% end %>
                  <%= l_prism_bar_reflex_test %>
                <br>
              <% end %>

              <% if l_ocular_diagram_counter > 0 %>
                <div class="row col-md-12 col-sm-12 common_margin" style="margin-bottom: 10px">
                  <b>Ocular Movements :</b>
                  <div class="text-center" style="margin-top: 10px;">
                    <div class="col-md-12 col-sm-12">
                      <div class="col-md-1 col-sm-1"></div>
                      <div class="col-md-1 col-sm-1"> <%= l_ocular_movement1 %></div>
                      <div class="col-md-7 col-sm-7"></div>
                      <div class="col-md-1 col-sm-1"> <%= l_ocular_movement2 %></div>
                    </div>
                    <div class="col-md-12 col-sm-12">
                      <div class="col-md-1 col-sm-1"></div>
                      <div class="col-md-1 col-sm-1" style="margin-top: 18px;"><%= l_ocular_movement3 %></div>
                      <div class="col-md-7 col-sm-7">
                        <svg width="120" height="60" style="    margin-left: -2px;">
                          <line x1="0" y1="0" x2="120" y2="60" style="stroke:#636e7b;stroke-width:2" />
                          <line x1="0" y1="60" x2="120" y2="0" style="stroke:#636e7b;stroke-width:2" />
                          <line x1="0" y1="30" x2="120" y2="30" style="stroke:#636e7b;stroke-width:2" />
                          Sorry, your browser does not support inline SVG.
                        </svg>
                      </div>
                      <div class="col-md-1 col-sm-1" style="margin-top: 18px;"><%= l_ocular_movement4 %></div>
                    </div>
                    <div class="col-md-12 col-sm-12" style="margin-top: -8px;">
                      <div class="col-md-1 col-sm-1"></div>
                      <div class="col-md-1 col-sm-1"><%= l_ocular_movement5 %></div>
                      <div class="col-md-7 col-sm-7"></div>
                      <div class="col-md-1 col-sm-1"><%= l_ocular_movement6 %></div>
                    </div>
                  </div>
                </div>
              <% end %>

              <% if l_nystagmus.present? %>
                <b>Nystagmus :</b> <%= l_nystagmus %>
                <br>
              <% end %>

              <% if l_maddox_test.present? %>
                <b>Maddox Test :</b> <%= l_maddox_test %>
                <br>
              <% end %>

              <% if l_worth_four_dot_test.present? %>
                <b>Worth four dot test :</b> <%= l_worth_four_dot_test %>
                <br>
              <% end %>

              <% if l_stereopsis.present? %>
                <b>Stereopsis :</b> <%= l_stereopsis %>
                <br>
              <% end %>

              <% if l_hess_screen_test.present? %>
                <b>Hess Screen test :</b> <%= l_hess_screen_test %>
                <br>
              <% end %>
            <% end %>

            <% if @current_facility.country_id != "VN_254" %>
              <% if l_visualacuity_counter > 0 %>
                <strong>VA:</strong> <%= l_visualacuity_op %>
                <% if l_visualacuity_ua_s.present? || l_visualacuity_ua_i.present? || l_visualacuity_ua_n.present? || l_visualacuity_ua_t.present? %>
                  PR(UCVA): <%= l_visualacuity_ua_s %> <%= l_visualacuity_ua_i %> <%= l_visualacuity_ua_n %> <%= l_visualacuity_ua_t %>
                <% end %>
                <br>
              <% end %>
              <% if l_intraocularpressure_counter > 0 %>
                <% if l_intraocularpressure_op.to_i >= 0  && l_intraocularpressure_op.to_i < 19 %>
                  <strong>IOP:</strong>
                  <%= l_intraocularpressure_op %>
                <% elsif l_intraocularpressure_op.to_i >= 19 %>
                  <span class="abnormal-highlight">
                    <strong>IOP:</strong>
                    <%= l_intraocularpressure_op %>
                  </span>
                <% end %>
                <% if l_intraocularpressure_comments.present? %>
                  <ul><li><%= l_intraocularpressure_comments %></li></ul>
                <% end %>
                <br/>
              <% end %>
            <% else %>
              <% if l_intraocularpressure_counter > 0 %>
                <% if l_intraocularpressure_op.to_i >= 0  && l_intraocularpressure_op.to_i < 19 %>
                  <strong>IOP:</strong>
                  <%= l_intraocularpressure_op %>
                <% elsif l_intraocularpressure_op.to_i >= 19 %>
                  <span class="abnormal-highlight">
                    <strong>IOP:</strong>
                    <%= l_intraocularpressure_op %>
                  </span>
                <% end %>
                <% if l_intraocularpressure_comments.present? %>
                  <ul><li><%= l_intraocularpressure_comments %></li></ul>
                <% end %>
              <% end %>
            <% end %>

            <% if l_appearance_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Appearance:</b><% unless l_appearance_op ==[] %> <%= l_appearance_op %><% end %>
                <% if l_appearance_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= l_appearance_comments_op.html_safe %> </span> </div>
                <% end %>
              </span>
              <div class="examination_non_tabular"></div>
            <% elsif opdrecord.l_local_examination_normal == "normal" %>
                <b>Appearance: </b>Normal
                <div class="examination_non_tabular"></div>
            <% end %>

            <% if l_scleracommon_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Sclera:</b>
                <% if l_scleracommon_comments.present? %><div><span style="display: list-item;margin-left: 4%"><%= l_scleracommon_comments.html_safe %> </span> </div>
                <% end %>
              </span>
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if l_appendages_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Appendages: </b>
                <% if l_eyelid_counter > 0 %>
                  <% if opdrecord.l_appendages_tests.include?"eyelids" %>
                    <b>Eyelids:</b>
                    <% unless opdrecord.l_appendages_eyelids_chalazion == "No" %>
                      Chalazion,
                    <% end %>
                    <% unless opdrecord.l_appendages_eyelids_ptosis == "No" %>
                      Ptosis,
                    <% end %>
                    <% unless opdrecord.l_appendages_eyelids_swelling == "No" %>
                      Swelling,
                    <% end %>
                    <% unless opdrecord.l_appendages_eyelids_entropion == "No" %>
                      Entropion,
                    <% end %>
                    <% unless opdrecord.l_appendages_eyelids_ectropion == "No" %>
                      Ectropion,
                    <% end %>
                    <% unless opdrecord.l_appendages_eyelids_mass== "No" %>
                      Eyelids mass,
                    <% end %>
                    <% unless opdrecord.l_appendages_eyelids_meibomitis == "No" %>
                      Meibomitis,
                    <% end %>
                  <% end %>
                <% end %>
                <% if l_eyelsahes_counter > 0 %>
                  <% if opdrecord.l_appendages_tests.include?"eyelashes" %>
                    <b>Eyelashes:</b>
                    <% unless opdrecord.l_appendages_eyelashes_trichiasis == "No" %>
                      Trichiasis,
                    <% end %>
                    <% unless opdrecord.l_appendages_eyelashes_dystrichiasis == "No" %>
                      Dystrichiasis,
                    <% end %>
                  <% end %>
                <% end %>
                <% if l_lacrimal_counter> 0 %>
                  <% if opdrecord.l_appendages_tests.include?"lacrimalsac" %>
                    <b>Lacrimal sac:</b>
                    <% unless opdrecord.l_appendages_lacrimalsac_swelling == "No" %>
                      Swelling,
                    <% end %>
                    <% unless opdrecord.l_appendages_lacrimalsac_regurgitation == "No" %>
                      Roplas-positive,
                    <% end %>
                  <% end %>
                <% end %>
                <% if l_syringing_counter > 0 %>
                  <% if opdrecord.l_appendages_tests.include?"syringing" %>
                    <b>Syringing:</b>
                    <% unless opdrecord.l_appendages_syringing == "Patent" %>
                      Blocked,
                    <% else %>
                      Patent
                    <% end %>
                  <% end %>
                <% end %>
                <% if mail_job == false %>
                  <% unless params[:action] == "print_opd_record" %>
                    <div class="row">
                      <% if opdrecord['l_appendages_diagram_present'] == "Y" %>
                        <div class="col-md-4 col-sm-4">
                          <% appendages_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.l_appendages_temp_asset_id).try(:asset_path) %>
                          <% eyeside = 'l' %>
                          <% temp_asset_id = opdrecord.id %>
                          <% diagram_type = 'appendages' %>
                          <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                            <%= image_tag appendages_image_url_thumb.to_s, height: '90', width: '90' %>
                            <% end %>
                          <div>
                            Appendages
                          </div>
                        </div>
                      <% end %>
                    </div>
                  <% end %>
                <% end %>
                <% if l_appendages_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= l_appendages_comments_op.html_safe %> </span> </div>
                <% end %>
              </span>
            <% elsif opdrecord.l_local_examination_normal == "normal" %>
              <b>Appendages: </b>Normal
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if l_conjunctiva_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Conjunctiva:</b><% unless l_conjunctiva_op ==[] %> <%= l_conjunctiva_op %><% end %>
                <% if l_conjunctiva_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= l_conjunctiva_comments_op.html_safe %> </span> </div>
                <% end %>
              </span>
              <div class="examination_non_tabular"></div>
            <% elsif opdrecord.l_local_examination_normal == "normal" %>
              <b>Conjunctiva: </b>Normal
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if l_cornea_counter > 0 || l_corneaslit_counter > 0 %>
              <span class="abnormal-highlight">
                <b>Cornea: </b><% unless l_cornea_op ==[] %><%= l_cornea_op %><% end %>
                <% if mail_job == false %>
                  <% unless params[:action] == "print_opd_record" %>
                    <div class="row">
                      <% if opdrecord['l_cornea_diagram_present'] == "Y" %>
                        <div class="col-md-4 col-sm-4">
                          <% cornea_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.l_cornea_temp_asset_id).try(:asset_path) %>
                          <% eyeside = 'l' %>
                          <% temp_asset_id = opdrecord.id %>
                          <% diagram_type = 'cornea' %>
                          <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                            <%= image_tag cornea_image_url_thumb.to_s, height: '90', width: '90' %>
                          <% end %>
                          <div>
                            Cornea
                          </div>
                        </div>
                      <% end %>
                      <% if opdrecord['l_corneaslit_diagram_present'] == "Y" %>
                        <div class="col-md-4 col-sm-4">
                          <% cornea_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.l_corneaslit_temp_asset_id).try(:asset_path) %>
                          <% diagram_type = 'corneaslit' %>
                          <% eyeside = 'l' %>
                          <% temp_asset_id = opdrecord.id %>
                          <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                            <%= image_tag cornea_image_url_thumb.to_s, height: '90', width: '90' %>
                          <% end %>
                          <div>
                            Cornea Slit
                          </div>
                        </div>
                      <% end %>
                    </div>
                  <% end %>
                <% end %>
                <% if l_cornea_comments_op.present? %><div><span style="display: list-item;margin-left: 4%"><%= l_cornea_comments_op.html_safe %> </span> </div>
                <% end %>
              </span>
              <div class="examination_non_tabular"></div>
            <% elsif opdrecord.l_local_examination_normal == "normal" %>
              <b>Cornea: </b>Size/Shape/Surface Normal
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if l_anteriorchamber_counter > 0 %>
              <span class="abnormal-highlight">
                <p class="examination_non_tabular"><b>Anterior Chamber:</b> <%= l_anteriorchamber_op %><% if l_anteriorchamber_comments_op.present? %><br> <span style="display: list-item;margin-left: 4%"><%= l_anteriorchamber_comments_op.html_safe %> </span> <% end %></p>
              </span>
            <% elsif opdrecord.l_local_examination_normal == "normal" %>
                <b>Anterior Chamber: </b>Normal depth, No cells/flare
                <div class="examination_non_tabular"></div>
            <% end %>

            <% if l_pupil_counter > 0 %>
              <span class="abnormal-highlight">
                <p class="examination_non_tabular"><b>Pupil:</b> <%= l_pupil_op %> <% if l_pupil_comments_op.present? %> <br><span style="display: list-item;margin-left: 4%"><%= l_pupil_comments_op.html_safe %> </span>  <% end %></p>
              </span>
            <% elsif opdrecord.l_local_examination_normal == "normal" %>
                <b>Pupil: </b>Round shape, Normal direct & Consensual reflex
                <div class="examination_non_tabular"></div>
            <% end %>

            <% if l_iris_counter > 0 %>
              <span class="abnormal-highlight">
                <p class="examination_non_tabular"><b>Iris:</b> <%= l_iris_op %> <% if l_iris_comments_op.present? %> <br><span style="display: list-item;margin-left: 4%"><%= l_iris_comments_op.html_safe %> </span>  <% end %></p>
              </span>
            <% elsif opdrecord.l_local_examination_normal == "normal" %>
                <b>Iris: </b>Within normal Limits
                <div class="examination_non_tabular"></div>
            <% end %>

            <% if l_lens_counter > 0 %>
              <span class="abnormal-highlight">
                <p class=""><b>Lens:</b> <%= l_lens_op %> <% if l_lens_comments_op.present? %> <br><span style="display: list-item;margin-left: 4%"><%= l_lens_comments_op.html_safe %> </span>  <% end %></p>
              </span>
              <% if mail_job == false %>
                <% unless params[:action] == "print_opd_record" %>
                  <div class="row abnormal-highlight">
                    <% if opdrecord['l_lens_diagram_present'] == "Y" %>
                      <% l_lens_diagram_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.l_lens_temp_asset_id).try(:asset_path) %>
                      <div class="col-md-3 col-sm-3" data-toggle='opdrecord_diagram' title="Click for Enlarge View" data-placement="bottom">
                        <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: opdrecord.id, eyeside: 'l', diagram_type: 'lens'), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                          <%= image_tag l_lens_diagram_thumb.to_s, height: '90', width: '90', style: 'border: 1px solid #000;' %>
                        <% end %>
                        <div>
                          Lens
                        </div>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
              <div class="examination_non_tabular"></div>
            <% elsif opdrecord.l_local_examination_normal == "normal" %>
              <b>Lens: </b>Clear, Crystalline, Central
              <div class="examination_non_tabular"></div>
            <% end %>

            <% if l_extraocularmovements_counter > 0 %>
              <span class="abnormal-highlight">
                <p class="examination_non_tabular"><b>Extra Ocular Movements:</b> <%= l_extraocularmovements_op %> <% if l_extraocularmovements_comments_op.present? %> <br><span style="display: list-item;margin-left: 4%"><%= l_extraocularmovements_comments_op.html_safe %> </span> <% end %></p>
              </span>
            <% elsif opdrecord.l_local_examination_normal == "normal" %>
              <b>Extra Ocular Movements: </b>Uniocular and Binocular movements full and normal
              <div class="examination_non_tabular"></div>
            <% end %>
            <% if l_objectivecomments_counter > 0 %>
              <p class="examination_non_tabular"><span style="display: list-item;margin-left: 4%"><%= l_objectivecomments_comments_op %></span></p>
            <% end %>

            <% if opdrecord.read_attribute(:l_gonioscopy) == "Abnormal" %>
              <% if opdrecord.read_attribute(:l_gonioscopy_eye_superior_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_superior_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_superior_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_comment) != "" || opdrecord.read_attribute(:l_gonioscopy_comment) != nil %>
                <span class="abnormal-highlight">
                  <b>Gonioscopy: </b>
                </span>
              <% end %>
              <% if opdrecord.read_attribute(:l_gonioscopy_eye_superior_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_superior_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_superior_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d3) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d1) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d2) != "" || opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d3) != "" %>
                <span class="abnormal-highlight">
                  <div class="row">
                    <div class="col-md-12 col-sm-12 text-center" style="margin-bottom:10px;">
                      <span><b>Superior:</b></span>
                      <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_superior_d1) != "" %>Grade <%= opdrecord.read_attribute(:l_gonioscopy_eye_superior_d1) %>, <% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_superior_d2) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_superior_d2) %>, <% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_superior_d3) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_superior_d3) %><% else %>-<% end %></span>
                    </div>
                    <div class="col-md-4 col-sm-4" style="margin-top:5%;">
                      <b>Nasal:</b><br>
                      <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d1) != "" %>Grade <%= opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d1) %>, <% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d2) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d2) %>, <% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d3) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_nasal_d3) %><% else %>-<% end %></span>
                    </div>
                    <div class="col-md-4 col-sm-4 text-center" style="margin-top: 20px">
                      <svg width="120" height="60" style="    margin-left: -2px;">
                        <line x1="0" y1="0" x2="60" y2="40" style="stroke:#636e7b;stroke-width:2" />
                        <line x1="0" y1="40" x2="60" y2="0" style="stroke:#636e7b;stroke-width:2" />
                        Sorry, your browser does not support inline SVG.
                      </svg>
                    </div>
                    <div class="col-md-4 col-sm-4" style="margin-top:5%;">
                      <b>Temporal:</b><br>
                      <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d1) != "" %>Grade <%= opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d1) %>, <% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d2) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d2) %>, <% else %>-<% end %></span>
                      <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d3) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_temporal_d3) %><% else %>-<% end %></span>
                    </div>
                    <div class="col-md-12 col-sm-12 text-center mb10">
                      <div class="col-md-12 col-sm-12 text-center" style="margin-top:5px;">
                        <span><b>Inferior:</b></span>
                        <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d1) != "" %>Grade <%= opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d1) %>, <% else %>-<% end %></span>
                        <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d2) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d2) %>, <% else %>-<% end %></span>
                          <span><% if opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d3) != "" %><%= opdrecord.read_attribute(:l_gonioscopy_eye_inferior_d3) %><% else %>-<% end %></span>
                      </div>
                    </div>
                  </div>
                </span>
              <% end %>
              <% if opdrecord.read_attribute(:l_gonioscopy_comment) != "" || opdrecord.read_attribute(:l_gonioscopy_comment) != nil %>
                <span class="abnormal-highlight">
                  <div class="row">
                    <div class="col-md-12 col-sm-12">
                      <p class="examination_non_tabular"><span style="display: list-item;margin-left: 4%"><%= opdrecord.read_attribute(:l_gonioscopy_comment).html_safe %></span> </p>
                    </div>
                  </div>
                </span>
              <% end %>
            <% end %>
            <% if l_fundus_counter > 0 %>
              <span>
                <% l_fundus_opd = '' %>
                <% fundus_values = '' %>
                <% count = 0 %>
                <div class="fundus_title"><b>Fundus: </b></div>
                <% unless opdrecord.l_fundus_media_select == "" %>
                  <% if l_fundus_media_select == "Media-Clear" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{l_fundus_media_select}</span>" %>
                  <% else %>
                  <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_media_select} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.l_fundus_pvd_select == "" %>
                  <% if l_fundus_pvd_select == "PVD-Absent" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{l_fundus_pvd_select}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_pvd_select} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.l_fundus_optdiscsize_select == "" %>
                  <% if l_fundus_optdiscsize_select == "OptDiscSize-Medium" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{l_fundus_optdiscsize_select}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_optdiscsize_select} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.l_fundus_cup_disc_ratio_select == "" %>
                  <% if l_fundus_cup_disc_ratio_select == "CupRatio-0.3" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{l_fundus_cup_disc_ratio_select}</span>" %>
                  <% else %>
                  <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_cup_disc_ratio_select} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.l_fundus_opticdisc_comment == "" %>
                  <% if l_fundus_opticdisc_comment == "OpticDisc-healthy" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{l_fundus_opticdisc_comment}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_opticdisc_comment} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if l_fundus_bloodvessel.present? %>
                  <% if l_fundus_bloodvessel == "Bloodvessel-normal" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                      <% fundus_values = "<span> #{l_fundus_bloodvessel}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                      <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_bloodvessel} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if l_fundus_macula.present? %>
                  <% if l_fundus_macula == "Macula-Foveal Reflex" || l_fundus_macula == "Macula-foveal reflex present" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                      <%  if l_fundus_macula_fovealreflex.present? && l_fundus_macula_fovealreflex == 'Foveal Reflex- Present' %>  
                        <% fundus_values = "<span> #{l_fundus_macula}</span>" %>
                      <% else %>
                        <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_macula} </span>" %>
                      <% end %>
                  <% else %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                      <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_macula} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if l_fundus_macula_fovealreflex.present? %>
                  <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                  <% count += 1 %>
                  <% if (l_fundus_macula == "Macula-Foveal Reflex" || l_fundus_macula == "Macula-foveal reflex present") && (l_fundus_macula_fovealreflex == 'Foveal Reflex- Present') %>
                    <% fundus_values = "<span>#{l_fundus_macula_fovealreflex} </span>" %>
                  <% else %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_macula_fovealreflex} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if l_fundus_vitreous.present? %>
                  <% if l_fundus_vitreous == "" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                      <% fundus_values = "<span> #{l_fundus_vitreous}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                      <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_vitreous} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if l_fundus_retinal_detachment.present? %>
                  <% if l_fundus_retinal_detachment == "" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                      <% fundus_values = "<span> #{l_fundus_retinal_detachment}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                      <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_retinal_detachment} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% if l_fundus_peripheral_lesions.present? %>
                  <% if l_fundus_peripheral_lesions == "" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                      <% count += 1 %>
                      <% fundus_values = "<span> #{l_fundus_peripheral_lesions}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{l_fundus_peripheral_lesions} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <% unless opdrecord.l_fundustext_comment == "" %>
                  <% if l_fundustext_comment == "Fundus-within normal limits" %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span> #{l_fundustext_comment}</span>" %>
                  <% else %>
                    <% if count != 0 %> <% l_fundus_opd += ', ' %> <% end %>
                    <% count += 1 %>
                    <% fundus_values = "<span class='abnormal-highlight'>#{l_fundustext_comment} </span>" %>
                  <% end %>
                  <% l_fundus_opd = l_fundus_opd.html_safe + fundus_values.html_safe %>
                <% end %>
                <%= l_fundus_opd %>
                <% if mail_job == false %>
                  <% unless params[:action] == "print_opd_record" %>
                    <div class="row">
                      <% if opdrecord['l_fundus_diagram_present'] == "Y" %>
                        <div class="col-md-2 col-sm-2">
                          <% fundus_image_url_thumb = PatientSummaryAssetUpload.find_by(id: opdrecord.l_fundus_temp_asset_id).try(:asset_path) %>
                          <% eyeside = 'l' %>
                          <% temp_asset_id = opdrecord.id %>
                          <% diagram_type = 'fundus' %>
                          <%= link_to opd_records_view_opd_diagram_path(temp_asset_id: temp_asset_id, eyeside: eyeside, diagram_type: diagram_type), data: { :remote => true, 'toggle' => 'modal', 'target' => '#cornea-view-modal' } do %>
                            <%= image_tag fundus_image_url_thumb.to_s, height: '90', width: '90' %>
                          <% end %>
                          <div>
                            Fundus
                          </div>
                        </div>
                      <% end %>
                    </div>
                  <% end %>
                <% end %>
                <% if l_fundus_comments_op.present? %><div> <span class="abnormal-highlight" style="display: list-item;margin-left: 4%"><%= l_fundus_comments_op.html_safe %> </span> </div><% end %>
              </span>
              <div class="examination_non_tabular"></div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if opdrecord.send("#{@flag}_diagram_flag") == "1" %>
    <% diagram_counter = 0 %>
    <% r_lens_diagram = '' %>
    <% r_lens_counter = 0 %>
    <% r_fundus_diagram = '' %>
    <% r_fundus_counter = 0 %>
    <% r_appendages_diagram = '' %>
    <% r_appendages_count = 0 %>
    <% r_cornea_diagram = '' %>
    <% r_cornea_img_counter = 0 %>
    <% r_cornea_slit_diagram = '' %>
    <% r_cornea_slit_img_counter = 0 %>
    <% l_fundus_diagram = '' %>
    <% l_fundus_counter = 0 %>
    <% l_lens_diagram = '' %>
    <% l_lens_counter = 0 %>
    <% l_appendages_diagram = '' %>
    <% l_appendages_count = 0 %>
    <% l_cornea_diagram = '' %>
    <% l_cornea_img_counter = 0 %>
    <% l_cornea_slit_diagram = '' %>
    <% l_cornea_slit_img_counter = 0 %>
    <% if opdrecord.l_corneaslit_diagram_full.present? %>
      <%# l_cornea_slit_diagram = opdrecord.l_corneaslit_diagram_full %>
      <% l_cornea_slit_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.l_corneaslit_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% l_cornea_slit_img_counter += 1 %>
    <% end %>
    <% if opdrecord.r_corneaslit_diagram_full.present? %>
      <%# r_cornea_slit_diagram = opdrecord.r_corneaslit_diagram_full %>
      <% r_cornea_slit_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.r_corneaslit_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% r_cornea_slit_img_counter += 1 %>
    <% end %>
    <% if opdrecord.l_cornea_diagram_full.present? %>
      <%# l_cornea_diagram = opdrecord.l_cornea_diagram_full %>
      <% l_cornea_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.l_cornea_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% l_cornea_img_counter += 1 %>
    <% end %>
    <% if opdrecord.r_cornea_diagram_full.present? %>
      <%# r_cornea_diagram = opdrecord.r_cornea_diagram_full %>
      <% r_cornea_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.r_cornea_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% r_cornea_img_counter += 1 %>
    <% end %>
    <% if opdrecord.l_appendages_diagram_full.present? %>
      <%# l_appendages_diagram = opdrecord.l_appendages_diagram_full %>
      <% l_appendages_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.l_appendages_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% l_appendages_count += 1 %>
    <% end %>
    <% if opdrecord.r_appendages_diagram_full.present? %>
      <%# r_appendages_diagram = opdrecord.r_appendages_diagram_full %>
      <% r_appendages_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.r_appendages_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% r_appendages_count += 1 %>
    <% end %>
    <% if opdrecord.r_lens_diagram_full.present? %>
      <%# r_lens_diagram = opdrecord.r_lens_diagram_full %>
      <% r_lens_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.r_lens_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% r_lens_counter += 1 %>
    <% end %>
    <% if opdrecord.l_lens_diagram_full.present? %>
      <%# l_lens_diagram = opdrecord.l_lens_diagram_full %>
      <% l_lens_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.l_lens_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% l_lens_counter += 1 %>
    <% end %>
    <% if opdrecord.l_fundus_diagram_full.present? %>
      <%# l_fundus_diagram = opdrecord.l_fundus_diagram_full %>
      <% l_fundus_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.l_fundus_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% l_fundus_counter += 1 %>
    <% end %>
    <% if opdrecord.r_fundus_diagram_full.present? %>
      <%# r_fundus_diagram = opdrecord.r_fundus_diagram_full %>
      <% r_fundus_diagram = PatientSummaryAssetUpload.find_by(id: opdrecord.r_fundus_temp_asset_id).try(:asset_path) %>
      <% diagram_counter += 1 %>
      <% r_fundus_counter += 1 %>
    <% end %>
    <% if diagram_counter > 0 %>
      <div class="row mb5">
        <strong style="<%= heading_font_size %>">Diagram</strong>
        <div class="summary-line-border"></div><br>
        <div class="col-md-6 col-sm-6">
          <div class="text-center" style="background-color:#ddd;">R/OD</div>
        </div>
        <div class="col-md-6 col-sm-6">
          <div class="text-center" style="background-color:#ddd;">L/OS</div>
        </div>
      </div>
    <% end %>
    <% if r_lens_counter > 0 || l_lens_counter > 0 %>
      <p>Lens Diagram:</p>
      <% if opdrecord['r_lens_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 4%">
          <%= image_tag(r_lens_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
      <% if opdrecord['l_lens_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 22rem">
          <%= image_tag(l_lens_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
    <% end %>
    <div class="examination_non_tabular"></div><br>
    <% if r_fundus_counter > 0 || l_fundus_counter > 0 %>
      <p>Fundus Diagram:</p><br>
      <% if opdrecord['r_fundus_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 4%">
          <%= image_tag(r_fundus_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
      <% if opdrecord['l_fundus_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 22rem">
          <%= image_tag(l_fundus_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
    <% end %>
    <div class="examination_non_tabular"></div><br>
    <% if l_appendages_count > 0 || r_appendages_count > 0 %>
      <p>Appendges Diagram:</p><br>
      <% if opdrecord['r_appendages_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 4%">
          <%= image_tag(r_appendages_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
      <% if opdrecord['l_appendages_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 22rem">
          <%= image_tag(l_appendages_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
    <% end %>
    <div class="examination_non_tabular"></div><br>
    <% if l_cornea_img_counter > 0 || r_cornea_img_counter > 0 %>
      <p>Cornea Diagram:</p><br>
      <% if opdrecord['r_cornea_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 4%">
          <%= image_tag(r_cornea_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
      <% if opdrecord['l_cornea_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 22rem">
          <%= image_tag(l_cornea_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
    <% end %>
    <div class="examination_non_tabular"></div><br>
    <% if l_cornea_slit_img_counter > 0 || r_cornea_slit_img_counter > 0 %>
      <p>Cornea Slit Diagram:</p><br>
      <% if opdrecord['r_corneaslit_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 4%">
          <%= image_tag(r_cornea_slit_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
      <% if opdrecord['l_corneaslit_diagram_present'] == "Y" %>
        <span class="abnormal-highlight" style="margin-left: 22rem">
          <%= image_tag(l_cornea_slit_diagram.to_s, { style: 'width:100px;' }) %>
        </span>
      <% end %>
    <% end %>
    <div class="examination_non_tabular"></div>
  <% end %>
</div>
<style type="text/css">
  .print_text_font_size *{
    font-size: inherit!important
  }

  .examination_non_tabular {
    margin-bottom:0;
    padding-bottom:0;
    border-bottom:1px solid #ddd;
  }

  .circle {
    border-radius: 50%;
    width: 40px;
    height: 40px;
    box-sizing: border-box;
    border-width: 5px;
    border-style: solid;
    border-color: #888 #aaa #888 #aaa;
    transform: rotate(0deg);
  }

  .centralize {
    margin-top: 35%;
    font-size: 28px;
  }

  .wide {
    width: 100px;
    height: 100px;
  }
  <%# unless params[:action] == "print_opd_record" %>
  .abnormal-highlight{
    color: red;
  }
  <%#end%>

  .red {
    color: red;
  }
</style>

<script type="text/javascript">
  $('[data-toggle="opdrecord_diagram"]').tooltip();
</script>
