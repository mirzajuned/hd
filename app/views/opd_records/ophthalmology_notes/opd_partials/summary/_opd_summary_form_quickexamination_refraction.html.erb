<% if opdrecord.send("#{@flag}_refraction_flag") == "1" %>
  <div class="refraction mb5" id="refraction">
    <% refraction_counter = 0 %>
    <% diagram_counter = 0 %>
    <% general_refraction_counter = 0 %>

    <% refractioncommoncomment = '' %>

    <% r_refraction_counter = 0 %>
    <% r_refraction_op = '' %>
    <% r_refraction_distant_sph = '' %>
    <% r_refraction_distant_cyl = '' %>
    <% r_refraction_distant_axis = '' %>
    <% r_refraction_distant_vision = '' %>
    <% r_refraction_near_sph = '' %>
    <% r_refraction_near_cyl = '' %>
    <% r_refraction_near_axis = '' %>
    <% r_refraction_near_vision = '' %>
    <% r_refraction_comments_counter = 0 %>
    <% r_refraction_comments = '' %>

    <% r_autorefraction_counter = 0 %>
    <% r_autorefraction_op = '' %>
    <% r_autorefraction_dry_sph = '' %>
    <% r_autorefraction_dry_cyl = '' %>
    <% r_autorefraction_dry_axis = '' %>
    <% r_autorefraction_dry1_sph = '' %>
    <% r_autorefraction_dry1_cyl = '' %>
    <% r_autorefraction_dry1_axis = '' %>
    <% r_autorefraction_dry2_sph = '' %>
    <% r_autorefraction_dry2_cyl = '' %>
    <% r_autorefraction_dry2_axis = '' %>
    <% r_autorefraction_dilated1_sph = '' %>
    <% r_autorefraction_dilated1_cyl = '' %>
    <% r_autorefraction_dilated1_axis = '' %>
    <% r_autorefraction_dilated2_sph = '' %>
    <% r_autorefraction_dilated2_cyl = '' %>
    <% r_autorefraction_dilated2_axis = '' %>
    <% r_autorefraction_dilated3_sph = '' %>
    <% r_autorefraction_dilated3_cyl = '' %>
    <% r_autorefraction_dilated3_axis = '' %>

    <% r_dilatedretinoscopy_pmt_axis = '' %>
    <% r_dilatedretinoscopy_pmt_sph = '' %>
    <% r_dilatedretinoscopy_pmt_cyl = '' %>
    <% r_dilatedretinoscopy_pmt_vision = '' %>
    <% r_dilatedretinoscopy_pmt_axis_row2 = '' %>
    <% r_dilatedretinoscopy_pmt_sph_row2 = '' %>
    <% r_dilatedretinoscopy_pmt_cyl_row2 = '' %>
    <% r_dilatedretinoscopy_pmt_vision_row2 = '' %>
    <% r_dilatedretinoscopy_pmt_axis_row3 = '' %>
    <% r_dilatedretinoscopy_pmt_sph_row3 = '' %>
    <% r_dilatedretinoscopy_pmt_cyl_row3 = '' %>
    <% r_dilatedretinoscopy_pmt_vision_row3 = '' %>
    <% r_dilatedretinoscopy_pmt_counter = 0 %>

    <% r_dilatedretinoscopy_counter = 0 %>
    <% r_dilatedretinoscopy_top_va1 = '' %>
    <% r_dilatedretinoscopy_left_ha1 = '' %>
    <% r_dilatedretinoscopy_right_ha2 = '' %>
    <% r_dilatedretinoscopy_bottom_va2 = '' %>
    <% r_dilatedretinoscopy_va = '' %>
    <% r_dilatedretinoscopy_ha = '' %>
    <% r_dilatedretinoscopy_distance = '' %>
    <% r_retinoscopy_drug_used = '' %>
    <% r_retinoscopy_comments_counter = 0 %>
    <% r_retinoscopy_comments = '' %>

    <% r_dilatedrefraction_counter = 0 %>
    <% r_dilatedrefraction_op = '' %>
    <% r_dilatedrefraction_distant_sph = '' %>
    <% r_dilatedrefraction_distant_cyl = '' %>
    <% r_dilatedrefraction_distant_axis = '' %>
    <% r_dilatedrefraction_distant_vision = '' %>
    <% r_dilatedrefraction_near_sph = '' %>
    <% r_dilatedrefraction_near_cyl = '' %>
    <% r_dilatedrefraction_near_axis = '' %>
    <% r_dilatedrefraction_near_vision = '' %>
    <% r_dilatedrefraction_drug_used = '' %>
    <% r_dilatedrefraction_drug_used_op = '' %>
    <% r_dilatedrefraction_comments_counter = 0 %>
    <% r_dilatedrefraction_comments = '' %>

    <% r_keratometry_counter = 0 %>
    <% r_keratometry_op = '' %>
    <% r_keratometry_distant_kh = '' %>
    <% r_keratometry_distant_axis = '' %>
    <% r_keratometry_near_kv = '' %>
    <% r_keratometry_near_axis = '' %>

    <% r_amsler_counter = 0 %>

    <% r_pgp_counter = 0 %>
    <% r_pgp_op = '' %>
    <% r_pgp_distant_sph = '' %>
    <% r_pgp_distant_cyl = '' %>
    <% r_pgp_distant_axis = '' %>
    <% r_pgp_distant_vision = '' %>
    <% r_pgp_near_sph = '' %>
    <% r_pgp_near_cyl = '' %>
    <% r_pgp_near_axis = '' %>
    <% r_pgp_near_vision = '' %>
    <% r_pgp_typeoflens = '' %>
    <% r_pgp_comments_counter = 0 %>
    <% r_pgp_comments = "" %>

    <% r_pgp_counter2 = 0 %>
    <% r_pgp_op2 = '' %>
    <% r_pgp_distant_sph2 = '' %>
    <% r_pgp_distant_cyl2 = '' %>
    <% r_pgp_distant_axis2 = '' %>
    <% r_pgp_distant_vision2 = '' %>
    <% r_pgp_near_sph2 = '' %>
    <% r_pgp_near_cyl2 = '' %>
    <% r_pgp_near_axis2 = '' %>
    <% r_pgp_near_vision2 = '' %>
    <% r_pgp_typeoflens2 = '' %>
    <% r_pgp_comments_counter2 = 0 %>
    <% r_pgp_comments2 = "" %>

    <% r_pgp_counter3 = 0 %>
    <% r_pgp_op3 = '' %>
    <% r_pgp_distant_sph3 = '' %>
    <% r_pgp_distant_cyl3 = '' %>
    <% r_pgp_distant_axis3 = '' %>
    <% r_pgp_distant_vision3 = '' %>
    <% r_pgp_near_sph3 = '' %>
    <% r_pgp_near_cyl3 = '' %>
    <% r_pgp_near_axis3 = '' %>
    <% r_pgp_near_vision3 = '' %>
    <% r_pgp_typeoflens3 = '' %>
    <% r_pgp_comments_counter3 = 0 %>
    <% r_pgp_comments3 = "" %>

    <% r_color_vision_counter = 0 %>
    <% orthoptics_heading_counter = 0 %>
    <% r_orthoptics_counter = 0 %>
    <% r_contrastsensitivity_counter = 0 %>

    <% r_objectivecomments_counter = 0 %>
    <% r_objectivecomments_op = '' %>
    <% r_objectivecomments_comments_op = '' %>
    <% r_objectivecomments = '' %>

    <!-- common refraction comments -->
    <% unless opdrecord.refractioncommoncomment.blank? %>
      <% if opdrecord.refractioncommoncomment.present? %>
        <% refractioncommoncomment = "Refraction Comments: #{opdrecord.read_attribute(:refractioncommoncomment).to_s}" %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>
    <!-- common refraction comments -->

    <% if @current_facility.country_id != "VN_254" %>
      <% if opdrecord.r_autorefraction_dry_sph.present? %>
        <% r_autorefraction_dry_sph = opdrecord.read_attribute(:r_autorefraction_dry_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dry_cyl.present? %>
        <% r_autorefraction_dry_cyl = opdrecord.read_attribute(:r_autorefraction_dry_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dry_axis.present? %>
        <% r_autorefraction_dry_axis = opdrecord.read_attribute(:r_autorefraction_dry_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry_axis = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dry1_sph.present? %>
        <% r_autorefraction_dry1_sph = opdrecord.read_attribute(:r_autorefraction_dry1_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry1_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dry1_cyl.present? %>
        <% r_autorefraction_dry1_cyl = opdrecord.read_attribute(:r_autorefraction_dry1_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry1_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dry1_axis.present? %>
        <% r_autorefraction_dry1_axis = opdrecord.read_attribute(:r_autorefraction_dry1_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry1_axis = '--' %>
      <% end %>

      <% if opdrecord.r_autorefraction_dry2_sph.present? %>
        <% r_autorefraction_dry2_sph = opdrecord.read_attribute(:r_autorefraction_dry2_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry2_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dry2_cyl.present? %>
        <% r_autorefraction_dry2_cyl = opdrecord.read_attribute(:r_autorefraction_dry2_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry2_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dry2_axis.present? %>
        <% r_autorefraction_dry2_axis = opdrecord.read_attribute(:r_autorefraction_dry2_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry2_axis = '--' %>
      <% end %>

      <% if opdrecord.r_autorefraction_dilated1_sph.present? %>
        <% r_autorefraction_dilated1_sph = opdrecord.read_attribute(:r_autorefraction_dilated1_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated1_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated1_cyl.present? %>
        <% r_autorefraction_dilated1_cyl = opdrecord.read_attribute(:r_autorefraction_dilated1_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated1_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated1_axis.present? %>
        <% r_autorefraction_dilated1_axis = opdrecord.read_attribute(:r_autorefraction_dilated1_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated1_axis = '--' %>
      <% end %>

      <% if opdrecord.r_autorefraction_dilated2_sph.present? %>
        <% r_autorefraction_dilated2_sph = opdrecord.read_attribute(:r_autorefraction_dilated2_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated2_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated2_cyl.present? %>
        <% r_autorefraction_dilated2_cyl = opdrecord.read_attribute(:r_autorefraction_dilated2_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated2_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated2_axis.present? %>
        <% r_autorefraction_dilated2_axis = opdrecord.read_attribute(:r_autorefraction_dilated2_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated2_axis = '--' %>
      <% end %>

      <% if opdrecord.r_autorefraction_dilated3_sph.present? %>
        <% r_autorefraction_dilated3_sph = opdrecord.read_attribute(:r_autorefraction_dilated3_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated3_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated3_cyl.present? %>
        <% r_autorefraction_dilated3_cyl = opdrecord.read_attribute(:r_autorefraction_dilated3_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated3_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated3_axis.present? %>
        <% r_autorefraction_dilated3_axis = opdrecord.read_attribute(:r_autorefraction_dilated3_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated3_axis = '--' %>
      <% end %>

      <% if opdrecord.r_refraction_distant_sph.present? %>
        <% r_refraction_distant_sph = opdrecord.read_attribute(:r_refraction_distant_sph).to_s %>
        <% r_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_refraction_distant_sph = '--' %>
      <% end %>
      <% if opdrecord.r_refraction_distant_cyl.present? %>
        <% r_refraction_distant_cyl = opdrecord.read_attribute(:r_refraction_distant_cyl).to_s %>
        <% r_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_refraction_distant_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_refraction_distant_axis.present? %>
        <% r_refraction_distant_axis = opdrecord.read_attribute(:r_refraction_distant_axis).to_s %>
        <% r_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_refraction_distant_axis = '--' %>
      <% end %>
      <% unless opdrecord.r_refraction_distant_vision.blank? %>
        <% r_refraction_distant_vision = opdrecord.read_attribute(:r_refraction_distant_vision).to_s %>
        <% r_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_refraction_distant_vision = '--' %>
      <% end %>
      <% if opdrecord.r_refraction_near_sph.present? %>
        <% r_refraction_near_sph = opdrecord.read_attribute(:r_refraction_near_sph).to_s %>
        <% r_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_refraction_near_sph = '--' %>
      <% end %>
      <% if opdrecord.r_refraction_near_cyl.present? %>
        <% r_refraction_near_cyl = opdrecord.read_attribute(:r_refraction_near_cyl).to_s %>
        <% r_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_refraction_near_cyl = '--' %>
      <% end %>
      <% unless opdrecord.r_refraction_near_axis.blank? %>
        <% r_refraction_near_axis = opdrecord.read_attribute(:r_refraction_near_axis).to_s %>
        <% r_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_refraction_near_axis = '--' %>
      <% end %>
      <% unless opdrecord.r_refraction_near_vision.blank? %>
        <% r_refraction_near_vision = opdrecord.read_attribute(:r_refraction_near_vision).to_s %>
        <% r_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_refraction_near_vision = '--' %>
      <% end %>
      <% if opdrecord.r_refraction_comments.present? %>
        <% r_refraction_comments = r_refraction_comments.to_s %>
        <% r_refraction_comments_counter += 1 %>
        <% r_refraction_comments = " #{opdrecord.read_attribute(:r_refraction_comments)}" %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.r_dilatedrefraction_distant_sph.present? %>
        <% r_dilatedrefraction_distant_sph = opdrecord.read_attribute(:r_dilatedrefraction_distant_sph).to_s %>
        <% r_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedrefraction_distant_sph = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedrefraction_distant_cyl.present? %>
        <% r_dilatedrefraction_distant_cyl = opdrecord.read_attribute(:r_dilatedrefraction_distant_cyl).to_s %>
        <% r_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedrefraction_distant_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedrefraction_distant_axis.present? %>
        <% r_dilatedrefraction_distant_axis = opdrecord.read_attribute(:r_dilatedrefraction_distant_axis).to_s %>
        <% r_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedrefraction_distant_axis = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedrefraction_distant_vision.present? %>
        <% r_dilatedrefraction_distant_vision = opdrecord.read_attribute(:r_dilatedrefraction_distant_vision).to_s %>
        <% r_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedrefraction_distant_vision = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedrefraction_near_sph.present? %>
        <% r_dilatedrefraction_near_sph = opdrecord.read_attribute(:r_dilatedrefraction_near_sph).to_s %>
        <% r_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedrefraction_near_sph = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedrefraction_near_cyl.present? %>
        <% r_dilatedrefraction_near_cyl = opdrecord.read_attribute(:r_dilatedrefraction_near_cyl).to_s %>
        <% r_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedrefraction_near_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedrefraction_near_axis.present? %>
        <% r_dilatedrefraction_near_axis = opdrecord.read_attribute(:r_dilatedrefraction_near_axis).to_s %>
        <% r_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedrefraction_near_axis = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedrefraction_near_vision.present? %>
        <% r_dilatedrefraction_near_vision = opdrecord.read_attribute(:r_dilatedrefraction_near_vision).to_s %>
        <% r_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedrefraction_near_vision = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedrefraction_drug_used.present? %>
        <% r_dilatedrefraction_drug_used = "Drug Used- #{opdrecord.read_attribute(:r_dilatedrefraction_drug_used)}" %>
        <% r_dilatedrefraction_drug_used_op = r_dilatedrefraction_drug_used.to_s %>
        <% r_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_dilatedrefraction_comments.present? %>
        <% r_dilatedrefraction_comments = " #{opdrecord.read_attribute(:r_dilatedrefraction_comments)}" %>
        <% r_dilatedrefraction_comments = r_dilatedrefraction_comments.to_s %>
        <% r_dilatedrefraction_comments_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.r_retinoscopy_comments.present? %>
        <% r_retinoscopy_comments = r_retinoscopy_comments.to_s %>
        <% r_retinoscopy_comments_counter += 1 %>
        <% r_retinoscopy_comments = " #{opdrecord.read_attribute(:r_retinoscopy_comments)}" %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.r_dilated_retinoscopy_top_va1.present? %>
        <% r_dilatedretinoscopy_top_va1 = opdrecord.read_attribute(:r_dilated_retinoscopy_top_va1).to_s %>
        <% r_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_top_va1 = '--' %>
      <% end %>
      <% if opdrecord.r_dilated_retinoscopy_left_ha1.present? %>
        <% r_dilatedretinoscopy_left_ha1 = opdrecord.read_attribute(:r_dilated_retinoscopy_left_ha1).to_s %>
        <% r_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_left_ha1 = '--' %>
      <% end %>
      <% if opdrecord.r_dilated_retinoscopy_right_ha2.present? %>
        <% r_dilatedretinoscopy_right_ha2 = opdrecord.read_attribute(:r_dilated_retinoscopy_right_ha2).to_s %>
        <% r_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_right_ha2 = '--' %>
      <% end %>
      <% if opdrecord.r_dilated_retinoscopy_bottom_va2.present? %>
        <% r_dilatedretinoscopy_bottom_va2 = opdrecord.read_attribute(:r_dilated_retinoscopy_bottom_va2).to_s %>
        <% r_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_bottom_va2 = '--' %>
      <% end %>
      <% if opdrecord.r_dilated_retinoscopy_va.present? %>
        <% r_dilatedretinoscopy_va = opdrecord.read_attribute(:r_dilated_retinoscopy_va).to_s %>
        <% r_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_va = '--' %>
      <% end %>
      <% if opdrecord.r_dilated_retinoscopy_ha.present? %>
        <% r_dilatedretinoscopy_ha = opdrecord.read_attribute(:r_dilated_retinoscopy_ha).to_s %>
        <% r_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_ha = '--' %>
      <% end %>
      <% if opdrecord.r_dilated_retinoscopy_distance.present? %>
        <% r_dilatedretinoscopy_distance = opdrecord.read_attribute(:r_dilated_retinoscopy_distance).to_s %>
        <% r_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_distance = '--' %>
      <% end %>

      <% if opdrecord.r_retinoscopy_drug_used.present? %>
        <% r_retinoscopy_drug_used = opdrecord.read_attribute(:r_retinoscopy_drug_used).to_s %>
        <% r_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_retinoscopy_drug_used = '--' %>
      <% end %>

      <% if opdrecord.r_dilatedretinoscopy_pmt_axis.present? %>
        <% r_dilatedretinoscopy_pmt_axis = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_axis).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_axis = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedretinoscopy_pmt_sph.present? %>
        <% r_dilatedretinoscopy_pmt_sph = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_sph).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_sph = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedretinoscopy_pmt_cyl.present? %>
        <% r_dilatedretinoscopy_pmt_cyl = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_cyl).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedretinoscopy_pmt_vision.present? %>
        <% r_dilatedretinoscopy_pmt_vision = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_vision).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_vision = '--' %>
      <% end %>

      <% if opdrecord.r_dilatedretinoscopy_pmt_axis_row2.present? %>
        <% r_dilatedretinoscopy_pmt_axis_row2 = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_axis_row2).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_axis_row2 = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedretinoscopy_pmt_sph_row2.present? %>
        <% r_dilatedretinoscopy_pmt_sph_row2 = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_sph_row2).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_sph_row2 = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedretinoscopy_pmt_cyl_row2.present? %>
        <% r_dilatedretinoscopy_pmt_cyl_row2 = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_cyl_row2).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_cyl_row2 = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedretinoscopy_pmt_vision_row2.present? %>
        <% r_dilatedretinoscopy_pmt_vision_row2 = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_vision_row2).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_vision_row2 = '--' %>
      <% end %>

      <% if opdrecord.r_dilatedretinoscopy_pmt_axis_row3.present? %>
        <% r_dilatedretinoscopy_pmt_axis_row3 = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_axis_row3).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_axis_row3 = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedretinoscopy_pmt_sph_row3.present? %>
        <% r_dilatedretinoscopy_pmt_sph_row3 = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_sph_row3).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_sph_row3 = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedretinoscopy_pmt_cyl_row3.present? %>
        <% r_dilatedretinoscopy_pmt_cyl_row3 = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_cyl_row3).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_cyl_row3 = '--' %>
      <% end %>
      <% if opdrecord.r_dilatedretinoscopy_pmt_vision_row3.present? %>
        <% r_dilatedretinoscopy_pmt_vision_row3 = opdrecord.read_attribute(:r_dilatedretinoscopy_pmt_vision_row3).to_s %>
        <% r_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_dilatedretinoscopy_pmt_vision_row3 = '--' %>
      <% end %>

      <% if opdrecord.r_keratometry_distant_kh.present? %>
        <% r_keratometry_distant_kh = opdrecord.read_attribute(:r_keratometry_distant_kh).to_s %>
        <% r_keratometry_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_keratometry_distant_kh = '--' %>
      <% end %>
      <% if opdrecord.r_keratometry_distant_axis.present? %>
        <% r_keratometry_distant_axis = opdrecord.read_attribute(:r_keratometry_distant_axis).to_s %>
        <% r_keratometry_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_keratometry_distant_axis = '--' %>
      <% end %>
      <% if opdrecord.r_keratometry_near_kv.present? %>
        <% r_keratometry_near_kv = opdrecord.read_attribute(:r_keratometry_near_kv).to_s %>
        <% r_keratometry_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_keratometry_near_kv = '--' %>
      <% end %>
      <% if opdrecord.r_keratometry_near_axis.present? %>
        <% r_keratometry_near_axis = opdrecord.read_attribute(:r_keratometry_near_axis).to_s %>
        <% r_keratometry_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_keratometry_near_axis = '--' %>
      <% end %>

      <% if opdrecord.r_amsler_comment.present? || opdrecord.r_amsler.present? %>
        <% r_amsler_comment = opdrecord.r_amsler_comment %>
        <% r_amsler = opdrecord.r_amsler.blank? ? 'Normal' : opdrecord.r_amsler %>
        <% r_amsler_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.r_pgp_distant_sph.present? %>
        <% r_pgp_distant_sph = opdrecord.read_attribute(:r_pgp_distant_sph).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_sph = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_cyl.present? %>
        <% r_pgp_distant_cyl = opdrecord.read_attribute(:r_pgp_distant_cyl).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_axis.present? %>
        <% r_pgp_distant_axis = opdrecord.read_attribute(:r_pgp_distant_axis).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_axis = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_vision.present? %>
        <% r_pgp_distant_vision = opdrecord.read_attribute(:r_pgp_distant_vision).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_vision = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_sph.present? %>
        <% r_pgp_near_sph = opdrecord.read_attribute(:r_pgp_near_sph).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_sph = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_cyl.present? %>
        <% r_pgp_near_cyl = opdrecord.read_attribute(:r_pgp_near_cyl).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_axis.present? %>
        <% r_pgp_near_axis = opdrecord.read_attribute(:r_pgp_near_axis).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_axis = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_vision.present? %>
        <% r_pgp_near_vision = opdrecord.read_attribute(:r_pgp_near_vision).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_vision = '--' %>
      <% end %>
      <% unless opdrecord.r_pgp_typeoflens == "" || opdrecord.r_pgp_typeoflens == nil %>
        <% r_pgp_typeoflens = "Type of Lens- #{opdrecord.read_attribute(:r_pgp_typeoflens)}" %>
        <% r_pgp_op = r_pgp_typeoflens.to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_pgp_comments.present? %>
        <% r_pgp_comments = r_pgp_comments.to_s %>
        <% r_pgp_comments_counter = r_pgp_comments_counter + 1 %>
        <% r_pgp_comments = "#{opdrecord.read_attribute(:r_pgp_comments)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>

      <% if opdrecord.r_pgp_distant_sph2.present? %>
        <% r_pgp_distant_sph2 = opdrecord.read_attribute(:r_pgp_distant_sph2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_sph2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_cyl2.present? %>
        <% r_pgp_distant_cyl2 = opdrecord.read_attribute(:r_pgp_distant_cyl2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_cyl2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_axis2.present? %>
        <% r_pgp_distant_axis2 = opdrecord.read_attribute(:r_pgp_distant_axis2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_axis2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_vision2.present? %>
        <% r_pgp_distant_vision2 = opdrecord.read_attribute(:r_pgp_distant_vision2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_vision2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_sph2.present? %>
        <% r_pgp_near_sph2 = opdrecord.read_attribute(:r_pgp_near_sph2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_sph2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_cyl2.present? %>
        <% r_pgp_near_cyl2 = opdrecord.read_attribute(:r_pgp_near_cyl2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_cyl2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_axis2.present? %>
        <% r_pgp_near_axis2 = opdrecord.read_attribute(:r_pgp_near_axis2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_axis2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_vision2.present? %>
        <% r_pgp_near_vision2 = opdrecord.read_attribute(:r_pgp_near_vision2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_vision2 = '--' %>
      <% end %>
      <% unless opdrecord.r_pgp_typeoflens2 == "" || opdrecord.r_pgp_typeoflens2 == nil %>
        <% r_pgp_typeoflens2 = "Type of Lens- #{opdrecord.read_attribute(:r_pgp_typeoflens2)}" %>
        <% r_pgp_op2 = r_pgp_typeoflens2.to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_pgp_comments2.present? %>
        <% r_pgp_comments2 = r_pgp_comments2.to_s %>
        <% r_pgp_comments_counter2 = r_pgp_comments_counter2 + 1 %>
        <% r_pgp_comments2 = "#{opdrecord.read_attribute(:r_pgp_comments2)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>

      <% if opdrecord.r_pgp_distant_sph3.present? %>
        <% r_pgp_distant_sph3 = opdrecord.read_attribute(:r_pgp_distant_sph3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_sph3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_cyl3.present? %>
        <% r_pgp_distant_cyl3 = opdrecord.read_attribute(:r_pgp_distant_cyl3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_cyl3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_axis3.present? %>
        <% r_pgp_distant_axis3 = opdrecord.read_attribute(:r_pgp_distant_axis3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_axis3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_vision3.present? %>
        <% r_pgp_distant_vision3 = opdrecord.read_attribute(:r_pgp_distant_vision3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_vision3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_sph3.present? %>
        <% r_pgp_near_sph3 = opdrecord.read_attribute(:r_pgp_near_sph3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_sph3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_cyl3.present? %>
        <% r_pgp_near_cyl3 = opdrecord.read_attribute(:r_pgp_near_cyl3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_cyl3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_axis3.present? %>
        <% r_pgp_near_axis3 = opdrecord.read_attribute(:r_pgp_near_axis3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_axis3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_vision3.present? %>
        <% r_pgp_near_vision3 = opdrecord.read_attribute(:r_pgp_near_vision3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_vision3 = '--' %>
      <% end %>
      <% unless opdrecord.r_pgp_typeoflens3 == "" || opdrecord.r_pgp_typeoflens3 == nil %>
        <% r_pgp_typeoflens3 = "Type of Lens- #{opdrecord.read_attribute(:r_pgp_typeoflens3)}" %>
        <% r_pgp_op3 = r_pgp_typeoflens3.to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_pgp_comments3.present? %>
        <% r_pgp_comments3 = r_pgp_comments3.to_s %>
        <% r_pgp_comments_counter3 = r_pgp_comments_counter3 + 1 %>
        <% r_pgp_comments3 = "#{opdrecord.read_attribute(:r_pgp_comments3)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_objectivecomments.blank? %>
      <% if opdrecord.r_objectivecomments.present? %>
        <% r_objectivecomments = opdrecord.read_attribute(:r_objectivecomments).to_s %>
        <% r_objectivecomments_comments_op = r_objectivecomments.to_s %>
        <% r_objectivecomments_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_color_vision.blank? %>
      <% if opdrecord.r_color_vision.present? %>
        <% r_color_vision = opdrecord.read_attribute(:r_color_vision).to_s %>
        <% r_color_vision_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_orthoptics.blank? %>
      <% if opdrecord.r_orthoptics.present? %>
        <% r_orthoptics = opdrecord.read_attribute(:r_orthoptics).to_s %>
        <% r_orthoptics_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_contrastsensitivity.blank? %>
      <% if opdrecord.r_contrastsensitivity.present? %>
        <% r_contrastsensitivity = opdrecord.read_attribute(:r_contrastsensitivity).to_s %>
        <% r_contrastsensitivity_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_contrastsensitivity_comments.blank? %>
      <% if opdrecord.r_contrastsensitivity_comments.present? %>
        <% r_contrastsensitivity_comments = opdrecord.read_attribute(:r_contrastsensitivity_comments).to_s %>
        <% r_contrastsensitivity_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% l_refraction_counter = 0 %>
    <% l_refraction_op = '' %>
    <% l_refraction_distant_sph = '' %>
    <% l_refraction_distant_cyl = '' %>
    <% l_refraction_distant_axis = '' %>
    <% l_refraction_distant_vision = '' %>
    <% l_refraction_near_sph = '' %>
    <% l_refraction_near_cyl = '' %>
    <% l_refraction_near_axis = '' %>
    <% l_refraction_near_vision = '' %>
    <% l_refraction_comments_counter = 0 %>
    <% l_refraction_comments = '' %>

    <% l_autorefraction_counter = 0 %>
    <% l_autorefraction_op = '' %>
    <% l_autorefraction_dry_sph = '' %>
    <% l_autorefraction_dry_cyl = '' %>
    <% l_autorefraction_dry_axis = '' %>
    <% l_autorefraction_dry1_sph = '' %>
    <% l_autorefraction_dry1_cyl = '' %>
    <% l_autorefraction_dry1_axis = '' %>
    <% l_autorefraction_dry2_sph = '' %>
    <% l_autorefraction_dry2_cyl = '' %>
    <% l_autorefraction_dry2_axis = '' %>
    <% l_autorefraction_dilated1_sph = '' %>
    <% l_autorefraction_dilated1_cyl = '' %>
    <% l_autorefraction_dilated1_axis = '' %>
    <% l_autorefraction_dilated2_sph = '' %>
    <% l_autorefraction_dilated2_cyl = '' %>
    <% l_autorefraction_dilated2_axis = '' %>
    <% l_autorefraction_dilated3_sph = '' %>
    <% l_autorefraction_dilated3_cyl = '' %>
    <% l_autorefraction_dilated3_axis = '' %>

    <% l_dilatedrefraction_counter = 0 %>
    <% l_dilatedrefraction_op = '' %>
    <% l_dilatedrefraction_distant_sph = '' %>
    <% l_dilatedrefraction_distant_cyl = '' %>
    <% l_dilatedrefraction_distant_axis = '' %>
    <% l_dilatedrefraction_distant_vision = '' %>
    <% l_dilatedrefraction_near_sph = '' %>
    <% l_dilatedrefraction_near_cyl = '' %>
    <% l_dilatedrefraction_near_axis = '' %>
    <% l_dilatedrefraction_near_vision = '' %>
    <% l_dilatedrefraction_drug_used = '' %>
    <% l_dilatedrefraction_drug_used_op = '' %>
    <% l_dilatedrefraction_comments_counter = 0 %>
    <% l_dilatedrefraction_comments = '' %>

    <% l_dilatedretinoscopy_pmt_axis = '' %>
    <% l_dilatedretinoscopy_pmt_sph = '' %>
    <% l_dilatedretinoscopy_pmt_cyl = '' %>
    <% l_dilatedretinoscopy_pmt_vision = '' %>
    <% l_dilatedretinoscopy_pmt_axis_row2 = '' %>
    <% l_dilatedretinoscopy_pmt_sph_row2 = '' %>
    <% l_dilatedretinoscopy_pmt_cyl_row2 = '' %>
    <% l_dilatedretinoscopy_pmt_vision_row2 = '' %>
    <% l_dilatedretinoscopy_pmt_axis_row3 = '' %>
    <% l_dilatedretinoscopy_pmt_sph_row3 = '' %>
    <% l_dilatedretinoscopy_pmt_cyl_row3 = '' %>
    <% l_dilatedretinoscopy_pmt_vision_row3 = '' %>
    <% l_dilatedretinoscopy_pmt_counter = 0 %>

    <% l_dilatedretinoscopy_counter = 0 %>
    <% l_dilatedretinoscopy_top_va1 = '' %>
    <% l_dilatedretinoscopy_left_ha1 = '' %>
    <% l_dilatedretinoscopy_right_ha2 = '' %>
    <% l_dilatedretinoscopy_bottom_va2 = '' %>
    <% l_dilatedretinoscopy_va = '' %>
    <% l_dilatedretinoscopy_ha = '' %>
    <% l_dilatedretinoscopy_distance = '' %>
    <% l_retinoscopy_drug_used = '' %>
    <% l_retinoscopy_comments_counter = 0 %>
    <% l_retinoscopy_comments = '' %>

    <% l_keratometry_counter = 0 %>
    <% l_keratometry_op = '' %>
    <% l_keratometry_distant_kh = '' %>
    <% l_keratometry_distant_axis = '' %>
    <% l_keratometry_near_kv = '' %>
    <% l_keratometry_near_axis = '' %>
    <% l_amsler_counter = 0 %>

    <% l_pgp_counter = 0 %>
    <% l_pgp_op = '' %>
    <% l_pgp_distant_sph = '' %>
    <% l_pgp_distant_cyl = '' %>
    <% l_pgp_distant_axis = '' %>
    <% l_pgp_distant_vision = '' %>
    <% l_pgp_near_sph = '' %>
    <% l_pgp_near_cyl = '' %>
    <% l_pgp_near_axis = '' %>
    <% l_pgp_near_vision = '' %>
    <% l_pgp_typeoflens = '' %>
    <% l_pgp_comments_counter = 0 %>
    <% l_pgp_comments = "" %>

    <% l_pgp_counter2 = 0 %>
    <% l_pgp_op2 = '' %>
    <% l_pgp_distant_sph2 = '' %>
    <% l_pgp_distant_cyl2 = '' %>
    <% l_pgp_distant_axis2 = '' %>
    <% l_pgp_distant_vision2 = '' %>
    <% l_pgp_near_sph2 = '' %>
    <% l_pgp_near_cyl2 = '' %>
    <% l_pgp_near_axis2 = '' %>
    <% l_pgp_near_vision2 = '' %>
    <% l_pgp_typeoflens2 = '' %>
    <% l_pgp_comments_counter2 = 0 %>
    <% l_pgp_comments2 = "" %>

    <% l_pgp_counter3 = 0 %>
    <% l_pgp_op3 = '' %>
    <% l_pgp_distant_sph3 = '' %>
    <% l_pgp_distant_cyl3 = '' %>
    <% l_pgp_distant_axis3 = '' %>
    <% l_pgp_distant_vision3 = '' %>
    <% l_pgp_near_sph3 = '' %>
    <% l_pgp_near_cyl3 = '' %>
    <% l_pgp_near_axis3 = '' %>
    <% l_pgp_near_vision3 = '' %>
    <% l_pgp_typeoflens3 = '' %>
    <% l_pgp_comments_counter3 = 0 %>
    <% l_pgp_comments3 = "" %>

    <% l_color_vision_counter = 0 %>
    <% l_orthoptics_counter = 0 %>
    <% l_contrastsensitivity_counter = 0 %>

    <% l_objectivecomments_counter = 0 %>
    <% l_objectivecomments_op = '' %>
    <% l_objectivecomments_comments_op = '' %>
    <% l_objectivecomments = '' %>

    <% if @current_facility.country_id != "VN_254" %>
      <% if opdrecord.l_autorefraction_dry_sph.present? %>
        <% l_autorefraction_dry_sph = opdrecord.read_attribute(:l_autorefraction_dry_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dry_cyl.present? %>
        <% l_autorefraction_dry_cyl = opdrecord.read_attribute(:l_autorefraction_dry_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dry_axis.present? %>
        <% l_autorefraction_dry_axis = opdrecord.read_attribute(:l_autorefraction_dry_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry_axis = '--' %>
      <% end %>

      <% if opdrecord.l_autorefraction_dry1_sph.present? %>
        <% l_autorefraction_dry1_sph = opdrecord.read_attribute(:l_autorefraction_dry1_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry1_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dry1_cyl.present? %>
        <% l_autorefraction_dry1_cyl = opdrecord.read_attribute(:l_autorefraction_dry1_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry1_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dry1_axis.present? %>
        <% l_autorefraction_dry1_axis = opdrecord.read_attribute(:l_autorefraction_dry1_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry1_axis = '--' %>
      <% end %>

      <% if opdrecord.l_autorefraction_dry2_sph.present? %>
        <% l_autorefraction_dry2_sph = opdrecord.read_attribute(:l_autorefraction_dry2_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry2_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dry2_cyl.present? %>
        <% l_autorefraction_dry2_cyl = opdrecord.read_attribute(:l_autorefraction_dry2_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry2_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dry2_axis.present? %>
        <% l_autorefraction_dry2_axis = opdrecord.read_attribute(:l_autorefraction_dry2_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry2_axis = '--' %>
      <% end %>

      <% if opdrecord.l_autorefraction_dilated1_sph.present? %>
        <% l_autorefraction_dilated1_sph = opdrecord.read_attribute(:l_autorefraction_dilated1_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated1_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated1_cyl.present? %>
        <% l_autorefraction_dilated1_cyl = opdrecord.read_attribute(:l_autorefraction_dilated1_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated1_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated1_axis.present? %>
        <% l_autorefraction_dilated1_axis = opdrecord.read_attribute(:l_autorefraction_dilated1_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated1_axis = '--' %>
      <% end %>

      <% if opdrecord.l_autorefraction_dilated2_sph.present? %>
        <% l_autorefraction_dilated2_sph = opdrecord.read_attribute(:l_autorefraction_dilated2_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated2_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated2_cyl.present? %>
        <% l_autorefraction_dilated2_cyl = opdrecord.read_attribute(:l_autorefraction_dilated2_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated2_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated2_axis.present? %>
        <% l_autorefraction_dilated2_axis = opdrecord.read_attribute(:l_autorefraction_dilated2_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated2_axis = '--' %>
      <% end %>

      <% if opdrecord.l_autorefraction_dilated3_sph.present? %>
        <% l_autorefraction_dilated3_sph = opdrecord.read_attribute(:l_autorefraction_dilated3_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated3_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated3_cyl.present? %>
        <% l_autorefraction_dilated3_cyl = opdrecord.read_attribute(:l_autorefraction_dilated3_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated3_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated3_axis.present? %>
        <% l_autorefraction_dilated3_axis = opdrecord.read_attribute(:l_autorefraction_dilated3_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated3_axis = '--' %>
      <% end %>

      <% if opdrecord.l_refraction_distant_sph.present? %>
        <% l_refraction_distant_sph = opdrecord.read_attribute(:l_refraction_distant_sph).to_s %>
        <% l_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_refraction_distant_sph = '--' %>
      <% end %>
      <% if opdrecord.l_refraction_distant_cyl.present? %>
        <% l_refraction_distant_cyl = opdrecord.read_attribute(:l_refraction_distant_cyl).to_s %>
        <% l_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_refraction_distant_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_refraction_distant_axis.present? %>
        <% l_refraction_distant_axis = opdrecord.read_attribute(:l_refraction_distant_axis).to_s %>
        <% l_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_refraction_distant_axis = '--' %>
      <% end %>
      <% unless opdrecord.l_refraction_distant_vision.blank? %>
        <% l_refraction_distant_vision = opdrecord.read_attribute(:l_refraction_distant_vision).to_s %>
        <% l_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_refraction_distant_vision = '--' %>
      <% end %>
      <% if opdrecord.l_refraction_near_sph.present? %>
        <% l_refraction_near_sph = opdrecord.read_attribute(:l_refraction_near_sph).to_s %>
        <% l_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_refraction_near_sph = '--' %>
      <% end %>
      <% if opdrecord.l_refraction_near_cyl.present? %>
        <% l_refraction_near_cyl = opdrecord.read_attribute(:l_refraction_near_cyl).to_s %>
        <% l_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_refraction_near_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_refraction_near_axis.present? %>
        <% l_refraction_near_axis = opdrecord.read_attribute(:l_refraction_near_axis).to_s %>
        <% l_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_refraction_near_axis = '--' %>
      <% end %>
      <% unless opdrecord.l_refraction_near_vision.blank? %>
        <% l_refraction_near_vision = opdrecord.read_attribute(:l_refraction_near_vision).to_s %>
        <% l_refraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_refraction_near_vision = '--' %>
      <% end %>
      <% if opdrecord.l_refraction_comments.present? %>
        <% l_refraction_comments = l_refraction_comments.to_s %>
        <% l_refraction_comments_counter += 1 %>
        <% l_refraction_comments = " #{opdrecord.read_attribute(:l_refraction_comments)}" %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.l_dilatedrefraction_distant_sph.present? %>
        <% l_dilatedrefraction_distant_sph = opdrecord.read_attribute(:l_dilatedrefraction_distant_sph).to_s %>
        <% l_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedrefraction_distant_sph = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedrefraction_distant_cyl.present? %>
        <% l_dilatedrefraction_distant_cyl = opdrecord.read_attribute(:l_dilatedrefraction_distant_cyl).to_s %>
        <% l_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedrefraction_distant_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedrefraction_distant_axis.present? %>
        <% l_dilatedrefraction_distant_axis = opdrecord.read_attribute(:l_dilatedrefraction_distant_axis).to_s %>
        <% l_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedrefraction_distant_axis = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedrefraction_distant_vision.present? %>
        <% l_dilatedrefraction_distant_vision = opdrecord.read_attribute(:l_dilatedrefraction_distant_vision).to_s %>
        <% l_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedrefraction_distant_vision = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedrefraction_near_sph.present? %>
        <% l_dilatedrefraction_near_sph = opdrecord.read_attribute(:l_dilatedrefraction_near_sph).to_s %>
        <% l_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedrefraction_near_sph = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedrefraction_near_cyl.present? %>
        <% l_dilatedrefraction_near_cyl = opdrecord.read_attribute(:l_dilatedrefraction_near_cyl).to_s %>
        <% l_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedrefraction_near_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedrefraction_near_axis.present? %>
        <% l_dilatedrefraction_near_axis = opdrecord.read_attribute(:l_dilatedrefraction_near_axis).to_s %>
        <% l_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedrefraction_near_axis = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedrefraction_near_vision.present? %>
        <% l_dilatedrefraction_near_vision = opdrecord.read_attribute(:l_dilatedrefraction_near_vision).to_s %>
        <% l_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedrefraction_near_vision = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedrefraction_drug_used.present? %>
        <% l_dilatedrefraction_drug_used = "Drug Used- #{opdrecord.read_attribute(:l_dilatedrefraction_drug_used)}" %>
        <% l_dilatedrefraction_drug_used_op = l_dilatedrefraction_drug_used.to_s %>
        <% l_dilatedrefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_dilatedrefraction_comments.present? %>
        <% l_dilatedrefraction_comments = " #{opdrecord.read_attribute(:l_dilatedrefraction_comments)}" %>
        <% l_dilatedrefraction_comments = l_dilatedrefraction_comments.to_s %>
        <% l_dilatedrefraction_comments_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.l_retinoscopy_comments.present? %>
        <% l_retinoscopy_comments = l_retinoscopy_comments.to_s %>
        <% l_retinoscopy_comments_counter += 1 %>
        <% l_retinoscopy_comments = " #{opdrecord.read_attribute(:l_retinoscopy_comments)}" %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.l_dilated_retinoscopy_top_va1.present? %>
        <% l_dilatedretinoscopy_top_va1 = opdrecord.read_attribute(:l_dilated_retinoscopy_top_va1).to_s %>
        <% l_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_top_va1 = '--' %>
      <% end %>
      <% if opdrecord.l_dilated_retinoscopy_left_ha1.present? %>
        <% l_dilatedretinoscopy_left_ha1 = opdrecord.read_attribute(:l_dilated_retinoscopy_left_ha1).to_s %>
        <% l_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_left_ha1 = '--' %>
      <% end %>

      <% if opdrecord.l_dilated_retinoscopy_right_ha2.present? %>
        <% l_dilatedretinoscopy_right_ha2 = opdrecord.read_attribute(:l_dilated_retinoscopy_right_ha2).to_s %>
        <% l_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_right_ha2 = '--' %>
      <% end %>
      <% if opdrecord.l_dilated_retinoscopy_bottom_va2.present? %>
        <% l_dilatedretinoscopy_bottom_va2 = opdrecord.read_attribute(:l_dilated_retinoscopy_bottom_va2).to_s %>
        <% l_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_bottom_va2 = '--' %>
      <% end %>

      <% if opdrecord.l_dilated_retinoscopy_va.present? %>
        <% l_dilatedretinoscopy_va = opdrecord.read_attribute(:l_dilated_retinoscopy_va).to_s %>
        <% l_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_va = '--' %>
      <% end %>
      <% if opdrecord.l_dilated_retinoscopy_ha.present? %>
        <% l_dilatedretinoscopy_ha = opdrecord.read_attribute(:l_dilated_retinoscopy_ha).to_s %>
        <% l_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_ha = '--' %>
      <% end %>

      <% if opdrecord.l_dilated_retinoscopy_distance.present? %>
        <% l_dilatedretinoscopy_distance = opdrecord.read_attribute(:l_dilated_retinoscopy_distance).to_s %>
        <% l_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_distance = '--' %>
      <% end %>
      <% if opdrecord.l_retinoscopy_drug_used.present? %>
        <% l_retinoscopy_drug_used = opdrecord.read_attribute(:l_retinoscopy_drug_used).to_s %>
        <% l_dilatedretinoscopy_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_retinoscopy_drug_used = '--' %>
      <% end %>

      <% if opdrecord.l_dilatedretinoscopy_pmt_axis.present? %>
        <% l_dilatedretinoscopy_pmt_axis = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_axis).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_axis = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedretinoscopy_pmt_sph.present? %>
        <% l_dilatedretinoscopy_pmt_sph = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_sph).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_sph = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedretinoscopy_pmt_cyl.present? %>
        <% l_dilatedretinoscopy_pmt_cyl = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_cyl).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedretinoscopy_pmt_vision.present? %>
        <% l_dilatedretinoscopy_pmt_vision = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_vision).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_vision = '--' %>
      <% end %>

      <% if opdrecord.l_dilatedretinoscopy_pmt_axis_row2.present? %>
        <% l_dilatedretinoscopy_pmt_axis_row2 = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_axis_row2).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_axis_row2 = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedretinoscopy_pmt_sph_row2.present? %>
        <% l_dilatedretinoscopy_pmt_sph_row2 = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_sph_row2).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_sph_row2 = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedretinoscopy_pmt_cyl_row2.present? %>
        <% l_dilatedretinoscopy_pmt_cyl_row2 = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_cyl_row2).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_cyl_row2 = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedretinoscopy_pmt_vision_row2.present? %>
        <% l_dilatedretinoscopy_pmt_vision_row2 = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_vision_row2).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_vision_row2 = '--' %>
      <% end %>

      <% if opdrecord.l_dilatedretinoscopy_pmt_axis_row3.present? %>
        <% l_dilatedretinoscopy_pmt_axis_row3 = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_axis_row3).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_axis_row3 = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedretinoscopy_pmt_sph_row3.present? %>
        <% l_dilatedretinoscopy_pmt_sph_row3 = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_sph_row3).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_sph_row3 = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedretinoscopy_pmt_cyl_row3.present? %>
        <% l_dilatedretinoscopy_pmt_cyl_row3 = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_cyl_row3).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_cyl_row3 = '--' %>
      <% end %>
      <% if opdrecord.l_dilatedretinoscopy_pmt_vision_row3.present? %>
        <% l_dilatedretinoscopy_pmt_vision_row3 = opdrecord.read_attribute(:l_dilatedretinoscopy_pmt_vision_row3).to_s %>
        <% l_dilatedretinoscopy_pmt_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_dilatedretinoscopy_pmt_vision_row3 = '--' %>
      <% end %>

      <% if opdrecord.l_keratometry_distant_kh.present? %>
        <% l_keratometry_distant_kh = opdrecord.read_attribute(:l_keratometry_distant_kh).to_s %>
        <% l_keratometry_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_keratometry_distant_kh = '--' %>
      <% end %>
      <% if opdrecord.l_keratometry_distant_axis.present? %>
        <% l_keratometry_distant_axis = opdrecord.read_attribute(:l_keratometry_distant_axis).to_s %>
        <% l_keratometry_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_keratometry_distant_axis = '--' %>
      <% end %>
      <% if opdrecord.l_keratometry_near_kv.present? %>
        <% l_keratometry_near_kv = opdrecord.read_attribute(:l_keratometry_near_kv).to_s %>
        <% l_keratometry_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_keratometry_near_kv = '--' %>
      <% end %>
      <% if opdrecord.l_keratometry_near_axis.present? %>
        <% l_keratometry_near_axis = opdrecord.read_attribute(:l_keratometry_near_axis).to_s %>
        <% l_keratometry_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_keratometry_near_axis = '--' %>
      <% end %>

      <% if opdrecord.l_amsler_comment.present? || opdrecord.l_amsler.present? %>
        <% l_amsler_comment = opdrecord.l_amsler_comment %>
        <% l_amsler = opdrecord.l_amsler.blank? ? 'Normal' : opdrecord.l_amsler %>
        <% l_amsler_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.l_pgp_distant_sph.present? %>
        <% l_pgp_distant_sph = opdrecord.read_attribute(:l_pgp_distant_sph).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_sph = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_cyl.present? %>
        <% l_pgp_distant_cyl = opdrecord.read_attribute(:l_pgp_distant_cyl).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_axis.present? %>
        <% l_pgp_distant_axis = opdrecord.read_attribute(:l_pgp_distant_axis).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_axis = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_vision.present? %>
        <% l_pgp_distant_vision = opdrecord.read_attribute(:l_pgp_distant_vision).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_vision = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_sph.present? %>
        <% l_pgp_near_sph = opdrecord.read_attribute(:l_pgp_near_sph).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_sph = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_cyl.present? %>
        <% l_pgp_near_cyl = opdrecord.read_attribute(:l_pgp_near_cyl).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_axis.present? %>
        <% l_pgp_near_axis = opdrecord.read_attribute(:l_pgp_near_axis).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_axis = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_vision.present? %>
        <% l_pgp_near_vision = opdrecord.read_attribute(:l_pgp_near_vision).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_vision = '--' %>
      <% end %>
      <% unless opdrecord.l_pgp_typeoflens == "" || opdrecord.l_pgp_typeoflens == nil %>
        <% l_pgp_typeoflens = "Type of Lens- #{opdrecord.read_attribute(:l_pgp_typeoflens)}" %>
        <% l_pgp_op = l_pgp_typeoflens.to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_pgp_comments.present? %>
        <% l_pgp_comments = l_pgp_comments.to_s %>
        <% l_pgp_comments_counter = l_pgp_comments_counter + 1 %>
        <% l_pgp_comments = "#{opdrecord.read_attribute(:l_pgp_comments)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>

      <% if opdrecord.l_pgp_distant_sph2.present? %>
        <% l_pgp_distant_sph2 = opdrecord.read_attribute(:l_pgp_distant_sph2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_sph2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_cyl2.present? %>
        <% l_pgp_distant_cyl2 = opdrecord.read_attribute(:l_pgp_distant_cyl2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_cyl2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_axis2.present? %>
        <% l_pgp_distant_axis2 = opdrecord.read_attribute(:l_pgp_distant_axis2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_axis2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_vision2.present? %>
        <% l_pgp_distant_vision2 = opdrecord.read_attribute(:l_pgp_distant_vision2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_vision2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_sph2.present? %>
        <% l_pgp_near_sph2 = opdrecord.read_attribute(:l_pgp_near_sph2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_sph2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_cyl2.present? %>
        <% l_pgp_near_cyl2 = opdrecord.read_attribute(:l_pgp_near_cyl2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_cyl2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_axis2.present? %>
        <% l_pgp_near_axis2 = opdrecord.read_attribute(:l_pgp_near_axis2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_axis2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_vision2.present? %>
        <% l_pgp_near_vision2 = opdrecord.read_attribute(:l_pgp_near_vision2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_vision2 = '--' %>
      <% end %>
      <% unless opdrecord.l_pgp_typeoflens2 == "" || opdrecord.l_pgp_typeoflens2 == nil %>
        <% l_pgp_typeoflens2 = "Type of Lens- #{opdrecord.read_attribute(:l_pgp_typeoflens2)}" %>
        <% l_pgp_op2 = l_pgp_typeoflens2.to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_pgp_comments2.present? %>
        <% l_pgp_comments2 = l_pgp_comments2.to_s %>
        <% l_pgp_comments_counter2 = l_pgp_comments_counter2 + 1 %>
        <% l_pgp_comments2 = "#{opdrecord.read_attribute(:l_pgp_comments2)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>

      <% if opdrecord.l_pgp_distant_sph3.present? %>
        <% l_pgp_distant_sph3 = opdrecord.read_attribute(:l_pgp_distant_sph3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_sph3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_cyl3.present? %>
        <% l_pgp_distant_cyl3 = opdrecord.read_attribute(:l_pgp_distant_cyl3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_cyl3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_axis3.present? %>
        <% l_pgp_distant_axis3 = opdrecord.read_attribute(:l_pgp_distant_axis3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_axis3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_vision3.present? %>
        <% l_pgp_distant_vision3 = opdrecord.read_attribute(:l_pgp_distant_vision3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_vision3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_sph3.present? %>
        <% l_pgp_near_sph3 = opdrecord.read_attribute(:l_pgp_near_sph3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_sph3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_cyl3.present? %>
        <% l_pgp_near_cyl3 = opdrecord.read_attribute(:l_pgp_near_cyl3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_cyl3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_axis3.present? %>
        <% l_pgp_near_axis3 = opdrecord.read_attribute(:l_pgp_near_axis3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_axis3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_vision3.present? %>
        <% l_pgp_near_vision3 = opdrecord.read_attribute(:l_pgp_near_vision3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_vision3 = '--' %>
      <% end %>
      <% unless opdrecord.l_pgp_typeoflens3 == "" || opdrecord.l_pgp_typeoflens3 == nil %>
        <% l_pgp_typeoflens3 = "Type of Lens- #{opdrecord.read_attribute(:l_pgp_typeoflens3)}" %>
        <% l_pgp_op3 = l_pgp_typeoflens3.to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_pgp_comments3.present? %>
        <% l_pgp_comments3 = l_pgp_comments3.to_s %>
        <% l_pgp_comments_counter3 = l_pgp_comments_counter3 + 1 %>
        <% l_pgp_comments3 = "#{opdrecord.read_attribute(:l_pgp_comments3)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_objectivecomments.blank? %>
      <% if opdrecord.l_objectivecomments.present? %>
        <% l_objectivecomments = opdrecord.read_attribute(:l_objectivecomments).to_s %>
        <% l_objectivecomments_comments_op = l_objectivecomments.to_s %>
        <% l_objectivecomments_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_color_vision.blank? %>
      <% if opdrecord.l_color_vision.present? %>
        <% l_color_vision = opdrecord.read_attribute(:l_color_vision).to_s %>
        <% l_color_vision_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_orthoptics.blank? %>
      <% if opdrecord.l_orthoptics.present? %>
        <% l_orthoptics = opdrecord.read_attribute(:l_orthoptics).to_s %>
        <% l_orthoptics_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_contrastsensitivity.blank? %>
      <% if opdrecord.l_contrastsensitivity.present? %>
        <% l_contrastsensitivity = opdrecord.read_attribute(:l_contrastsensitivity).to_s %>
        <% l_contrastsensitivity_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_contrastsensitivity_comments.blank? %>
      <% if opdrecord.l_contrastsensitivity_comments.present? %>
        <% l_contrastsensitivity_comments = opdrecord.read_attribute(:l_contrastsensitivity_comments).to_s %>
        <% l_contrastsensitivity_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% if refraction_counter > 0 || general_refraction_counter > 0 || opdrecord.r_local_examination_normal == "normal" || opdrecord.l_local_examination_normal == "normal" || orthoptics_heading_counter > 0 %>
      <div class="row mb5">
        <strong style="<%= heading_font_size %>">REFRACTION</strong>
        <% if mail_job == false %>
          <% if params[:action] != "print_opd_record" || diagram_counter > 0 %><% end %>
        <% end %>
        <div class="summary-line-border"></div>
      </div>
      <div class="row <%= 'print_text_font_size' if  @print_setting %>" style="<%= text_font_size %>">
        <% if refractioncommoncomment.present? %>
          <div class="col-md-12 col-sm-12">
            <span style="white-space: pre-line"><%=refractioncommoncomment%></span>
          </div>
        <% end %>
        <% if general_refraction_counter > 0 || opdrecord.r_local_examination_normal == "normal" || opdrecord.l_local_examination_normal == "normal" %>
          <div class="col-md-6 col-sm-6">
            <div class="text-center" style="background-color:#ddd;">R/OD</div>
          </div><!-- col-md-6  -->
          <div class="col-md-6 col-sm-6">
            <div class="text-center" style="background-color:#ddd;">L/OS</div>
          </div><!-- col-md-6  -->
        <% end %>
        <div class="col-md-6 col-sm-6">
          <% if @current_facility.country_id != "VN_254" %>
            <% if r_keratometry_counter > 0 %>
              <strong>Keratometry:</strong>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="30%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="30%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Kh</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_keratometry_distant_kh %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_keratometry_distant_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Kv</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_keratometry_near_kv %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_keratometry_near_axis %></td>
                  </tr>
                </tbody>
              </table>
            <% end %>

            <% if r_amsler_counter > 0 %>
              <span>
                <p class="examination_non_tabular">
                  <% if r_amsler.present? %>
                    <b>AMSLER:</b> <%= r_amsler %>
                  <% end %>
                  <% if r_amsler_comment.present? %> <br>
                    <span style="display: list-item;margin-left: 4%">
                      Comment: <%= r_amsler_comment.html_safe %>
                    </span>
                  <% end %>
                </p>
              </span>
            <% end %>

            <% if [r_pgp_counter + l_pgp_counter + r_pgp_comments_counter + l_pgp_comments_counter, r_pgp_counter2 + l_pgp_counter2 + r_pgp_comments_counter2 + l_pgp_comments_counter2, r_pgp_counter3 + l_pgp_counter3 + r_pgp_comments_counter3 + l_pgp_comments_counter3].reject { |r_pgp| r_pgp == 0 }.count > 1 %>
              <% show_pgp_counter = true %>
            <% end %>
            <% show_pgp_no = 1 %>
            <% if r_pgp_counter > 0 || l_pgp_counter > 0 %>
              <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>&nbsp;<%= r_pgp_op %>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_vision %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_vision %></td>
                  </tr>
                </tbody>
              </table>
              <% if r_pgp_comments_counter > 0 || l_pgp_comments_counter > 0  %>
                <div style="font-size: 12px;">
                  <strong>Comment :</strong>
                  <span><%= r_pgp_comments %></span>
                </div>
              <% end %>
              <% show_pgp_no += 1 %>
            <% elsif (r_pgp_comments_counter > 0 && r_pgp_counter == 0) || ( l_pgp_comments_counter > 0 && l_pgp_counter == 0) %>
              <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= r_pgp_comments %></span>
              </div>
              <% show_pgp_no += 1 %>
            <% end %>
            <% if r_pgp_counter2 > 0 || l_pgp_counter2 > 0 %>
              <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>&nbsp;<%= r_pgp_op2 %>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_sph2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_cyl2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_axis2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_vision2 %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_sph2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_cyl2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_axis2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_vision2 %></td>
                  </tr>
                </tbody>
              </table>
               <% if r_pgp_comments_counter2 > 0 || l_pgp_comments_counter2 > 0  %>
                <div style="font-size: 12px;">
                  <strong>Comment :</strong>
                  <span><%= r_pgp_comments2 %></span>
                </div>
              <% end %>
              <% show_pgp_no += 1 %>
            <% elsif (r_pgp_comments_counter2 > 0 && r_pgp_counter2 == 0) || ( l_pgp_comments_counter2 > 0 && l_pgp_counter2 == 0) %>
              <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= r_pgp_comments2 %></span>
              </div>
              <% show_pgp_no += 1 %>
            <% end %>
            <% if r_pgp_counter3 > 0 || l_pgp_counter3 > 0 %>
              <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>&nbsp;<%= r_pgp_op3 %>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_sph3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_cyl3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_axis3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_vision3 %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_sph3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_cyl3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_axis3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_vision3 %></td>
                  </tr>
                </tbody>
              </table>
              <% if r_pgp_comments_counter3 > 0 || l_pgp_comments_counter3 > 0  %>
                <div style="font-size: 12px;">
                  <strong>Comment :</strong>
                  <span><%= r_pgp_comments3 %></span>
                </div>
              <% end %>
              <% show_pgp_no += 1 %>
            <% elsif (r_pgp_comments_counter3 > 0 && r_pgp_counter3 == 0) || (l_pgp_comments_counter3 > 0 && l_pgp_counter3 == 0) %>
              <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= r_pgp_comments3 %></span>
              </div>
              <% show_pgp_no += 1 %>
            <% end %>

            <% if r_autorefraction_counter > 0 %>
              <strong>Auto Refraction:</strong>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="20%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="20%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="20%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Dry</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_autorefraction_dry_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_autorefraction_dry_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_autorefraction_dry_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;"></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_autorefraction_dry1_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_autorefraction_dry1_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_autorefraction_dry1_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;"></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_autorefraction_dry2_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_autorefraction_dry2_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_autorefraction_dry2_axis %></td>
                  </tr>
                </tbody>
              </table>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 40%;">Dilated</td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= r_autorefraction_dilated1_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= r_autorefraction_dilated1_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= r_autorefraction_dilated1_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 40%;"></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= r_autorefraction_dilated2_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= r_autorefraction_dilated2_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= r_autorefraction_dilated2_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 40%;"></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= r_autorefraction_dilated3_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= r_autorefraction_dilated3_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= r_autorefraction_dilated3_axis %></td>
                  </tr>
                </tbody>
              </table>
            <% end %>

            <% if r_refraction_counter > 0 %>
              <strong>Dry Refraction:</strong>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_refraction_distant_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_refraction_distant_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_refraction_distant_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_refraction_distant_vision %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_refraction_near_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_refraction_near_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_refraction_near_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_refraction_near_vision %></td>
                  </tr>
                </tbody>
              </table>
              <% if r_refraction_comments_counter > 0 %>
                <li><%= r_refraction_comments %></li>
              <% end %>
            <% end %>
            <% if r_refraction_comments_counter > 0 && r_refraction_counter == 0 %>
              <strong>Dry Refraction:</strong>
              <li><%= r_refraction_comments %></li>
            <% end %>

            <% if r_dilatedrefraction_counter > 0 %>
              <strong>Refraction (Dilated):</strong><%= r_dilatedrefraction_drug_used_op %>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedrefraction_distant_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedrefraction_distant_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedrefraction_distant_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedrefraction_distant_vision %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedrefraction_near_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedrefraction_near_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedrefraction_near_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedrefraction_near_vision %></td>
                  </tr>
                </tbody>
              </table>
              <% if r_dilatedrefraction_comments_counter > 0 %>
                <li><%= r_dilatedrefraction_comments %></li>
              <% end %>
            <% end %>
            <% if r_dilatedrefraction_comments_counter > 0 && r_dilatedrefraction_counter == 0 %>
              <strong>Refraction (Dilated):</strong>
              <li><%= r_dilatedrefraction_comments %></li>
            <% end %>

            <% if r_dilatedretinoscopy_counter > 0 %>
              <strong>Retinoscopy:</strong>
              <div class="row">
                <div class="col-md-7 col-md-7">
                  <svg height="80" width="200">
                    <text x="70" y="10" fill="#636e7b"><%= r_dilatedretinoscopy_top_va1 %></text>
                    <line x1="40" y1="40" x2="120" y2="40" style="stroke:#636e7b;stroke-width:2" />
                    <text x="0" y="45" fill="#636e7b"><%= r_dilatedretinoscopy_left_ha1 %></text>
                    <text x="130" y="45" fill="#636e7b"><%= r_dilatedretinoscopy_right_ha2 %></text>
                    <line x1="80" y1="15" x2="80" y2="65" style="stroke:#636e7b;stroke-width:2" />
                    <text x="70" y="80" fill="#636e7b"><%= r_dilatedretinoscopy_bottom_va2 %></text>
                      Sorry, your browser does not support inline SVG.
                  </svg>
                </div>
                <div class="col-md-5 col-md-5" style="font-size: smaller;">
                  <div class="row" style="padding: 0px;">
                    <div class="col-md-6 col-md-6" style="padding: 0px;">
                      <strong>VA:</strong> <%= r_dilatedretinoscopy_va %>
                    </div>
                    <div class="col-md-6 col-md-6" style="padding: 0px;">
                      <strong>HA:</strong> <%= r_dilatedretinoscopy_ha %>
                    </div>
                  </div>
                  <div class="row">
                    <strong>At Distance:</strong>  <%= r_dilatedretinoscopy_distance %>
                  </div>
                  <div class="row">
                    <strong>Drug Used:</strong>  <%= r_retinoscopy_drug_used %>
                  </div>
                </div>
              </div>
              <% if r_retinoscopy_comments_counter > 0 %>
                <li><%= r_retinoscopy_comments %></li>
              <% end %>
            <% end %>
            <% if r_retinoscopy_comments_counter > 0 && r_dilatedretinoscopy_counter == 0 %>
              <strong>Retinoscopy comments:</strong>
              <li><%= r_retinoscopy_comments %></li>
            <% end %>

            <% if r_dilatedretinoscopy_pmt_counter > 0 %>
              <strong>PMT:</strong>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedretinoscopy_pmt_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedretinoscopy_pmt_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedretinoscopy_pmt_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedretinoscopy_pmt_vision %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedretinoscopy_pmt_sph_row3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedretinoscopy_pmt_cyl_row3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedretinoscopy_pmt_axis_row3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= r_dilatedretinoscopy_pmt_vision_row3 %></td>
                  </tr>
                </tbody>
              </table>
            <% end %>

            <% if r_color_vision_counter > 0 %>
              <p style="margin-bottom:0px;"><b>Color Vision:</b> <%= r_color_vision %></p>
            <% end %>

            <% if r_contrastsensitivity_counter > 0 %>
              <p style="margin-bottom:0px;"><b style="<%= heading_font_size %>">Contrast Sensitivity:</b> 
                <% if r_contrastsensitivity.present? %>
                  <%= r_contrastsensitivity %>
                <% end %>
                <% if r_contrastsensitivity_comments.present? %> <br>
                  <span style="display: list-item;margin-left: 4%">
                    Comment: <%= r_contrastsensitivity_comments.html_safe %>
                  </span>
                <% end %>
              </p>
            <% end %>

            <% if r_orthoptics_counter > 0 %>
              <p style="margin-bottom:0px;"><b>Orthoptics:</b> <%= r_orthoptics %></p>
            <% end %>
          <% end %>
        </div>
        <div class="col-md-6 col-sm-6">
          <% if @current_facility.country_id != "VN_254" %>
            <% if l_keratometry_counter > 0 %>
              <strong>Keratometry:</strong>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="30%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="30%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Kh</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_keratometry_distant_kh %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_keratometry_distant_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Kv</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_keratometry_near_kv %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_keratometry_near_axis %></td>
                  </tr>
                </tbody>
              </table>
            <% end %>

            <% if l_amsler_counter > 0 %>
              <span>
                <p class="examination_non_tabular">
                <% if l_amsler.present? %>
                  <b>AMSLER:</b> <%= l_amsler %>
                <% end %>
                <% if l_amsler_comment.present? %> <br>
                  <span style="display: list-item;margin-left: 4%">
                    Comment: <%= l_amsler_comment.html_safe %>
                  </span>
                <% end %></p>
              </span>
            <% end %>

            <% if [l_pgp_counter + r_pgp_counter + l_pgp_comments_counter + r_pgp_comments_counter, l_pgp_counter2 + r_pgp_counter2 + l_pgp_comments_counter2 + r_pgp_comments_counter2, l_pgp_counter3 + r_pgp_counter3 + l_pgp_comments_counter3 + r_pgp_comments_counter3].reject { |l_pgp| l_pgp == 0 }.count > 1 %>
              <% show_l_pgp_counter = true %>
            <% end %>
            <% show_l_pgp_no = 1 %>
            <% if l_pgp_counter > 0 || r_pgp_counter > 0 %>
              <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>&nbsp;<%= l_pgp_op %>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_vision %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_vision %></td>
                  </tr>
                </tbody>
              </table>
              <% if l_pgp_comments_counter > 0 || r_pgp_comments_counter > 0  %>
                <div style="font-size: 12px;">
                  <strong>Comment :</strong>
                  <span><%= l_pgp_comments %></span>
                </div>
              <% end %>
              <% show_l_pgp_no += 1 %>
            <% elsif (l_pgp_comments_counter > 0 && l_pgp_counter == 0) || (r_pgp_comments_counter > 0 && r_pgp_counter == 0) %>
              <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= l_pgp_comments %></span>
              </div>
              <% show_l_pgp_no += 1 %>
            <% end %>
            <% if l_pgp_counter2 > 0 || r_pgp_counter2 > 0 %>
              <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>&nbsp;<%= l_pgp_op2 %>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_sph2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_cyl2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_axis2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_vision2 %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_sph2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_cyl2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_axis2 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_vision2 %></td>
                  </tr>
                </tbody>
              </table>
              <% if l_pgp_comments_counter2 > 0 || r_pgp_comments_counter2 > 0  %>
                <div style="font-size: 12px;">
                  <strong>Comment :</strong>
                  <span><%= l_pgp_comments2 %></span>
                </div>
              <% end %>
              <% show_l_pgp_no += 1 %>
            <% elsif (l_pgp_comments_counter2 > 0 && l_pgp_counter2 == 0) || (r_pgp_comments_counter2 > 0 && r_pgp_counter2 == 0) %>
              <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= l_pgp_comments2 %></span>
              </div>
              <% show_l_pgp_no += 1 %>
            <% end %>
            <% if l_pgp_counter3 > 0 || r_pgp_counter3 > 0 %>
              <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>&nbsp;<%= l_pgp_op3 %>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_sph3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_cyl3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_axis3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_vision3 %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_sph3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_cyl3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_axis3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_vision3 %></td>
                  </tr>
                </tbody>
              </table>
              <% if l_pgp_comments_counter3 > 0 || r_pgp_comments_counter3 > 0  %>
                <div style="font-size: 12px;">
                  <strong>Comment :</strong>
                  <span><%= l_pgp_comments3 %></span>
                </div>
              <% end %>
            <% elsif (l_pgp_comments_counter3 > 0 && l_pgp_counter3 == 0) || (r_pgp_comments_counter3 > 0 && r_pgp_counter3 == 0) %>
              <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= l_pgp_comments3 %></span>
              </div>
              <% show_l_pgp_no += 1 %>
            <% end %>

            <% if l_autorefraction_counter > 0 %>
              <strong>Auto Refraction:</strong>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="20%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="20%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="20%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Dry</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_autorefraction_dry_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_autorefraction_dry_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_autorefraction_dry_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;"></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_autorefraction_dry1_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_autorefraction_dry1_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_autorefraction_dry1_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;"></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_autorefraction_dry2_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_autorefraction_dry2_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_autorefraction_dry2_axis %></td>
                  </tr>
                </tbody>
              </table>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 40%;">Dilated</td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= l_autorefraction_dilated1_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= l_autorefraction_dilated1_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= l_autorefraction_dilated1_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 40%;"></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= l_autorefraction_dilated2_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= l_autorefraction_dilated2_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= l_autorefraction_dilated2_axis %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 40%;"></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= l_autorefraction_dilated3_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= l_autorefraction_dilated3_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;width: 20%;"><%= l_autorefraction_dilated3_axis %></td>
                  </tr>
                </tbody>
              </table>
            <% end %>

            <% if l_refraction_counter > 0 %>
              <strong>Dry Refraction:</strong>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_refraction_distant_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_refraction_distant_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_refraction_distant_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_refraction_distant_vision %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_refraction_near_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_refraction_near_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_refraction_near_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_refraction_near_vision %></td>
                  </tr>
                </tbody>
              </table>
              <% if l_refraction_comments_counter > 0 %>
                <li><%= l_refraction_comments %></li>
              <% end %>
            <% end %>
            <% if l_refraction_comments_counter > 0 && l_refraction_counter == 0 %>
              <strong>Dry Refraction:</strong>
              <li><%= l_refraction_comments %></li>
            <% end %>

            <% if l_dilatedrefraction_counter > 0 %>
              <strong>Refraction (Dilated):</strong><%= l_dilatedrefraction_drug_used_op %>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedrefraction_distant_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedrefraction_distant_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedrefraction_distant_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedrefraction_distant_vision %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedrefraction_near_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedrefraction_near_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedrefraction_near_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedrefraction_near_vision %></td>
                  </tr>
                </tbody>
              </table>
              <% if l_dilatedrefraction_comments_counter > 0 %>
                <li><%= l_dilatedrefraction_comments %></li>
              <% end %>
            <% end %>
            <% if l_dilatedrefraction_comments_counter > 0 && l_dilatedrefraction_counter == 0 %>
              <strong>Refraction (Dilated):</strong>
              <li><%= l_dilatedrefraction_comments %></li>
            <% end %>

            <% if l_dilatedretinoscopy_counter > 0 %>
              <strong>Retinoscopy:</strong>
              <div class="row">
                <div class="col-md-7 col-sm-7">
                  <svg height="80" width="200">
                    <text x="70" y="10" fill="#636e7b"><%= l_dilatedretinoscopy_top_va1 %></text>
                    <line x1="40" y1="40" x2="120" y2="40" style="stroke:#636e7b;stroke-width:2" />
                    <text x="0" y="45" fill="#636e7b"><%= l_dilatedretinoscopy_left_ha1 %></text>
                    <text x="130" y="45" fill="#636e7b"><%= l_dilatedretinoscopy_right_ha2 %></text>
                    <line x1="80" y1="15" x2="80" y2="65" style="stroke:#636e7b;stroke-width:2" />
                    <text x="70" y="80" fill="#636e7b"><%= l_dilatedretinoscopy_bottom_va2 %></text>
                    Sorry, your browser does not support inline SVG.
                  </svg>
                </div>
                <div class="col-md-5 col-sm-5" style="font-size: smaller;">
                  <div class="row" style="padding: 0px;">
                    <div class="col-md-6 col-sm-6" style="padding: 0px;">
                      <strong>VA:</strong> <%= l_dilatedretinoscopy_va %>
                    </div>
                    <div class="col-md-6 col-sm-6" style="padding: 0px;">
                      <strong>HA:</strong> <%= l_dilatedretinoscopy_ha %>
                    </div>
                  </div>
                  <div class="row">
                    <strong>At Distance:</strong>  <%= l_dilatedretinoscopy_distance %>
                  </div>
                  <div class="row">
                    <strong>Drug Used:</strong>  <%= l_retinoscopy_drug_used %>
                  </div>
                </div>
              </div>
              <% if l_retinoscopy_comments_counter > 0 %>
                <li><%= l_retinoscopy_comments %></li>
              <% end %>
            <% end %>
            <% if l_retinoscopy_comments_counter > 0 && l_dilatedretinoscopy_counter == 0 %>
              <strong>Retinoscopy comments:</strong>
              <li><%= l_retinoscopy_comments %></li>
            <% end %>

            <% if l_dilatedretinoscopy_pmt_counter > 0 %>
              <strong>PMT:</strong>
              <table class="table table-bordered mb10" width="100%">
                <tbody>
                  <tr>
                    <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                    <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  </tr>
                </tbody>
                <tbody>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedretinoscopy_pmt_sph %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedretinoscopy_pmt_cyl %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedretinoscopy_pmt_axis %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedretinoscopy_pmt_vision %></td>
                  </tr>
                  <tr>
                    <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedretinoscopy_pmt_sph_row3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedretinoscopy_pmt_cyl_row3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedretinoscopy_pmt_axis_row3 %></td>
                    <td style="padding:1px;font-size:11px;text-align:center;"><%= l_dilatedretinoscopy_pmt_vision_row3 %></td>
                  </tr>
                </tbody>
              </table>
            <% end %>

            <% if l_color_vision_counter > 0 %>
                <p style="margin-bottom:0px;"><b>Color Vision:</b> <%= l_color_vision %></p>
            <% end %>

            <% if l_contrastsensitivity_counter > 0 %>
              <p style="margin-bottom:0px;"><b style="<%= heading_font_size %>">Contrast Sensitivity:</b> 
                <% if l_contrastsensitivity.present? %>
                  <%= l_contrastsensitivity %>
                <% end %>
                <% if l_contrastsensitivity_comments.present? %> <br>
                  <span style="display: list-item;margin-left: 4%">
                    Comment: <%= l_contrastsensitivity_comments.html_safe %>
                  </span>
                <% end %>
              </p>
            <% end %>

            <% if l_orthoptics_counter > 0 %>
                <p style="margin-bottom:0px;"><b>Orthoptics:</b> <%= l_orthoptics %></p>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
<style type="text/css">
  .examination_non_tabular {
    margin-bottom:0;
    padding-bottom:0;
    border-bottom:1px solid #ddd;
  }

  .circle {
    border-radius: 50%;
    width: 40px;
    height: 40px;
    box-sizing: border-box;
    border-width: 5px;
    border-style: solid;
    border-color: #888 #aaa #888 #aaa;
    transform: rotate(0deg);
  }

  .centralize {
    margin-top: 35%;
    font-size: 28px;
  }

  .wide {
    width: 100px;
    height: 100px;
  }
  <%# unless params[:action] == "print_opd_record" %>
  .abnormal-highlight{
    color: red;
  }
  <%#end%>

  .red {
    color: red;
  }
</style>
