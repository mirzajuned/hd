<% if opdrecord.send("#{@flag}_refraction_flag") == "1" %>
  <div class="refraction mb5" id="refraction">
    <% refraction_counter = 0 %>
    <% diagram_counter = 0 %>
    <% general_refraction_counter = 0 %>

    <% r_occular_counter = 0 %>
    <% r_tear_film = '' %>
    <% r_lid_margin = '' %>
    <% r_keratometry = '' %>
    <% r_contact_lens_cornea = '' %>
    <% r_contact_lens_conjunctiva = '' %>

    <% r_pgp_counter = 0 %>
    <% r_pgp_op = '' %>
    <% r_pgp_distant_sph = '' %>
    <% r_pgp_distant_cyl = '' %>
    <% r_pgp_distant_axis = '' %>
    <% r_pgp_distant_vision = '' %>
    <% r_pgp_near_sph = '' %>
    <% r_pgp_near_cyl = '' %>
    <% r_pgp_near_axis = '' %>
    <% r_pgp_near_vision = '' %>
    <% r_pgp_typeoflens = '' %>
    <% r_pgp_comments_counter = 0 %>
    <% r_pgp_comments = "" %>

    <% r_pgp_counter2 = 0 %>
    <% r_pgp_op2 = '' %>
    <% r_pgp_distant_sph2 = '' %>
    <% r_pgp_distant_cyl2 = '' %>
    <% r_pgp_distant_axis2 = '' %>
    <% r_pgp_distant_vision2 = '' %>
    <% r_pgp_near_sph2 = '' %>
    <% r_pgp_near_cyl2 = '' %>
    <% r_pgp_near_axis2 = '' %>
    <% r_pgp_near_vision2 = '' %>
    <% r_pgp_typeoflens2 = '' %>
    <% r_pgp_comments_counter2 = 0 %>
    <% r_pgp_comments2 = "" %>

    <% r_pgp_counter3 = 0 %>
    <% r_pgp_op3 = '' %>
    <% r_pgp_distant_sph3 = '' %>
    <% r_pgp_distant_cyl3 = '' %>
    <% r_pgp_distant_axis3 = '' %>
    <% r_pgp_distant_vision3 = '' %>
    <% r_pgp_near_sph3 = '' %>
    <% r_pgp_near_cyl3 = '' %>
    <% r_pgp_near_axis3 = '' %>
    <% r_pgp_near_vision3 = '' %>
    <% r_pgp_typeoflens3 = '' %>
    <% r_pgp_comments_counter3 = 0 %>
    <% r_pgp_comments3 = "" %>

    <% r_trial_counter = 0 %>
    <% r_trial_1 = '' %>
    <% r_trial_2 = '' %>
    <% r_trial_3 = '' %>

    <% r_fit_counter = 0 %>
    <% r_fluoresce = '' %>
    <% r_blink = '' %>
    <% r_contact_lens_pupil = '' %>
    <% r_vision = '' %>
    <% r_fit_comments = '' %>

    <% r_over_reaction_counter = 0 %>
    <% r_sphere = '' %>
    <% r_cylinder = '' %>
    <% r_axis = '' %>
    <% r_vision_over_reaction = '' %>
    <% r_over_reaction_comments = '' %>

    <% r_virtual_counter = 0 %>
    <% r_virtual_current_distance = '' %>
    <% r_virtual_current_intermediate = '' %>
    <% r_virtual_current_near = '' %>
    <% r_virtual_current_special = '' %>
    <% r_virtual_planned_distance = '' %>
    <% r_virtual_planned_intermediate = '' %>
    <% r_virtual_planned_near = '' %>
    <% r_virtual_planned_special = '' %>

    <% r_trial_box_counter = 0 %>
    <% r_distance_trial1_device = '' %>
    <% r_distance_trial1_vision = '' %>
    <% r_distance_trial1_activity = '' %>
    <% r_distance_trial1_remark = '' %>
    <% r_distance_trial2_device = '' %>
    <% r_distance_trial2_vision = '' %>
    <% r_distance_trial2_activity = '' %>
    <% r_distance_trial2_remark = '' %>
    <% r_distance_trial3_device = '' %>
    <% r_distance_trial3_vision = '' %>
    <% r_distance_trial3_activity = '' %>
    <% r_distance_trial3_remark = '' %>
    <% r_distance_trial4_device = '' %>
    <% r_distance_trial4_vision = '' %>
    <% r_distance_trial4_activity = '' %>
    <% r_distance_trial4_remark = '' %>

    <% r_device_counter = 0 %>
    <% r_device_1 = '' %>
    <% r_device_2 = '' %>
    <% r_device_3 = '' %>

    <% r_lva_problem_counter = 0 %>
    <% r_problem_pgbv = '' %>
    <% r_problem_aa = '' %>
    <% r_problem_txcm = '' %>
    <% r_problem_ctl = '' %>
    <% r_problem_cvl = '' %>
    <% r_problem_ardm = '' %>
    <% r_problem_med = '' %>
    <% r_problem_nsg = '' %>
    <% r_problem_bvhv = '' %>
    <% r_problem_ctk = '' %>
    <% r_problem_smbsb = '' %>
    <% r_problem_nsg2 = '' %>
    <% r_problem_lpv = '' %>
    <% r_problem_gorp = '' %>
    <% r_problem_mfsis = '' %>
    <% r_problem_sntc = '' %>

    <% r_contact_lens_counter = 0 %>
    <% r_contact_lens_keratometry = '' %>
    <% r_contact_lens_lid_margin = '' %>
    <% r_exam_contact_lens_conjuctiva = '' %>
    <% r_exam_contact_lens_cornea = '' %>
    <% r_contact_lens_tear_film = '' %>
    <% r_contact_lens_surface = '' %>
    <% r_contact_lens_coverage = '' %>
    <% r_contact_lens_blink = '' %>
    <% r_contact_lens_lag = '' %>
    <% r_contact_lens_push_up = '' %>
    <% r_contact_lens_rotation = '' %>
    <% r_contact_lens_sphere_test = '' %>
    <% r_contact_lens_cylinder = '' %>
    <% r_contact_lens_axis = '' %>
    <% r_contact_lens_vision = '' %>
    <% r_contact_lens_company = '' %>
    <% r_contact_lens_brand = '' %>
    <% r_contact_lens_color = '' %>

    <% r_color_vision_counter = 0 %>
    <% r_orthoptics_counter = 0 %>
    <% orthoptics_heading_counter = 0 %>
    <% r_contrastsensitivity_counter = 0 %>

    <% r_objectivecomments_counter = 0 %>
    <% r_objectivecomments_op = '' %>
    <% r_objectivecomments_comments_op = '' %>
    <% r_objectivecomments = '' %>


    <% if @current_facility.country_id != "VN_254" %>
      <% if opdrecord.read_attribute(:r_tear_film).present? %>
        <% r_tear_film = "Tear Film: #{opdrecord.read_attribute(:r_tear_film)}" %>
        <% r_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_lid_margin).present? %>
        <% r_lid_margin = "Lid Margin: #{opdrecord.read_attribute(:r_lid_margin)}" %>
        <% r_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_keratometry).present? %>
        <% r_keratometry = "Keratometry: #{opdrecord.read_attribute(:r_keratometry)}" %>
        <% r_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_contact_lens_cornea).present? %>
        <% r_contact_lens_cornea = "Cornea: #{opdrecord.read_attribute(:r_contact_lens_cornea)}" %>
        <% r_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_contact_lens_conjunctiva).present? %>
        <% r_contact_lens_conjunctiva = "Conjuctiva: #{opdrecord.read_attribute(:r_contact_lens_conjunctiva)}" %>
        <% r_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.read_attribute(:r_trial_1).present? %>
        <% r_trial_1 = "Trial 1: #{opdrecord.read_attribute(:r_trial_1)}" %>
        <% r_trial_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_trial_2).present? %>
        <% r_trial_2 = "Trial 2: #{opdrecord.read_attribute(:r_trial_2)}" %>
        <% r_trial_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_trial_3).present? %>
        <% r_trial_3 = "Trial 3: #{opdrecord.read_attribute(:r_trial_3)}" %>
        <% r_trial_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.read_attribute(:r_fluoresce).present? %>
        <% r_fluoresce = "Fluoresce in Pattern: #{opdrecord.read_attribute(:r_fluoresce)}" %>
        <% r_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_blink).present? %>
        <% r_blink = "Movement With Blink: #{opdrecord.read_attribute(:r_blink)}" %>
        <% r_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_contact_lens_pupil).present? %>
        <% r_contact_lens_pupil = "Pupil Coverage: #{opdrecord.read_attribute(:r_contact_lens_pupil)}" %>
        <% r_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_vision).present? %>
        <% r_vision = "Vision: #{opdrecord.read_attribute(:r_vision)}" %>
        <% r_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_fit_comments).present? %>
        <% r_fit_comments = "Comment: #{opdrecord.read_attribute(:r_fit_comments)}" %>
        <% r_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.read_attribute(:r_sphere).present? %>
        <% r_sphere = "Sphere: #{opdrecord.read_attribute(:r_sphere)}" %>
        <% r_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_cylinder).present? %>
        <% r_cylinder = "Cylinder: #{opdrecord.read_attribute(:r_cylinder)}" %>
        <% r_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_axis).present? %>
        <% r_axis = "Axis: #{opdrecord.read_attribute(:r_axis)}" %>
        <% r_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_vision_over_reaction).present? %>
        <% r_vision_over_reaction = "Vision: #{opdrecord.read_attribute(:r_vision_over_reaction)}" %>
        <% r_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_over_reaction_comments).present? %>
        <% r_over_reaction_comments = "Comment: #{opdrecord.read_attribute(:r_over_reaction_comments)}" %>
        <% r_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.r_virtual_current_distance.present? %>
        <% r_virtual_current_distance = opdrecord.read_attribute(:r_virtual_current_distance).to_s %>
        <% r_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_virtual_current_distance = '--' %>
      <% end %>
      <% if opdrecord.r_virtual_current_intermediate.present? %>
        <% r_virtual_current_intermediate = opdrecord.read_attribute(:r_virtual_current_intermediate).to_s %>
        <% r_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_virtual_current_intermediate = '--' %>
      <% end %>
      <% if opdrecord.r_virtual_current_near.present? %>
        <% r_virtual_current_near = opdrecord.read_attribute(:r_virtual_current_near).to_s %>
        <% r_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_virtual_current_near = '--' %>
      <% end %>
      <% if opdrecord.r_virtual_current_special.present? %>
        <% r_virtual_current_special = opdrecord.read_attribute(:r_virtual_current_special).to_s %>
        <% r_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_virtual_current_special = '--' %>
      <% end %>
      <% if opdrecord.r_virtual_planned_distance.present? %>
        <% r_virtual_planned_distance = opdrecord.read_attribute(:r_virtual_planned_distance).to_s %>
        <% r_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_virtual_planned_distance = '--' %>
      <% end %>
      <% if opdrecord.r_virtual_planned_intermediate.present? %>
        <% r_virtual_planned_intermediate = opdrecord.read_attribute(:r_virtual_planned_intermediate).to_s %>
        <% r_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_virtual_planned_intermediate = '--' %>
      <% end %>
      <% if opdrecord.r_virtual_planned_near.present? %>
        <% r_virtual_planned_near = opdrecord.read_attribute(:r_virtual_planned_near).to_s %>
        <% r_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_virtual_planned_near = '--' %>
      <% end %>
      <% if opdrecord.r_virtual_planned_special.present? %>
        <% r_virtual_planned_special = opdrecord.read_attribute(:r_virtual_planned_special).to_s %>
        <% r_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_virtual_planned_special = '--' %>
      <% end %>

      <% if opdrecord.r_distance_trial1_device.present? %>
        <% r_distance_trial1_device = opdrecord.read_attribute(:r_distance_trial1_device).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial1_device = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial1_vision.present? %>
        <% r_distance_trial1_vision = opdrecord.read_attribute(:r_distance_trial1_vision).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial1_vision = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial1_activity.present? %>
        <% r_distance_trial1_activity = opdrecord.read_attribute(:r_distance_trial1_activity).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial1_activity = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial1_remark.present? %>
        <% r_distance_trial1_remark = opdrecord.read_attribute(:r_distance_trial1_remark).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial1_remark = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial2_device.present? %>
        <% r_distance_trial2_device = opdrecord.read_attribute(:r_distance_trial2_device).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial2_device = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial2_vision.present? %>
        <% r_distance_trial2_vision = opdrecord.read_attribute(:r_distance_trial2_vision).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial2_vision = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial2_activity.present? %>
        <% r_distance_trial2_activity = opdrecord.read_attribute(:r_distance_trial2_activity).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial2_activity = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial2_remark.present? %>
        <% r_distance_trial2_remark = opdrecord.read_attribute(:r_distance_trial2_remark).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial2_remark = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial3_device.present? %>
        <% r_distance_trial3_device = opdrecord.read_attribute(:r_distance_trial3_device).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial3_device = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial3_vision.present? %>
        <% r_distance_trial3_vision = opdrecord.read_attribute(:r_distance_trial3_vision).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial3_vision = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial3_activity.present? %>
        <% r_distance_trial3_activity = opdrecord.read_attribute(:r_distance_trial3_activity).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial3_activity = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial3_remark.present? %>
        <% r_distance_trial3_remark = opdrecord.read_attribute(:r_distance_trial3_remark).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial3_remark = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial4_device.present? %>
        <% r_distance_trial4_device = opdrecord.read_attribute(:r_distance_trial4_device).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial4_device = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial4_vision.present? %>
        <% r_distance_trial4_vision = opdrecord.read_attribute(:r_distance_trial4_vision).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial4_vision = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial4_activity.present? %>
        <% r_distance_trial4_activity = opdrecord.read_attribute(:r_distance_trial4_activity).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial4_activity = '--' %>
      <% end %>
      <% if opdrecord.r_distance_trial4_remark.present? %>
        <% r_distance_trial4_remark = opdrecord.read_attribute(:r_distance_trial4_remark).to_s %>
        <% r_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_distance_trial4_remark = '--' %>
      <% end %>

      <% if opdrecord.read_attribute(:r_device_1).present? %>
        <% r_device_1 = "Trial 1: #{opdrecord.read_attribute(:r_device_1)}" %>
        <% r_device_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_device_2).present? %>
        <% r_device_2 = "Trial 2: #{opdrecord.read_attribute(:r_device_2)}" %>
        <% r_device_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_device_3).present? %>
        <% r_device_3 = "Trial 3: #{opdrecord.read_attribute(:r_device_3)}" %>
        <% r_device_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.r_problem_pgbv.present? %>
        <% r_problem_pgbv = opdrecord.read_attribute(:r_problem_pgbv).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_aa.present? %>
        <% r_problem_aa = opdrecord.read_attribute(:r_problem_aa).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_txcm.present? %>
        <% r_problem_txcm = opdrecord.read_attribute(:r_problem_txcm).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_ctl.present? %>
        <% r_problem_ctl = opdrecord.read_attribute(:r_problem_ctl).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_cvl.present? %>
        <% r_problem_cvl = opdrecord.read_attribute(:r_problem_cvl).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_ardm.present? %>
        <% r_problem_ardm = opdrecord.read_attribute(:r_problem_ardm).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_med.present? %>
        <% r_problem_med = opdrecord.read_attribute(:r_problem_med).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_nsg.present? %>
        <% r_problem_nsg = opdrecord.read_attribute(:r_problem_nsg).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_bvhv.present? %>
        <% r_problem_bvhv = opdrecord.read_attribute(:r_problem_bvhv).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_ctk.present? %>
        <% r_problem_ctk = opdrecord.read_attribute(:r_problem_ctk).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_smbsb.present? %>
        <% r_problem_smbsb = opdrecord.read_attribute(:r_problem_smbsb).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_nsg2.present? %>
        <% r_problem_nsg2 = opdrecord.read_attribute(:r_problem_nsg2).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_lpv.present? %>
        <% r_problem_lpv = opdrecord.read_attribute(:r_problem_lpv).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_gorp.present? %>
        <% r_problem_gorp = opdrecord.read_attribute(:r_problem_gorp).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_mfsis.present? %>
        <% r_problem_mfsis = opdrecord.read_attribute(:r_problem_mfsis).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_problem_sntc.present? %>
        <% r_problem_sntc = opdrecord.read_attribute(:r_problem_sntc).to_s %>
        <% r_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.r_autorefraction_dry_sph.present? %>
        <% r_autorefraction_dry_sph = opdrecord.read_attribute(:r_autorefraction_dry_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dry_cyl.present? %>
        <% r_autorefraction_dry_cyl = opdrecord.read_attribute(:r_autorefraction_dry_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dry_axis.present? %>
        <% r_autorefraction_dry_axis = opdrecord.read_attribute(:r_autorefraction_dry_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dry_axis = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated1_sph.present? %>
        <% r_autorefraction_dilated1_sph = opdrecord.read_attribute(:r_autorefraction_dilated1_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated1_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated1_cyl.present? %>
        <% r_autorefraction_dilated1_cyl = opdrecord.read_attribute(:r_autorefraction_dilated1_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated1_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated1_axis.present? %>
        <% r_autorefraction_dilated1_axis = opdrecord.read_attribute(:r_autorefraction_dilated1_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated1_axis = '--' %>
      <% end %>

      <% if opdrecord.r_autorefraction_dilated2_sph.present? %>
        <% r_autorefraction_dilated2_sph = opdrecord.read_attribute(:r_autorefraction_dilated2_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated2_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated2_cyl.present? %>
        <% r_autorefraction_dilated2_cyl = opdrecord.read_attribute(:r_autorefraction_dilated2_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated2_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated2_axis.present? %>
        <% r_autorefraction_dilated2_axis = opdrecord.read_attribute(:r_autorefraction_dilated2_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated2_axis = '--' %>
      <% end %>

      <% if opdrecord.r_autorefraction_dilated3_sph.present? %>
        <% r_autorefraction_dilated3_sph = opdrecord.read_attribute(:r_autorefraction_dilated3_sph).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated3_sph = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated3_cyl.present? %>
        <% r_autorefraction_dilated3_cyl = opdrecord.read_attribute(:r_autorefraction_dilated3_cyl).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated3_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_autorefraction_dilated3_axis.present? %>
        <% r_autorefraction_dilated3_axis = opdrecord.read_attribute(:r_autorefraction_dilated3_axis).to_s %>
        <% r_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_autorefraction_dilated3_axis = '--' %>
      <% end %>

      <% if opdrecord.r_pgp_distant_sph.present? %>
        <% r_pgp_distant_sph = opdrecord.read_attribute(:r_pgp_distant_sph).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_sph = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_cyl.present? %>
        <% r_pgp_distant_cyl = opdrecord.read_attribute(:r_pgp_distant_cyl).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_axis.present? %>
        <% r_pgp_distant_axis = opdrecord.read_attribute(:r_pgp_distant_axis).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_axis = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_vision.present? %>
        <% r_pgp_distant_vision = opdrecord.read_attribute(:r_pgp_distant_vision).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_vision = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_sph.present? %>
        <% r_pgp_near_sph = opdrecord.read_attribute(:r_pgp_near_sph).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_sph = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_cyl.present? %>
        <% r_pgp_near_cyl = opdrecord.read_attribute(:r_pgp_near_cyl).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_cyl = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_axis.present? %>
        <% r_pgp_near_axis = opdrecord.read_attribute(:r_pgp_near_axis).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_axis = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_vision.present? %>
        <% r_pgp_near_vision = opdrecord.read_attribute(:r_pgp_near_vision).to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_vision = '--' %>
      <% end %>
      <% unless opdrecord.r_pgp_typeoflens == "" || opdrecord.r_pgp_typeoflens == nil %>
        <% r_pgp_typeoflens = "Type of Lens- #{opdrecord.read_attribute(:r_pgp_typeoflens)}" %>
        <% r_pgp_op = r_pgp_typeoflens.to_s %>
        <% r_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_pgp_comments.present? %>
        <% r_pgp_comments = r_pgp_comments.to_s %>
        <% r_pgp_comments_counter = r_pgp_comments_counter + 1 %>
        <% r_pgp_comments = "#{opdrecord.read_attribute(:r_pgp_comments)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>

      <% if opdrecord.r_pgp_distant_sph2.present? %>
        <% r_pgp_distant_sph2 = opdrecord.read_attribute(:r_pgp_distant_sph2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_sph2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_cyl2.present? %>
        <% r_pgp_distant_cyl2 = opdrecord.read_attribute(:r_pgp_distant_cyl2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_cyl2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_axis2.present? %>
        <% r_pgp_distant_axis2 = opdrecord.read_attribute(:r_pgp_distant_axis2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_axis2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_vision2.present? %>
        <% r_pgp_distant_vision2 = opdrecord.read_attribute(:r_pgp_distant_vision2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_vision2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_sph2.present? %>
        <% r_pgp_near_sph2 = opdrecord.read_attribute(:r_pgp_near_sph2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_sph2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_cyl2.present? %>
        <% r_pgp_near_cyl2 = opdrecord.read_attribute(:r_pgp_near_cyl2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_cyl2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_axis2.present? %>
        <% r_pgp_near_axis2 = opdrecord.read_attribute(:r_pgp_near_axis2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_axis2 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_vision2.present? %>
        <% r_pgp_near_vision2 = opdrecord.read_attribute(:r_pgp_near_vision2).to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_vision2 = '--' %>
      <% end %>
      <% unless opdrecord.r_pgp_typeoflens2 == "" || opdrecord.r_pgp_typeoflens2 == nil %>
        <% r_pgp_typeoflens2 = "Type of Lens- #{opdrecord.read_attribute(:r_pgp_typeoflens2)}" %>
        <% r_pgp_op2 = r_pgp_typeoflens2.to_s %>
        <% r_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_pgp_comments2.present? %>
        <% r_pgp_comments2 = r_pgp_comments2.to_s %>
        <% r_pgp_comments_counter2 = r_pgp_comments_counter2 + 1 %>
        <% r_pgp_comments2 = "#{opdrecord.read_attribute(:r_pgp_comments2)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>

      <% if opdrecord.r_pgp_distant_sph3.present? %>
        <% r_pgp_distant_sph3 = opdrecord.read_attribute(:r_pgp_distant_sph3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_sph3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_cyl3.present? %>
        <% r_pgp_distant_cyl3 = opdrecord.read_attribute(:r_pgp_distant_cyl3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_cyl3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_axis3.present? %>
        <% r_pgp_distant_axis3 = opdrecord.read_attribute(:r_pgp_distant_axis3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_axis3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_distant_vision3.present? %>
        <% r_pgp_distant_vision3 = opdrecord.read_attribute(:r_pgp_distant_vision3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_distant_vision3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_sph3.present? %>
        <% r_pgp_near_sph3 = opdrecord.read_attribute(:r_pgp_near_sph3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_sph3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_cyl3.present? %>
        <% r_pgp_near_cyl3 = opdrecord.read_attribute(:r_pgp_near_cyl3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_cyl3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_axis3.present? %>
        <% r_pgp_near_axis3 = opdrecord.read_attribute(:r_pgp_near_axis3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_axis3 = '--' %>
      <% end %>
      <% if opdrecord.r_pgp_near_vision3.present? %>
        <% r_pgp_near_vision3 = opdrecord.read_attribute(:r_pgp_near_vision3).to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% r_pgp_near_vision3 = '--' %>
      <% end %>
      <% unless opdrecord.r_pgp_typeoflens3 == "" || opdrecord.r_pgp_typeoflens3 == nil %>
        <% r_pgp_typeoflens3 = "Type of Lens- #{opdrecord.read_attribute(:r_pgp_typeoflens3)}" %>
        <% r_pgp_op3 = r_pgp_typeoflens3.to_s %>
        <% r_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.r_pgp_comments3.present? %>
        <% r_pgp_comments3 = r_pgp_comments3.to_s %>
        <% r_pgp_comments_counter3 = r_pgp_comments_counter3 + 1 %>
        <% r_pgp_comments3 = "#{opdrecord.read_attribute(:r_pgp_comments3)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_objectivecomments.blank? %>
      <% if opdrecord.r_objectivecomments.present? %>
        <% r_objectivecomments = opdrecord.read_attribute(:r_objectivecomments).to_s %>
        <% r_objectivecomments_comments_op = r_objectivecomments.to_s %>
        <% r_objectivecomments_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_color_vision.blank? %>
      <% if opdrecord.r_color_vision.present? %>
        <% r_color_vision = opdrecord.read_attribute(:r_color_vision).to_s %>
        <% r_color_vision_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_orthoptics.blank? %>
      <% if opdrecord.r_orthoptics.present? %>
        <% r_orthoptics = opdrecord.read_attribute(:r_orthoptics).to_s %>
        <% r_orthoptics_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_contrastsensitivity.blank? %>
      <% if opdrecord.r_contrastsensitivity.present? %>
        <% r_contrastsensitivity = opdrecord.read_attribute(:r_contrastsensitivity).to_s %>
        <% r_contrastsensitivity_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.r_contrastsensitivity_comments.blank? %>
      <% if opdrecord.r_contrastsensitivity_comments.present? %>
        <% r_contrastsensitivity_comments = opdrecord.read_attribute(:r_contrastsensitivity_comments).to_s %>
        <% r_contrastsensitivity_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% l_occular_counter = 0 %>
    <% l_tear_film = '' %>
    <% l_lid_margin = '' %>
    <% l_keratometry = '' %>
    <% l_contact_lens_cornea = '' %>
    <% l_contact_lens_conjunctiva = '' %>

    <% l_pgp_counter = 0 %>
    <% l_pgp_op = '' %>
    <% l_pgp_distant_sph = '' %>
    <% l_pgp_distant_cyl = '' %>
    <% l_pgp_distant_axis = '' %>
    <% l_pgp_distant_vision = '' %>
    <% l_pgp_near_sph = '' %>
    <% l_pgp_near_cyl = '' %>
    <% l_pgp_near_axis = '' %>
    <% l_pgp_near_vision = '' %>
    <% l_pgp_typeoflens = '' %>
    <% l_pgp_comments_counter = 0 %>
    <% l_pgp_comments = "" %>

    <% l_pgp_counter2 = 0 %>
    <% l_pgp_op2 = '' %>
    <% l_pgp_distant_sph2 = '' %>
    <% l_pgp_distant_cyl2 = '' %>
    <% l_pgp_distant_axis2 = '' %>
    <% l_pgp_distant_vision2 = '' %>
    <% l_pgp_near_sph2 = '' %>
    <% l_pgp_near_cyl2 = '' %>
    <% l_pgp_near_axis2 = '' %>
    <% l_pgp_near_vision2 = '' %>
    <% l_pgp_typeoflens2 = '' %>
    <% l_pgp_comments_counter2 = 0 %>
    <% l_pgp_comments2 = "" %>

    <% l_pgp_counter3 = 0 %>
    <% l_pgp_op3 = '' %>
    <% l_pgp_distant_sph3 = '' %>
    <% l_pgp_distant_cyl3 = '' %>
    <% l_pgp_distant_axis3 = '' %>
    <% l_pgp_distant_vision3 = '' %>
    <% l_pgp_near_sph3 = '' %>
    <% l_pgp_near_cyl3 = '' %>
    <% l_pgp_near_axis3 = '' %>
    <% l_pgp_near_vision3 = '' %>
    <% l_pgp_typeoflens3 = '' %>
    <% l_pgp_comments_counter3 = 0 %>
    <% l_pgp_comments3 = "" %>

    <% l_trial_counter = 0 %>
    <% l_trial_1 = '' %>
    <% l_trial_2 = '' %>
    <% l_trial_3 = '' %>

    <% l_fit_counter = 0 %>
    <% l_fluoresce = '' %>
    <% l_blink = '' %>
    <% l_contact_lens_pupil = '' %>
    <% l_vision = '' %>
    <% l_fit_comments = '' %>

    <% l_over_reaction_counter = 0 %>
    <% l_sphere = '' %>
    <% l_cylinder = '' %>
    <% l_axis = '' %>
    <% l_vision_over_reaction = '' %>
    <% l_over_reaction_comments = '' %>

    <% l_virtual_counter = 0 %>
    <% l_virtual_current_distance = '' %>
    <% l_virtual_current_intermediate = '' %>
    <% l_virtual_current_near = '' %>
    <% l_virtual_current_special = '' %>
    <% l_virtual_planned_distance = '' %>
    <% l_virtual_planned_intermediate = '' %>
    <% l_virtual_planned_near = '' %>
    <% l_virtual_planned_special = '' %>

    <% l_trial_box_counter = 0 %>
    <% l_distance_trial1_device = '' %>
    <% l_distance_trial1_vision = '' %>
    <% l_distance_trial1_activity = '' %>
    <% l_distance_trial1_remark = '' %>
    <% l_distance_trial2_device = '' %>
    <% l_distance_trial2_vision = '' %>
    <% l_distance_trial2_activity = '' %>
    <% l_distance_trial2_remark = '' %>
    <% l_distance_trial3_device = '' %>
    <% l_distance_trial3_vision = '' %>
    <% l_distance_trial3_activity = '' %>
    <% l_distance_trial3_remark = '' %>
    <% l_distance_trial4_device = '' %>
    <% l_distance_trial4_vision = '' %>
    <% l_distance_trial4_activity = '' %>
    <% l_distance_trial4_remark = '' %>

    <% l_device_counter = 0 %>
    <% l_device_1 = '' %>
    <% l_device_2 = '' %>
    <% l_device_3 = '' %>

    <% l_lva_problem_counter = 0 %>
    <% l_problem_pgbv = '' %>
    <% l_problem_aa = '' %>
    <% l_problem_txcm = '' %>
    <% l_problem_ctl = '' %>
    <% l_problem_cvl = '' %>
    <% l_problem_ardm = '' %>
    <% l_problem_med = '' %>
    <% l_problem_nsg = '' %>
    <% l_problem_bvhv = '' %>
    <% l_problem_ctk = '' %>
    <% l_problem_smbsb = '' %>
    <% l_problem_nsg2 = '' %>
    <% l_problem_lpv = '' %>
    <% l_problem_gorp = '' %>
    <% l_problem_mfsis = '' %>
    <% l_problem_sntc = '' %>

    <% l_contact_lens_counter = 0 %>
    <% l_contact_lens_keratometry = '' %>
    <% l_contact_lens_lid_margin = '' %>
    <% l_exam_contact_lens_conjuctiva = '' %>
    <% l_exam_contact_lens_cornea = '' %>
    <% l_contact_lens_tear_film = '' %>
    <% l_contact_lens_surface = '' %>
    <% l_contact_lens_coverage = '' %>
    <% l_contact_lens_blink = '' %>
    <% l_contact_lens_lag = '' %>
    <% l_contact_lens_push_up = '' %>
    <% l_contact_lens_rotation = '' %>
    <% l_contact_lens_sphere_test = '' %>
    <% l_contact_lens_cylinder = '' %>
    <% l_contact_lens_axis = '' %>
    <% l_contact_lens_vision = '' %>
    <% l_contact_lens_company = '' %>
    <% l_contact_lens_brand = '' %>
    <% l_contact_lens_color = '' %>

    <% l_lens_counter = 0 %>
    <% l_lens_op = '' %>
    <% l_lens_comments_op = '' %>
    <% l_lens_comments = '' %>
    <% l_lens_nature = '' %>
    <% l_lens_position = '' %>
    <% l_lens_size = '' %>
    <% l_lens_grading_no = '' %>
    <% l_lens_grading_nc = '' %>
    <% l_lens_grading_c = '' %>
    <% l_lens_grading_p = '' %>

    <% l_color_vision_counter = 0 %>
    <% l_orthoptics_counter = 0 %>
    <% l_contrastsensitivity_counter = 0 %>

    <% l_objectivecomments_counter = 0 %>
    <% l_objectivecomments_op = '' %>
    <% l_objectivecomments_comments_op = '' %>
    <% l_objectivecomments = '' %>

    <% if @current_facility.country_id != "VN_254" %>
      <% if opdrecord.read_attribute(:l_tear_film).present? %>
        <% l_tear_film = "Tear Film: #{opdrecord.read_attribute(:l_tear_film)}" %>
        <% l_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_lid_margin).present? %>
        <% l_lid_margin = "Lid Margin: #{opdrecord.read_attribute(:l_lid_margin)}" %>
        <% l_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_keratometry).present? %>
        <% l_keratometry = "Keratometry: #{opdrecord.read_attribute(:l_keratometry)}" %>
        <% l_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:r_contact_lens_cornea).present? %>
        <% r_contact_lens_cornea = "Cornea: #{opdrecord.read_attribute(:r_contact_lens_cornea)}" %>
        <% l_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_contact_lens_conjunctiva).present? %>
        <% l_contact_lens_conjunctiva = "Conjuctiva: #{opdrecord.read_attribute(:l_contact_lens_conjunctiva)}" %>
        <% l_occular_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.read_attribute(:l_trial_1).present? %>
        <% l_trial_1 = "Trial 1: #{opdrecord.read_attribute(:l_trial_1)}" %>
        <% l_trial_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_trial_2).present? %>
        <% l_trial_2 = "Trial 2: #{opdrecord.read_attribute(:l_trial_2)}" %>
        <% l_trial_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_trial_3).present? %>
        <% l_trial_3 = "Trial 3: #{opdrecord.read_attribute(:l_trial_3)}" %>
        <% l_trial_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.read_attribute(:l_fluoresce).present? %>
        <% l_fluoresce = "Fluoresce in Pattern: #{opdrecord.read_attribute(:l_fluoresce)}" %>
        <% l_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_blink).present? %>
        <% l_blink = "Movement With Blink: #{opdrecord.read_attribute(:l_blink)}" %>
        <% l_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_contact_lens_pupil).present? %>
        <% l_contact_lens_pupil = "Pupil Coverage: #{opdrecord.read_attribute(:l_contact_lens_pupil)}" %>
        <% l_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_vision).present? %>
        <% l_vision = "Vision: #{opdrecord.read_attribute(:l_vision)}" %>
        <% l_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_fit_comments).present? %>
        <% l_fit_comments = "Comment: #{opdrecord.read_attribute(:l_fit_comments)}" %>
        <% l_fit_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.read_attribute(:l_sphere).present? %>
        <% l_sphere = "Sphere: #{opdrecord.read_attribute(:l_sphere)}" %>
        <% l_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_cylinder).present? %>
        <% l_cylinder = "Cylinder: #{opdrecord.read_attribute(:l_cylinder)}" %>
        <% l_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_axis).present? %>
        <% l_axis = "Axis: #{opdrecord.read_attribute(:l_axis)}" %>
        <% l_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_vision_over_reaction).present? %>
        <% l_vision_over_reaction = "Vision: #{opdrecord.read_attribute(:l_vision_over_reaction)}" %>
        <% l_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_over_reaction_comments).present? %>
        <% l_over_reaction_comments = "Comment: #{opdrecord.read_attribute(:l_over_reaction_comments)}" %>
        <% l_over_reaction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.l_virtual_current_distance.present? %>
        <% l_virtual_current_distance = opdrecord.read_attribute(:l_virtual_current_distance).to_s %>
        <% l_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_virtual_current_distance = '--' %>
      <% end %>
      <% if opdrecord.l_virtual_current_intermediate.present? %>
        <% l_virtual_current_intermediate = opdrecord.read_attribute(:l_virtual_current_intermediate).to_s %>
        <% l_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_virtual_current_intermediate = '--' %>
      <% end %>
      <% if opdrecord.l_virtual_current_near.present? %>
        <% l_virtual_current_near = opdrecord.read_attribute(:l_virtual_current_near).to_s %>
        <% l_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_virtual_current_near = '--' %>
      <% end %>
      <% if opdrecord.l_virtual_current_special.present? %>
        <% l_virtual_current_special = opdrecord.read_attribute(:l_virtual_current_special).to_s %>
        <% l_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_virtual_current_special = '--' %>
      <% end %>
      <% if opdrecord.l_virtual_planned_distance.present? %>
        <% l_virtual_planned_distance = opdrecord.read_attribute(:l_virtual_planned_distance).to_s %>
        <% l_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_virtual_planned_distance = '--' %>
      <% end %>
      <% if opdrecord.l_virtual_planned_intermediate.present? %>
        <% l_virtual_planned_intermediate = opdrecord.read_attribute(:l_virtual_planned_intermediate).to_s %>
        <% l_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_virtual_planned_intermediate = '--' %>
      <% end %>
      <% if opdrecord.l_virtual_planned_near.present? %>
        <% l_virtual_planned_near = opdrecord.read_attribute(:l_virtual_planned_near).to_s %>
        <% l_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_virtual_planned_near = '--' %>
      <% end %>
      <% if opdrecord.l_virtual_planned_special.present? %>
        <% l_virtual_planned_special = opdrecord.read_attribute(:l_virtual_planned_special).to_s %>
        <% l_virtual_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_virtual_planned_special = '--' %>
      <% end %>

      <% if opdrecord.l_distance_trial1_device.present? %>
        <% l_distance_trial1_device = opdrecord.read_attribute(:l_distance_trial1_device).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial1_device = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial1_vision.present? %>
        <% l_distance_trial1_vision = opdrecord.read_attribute(:l_distance_trial1_vision).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial1_vision = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial1_activity.present? %>
        <% l_distance_trial1_activity = opdrecord.read_attribute(:l_distance_trial1_activity).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial1_activity = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial1_remark.present? %>
        <% l_distance_trial1_remark = opdrecord.read_attribute(:l_distance_trial1_remark).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial1_remark = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial2_device.present? %>
        <% l_distance_trial2_device = opdrecord.read_attribute(:l_distance_trial2_device).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial2_device = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial2_vision.present? %>
        <% l_distance_trial2_vision = opdrecord.read_attribute(:l_distance_trial2_vision).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial2_vision = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial2_activity.present? %>
        <% l_distance_trial2_activity = opdrecord.read_attribute(:l_distance_trial2_activity).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial2_activity = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial2_remark.present? %>
        <% l_distance_trial2_remark = opdrecord.read_attribute(:l_distance_trial2_remark).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial2_remark = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial3_device.present? %>
        <% l_distance_trial3_device = opdrecord.read_attribute(:l_distance_trial3_device).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial3_device = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial3_vision.present? %>
        <% l_distance_trial3_vision = opdrecord.read_attribute(:l_distance_trial3_vision).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial3_vision = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial3_activity.present? %>
        <% l_distance_trial3_activity = opdrecord.read_attribute(:l_distance_trial3_activity).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial3_activity = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial3_remark.present? %>
        <% l_distance_trial3_remark = opdrecord.read_attribute(:l_distance_trial3_remark).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial3_remark = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial4_device.present? %>
        <% l_distance_trial4_device = opdrecord.read_attribute(:l_distance_trial4_device).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial4_device = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial4_vision.present? %>
        <% l_distance_trial4_vision = opdrecord.read_attribute(:l_distance_trial4_vision).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial4_vision = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial4_activity.present? %>
        <% l_distance_trial4_activity = opdrecord.read_attribute(:l_distance_trial4_activity).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial4_activity = '--' %>
      <% end %>
      <% if opdrecord.l_distance_trial4_remark.present? %>
        <% l_distance_trial4_remark = opdrecord.read_attribute(:l_distance_trial4_remark).to_s %>
        <% l_trial_box_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_distance_trial4_remark = '--' %>
      <% end %>

      <% if opdrecord.read_attribute(:l_device_1).present? %>
        <% l_device_1 = "Trial 1: #{opdrecord.read_attribute(:l_device_1)}" %>
        <% l_device_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_device_2).present? %>
        <% l_device_2 = "Trial 2: #{opdrecord.read_attribute(:l_device_2)}" %>
        <% l_device_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.read_attribute(:l_device_3).present? %>
        <% l_device_3 = "Trial 3: #{opdrecord.read_attribute(:l_device_3)}" %>
        <% l_device_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.l_problem_pgbv.present? %>
        <% l_problem_pgbv = opdrecord.read_attribute(:l_problem_pgbv).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_aa.present? %>
        <% l_problem_aa = opdrecord.read_attribute(:l_problem_aa).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_txcm.present? %>
        <% l_problem_txcm = opdrecord.read_attribute(:l_problem_txcm).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_ctl.present? %>
        <% l_problem_ctl = opdrecord.read_attribute(:l_problem_ctl).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_cvl.present? %>
        <% l_problem_cvl = opdrecord.read_attribute(:l_problem_cvl).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_ardm.present? %>
        <% l_problem_ardm = opdrecord.read_attribute(:l_problem_ardm).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_med.present? %>
        <% l_problem_med = opdrecord.read_attribute(:l_problem_med).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_nsg.present? %>
        <% l_problem_nsg = opdrecord.read_attribute(:l_problem_nsg).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_bvhv.present? %>
        <% l_problem_bvhv = opdrecord.read_attribute(:l_problem_bvhv).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_ctk.present? %>
        <% l_problem_ctk = opdrecord.read_attribute(:l_problem_ctk).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_smbsb.present? %>
        <% l_problem_smbsb = opdrecord.read_attribute(:l_problem_smbsb).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_nsg2.present? %>
        <% l_problem_nsg2 = opdrecord.read_attribute(:l_problem_nsg2).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_lpv.present? %>
        <% l_problem_lpv = opdrecord.read_attribute(:l_problem_lpv).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_gorp.present? %>
        <% l_problem_gorp = opdrecord.read_attribute(:l_problem_gorp).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_mfsis.present? %>
        <% l_problem_mfsis = opdrecord.read_attribute(:l_problem_mfsis).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_problem_sntc.present? %>
        <% l_problem_sntc = opdrecord.read_attribute(:l_problem_sntc).to_s %>
        <% l_lva_problem_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>

      <% if opdrecord.l_autorefraction_dry_sph.present? %>
        <% l_autorefraction_dry_sph = opdrecord.read_attribute(:l_autorefraction_dry_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dry_cyl.present? %>
        <% l_autorefraction_dry_cyl = opdrecord.read_attribute(:l_autorefraction_dry_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dry_axis.present? %>
        <% l_autorefraction_dry_axis = opdrecord.read_attribute(:l_autorefraction_dry_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dry_axis = '--' %>
      <% end %>

      <% if opdrecord.l_autorefraction_dilated1_sph.present? %>
        <% l_autorefraction_dilated1_sph = opdrecord.read_attribute(:l_autorefraction_dilated1_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated1_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated1_cyl.present? %>
        <% l_autorefraction_dilated1_cyl = opdrecord.read_attribute(:l_autorefraction_dilated1_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated1_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated1_axis.present? %>
        <% l_autorefraction_dilated1_axis = opdrecord.read_attribute(:l_autorefraction_dilated1_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated1_axis = '--' %>
      <% end %>

      <% if opdrecord.l_autorefraction_dilated2_sph.present? %>
        <% l_autorefraction_dilated2_sph = opdrecord.read_attribute(:l_autorefraction_dilated2_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated2_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated2_cyl.present? %>
        <% l_autorefraction_dilated2_cyl = opdrecord.read_attribute(:l_autorefraction_dilated2_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated2_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated2_axis.present? %>
        <% l_autorefraction_dilated2_axis = opdrecord.read_attribute(:l_autorefraction_dilated2_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated2_axis = '--' %>
      <% end %>

      <% if opdrecord.l_autorefraction_dilated3_sph.present? %>
        <% l_autorefraction_dilated3_sph = opdrecord.read_attribute(:l_autorefraction_dilated3_sph).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated3_sph = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated3_cyl.present? %>
        <% l_autorefraction_dilated3_cyl = opdrecord.read_attribute(:l_autorefraction_dilated3_cyl).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated3_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_autorefraction_dilated3_axis.present? %>
        <% l_autorefraction_dilated3_axis = opdrecord.read_attribute(:l_autorefraction_dilated3_axis).to_s %>
        <% l_autorefraction_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_autorefraction_dilated3_axis = '--' %>
      <% end %>

      <% if opdrecord.l_pgp_distant_sph.present? %>
        <% l_pgp_distant_sph = opdrecord.read_attribute(:l_pgp_distant_sph).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_sph = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_cyl.present? %>
        <% l_pgp_distant_cyl = opdrecord.read_attribute(:l_pgp_distant_cyl).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_axis.present? %>
        <% l_pgp_distant_axis = opdrecord.read_attribute(:l_pgp_distant_axis).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_axis = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_vision.present? %>
        <% l_pgp_distant_vision = opdrecord.read_attribute(:l_pgp_distant_vision).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_vision = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_sph.present? %>
        <% l_pgp_near_sph = opdrecord.read_attribute(:l_pgp_near_sph).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_sph = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_cyl.present? %>
        <% l_pgp_near_cyl = opdrecord.read_attribute(:l_pgp_near_cyl).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_cyl = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_axis.present? %>
        <% l_pgp_near_axis = opdrecord.read_attribute(:l_pgp_near_axis).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_axis = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_vision.present? %>
        <% l_pgp_near_vision = opdrecord.read_attribute(:l_pgp_near_vision).to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_vision = '--' %>
      <% end %>
      <% unless opdrecord.l_pgp_typeoflens == "" || opdrecord.l_pgp_typeoflens == nil %>
        <% l_pgp_typeoflens = "Type of Lens- #{opdrecord.read_attribute(:l_pgp_typeoflens)}" %>
        <% l_pgp_op = l_pgp_typeoflens.to_s %>
        <% l_pgp_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_pgp_comments.present? %>
        <% l_pgp_comments = l_pgp_comments.to_s %>
        <% l_pgp_comments_counter = l_pgp_comments_counter + 1 %>
        <% l_pgp_comments = "#{opdrecord.read_attribute(:l_pgp_comments)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>

      <% if opdrecord.l_pgp_distant_sph2.present? %>
        <% l_pgp_distant_sph2 = opdrecord.read_attribute(:l_pgp_distant_sph2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_sph2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_cyl2.present? %>
        <% l_pgp_distant_cyl2 = opdrecord.read_attribute(:l_pgp_distant_cyl2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_cyl2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_axis2.present? %>
        <% l_pgp_distant_axis2 = opdrecord.read_attribute(:l_pgp_distant_axis2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_axis2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_vision2.present? %>
        <% l_pgp_distant_vision2 = opdrecord.read_attribute(:l_pgp_distant_vision2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_vision2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_sph2.present? %>
        <% l_pgp_near_sph2 = opdrecord.read_attribute(:l_pgp_near_sph2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_sph2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_cyl2.present? %>
        <% l_pgp_near_cyl2 = opdrecord.read_attribute(:l_pgp_near_cyl2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_cyl2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_axis2.present? %>
        <% l_pgp_near_axis2 = opdrecord.read_attribute(:l_pgp_near_axis2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_axis2 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_vision2.present? %>
        <% l_pgp_near_vision2 = opdrecord.read_attribute(:l_pgp_near_vision2).to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_vision2 = '--' %>
      <% end %>
      <% unless opdrecord.l_pgp_typeoflens2 == "" || opdrecord.l_pgp_typeoflens2 == nil %>
        <% l_pgp_typeoflens2 = "Type of Lens- #{opdrecord.read_attribute(:l_pgp_typeoflens2)}" %>
        <% l_pgp_op2 = l_pgp_typeoflens2.to_s %>
        <% l_pgp_counter2 += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_pgp_comments2.present? %>
        <% l_pgp_comments2 = l_pgp_comments2.to_s %>
        <% l_pgp_comments_counter2 = l_pgp_comments_counter2 + 1 %>
        <% l_pgp_comments2 = "#{opdrecord.read_attribute(:l_pgp_comments2)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>

      <% if opdrecord.l_pgp_distant_sph3.present? %>
        <% l_pgp_distant_sph3 = opdrecord.read_attribute(:l_pgp_distant_sph3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_sph3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_cyl3.present? %>
        <% l_pgp_distant_cyl3 = opdrecord.read_attribute(:l_pgp_distant_cyl3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_cyl3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_axis3.present? %>
        <% l_pgp_distant_axis3 = opdrecord.read_attribute(:l_pgp_distant_axis3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_axis3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_distant_vision3.present? %>
        <% l_pgp_distant_vision3 = opdrecord.read_attribute(:l_pgp_distant_vision3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_distant_vision3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_sph3.present? %>
        <% l_pgp_near_sph3 = opdrecord.read_attribute(:l_pgp_near_sph3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_sph3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_cyl3.present? %>
        <% l_pgp_near_cyl3 = opdrecord.read_attribute(:l_pgp_near_cyl3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_cyl3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_axis3.present? %>
        <% l_pgp_near_axis3 = opdrecord.read_attribute(:l_pgp_near_axis3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_axis3 = '--' %>
      <% end %>
      <% if opdrecord.l_pgp_near_vision3.present? %>
        <% l_pgp_near_vision3 = opdrecord.read_attribute(:l_pgp_near_vision3).to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% else %>
        <% l_pgp_near_vision3 = '--' %>
      <% end %>
      <% unless opdrecord.l_pgp_typeoflens3 == "" || opdrecord.l_pgp_typeoflens3 == nil %>
        <% l_pgp_typeoflens3 = "Type of Lens- #{opdrecord.read_attribute(:l_pgp_typeoflens3)}" %>
        <% l_pgp_op3 = l_pgp_typeoflens3.to_s %>
        <% l_pgp_counter3 += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
      <% if opdrecord.l_pgp_comments3.present? %>
        <% l_pgp_comments3 = l_pgp_comments3.to_s %>
        <% l_pgp_comments_counter3 = l_pgp_comments_counter3 + 1 %>
        <% l_pgp_comments3 = "#{opdrecord.read_attribute(:l_pgp_comments3)}" %>
        <% refraction_counter = refraction_counter + 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_objectivecomments.blank? %>
      <% if opdrecord.l_objectivecomments.present? %>
        <% l_objectivecomments = opdrecord.read_attribute(:l_objectivecomments).to_s %>
        <% l_objectivecomments_comments_op = l_objectivecomments.to_s %>
        <% l_objectivecomments_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_color_vision.blank? %>
      <% if opdrecord.l_color_vision.present? %>
        <% l_color_vision = opdrecord.read_attribute(:l_color_vision).to_s %>
        <% l_color_vision_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_orthoptics.blank? %>
      <% if opdrecord.l_orthoptics.present? %>
        <% l_orthoptics = opdrecord.read_attribute(:l_orthoptics).to_s %>
        <% l_orthoptics_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_contrastsensitivity.blank? %>
      <% if opdrecord.l_contrastsensitivity.present? %>
        <% l_contrastsensitivity = opdrecord.read_attribute(:l_contrastsensitivity).to_s %>
        <% l_contrastsensitivity_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>

    <% unless opdrecord.l_contrastsensitivity_comments.blank? %>
      <% if opdrecord.l_contrastsensitivity_comments.present? %>
        <% l_contrastsensitivity_comments = opdrecord.read_attribute(:l_contrastsensitivity_comments).to_s %>
        <% l_contrastsensitivity_counter += 1 %>
        <% refraction_counter += 1 %>
      <% end %>
    <% end %>


    <% if refraction_counter > 0 || general_refraction_counter > 0 || opdrecord.r_local_examination_normal == "normal" || opdrecord.l_local_examination_normal == "normal" || orthoptics_heading_counter > 0 %>
      <div class="row mb5">
        <strong style="<%= heading_font_size %>">REFRACTION</strong>
        <% if mail_job == false %>
          <% if params[:action] != "print_opd_record" || diagram_counter > 0 %><% end %>
        <% end %>
        <div class="summary-line-border"></div>
      </div>
      <div class="row <%= 'print_text_font_size' if  @print_setting %>" style="<%= text_font_size %>">
        <% if general_refraction_counter > 0 || opdrecord.r_local_examination_normal == "normal" || opdrecord.l_local_examination_normal == "normal" %>
          <div class="col-md-6 col-sm-6">
            <div class="text-center" style="background-color:#ddd;">R/OD</div>
          </div><!-- col-md-6  -->
          <div class="col-md-6 col-sm-6">
            <div class="text-center" style="background-color:#ddd;">L/OS</div>
          </div><!-- col-md-6  -->
        <% end %>
        <div class="col-md-6 col-sm-6">
          <% if r_occular_counter > 0 %>
            <strong>Occular Assessment:</strong> <%= r_tear_film %> | <%= r_lid_margin %> | <%= r_keratometry %> | <%= r_contact_lens_cornea %> | <%= r_contact_lens_conjunctiva %>
            <br>
          <% end %>

          <% if [r_pgp_counter + l_pgp_counter + r_pgp_comments_counter + l_pgp_comments_counter, r_pgp_counter2 + l_pgp_counter2 + r_pgp_comments_counter2 + l_pgp_comments_counter2, r_pgp_counter3 + l_pgp_counter3 + r_pgp_comments_counter3 + l_pgp_comments_counter3].reject { |r_pgp| r_pgp == 0 }.count > 1 %>
            <% show_pgp_counter = true %>
          <% end %>
          <% show_pgp_no = 1 %>
          <% if r_pgp_counter > 0 || l_pgp_counter > 0 %>
            <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>&nbsp;<%= r_pgp_op %>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
                <tr>
                  <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                </tr>
              </tbody>
              <tbody>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_sph %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_cyl %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_axis %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_vision %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_sph %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_cyl %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_axis %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_vision %></td>
                </tr>
              </tbody>
            </table>
            <% if r_pgp_comments_counter > 0 || l_pgp_comments_counter > 0  %>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= r_pgp_comments %></span>
              </div>
            <% end %>
            <% show_pgp_no += 1 %>
          <% elsif (r_pgp_comments_counter > 0 && r_pgp_counter == 0) || ( l_pgp_comments_counter > 0 && l_pgp_counter == 0) %>
            <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>
            <div style="font-size: 12px;">
              <strong>Comment :</strong>
              <span><%= r_pgp_comments %></span>
            </div>
            <% show_pgp_no += 1 %>
          <% end %>
          <% if r_pgp_counter2 > 0 || l_pgp_counter2 > 0 %>
            <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>&nbsp;<%= r_pgp_op2 %>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
                <tr>
                  <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                </tr>
              </tbody>
              <tbody>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_sph2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_cyl2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_axis2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_vision2 %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_sph2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_cyl2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_axis2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_vision2 %></td>
                </tr>
              </tbody>
            </table>
              <% if r_pgp_comments_counter2 > 0 || l_pgp_comments_counter2 > 0  %>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= r_pgp_comments2 %></span>
              </div>
            <% end %>
            <% show_pgp_no += 1 %>
          <% elsif (r_pgp_comments_counter2 > 0 && r_pgp_counter2 == 0) || ( l_pgp_comments_counter2 > 0 && l_pgp_counter2 == 0) %>
            <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>
            <div style="font-size: 12px;">
              <strong>Comment :</strong>
              <span><%= r_pgp_comments2 %></span>
            </div>
            <% show_pgp_no += 1 %>
          <% end %>
          <% if r_pgp_counter3 > 0 || l_pgp_counter3 > 0 %>
            <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>&nbsp;<%= r_pgp_op3 %>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
                <tr>
                  <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                </tr>
              </tbody>
              <tbody>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_sph3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_cyl3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_axis3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_distant_vision3 %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_sph3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_cyl3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_axis3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_pgp_near_vision3 %></td>
                </tr>
              </tbody>
            </table>
            <% if r_pgp_comments_counter3 > 0 || l_pgp_comments_counter3 > 0  %>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= r_pgp_comments3 %></span>
              </div>
            <% end %>
            <% show_pgp_no += 1 %>
          <% elsif (r_pgp_comments_counter3 > 0 && r_pgp_counter3 == 0) || (l_pgp_comments_counter3 > 0 && l_pgp_counter3 == 0) %>
            <strong>PGP <%= show_pgp_no if show_pgp_counter %>:</strong>
            <div style="font-size: 12px;">
              <strong>Comment :</strong>
              <span><%= r_pgp_comments3 %></span>
            </div>
            <% show_pgp_no += 1 %>
          <% end %>

          <% if r_trial_counter > 0 %>
            <strong>Trial Lens Detail:</strong> <%= r_trial_1 %><% if r_trial_2.present? %> | <% end %><%= r_trial_2 %><% if r_trial_3.present? %> | <% end %><%= r_trial_3 %>
            <br>
          <% end %>

          <% if r_fit_counter > 0 %>
            <strong>Fit Assessment:</strong> <%= r_fluoresce %><% if r_blink.present? %> | <% end %><%= r_blink %><% if r_contact_lens_pupil.present? %> | <% end %><%= r_contact_lens_pupil %><% if r_vision.present? %> | <% end %><%= r_vision %><br> <%= r_fit_comments %>
            <br>
          <% end %>

          <% if r_over_reaction_counter > 0 %>
            <strong>Over-Reaction Acceptance:</strong> <%= r_sphere %><% if r_cylinder.present? %> | <% end %><%= r_cylinder %><% if r_axis.present? %> | <% end %><%= r_axis %><% if r_vision_over_reaction.present? %> | <% end %><%= r_vision_over_reaction %> <br> <%= r_over_reaction_comments %>
            <br>
          <% end %>

          <% if r_virtual_counter > 0 %>
            <strong>Virtual Needs:</strong>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
              <tr>
                <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Distance</th>
                <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Intermediate</th>
                <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Near</th>
                <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Special</th>
              </tr>
              </tbody>
              <tbody>
              <tr>
                <td style="padding:1px;font-size:11px;text-align:center;">Current</td>
                <td style="padding:1px;font-size:11px;text-align:center;"><%= r_virtual_current_distance %></td>
                <td style="padding:1px;font-size:11px;text-align:center;"><%= r_virtual_current_intermediate %></td>
                <td style="padding:1px;font-size:11px;text-align:center;"><%= r_virtual_current_near %></td>
                <td style="padding:1px;font-size:11px;text-align:center;"><%= r_virtual_current_special %></td>
              </tr>
              <tr>
                <td style="padding:1px;font-size:11px;text-align:center;">Planned</td>
                <td style="padding:1px;font-size:11px;text-align:center;"><%= r_virtual_planned_distance %></td>
                <td style="padding:1px;font-size:11px;text-align:center;"><%= r_virtual_planned_intermediate %></td>
                <td style="padding:1px;font-size:11px;text-align:center;"><%= r_virtual_planned_near %></td>
                <td style="padding:1px;font-size:11px;text-align:center;"><%= r_virtual_planned_special %></td>
              </tr>
              </tbody>
            </table>
          <% end %>

          <% if r_trial_box_counter > 0 %>
            <strong>Distance:</strong>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
              <tr>
                <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Deivce</th>
                <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                <th width="15%" style="padding:1px;font-size:11px;text-align:center;">For Activity</th>
                <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Remarks</th>
              </tr>
              </tbody>
              <tbody>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Trial 1</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial1_device %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial1_vision %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial1_activity %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial1_remark %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Trial 2</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial2_device %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial2_vision %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial2_activity %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial2_remark %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Trial 3</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial3_device %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial3_vision %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial3_activity %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial3_remark %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Trial 4</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial4_device %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial4_vision %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial4_activity %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= r_distance_trial4_remark %></td>
                </tr>
              </tbody>
            </table>
          <% end %>

          <% if r_device_counter > 0 %>
            <strong>Final Recommendation:</strong> <%= r_device_1 %><% if r_device_2.present? %> | <% end %><%= r_device_2 %><% if r_device_3.present? %> | <% end %><%= r_device_3 %>
            <br>
          <% end %>

          <% if r_color_vision_counter > 0 %>
            <p style="margin-bottom:0px;"><b>Color Vision:</b> <%= r_color_vision %></p>
          <% end %>

          <% if r_contrastsensitivity_counter > 0 %>
            <p style="margin-bottom:0px;"><b style="<%= heading_font_size %>">Contrast Sensitivity:</b> 
              <% if r_contrastsensitivity.present? %>
                <%= r_contrastsensitivity %>
              <% end %>
              <% if r_contrastsensitivity_comments.present? %> <br>
                <span style="display: list-item;margin-left: 4%">
                  Comment: <%= r_contrastsensitivity_comments.html_safe %>
                </span>
              <% end %>
            </p>
          <% end %>

          <% if r_orthoptics_counter > 0 %>
            <p style="margin-bottom:0px;"><b>Orthoptics:</b> <%= r_orthoptics %></p>
          <% end %>
        </div>
        <div class="col-md-6 col-sm-6">
          <% if l_occular_counter > 0 %>
            <strong>Occular Assessment:</strong> <%= l_tear_film %> | <%= l_lid_margin %> | <%= l_keratometry %> | <%= l_contact_lens_cornea %> | <%= l_contact_lens_conjunctiva %>
            <br>
          <% end %>

          <% if [l_pgp_counter + r_pgp_counter + l_pgp_comments_counter + r_pgp_comments_counter, l_pgp_counter2 + r_pgp_counter2 + l_pgp_comments_counter2 + r_pgp_comments_counter2, l_pgp_counter3 + r_pgp_counter3 + l_pgp_comments_counter3 + r_pgp_comments_counter3].reject { |l_pgp| l_pgp == 0 }.count > 1 %>
            <% show_l_pgp_counter = true %>
          <% end %>
          <% show_l_pgp_no = 1 %>
          <% if l_pgp_counter > 0 || r_pgp_counter > 0 %>
            <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>&nbsp;<%= l_pgp_op %>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
                <tr>
                  <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                </tr>
              </tbody>
              <tbody>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_sph %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_cyl %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_axis %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_vision %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_sph %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_cyl %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_axis %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_vision %></td>
                </tr>
              </tbody>
            </table>
            <% if l_pgp_comments_counter > 0 || r_pgp_comments_counter > 0  %>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= l_pgp_comments %></span>
              </div>
            <% end %>
            <% show_l_pgp_no += 1 %>
          <% elsif (l_pgp_comments_counter > 0 && l_pgp_counter == 0) || (r_pgp_comments_counter > 0 && r_pgp_counter == 0) %>
            <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>
            <div style="font-size: 12px;">
              <strong>Comment :</strong>
              <span><%= l_pgp_comments %></span>
            </div>
            <% show_l_pgp_no += 1 %>
          <% end %>
          <% if l_pgp_counter2 > 0 || r_pgp_counter2 > 0 %>
            <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>&nbsp;<%= l_pgp_op2 %>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
                <tr>
                  <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                </tr>
              </tbody>
              <tbody>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_sph2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_cyl2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_axis2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_vision2 %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_sph2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_cyl2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_axis2 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_vision2 %></td>
                </tr>
              </tbody>
            </table>
            <% if l_pgp_comments_counter2 > 0 || r_pgp_comments_counter2 > 0  %>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= l_pgp_comments2 %></span>
              </div>
            <% end %>
            <% show_l_pgp_no += 1 %>
          <% elsif (l_pgp_comments_counter2 > 0 && l_pgp_counter2 == 0) || (r_pgp_comments_counter2 > 0 && r_pgp_counter2 == 0) %>
            <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>
            <div style="font-size: 12px;">
              <strong>Comment :</strong>
              <span><%= l_pgp_comments2 %></span>
            </div>
            <% show_l_pgp_no += 1 %>
          <% end %>
          <% if l_pgp_counter3 > 0 || r_pgp_counter3 > 0 %>
            <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>&nbsp;<%= l_pgp_op3 %>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
                <tr>
                  <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Sph</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Cyl</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Axis</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                </tr>
              </tbody>
              <tbody>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Distant</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_sph3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_cyl3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_axis3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_distant_vision3 %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Near</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_sph3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_cyl3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_axis3 %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_pgp_near_vision3 %></td>
                </tr>
              </tbody>
            </table>
            <% if l_pgp_comments_counter3 > 0 || r_pgp_comments_counter3 > 0  %>
              <div style="font-size: 12px;">
                <strong>Comment :</strong>
                <span><%= l_pgp_comments3 %></span>
              </div>
            <% end %>
          <% elsif (l_pgp_comments_counter3 > 0 && l_pgp_counter3 == 0) || (r_pgp_comments_counter3 > 0 && r_pgp_counter3 == 0) %>
            <strong>PGP <%= show_l_pgp_no if show_l_pgp_counter %>:</strong>
            <div style="font-size: 12px;">
              <strong>Comment :</strong>
              <span><%= l_pgp_comments3 %></span>
            </div>
            <% show_l_pgp_no += 1 %>
          <% end %>

          <% if l_trial_counter > 0 %>
            <strong>Trial Lens Detail:</strong> <%= l_trial_1 %><% if l_trial_2.present? %> | <% end %><%= l_trial_2 %><% if l_trial_3.present? %> | <% end %><%= l_trial_3 %>
            <br>
          <% end %>

          <% if l_fit_counter > 0 %>
            <strong>Fit Assessment:</strong> <%= l_fluoresce %><% if l_blink.present? %> | <% end %><%= l_blink %><% if l_contact_lens_pupil.present? %> | <% end %><%= l_contact_lens_pupil %><% if l_vision.present? %> | <% end %><%= l_vision %><br> <%= l_fit_comments %>
            <br>
          <% end %>

          <% if l_over_reaction_counter > 0 %>
            <strong>Over-Reaction Acceptance:</strong> <%= l_sphere %><% if l_cylinder.present? %> | <% end %><%= l_cylinder %><% if l_axis.present? %> | <% end %><%= l_axis %><% if l_vision_over_reaction.present? %> | <% end %><%= l_vision_over_reaction %> <br> <%= l_over_reaction_comments %>
            <br>
          <% end %>

          <% if l_virtual_counter > 0 %>
            <strong>Virtual Needs:</strong>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
                <tr>
                  <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Distance</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Intermediate</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Near</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Special</th>
                </tr>
              </tbody>
              <tbody>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Current</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_virtual_current_distance %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_virtual_current_intermediate %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_virtual_current_near %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_virtual_current_special %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Planned</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_virtual_planned_distance %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_virtual_planned_intermediate %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_virtual_planned_near %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_virtual_planned_special %></td>
                </tr>
              </tbody>
            </table>
          <% end %>

          <% if l_trial_box_counter > 0 %>
            <strong>Distance:</strong>
            <table class="table table-bordered mb10" width="100%">
              <tbody>
                <tr>
                  <th width="40%" style="padding:1px;font-size:11px;text-align:center;"></th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Deivce</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Vision</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">For Activity</th>
                  <th width="15%" style="padding:1px;font-size:11px;text-align:center;">Remarks</th>
                </tr>
              </tbody>
              <tbody>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Trial 1</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial1_device %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial1_vision %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial1_activity %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial1_remark %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Trial 2</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial2_device %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial2_vision %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial2_activity %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial2_remark %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Trial 3</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial3_device %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial3_vision %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial3_activity %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial3_remark %></td>
                </tr>
                <tr>
                  <td style="padding:1px;font-size:11px;text-align:center;">Trial 4</td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial4_device %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial4_vision %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial4_activity %></td>
                  <td style="padding:1px;font-size:11px;text-align:center;"><%= l_distance_trial4_remark %></td>
                </tr>
              </tbody>
            </table>
          <% end %>

          <% if l_device_counter > 0 %>
            <strong>Final Recommendation:</strong> <%= l_device_1 %><% if l_device_2.present? %> | <% end %><%= l_device_2 %><% if l_device_3.present? %> | <% end %><%= l_device_3 %>
            <br>
          <% end %>

          <% if l_color_vision_counter > 0 %>
            <p style="margin-bottom:0px;"><b>Color Vision:</b> <%= l_color_vision %></p>
          <% end %>

          <% if l_contrastsensitivity_counter > 0 %>
            <p style="margin-bottom:0px;"><b style="<%= heading_font_size %>">Contrast Sensitivity:</b> 
              <% if l_contrastsensitivity.present? %>
                <%= l_contrastsensitivity %>
              <% end %>
              <% if l_contrastsensitivity_comments.present? %> <br>
                <span style="display: list-item;margin-left: 4%">
                  Comment: <%= l_contrastsensitivity_comments.html_safe %>
                </span>
              <% end %>
            </p>
          <% end %>

          <% if l_orthoptics_counter > 0 %>
            <p style="margin-bottom:0px;"><b>Orthoptics:</b> <%= l_orthoptics %></p>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
<style type="text/css">
  .examination_non_tabular {
    margin-bottom:0;
    padding-bottom:0;
    border-bottom:1px solid #ddd;
  }

  .circle {
    border-radius: 50%;
    width: 40px;
    height: 40px;
    box-sizing: border-box;
    border-width: 5px;
    border-style: solid;
    border-color: #888 #aaa #888 #aaa;
    transform: rotate(0deg);
  }

  .centralize {
    margin-top: 35%;
    font-size: 28px;
  }

  .wide {
    width: 100px;
    height: 100px;
  }
  <%# unless params[:action] == "print_opd_record" %>
  .abnormal-highlight{
    color: red;
  }
  <%#end%>

  .red {
    color: red;
  }
</style>
