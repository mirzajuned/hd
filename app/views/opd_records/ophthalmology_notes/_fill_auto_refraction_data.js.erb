$("#refraction_plus_minus").on("change",function(){
  lasttext.focus();
})

$(".selected-refraction-field").on("focus",function(){
  var sign
  if ($("#refraction_plus_minus").val() == "plus") {
    sign = "plus"
  }
  else {
    sign = "minus"
  }
  $(".refraction-btn").hide()
  if ($(this).hasClass("sph")) {
    $(".refraction-plus-minus").show()
    $(".refraction-sph-"+sign).show()
  }
  if ($(this).hasClass("cyl")) {
    $(".refraction-plus-minus").show()
    $(".refraction-cyl-"+sign).show()
  }
  if ($(this).hasClass("axis")) {
    $(".refraction-axis").show()
  }
})


$(".refraction-btn-class").on("click", function(){
  sometext = $(this).attr("input-value")
  console.log(sometext)
  doinsert_ie(sometext)
  return false;
})

$(".refraction-btn-class-ucva").on("click", function(){
  sometext = $(this).attr("input-value")
  console.log(sometext)
  doinsert_ie(sometext)
  return false;
})

function focusnext() {
  if ($(lasttext).hasClass("r-selected-refraction-field")) {
    side = "r"
    oposite_side = "l"
  }
  else{
    side = "l"
    oposite_side = "r"
  }
  if("<%= ['dry_auto_refraction', 'pmt_auto_refraction'].include?(params[:type]) || params[:type].nil? %>" == 'true'){
    if ($(lasttext).hasClass("dry_sph")) {
      $("."+side+"_fill_autorefraction_dry_cyl").focus()
    }
    if ($(lasttext).hasClass("dry_cyl")) {
      $("."+side+"_fill_autorefraction_dry_axis").focus()
    }
    if ($(lasttext).hasClass("dry1_sph")) {
      $("."+side+"_fill_autorefraction_dry1_cyl").focus()
    }
    if ($(lasttext).hasClass("dry1_cyl")) {
      $("."+side+"_fill_autorefraction_dry1_axis").focus()
    }
    if ($(lasttext).hasClass("dry2_sph")) {
      $("."+side+"_fill_autorefraction_dry2_cyl").focus()
    }
    if ($(lasttext).hasClass("dry2_cyl")) {
      $("."+side+"_fill_autorefraction_dry2_axis").focus()
    }
    if("<%= params[:type].nil? %>" == 'true'){
      if ($(lasttext).hasClass("dry2_axis")) {
        $("."+oposite_side+"_fill_autorefraction_dry_sph").focus()
      }
      if ($(lasttext).hasClass("dry_axis")) {
        $("."+side+"_fill_autorefraction_dry1_sph").focus()
      }
      if ($(lasttext).hasClass("dry1_axis")) {
        $("."+side+"_fill_autorefraction_dry2_sph").focus()
      }
    } else {
      if ($(lasttext).hasClass("dry2_axis")) {
        $("."+oposite_side+"_fill_autorefraction_dry_sph").focus()
      }
      if ($(lasttext).hasClass("dry_axis")) {
        $("."+side+"_fill_autorefraction_dry1_sph").focus()
      }
      if ($(lasttext).hasClass("dry1_axis")) {
        $("."+side+"_fill_autorefraction_dry2_sph").focus()
      }
    }
  }
  if("<%= params[:type] == 'dilated_auto_refraction' || params[:type].nil? %>" == 'true'){
    if ($(lasttext).hasClass("dilated1_sph")) {
      $("."+side+"_fill_autorefraction_dilated1_cyl").focus()
    }
    if ($(lasttext).hasClass("dilated1_cyl")) {
      $("."+side+"_fill_autorefraction_dilated1_axis").focus()
    }
    if ($(lasttext).hasClass("dilated1_axis")) {
      $("."+side+"_fill_autorefraction_dilated2_sph").focus()
    }
    if ($(lasttext).hasClass("dilated2_sph")) {
      $("."+side+"_fill_autorefraction_dilated2_cyl").focus()
    }
    if ($(lasttext).hasClass("dilated2_cyl")) {
      $("."+side+"_fill_autorefraction_dilated2_axis").focus()
    }
    if ($(lasttext).hasClass("dilated2_axis")) {
      $("."+side+"_fill_autorefraction_dilated3_sph").focus()
    }
    if ($(lasttext).hasClass("dilated3_sph")) {
      $("."+side+"_fill_autorefraction_dilated3_cyl").focus()
    }
    if ($(lasttext).hasClass("dilated3_cyl")) {
      $("."+side+"_fill_autorefraction_dilated3_axis").focus()
    }
    if ($(lasttext).hasClass("dilated3_axis")) {
      $("."+oposite_side+"_fill_autorefraction_dilated1_sph").focus()
    }
  }
}
function focusprev() {
  if ($(lasttext).hasClass("r-selected-refraction-field")) {
    side = "r"
    oposite_side = "l"
  }
  else{
    side = "l"
    oposite_side = "r"
  }
  if("<%= ['dry_auto_refraction', 'pmt_auto_refraction'].include?(params[:type]) || params[:type].nil? %>" == 'true'){
    if ($(lasttext).hasClass("dry_axis")) {
      $("."+side+"_fill_autorefraction_dry_cyl").focus()
    }
    if ($(lasttext).hasClass("dry1_axis")) {
      $("."+side+"_fill_autorefraction_dry1_cyl").focus()
    }
    if ($(lasttext).hasClass("dry2_axis")) {
      $("."+side+"_fill_autorefraction_dry2_cyl").focus()
    }
    if ($(lasttext).hasClass("dry_cyl")) {
      $("."+side+"_fill_autorefraction_dry_sph").focus()
    }
    if ($(lasttext).hasClass("dry1_cyl")) {
      $("."+side+"_fill_autorefraction_dry1_sph").focus()
    }
    if ($(lasttext).hasClass("dry2_cyl")) {
      $("."+side+"_fill_autorefraction_dry2_sph").focus()
    }
    if("<%= params[:type].nil? %>" == 'true'){
      if ($(lasttext).hasClass("dry_sph")) {
        $("."+oposite_side+"_fill_autorefraction_dry2_axis").focus()
      }
      if ($(lasttext).hasClass("dry1_sph")) {
        $("."+side+"_fill_autorefraction_dry_axis").focus()
      }
      if ($(lasttext).hasClass("dry2_sph")) {
        $("."+side+"_fill_autorefraction_dry1_axis").focus()
      }
    } else {
      if ($(lasttext).hasClass("dry_sph")) {
        $("."+oposite_side+"_fill_autorefraction_dry2_axis").focus()
      }
      if ($(lasttext).hasClass("dry1_sph")) {
        $("."+side+"_fill_autorefraction_dry_axis").focus()
      }
      if ($(lasttext).hasClass("dry2_sph")) {
        $("."+side+"_fill_autorefraction_dry1_axis").focus()
      }
    }
  }

  if("<%= params[:type] == 'dilated_auto_refraction' || params[:type].nil? %>" == 'true'){
    if("<%= params[:type].nil? %>" == 'true'){
      if ($(lasttext).hasClass("dilated1_sph")) {
        $("."+oposite_side+"_fill_autorefraction_dilated3_axis").focus()
      }
    } else {
      if ($(lasttext).hasClass("dilated1_sph")) {
        $("."+oposite_side+"_fill_autorefraction_dilated3_axis").focus()
      }
    }
    if ($(lasttext).hasClass("dilated1_cyl")) {
      $("."+side+"_fill_autorefraction_dilated1_sph").focus()
    }
    if ($(lasttext).hasClass("dilated1_axis")) {
      $("."+side+"_fill_autorefraction_dilated1_cyl").focus()
    }
    if ($(lasttext).hasClass("dilated2_sph")) {
      $("."+side+"_fill_autorefraction_dilated1_axis").focus()
    }
    if ($(lasttext).hasClass("dilated2_cyl")) {
      $("."+side+"_fill_autorefraction_dilated2_sph").focus()
    }
    if ($(lasttext).hasClass("dilated2_axis")) {
      $("."+side+"_fill_autorefraction_dilated2_cyl").focus()
    }
    if ($(lasttext).hasClass("dilated3_sph")) {
      $("."+side+"_fill_autorefraction_dilated2_axis").focus()
    }
    if ($(lasttext).hasClass("dilated3_cyl")) {
      $("."+side+"_fill_autorefraction_dilated3_sph").focus()
    }
    if ($(lasttext).hasClass("dilated3_axis")) {
      $("."+side+"_fill_autorefraction_dilated3_cyl").focus()
    }
  }

}

$("#next-refraction-btn").on("click",function(){
  focusnext()
})
$("#prev-refraction-btn").on("click",function(){
  focusprev()
})

var lasttext;
var side
var oposite_side
function doinsert_ie(sometext) {
  lasttext.focus();
  lasttext.value = sometext
  $(lasttext).attr("value",sometext)
  focusnext()
}
