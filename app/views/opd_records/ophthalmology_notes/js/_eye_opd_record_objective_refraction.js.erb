if($('#opdrecord_templatetype').val() == 'vision' && "<%= params[:action] %>" == "new"){
  $('#intermediate_glasses_prescriptions_show_add').val('true')
  $('#intermediate_glasses_prescriptions_show_add').prop("checked", true);
  $('#glassesprescriptions_show_add').val('true')
  $('#glassesprescriptions_show_add').prop("checked", true);
}

$(".calculate_sph_near_from_distant").on("keyup", function(){
  var distant_id =  $(this).attr("id")
  var add_id = $(this).attr("id").replace('distant', 'add')
  var near_id = $(this).attr("id").replace('distant', 'near')
  var near_val

  if ($("#"+add_id).val() == ""){
//    near_val = Math.round((parseFloat($("#"+distant_id).val()))*100)/100
    near_val =""
  }
  else {
    near_val = Math.round((parseFloat($("#"+distant_id).val())+parseFloat($("#"+add_id).val()))*100)/100
  }
  if (near_val == near_val) {
    if (near_val > 0) {
      $("#"+near_id).val("+"+near_val.toFixed(2))
    }
    if (near_val < 0) {
      $("#"+near_id).val(near_val.toFixed(2))
    }
    if (near_val == "0") {
      $("#"+near_id).val("0.00")
    }
  }
  else {
    $("#"+near_id).val("")
  }
})

$(".calculate_cyl_near_from_distant").on("keyup", function(){
  var distant_id =  $(this).attr("id")
  var add_id = $(this).attr("id").replace('distant', 'add').replace('cyl', 'sph')
  var near_id = $(this).attr("id").replace('distant', 'near')
  var near_val
  if ($("#"+add_id).val() == ""){
    near_val = ""
  }
  else {
    near_val = Math.round((parseFloat($("#"+distant_id).val()))*100)/100
  }
  if (near_val == near_val) {
    if (near_val > 0) {
      $("#"+near_id).val("+"+near_val.toFixed(2))
    }
    if (near_val < 0) {
      $("#"+near_id).val(near_val.toFixed(2))
    }
    if (near_val == "0") {
      $("#"+near_id).val("0.00")
    }
  }
  else {
    $("#"+near_id).val("")
  }
})

$(".calculate_axis_near_from_distant").on("keyup", function(){
  var distant_id =  $(this).attr("id")
  var add_id = $(this).attr("id").replace('distant', 'add').replace('axis', 'sph')
  var near_id = $(this).attr("id").replace('distant', 'near')
  var near_val

  if ($("#"+add_id).val() == ""){
    near_val = ""
  }
  else {
    near_val = Math.round((parseFloat($("#"+distant_id).val()))*100)/100
  }
  if (near_val == near_val) {

    $("#"+near_id).val(near_val)

  }
  else {
    $("#"+near_id).val("")
  }
})

$(".calculate_near_from_add").on("keyup", function(){
  var add_id =  $(this).attr("id")
  var distant_id = $(this).attr("id").replace('add','distant')
  var near_id = $(this).attr("id").replace('add','near')
  var near_val

  if ($("#"+distant_id).val() == ""){
    near_val = (Math.round((parseFloat($("#"+add_id).val()))*100)/100)
  }
  else {
    near_val = (Math.round((parseFloat($("#"+distant_id).val())+parseFloat($("#"+add_id).val()))*100)/100)
  }

  if (near_val == near_val) {
    if (near_val > 0) {
      $("#"+near_id).val("+"+near_val.toFixed(2))
    }
    if (near_val < 0) {
      $("#"+near_id).val(near_val.toFixed(2))
    }
    if (near_val == "0") {
      $("#"+near_id).val("0.00")
    }

    $(".calculate_axis_near_from_distant").trigger("keyup")
    $(".calculate_cyl_near_from_distant").trigger("keyup")


  }
  else {
    $("#"+near_id).val("")
  }
})

//for pmt repeatition of code need to refactor later
$(".calculate_sph_near_from_distant_pmt").on("keyup", function(){
  var distant_id =  $(this).attr("id")
  var add_id = $(this).attr("id").replace('sph', 'sph_row2')
  var near_id = $(this).attr("id").replace('sph', 'sph_row3')
  var near_val

  if ($("#"+add_id).val() == ""){
//    near_val = Math.round((parseFloat($("#"+distant_id).val()))*100)/100
    near_val =""
  }
  else {
    near_val = Math.round((parseFloat($("#"+distant_id).val())+parseFloat($("#"+add_id).val()))*100)/100
  }
  if (near_val == near_val) {
    if (near_val > 0) {
      $("#"+near_id).val("+"+near_val.toFixed(2))
    }
    if (near_val < 0) {
      $("#"+near_id).val(near_val.toFixed(2))
    }
    if (near_val == "0") {
      $("#"+near_id).val("0.00")
    }
  }
  else {
    $("#"+near_id).val("")
  }
})

$(".calculate_cyl_near_from_distant_pmt").on("keyup", function(){
  var distant_id =  $(this).attr("id")
  var add_id = $(this).attr("id").replace('cyl', 'sph_row2')
  var near_id = $(this).attr("id").replace('cyl', 'cyl_row3')
  var near_val
  if ($("#"+add_id).val() == ""){
    near_val = ""
  }
  else {
    near_val = Math.round((parseFloat($("#"+distant_id).val()))*100)/100
  }
  if (near_val == near_val) {
    if (near_val > 0) {
      $("#"+near_id).val("+"+near_val.toFixed(2))
    }
    if (near_val < 0) {
      $("#"+near_id).val(near_val.toFixed(2))
    }
    if (near_val == "0") {
      $("#"+near_id).val("0.00")
    }
  }
  else {
    $("#"+near_id).val("")
  }
})

$(".calculate_axis_near_from_distant_pmt").on("keyup", function(){
  var distant_id =  $(this).attr("id")
  var add_id = $(this).attr("id").replace('axis', 'sph_row2')
  var near_id = $(this).attr("id").replace('axis', 'axis_row3')
  var near_val

  if ($("#"+add_id).val() == ""){
    near_val = ""
  }
  else {
    near_val = Math.round((parseFloat($("#"+distant_id).val()))*100)/100
  }
  if (near_val == near_val) {

    $("#"+near_id).val(near_val)

  }
  else {
    $("#"+near_id).val("")
  }
})

$(".calculate_near_from_add_pmt").on("keyup", function(){
  var add_id =  $(this).attr("id")
  var distant_id = $(this).attr("id").replace('sph_row2','sph')
  var near_id = $(this).attr("id").replace('sph_row2','sph_row3')
  var near_val

  if ($("#"+distant_id).val() == ""){
    near_val = (Math.round((parseFloat($("#"+add_id).val()))*100)/100)
  }
  else {
    near_val = (Math.round((parseFloat($("#"+distant_id).val())+parseFloat($("#"+add_id).val()))*100)/100)
  }

  if (near_val == near_val) {
    if (near_val > 0) {
      $("#"+near_id).val("+"+near_val.toFixed(2))
    }
    if (near_val < 0) {
      $("#"+near_id).val(near_val.toFixed(2))
    }
    if (near_val == "0") {
      $("#"+near_id).val("0.00")
    }

    $(".calculate_axis_near_from_distant_pmt").trigger("keyup")
    $(".calculate_cyl_near_from_distant_pmt").trigger("keyup")


  }
  else {
    $("#"+near_id).val("")
  }
})

//pmt autocalculation ends

$('.r_retinoscopy_sph').on('keyup',function(){
  $('[name="opdrecord[r_retinoscopy_sph]"]').val($(this).val())
})

$('.r_retinoscopy_cyl').on('keyup',function(){
  $('[name="opdrecord[r_retinoscopy_cyl]"]').val($(this).val())
})

$('.r_retinoscopy_axis').on('keyup',function(){
  $('[name="opdrecord[r_retinoscopy_axis]"]').val($(this).val())
})

$('.r_retinoscopy_vision').on('keyup',function(){
  $('[name="opdrecord[r_retinoscopy_vision]"]').val($(this).val())
})

$('.r_retinoscopy_dilated_sph').on('keyup',function(){
  $('[name="opdrecord[r_retinoscopy_dilated_sph]"]').val($(this).val())
})

$('.r_retinoscopy_dilated_cyl').on('keyup',function(){
  $('[name="opdrecord[r_retinoscopy_dilated_cyl]"]').val($(this).val())
})

$('.r_retinoscopy_dilated_axis').on('keyup',function(){
  $('[name="opdrecord[r_retinoscopy_dilated_axis]"]').val($(this).val())
})

$('.r_retinoscopy_dilated_vision').on('keyup',function(){
  $('[name="opdrecord[r_retinoscopy_dilated_vision]"]').val($(this).val())
})

$('.l_retinoscopy_sph').on('keyup',function(){
  $('[name="opdrecord[l_retinoscopy_sph]"]').val($(this).val())
})

$('.l_retinoscopy_cyl').on('keyup',function(){
  $('[name="opdrecord[l_retinoscopy_cyl]"]').val($(this).val())
})

$('.l_retinoscopy_axis').on('keyup',function(){
  $('[name="opdrecord[l_retinoscopy_axis]"]').val($(this).val())
})

$('.l_retinoscopy_vision').on('keyup',function(){
  $('[name="opdrecord[l_retinoscopy_vision]"]').val($(this).val())
})

$('.l_retinoscopy_dilated_sph').on('keyup',function(){
  $('[name="opdrecord[l_retinoscopy_dilated_sph]"]').val($(this).val())
})

$('.l_retinoscopy_dilated_cyl').on('keyup',function(){
  $('[name="opdrecord[l_retinoscopy_dilated_cyl]"]').val($(this).val())
})

$('.l_retinoscopy_dilated_axis').on('keyup',function(){
  $('[name="opdrecord[l_retinoscopy_dilated_axis]"]').val($(this).val())
})

$('.l_retinoscopy_dilated_vision').on('keyup',function(){
  $('[name="opdrecord[l_retinoscopy_dilated_vision]"]').val($(this).val())
})

$('.r_retinoscopy_dry_comments').on('keyup',function(){
  $('[name="opdrecord[r_retinoscopy_dry_comments]"]').val($(this).val())
})

$('.l_retinoscopy_dry_comments').on('keyup',function(){
  $('[name="opdrecord[l_retinoscopy_dry_comments]"]').val($(this).val())
})

$("#copy_pgp_to_gl_pres").on("click", function(){
  $("#opdrecord_r_glassesprescriptions_distant_sph").val($("#opdrecord_r_pgp_distant_sph").val())
  $("#opdrecord_r_glassesprescriptions_distant_cyl").val($("#opdrecord_r_pgp_distant_cyl").val())
  $("#opdrecord_r_glassesprescriptions_distant_axis").val($("#opdrecord_r_pgp_distant_axis").val())
  $("#opdrecord_r_glassesprescriptions_distant_vision").val($("#opdrecord_r_pgp_distant_vision").val())

  $("#opdrecord_r_glassesprescriptions_add_sph").val($("#opdrecord_r_pgp_add_sph").val())
  $("#opdrecord_r_glassesprescriptions_add_vision").val($("#opdrecord_r_pgp_add_vision").val())

  $("#opdrecord_r_glassesprescriptions_near_sph").val($("#opdrecord_r_pgp_near_sph").val())
  $("#opdrecord_r_glassesprescriptions_near_cyl").val($("#opdrecord_r_pgp_near_cyl").val())
  $("#opdrecord_r_glassesprescriptions_near_axis").val($("#opdrecord_r_pgp_near_axis").val())
  $("#opdrecord_r_glassesprescriptions_near_vision").val($("#opdrecord_r_pgp_near_vision").val())

  $("#opdrecord_l_glassesprescriptions_distant_sph").val($("#opdrecord_l_pgp_distant_sph").val())
  $("#opdrecord_l_glassesprescriptions_distant_cyl").val($("#opdrecord_l_pgp_distant_cyl").val())
  $("#opdrecord_l_glassesprescriptions_distant_axis").val($("#opdrecord_l_pgp_distant_axis").val())
  $("#opdrecord_l_glassesprescriptions_distant_vision").val($("#opdrecord_l_pgp_distant_vision").val())

  $("#opdrecord_l_glassesprescriptions_add_sph").val($("#opdrecord_l_pgp_add_sph").val())
  $("#opdrecord_l_glassesprescriptions_add_vision").val($("#opdrecord_l_pgp_add_vision").val())

  $("#opdrecord_l_glassesprescriptions_near_sph").val($("#opdrecord_l_pgp_near_sph").val())
  $("#opdrecord_l_glassesprescriptions_near_cyl").val($("#opdrecord_l_pgp_near_cyl").val())
  $("#opdrecord_l_glassesprescriptions_near_axis").val($("#opdrecord_l_pgp_near_axis").val())
  $("#opdrecord_l_glassesprescriptions_near_vision").val($("#opdrecord_l_pgp_near_vision").val())

  check_validation_status(
    $('.glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
    false, 'glasses-prescription,intermediate-glasses-prescription',
    40
  );

  check_validation_status(
    $('.intermediate-glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
      false, 'intermediate-glasses-prescription,glasses-prescription',
    40
  );
})

$("#copy_pgp_to_gl_pres2").on("click", function(){
  $("#opdrecord_r_glassesprescriptions_distant_sph").val($("#opdrecord_r_pgp_distant_sph2").val())
  $("#opdrecord_r_glassesprescriptions_distant_cyl").val($("#opdrecord_r_pgp_distant_cyl2").val())
  $("#opdrecord_r_glassesprescriptions_distant_axis").val($("#opdrecord_r_pgp_distant_axis2").val())
  $("#opdrecord_r_glassesprescriptions_distant_vision").val($("#opdrecord_r_pgp_distant_vision2").val())

  $("#opdrecord_r_glassesprescriptions_add_sph").val($("#opdrecord_r_pgp_add_sph2").val())
  $("#opdrecord_r_glassesprescriptions_add_vision").val($("#opdrecord_r_pgp_add_vision2").val())

  $("#opdrecord_r_glassesprescriptions_near_sph").val($("#opdrecord_r_pgp_near_sph2").val())
  $("#opdrecord_r_glassesprescriptions_near_cyl").val($("#opdrecord_r_pgp_near_cyl2").val())
  $("#opdrecord_r_glassesprescriptions_near_axis").val($("#opdrecord_r_pgp_near_axis2").val())
  $("#opdrecord_r_glassesprescriptions_near_vision").val($("#opdrecord_r_pgp_near_vision2").val())

  $("#opdrecord_l_glassesprescriptions_distant_sph").val($("#opdrecord_l_pgp_distant_sph2").val())
  $("#opdrecord_l_glassesprescriptions_distant_cyl").val($("#opdrecord_l_pgp_distant_cyl2").val())
  $("#opdrecord_l_glassesprescriptions_distant_axis").val($("#opdrecord_l_pgp_distant_axis2").val())
  $("#opdrecord_l_glassesprescriptions_distant_vision").val($("#opdrecord_l_pgp_distant_vision2").val())

  $("#opdrecord_l_glassesprescriptions_add_sph").val($("#opdrecord_l_pgp_add_sph2").val())
  $("#opdrecord_l_glassesprescriptions_add_vision").val($("#opdrecord_l_pgp_add_vision2").val())

  $("#opdrecord_l_glassesprescriptions_near_sph").val($("#opdrecord_l_pgp_near_sph2").val())
  $("#opdrecord_l_glassesprescriptions_near_cyl").val($("#opdrecord_l_pgp_near_cyl2").val())
  $("#opdrecord_l_glassesprescriptions_near_axis").val($("#opdrecord_l_pgp_near_axis2").val())
  $("#opdrecord_l_glassesprescriptions_near_vision").val($("#opdrecord_l_pgp_near_vision2").val())

  check_validation_status(
    $('.glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
    false, 'glasses-prescription,intermediate-glasses-prescription',
    40
  );

  check_validation_status(
    $('.intermediate-glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
      false, 'intermediate-glasses-prescription,glasses-prescription',
    40
  );
})

$("#copy_pgp_to_gl_pres3").on("click", function(){
  $("#opdrecord_r_glassesprescriptions_distant_sph").val($("#opdrecord_r_pgp_distant_sph3").val())
  $("#opdrecord_r_glassesprescriptions_distant_cyl").val($("#opdrecord_r_pgp_distant_cyl3").val())
  $("#opdrecord_r_glassesprescriptions_distant_axis").val($("#opdrecord_r_pgp_distant_axis3").val())
  $("#opdrecord_r_glassesprescriptions_distant_vision").val($("#opdrecord_r_pgp_distant_vision3").val())

  $("#opdrecord_r_glassesprescriptions_add_sph").val($("#opdrecord_r_pgp_add_sph3").val())
  $("#opdrecord_r_glassesprescriptions_add_vision").val($("#opdrecord_r_pgp_add_vision3").val())

  $("#opdrecord_r_glassesprescriptions_near_sph").val($("#opdrecord_r_pgp_near_sph3").val())
  $("#opdrecord_r_glassesprescriptions_near_cyl").val($("#opdrecord_r_pgp_near_cyl3").val())
  $("#opdrecord_r_glassesprescriptions_near_axis").val($("#opdrecord_r_pgp_near_axis3").val())
  $("#opdrecord_r_glassesprescriptions_near_vision").val($("#opdrecord_r_pgp_near_vision3").val())

  $("#opdrecord_l_glassesprescriptions_distant_sph").val($("#opdrecord_l_pgp_distant_sph3").val())
  $("#opdrecord_l_glassesprescriptions_distant_cyl").val($("#opdrecord_l_pgp_distant_cyl3").val())
  $("#opdrecord_l_glassesprescriptions_distant_axis").val($("#opdrecord_l_pgp_distant_axis3").val())
  $("#opdrecord_l_glassesprescriptions_distant_vision").val($("#opdrecord_l_pgp_distant_vision3").val())

  $("#opdrecord_l_glassesprescriptions_add_sph").val($("#opdrecord_l_pgp_add_sph3").val())
  $("#opdrecord_l_glassesprescriptions_add_vision").val($("#opdrecord_l_pgp_add_vision3").val())

  $("#opdrecord_l_glassesprescriptions_near_sph").val($("#opdrecord_l_pgp_near_sph3").val())
  $("#opdrecord_l_glassesprescriptions_near_cyl").val($("#opdrecord_l_pgp_near_cyl3").val())
  $("#opdrecord_l_glassesprescriptions_near_axis").val($("#opdrecord_l_pgp_near_axis3").val())
  $("#opdrecord_l_glassesprescriptions_near_vision").val($("#opdrecord_l_pgp_near_vision3").val())

  check_validation_status(
    $('.glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
    false, 'glasses-prescription,intermediate-glasses-prescription',
    40
  );

  check_validation_status(
    $('.intermediate-glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
      false, 'intermediate-glasses-prescription,glasses-prescription',
    40
  );
})

$("#copy_near_pgp_to_gl_pres").on("click", function(){
  $("#opdrecord_r_glassesprescriptions_distant_sph").val($("#opdrecord_r_near_pgp_distant_sph").val())
  $("#opdrecord_r_glassesprescriptions_distant_cyl").val($("#opdrecord_r_near_pgp_distant_cyl").val())
  $("#opdrecord_r_glassesprescriptions_distant_axis").val($("#opdrecord_r_near_pgp_distant_axis").val())
  $("#opdrecord_r_glassesprescriptions_distant_vision").val($("#opdrecord_r_near_pgp_distant_vision").val())

  $("#opdrecord_r_glassesprescriptions_add_sph").val($("#opdrecord_r_near_pgp_add_sph").val())
  $("#opdrecord_r_glassesprescriptions_add_vision").val($("#opdrecord_r_near_pgp_add_vision").val())

  $("#opdrecord_r_glassesprescriptions_near_sph").val($("#opdrecord_r_near_pgp_near_sph").val())
  $("#opdrecord_r_glassesprescriptions_near_cyl").val($("#opdrecord_r_near_pgp_near_cyl").val())
  $("#opdrecord_r_glassesprescriptions_near_axis").val($("#opdrecord_r_near_pgp_near_axis").val())
  $("#opdrecord_r_glassesprescriptions_near_vision").val($("#opdrecord_r_near_pgp_near_vision").val())

  $("#opdrecord_l_glassesprescriptions_distant_sph").val($("#opdrecord_l_near_pgp_distant_sph").val())
  $("#opdrecord_l_glassesprescriptions_distant_cyl").val($("#opdrecord_l_near_pgp_distant_cyl").val())
  $("#opdrecord_l_glassesprescriptions_distant_axis").val($("#opdrecord_l_near_pgp_distant_axis").val())
  $("#opdrecord_l_glassesprescriptions_distant_vision").val($("#opdrecord_l_near_pgp_distant_vision").val())

  $("#opdrecord_l_glassesprescriptions_add_sph").val($("#opdrecord_l_near_pgp_add_sph").val())
  $("#opdrecord_l_glassesprescriptions_add_vision").val($("#opdrecord_l_near_pgp_add_vision").val())

  $("#opdrecord_l_glassesprescriptions_near_sph").val($("#opdrecord_l_near_pgp_near_sph").val())
  $("#opdrecord_l_glassesprescriptions_near_cyl").val($("#opdrecord_l_near_pgp_near_cyl").val())
  $("#opdrecord_l_glassesprescriptions_near_axis").val($("#opdrecord_l_near_pgp_near_axis").val())
  $("#opdrecord_l_glassesprescriptions_near_vision").val($("#opdrecord_l_near_pgp_near_vision").val())

  check_validation_status(
    $('.glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
    false, 'glasses-prescription,intermediate-glasses-prescription',
    40
  );

  check_validation_status(
    $('.intermediate-glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
      false, 'intermediate-glasses-prescription,glasses-prescription',
    40
  );
})

$("#copy_dryref_to_gl_pres").on("click", function(){
  $("#opdrecord_r_glassesprescriptions_distant_sph").val($("#opdrecord_r_refraction_distant_sph").val())
  $("#opdrecord_r_glassesprescriptions_distant_cyl").val($("#opdrecord_r_refraction_distant_cyl").val())
  $("#opdrecord_r_glassesprescriptions_distant_axis").val($("#opdrecord_r_refraction_distant_axis").val())
  $("#opdrecord_r_glassesprescriptions_distant_vision").val($("#opdrecord_r_refraction_distant_vision").val())

  $("#opdrecord_r_glassesprescriptions_add_sph").val($("#opdrecord_r_refraction_add_sph").val())
  $("#opdrecord_r_glassesprescriptions_add_vision").val($("#opdrecord_r_refraction_add_vision").val())

  $("#opdrecord_r_glassesprescriptions_near_sph").val($("#opdrecord_r_refraction_near_sph").val())
  $("#opdrecord_r_glassesprescriptions_near_cyl").val($("#opdrecord_r_refraction_near_cyl").val())
  $("#opdrecord_r_glassesprescriptions_near_axis").val($("#opdrecord_r_refraction_near_axis").val())
  $("#opdrecord_r_glassesprescriptions_near_vision").val($("#opdrecord_r_refraction_near_vision").val())

  $("#opdrecord_l_glassesprescriptions_distant_sph").val($("#opdrecord_l_refraction_distant_sph").val())
  $("#opdrecord_l_glassesprescriptions_distant_cyl").val($("#opdrecord_l_refraction_distant_cyl").val())
  $("#opdrecord_l_glassesprescriptions_distant_axis").val($("#opdrecord_l_refraction_distant_axis").val())
  $("#opdrecord_l_glassesprescriptions_distant_vision").val($("#opdrecord_l_refraction_distant_vision").val())

  $("#opdrecord_l_glassesprescriptions_add_sph").val($("#opdrecord_l_refraction_add_sph").val())
  $("#opdrecord_l_glassesprescriptions_add_vision").val($("#opdrecord_l_refraction_add_vision").val())

  $("#opdrecord_l_glassesprescriptions_near_sph").val($("#opdrecord_l_refraction_near_sph").val())
  $("#opdrecord_l_glassesprescriptions_near_cyl").val($("#opdrecord_l_refraction_near_cyl").val())
  $("#opdrecord_l_glassesprescriptions_near_axis").val($("#opdrecord_l_refraction_near_axis").val())
  $("#opdrecord_l_glassesprescriptions_near_vision").val($("#opdrecord_l_refraction_near_vision").val())

  check_validation_status(
    $('.glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
    false, 'glasses-prescription,intermediate-glasses-prescription',
    40
  );

  check_validation_status(
    $('.intermediate-glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
      false, 'intermediate-glasses-prescription,glasses-prescription',
    40
  );
})

$("#copy_dilatedref_to_gl_pres").on("click", function(){
  $("#opdrecord_r_glassesprescriptions_distant_sph").val($("#opdrecord_r_dilatedrefraction_distant_sph").val())
  $("#opdrecord_r_glassesprescriptions_distant_cyl").val($("#opdrecord_r_dilatedrefraction_distant_cyl").val())
  $("#opdrecord_r_glassesprescriptions_distant_axis").val($("#opdrecord_r_dilatedrefraction_distant_axis").val())
  $("#opdrecord_r_glassesprescriptions_distant_vision").val($("#opdrecord_r_dilatedrefraction_distant_vision").val())

  $("#opdrecord_r_glassesprescriptions_add_sph").val($("#opdrecord_r_dilatedrefraction_add_sph").val())
  $("#opdrecord_r_glassesprescriptions_add_vision").val($("#opdrecord_r_dilatedrefraction_add_vision").val())

  $("#opdrecord_r_glassesprescriptions_near_sph").val($("#opdrecord_r_dilatedrefraction_near_sph").val())
  $("#opdrecord_r_glassesprescriptions_near_cyl").val($("#opdrecord_r_dilatedrefraction_near_cyl").val())
  $("#opdrecord_r_glassesprescriptions_near_axis").val($("#opdrecord_r_dilatedrefraction_near_axis").val())
  $("#opdrecord_r_glassesprescriptions_near_vision").val($("#opdrecord_r_dilatedrefraction_near_vision").val())

  $("#opdrecord_l_glassesprescriptions_distant_sph").val($("#opdrecord_l_dilatedrefraction_distant_sph").val())
  $("#opdrecord_l_glassesprescriptions_distant_cyl").val($("#opdrecord_l_dilatedrefraction_distant_cyl").val())
  $("#opdrecord_l_glassesprescriptions_distant_axis").val($("#opdrecord_l_dilatedrefraction_distant_axis").val())
  $("#opdrecord_l_glassesprescriptions_distant_vision").val($("#opdrecord_l_dilatedrefraction_distant_vision").val())

  $("#opdrecord_l_glassesprescriptions_add_sph").val($("#opdrecord_l_dilatedrefraction_add_sph").val())
  $("#opdrecord_l_glassesprescriptions_add_vision").val($("#opdrecord_l_dilatedrefraction_add_vision").val())

  $("#opdrecord_l_glassesprescriptions_near_sph").val($("#opdrecord_l_dilatedrefraction_near_sph").val())
  $("#opdrecord_l_glassesprescriptions_near_cyl").val($("#opdrecord_l_dilatedrefraction_near_cyl").val())
  $("#opdrecord_l_glassesprescriptions_near_axis").val($("#opdrecord_l_dilatedrefraction_near_axis").val())
  $("#opdrecord_l_glassesprescriptions_near_vision").val($("#opdrecord_l_dilatedrefraction_near_vision").val())

  check_validation_status(
    $('.glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
    false, 'glasses-prescription,intermediate-glasses-prescription',
    40
  );

  check_validation_status(
    $('.intermediate-glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
      false, 'intermediate-glasses-prescription,glasses-prescription',
    40
  );
})

$("#copy_pmt_to_gl_pres").on("click", function(){
  $("#opdrecord_r_glassesprescriptions_distant_sph").val($("#opdrecord_r_dilatedretinoscopy_pmt_sph").val())
  $("#opdrecord_r_glassesprescriptions_distant_cyl").val($("#opdrecord_r_dilatedretinoscopy_pmt_cyl").val())
  $("#opdrecord_r_glassesprescriptions_distant_axis").val($("#opdrecord_r_dilatedretinoscopy_pmt_axis").val())
  $("#opdrecord_r_glassesprescriptions_distant_vision").val($("#opdrecord_r_dilatedretinoscopy_pmt_vision").val())

  $("#opdrecord_r_glassesprescriptions_add_sph").val($("#opdrecord_r_dilatedretinoscopy_pmt_sph_row2").val())
  $("#opdrecord_r_glassesprescriptions_add_vision").val($("#opdrecord_r_dilatedretinoscopy_pmt_vision_row2").val())

  $("#opdrecord_r_glassesprescriptions_near_sph").val($("#opdrecord_r_dilatedretinoscopy_pmt_sph_row3").val())
  $("#opdrecord_r_glassesprescriptions_near_cyl").val($("#opdrecord_r_dilatedretinoscopy_pmt_cyl_row3").val())
  $("#opdrecord_r_glassesprescriptions_near_axis").val($("#opdrecord_r_dilatedretinoscopy_pmt_axis_row3").val())
  $("#opdrecord_r_glassesprescriptions_near_vision").val($("#opdrecord_r_dilatedretinoscopy_pmt_vision_row3").val())

  $("#opdrecord_l_glassesprescriptions_distant_sph").val($("#opdrecord_l_dilatedretinoscopy_pmt_sph").val())
  $("#opdrecord_l_glassesprescriptions_distant_cyl").val($("#opdrecord_l_dilatedretinoscopy_pmt_cyl").val())
  $("#opdrecord_l_glassesprescriptions_distant_axis").val($("#opdrecord_l_dilatedretinoscopy_pmt_axis").val())
  $("#opdrecord_l_glassesprescriptions_distant_vision").val($("#opdrecord_l_dilatedretinoscopy_pmt_vision").val())

  $("#opdrecord_l_glassesprescriptions_add_sph").val($("#opdrecord_l_dilatedretinoscopy_pmt_sph_row2").val())
  $("#opdrecord_l_glassesprescriptions_add_vision").val($("#opdrecord_l_dilatedretinoscopy_pmt_vision_row2").val())

  $("#opdrecord_l_glassesprescriptions_near_sph").val($("#opdrecord_l_dilatedretinoscopy_pmt_sph_row3").val())
  $("#opdrecord_l_glassesprescriptions_near_cyl").val($("#opdrecord_l_dilatedretinoscopy_pmt_cyl_row3").val())
  $("#opdrecord_l_glassesprescriptions_near_axis").val($("#opdrecord_l_dilatedretinoscopy_pmt_axis_row3").val())
  $("#opdrecord_l_glassesprescriptions_near_vision").val($("#opdrecord_l_dilatedretinoscopy_pmt_vision_row3").val())

  check_validation_status(
    $('.glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
    false, 'glasses-prescription,intermediate-glasses-prescription',
    40
  );

  check_validation_status(
    $('.intermediate-glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
      false, 'intermediate-glasses-prescription,glasses-prescription',
    40
  );
})


$("#copy_pd_to_gl_pres").on("click", function(){
  $('#opdrecord_r_acceptance_distance_pd').val($('#opdrecord_r_monocular_distance_pd').val())
  $('#opdrecord_r_acceptance_near_pd').val($('#opdrecord_r_monocular_near_pd').val())
  $('#opdrecord_l_acceptance_distance_pd').val($('#opdrecord_l_monocular_distance_pd').val())
  $('#opdrecord_l_acceptance_near_pd').val($('#opdrecord_l_monocular_near_pd').val())

  check_validation_status(
    $('.glasses-prescription'),
    'glasses_is_valid', 'refraction_step',
    false, 'glasses-prescription,intermediate-glasses-prescription',
    40
  );
})

// (opto) code for clearing the radio button
if ($('input[name="opdrecord[r_visualacuity_unaided]"]').val() == ""){
  $(".clear_r_visualacuity_unaided").hide()
  $('input[name="opdrecord[r_visualacuity_unaided_comments]"]').hide()
} else{
  $(".clear_r_visualacuity_unaided").show()
  $('input[name="opdrecord[r_visualacuity_unaided_comments]"]').show()
}

$(".r_visualacuity_unaided").on("click",function(){
  setTimeout(function(){
    if ($('input[name="opdrecord[r_visualacuity_unaided]"]').val() == ""){
      $(".clear_r_visualacuity_unaided").hide()
      $('input[name="opdrecord[r_visualacuity_unaided_comments]"]').hide()
    }
    else{
      $('input[name="opdrecord[r_visualacuity_unaided]"]').val($('#opdrecord_r_visualacuity_unaided').val())
      deselected_radiobutton('r_visualacuity_unaided', 'opdrecord_r_visualacuity_unaided', $('#opdrecord_r_visualacuity_unaided').val())
      $(".clear_r_visualacuity_unaided").show()
      $('input[name="opdrecord[r_visualacuity_unaided_comments]"]').show()
    }
    check_vision_status()
  }, 200);
});

$(".clear_r_visualacuity_unaided").on("click",function(){
  deselected_radiobutton("r_visualacuity_unaided", "opdrecord_r_visualacuity_unaided", "");
  deselected_checkboxbutton("r_visualacuity_unaided_p", "opdrecord_r_visualacuity_unaided_p", "");
//  $("#opdrecord_r_visualacuity_unaided").val("")
  $(".clear_r_visualacuity_unaided").hide()
  $('input[name="opdrecord[r_visualacuity_unaided_comments]"]').hide()
  $('input[name="opdrecord[r_visualacuity_unaided_comments]"]').val("")
  check_vision_status()
});
/////////////////////////////////////////////
if ($("#opdrecord_r_visualacuity_pinhole").val() == ""){
  $("#clear_r_visualacuity_pinhole").hide()
  $("#opdrecord_r_visualacuity_pinhole_comments").hide()
}
else{
  $("#clear_r_visualacuity_pinhole").show()
  $("#opdrecord_r_visualacuity_pinhole_comments").show()
}

$(".r_visualacuity_pinhole").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_r_visualacuity_pinhole").val() == ""){
      $("#clear_r_visualacuity_pinhole").hide()
      $("#opdrecord_r_visualacuity_pinhole_comments").hide()
    }
    else{
      $("#clear_r_visualacuity_pinhole").show()
      $("#opdrecord_r_visualacuity_pinhole_comments").show()
    }
    check_vision_status()
  }, 200);
});

$("#clear_r_visualacuity_pinhole").on("click",function(){
  deselected_radiobutton("r_visualacuity_pinhole", "opdrecord_r_visualacuity_pinhole", "");
  deselected_checkboxbutton("r_visualacuity_pinhole_p", "opdrecord_r_visualacuity_pinhole_p", "");
  $("#clear_r_visualacuity_pinhole").hide()
  $("#opdrecord_r_visualacuity_pinhole_comments").hide()
  $("#opdrecord_r_visualacuity_pinhole_comments").val("")
  check_vision_status()
});
/////////////////////////////////////////////////////////////////////////////////////************************
if ($("#opdrecord_r_visualacuity_glasses").val() == ""){
  $("#clear_r_visualacuity_glasses").hide()
  $("#opdrecord_r_visualacuity_glasses_comments").hide()
}
else{
  $("#clear_r_visualacuity_glasses").show()
  $("#opdrecord_r_visualacuity_glasses_comments").show()
}

$(".r_visualacuity_glasses").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_r_visualacuity_glasses").val() == ""){
      $("#clear_r_visualacuity_glasses").hide()
      $("#opdrecord_r_visualacuity_glasses_comments").hide()
    }
    else{
      $("#clear_r_visualacuity_glasses").show()
      $("#opdrecord_r_visualacuity_glasses_comments").show()
    }
    check_vision_status()
  }, 200);
});

$("#clear_r_visualacuity_glasses").on("click",function(){
  deselected_radiobutton("r_visualacuity_glasses", "opdrecord_r_visualacuity_glasses", "");
  deselected_checkboxbutton("r_visualacuity_glasses_p", "opdrecord_r_visualacuity_glasses_p", "");
  $("#clear_r_visualacuity_glasses").hide()
  $("#opdrecord_r_visualacuity_glasses_comments").hide()
  $("#opdrecord_r_visualacuity_glasses_comments").val("")
  check_vision_status()
});

if ($("#opdrecord_r_visualacuity_lens").val() == ""){
  $("#clear_r_visualacuity_lens").hide()
  $("#opdrecord_r_visualacuity_lens_comments").hide()
}
else{
  $("#clear_r_visualacuity_lens").show()
  $("#opdrecord_r_visualacuity_lens_comments").show()
}

$(".r_visualacuity_lens").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_r_visualacuity_lens").val() == ""){
      $("#clear_r_visualacuity_lens").hide()
      $("#opdrecord_r_visualacuity_lens_comments").hide()
    }
    else{
      $("#clear_r_visualacuity_lens").show()
      $("#opdrecord_r_visualacuity_lens_comments").show()
    }
    check_vision_status()
  }, 200);
});

$("#clear_r_visualacuity_lens").on("click",function(){
  deselected_radiobutton("r_visualacuity_lens", "opdrecord_r_visualacuity_lens", "");
  deselected_checkboxbutton("r_visualacuity_lens_p", "opdrecord_r_visualacuity_lens_p", "");
  $("#clear_r_visualacuity_lens").hide()
  $("#opdrecord_r_visualacuity_lens_comments").hide()
  $("#opdrecord_r_visualacuity_lens_comments").val("")
  check_vision_status()
});

if ($("#opdrecord_r_visualacuity_near").val() == ""){
  $("#clear_r_visualacuity_near").hide()
  $("#opdrecord_r_visualacuity_near_comments").hide()
}
else{
  $("#clear_r_visualacuity_near").show()
  $("#opdrecord_r_visualacuity_near_comments").show()
}

$(".r_visualacuity_near").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_r_visualacuity_near").val() == ""){
      $("#clear_r_visualacuity_near").hide()
      $("#opdrecord_r_visualacuity_near_comments").hide()
    }
    else{
      $("#clear_r_visualacuity_near").show()
      $("#opdrecord_r_visualacuity_near_comments").show()
    }
    check_vision_status()
  }, 200);
});

$("#clear_r_visualacuity_near").on("click",function(){
  deselected_radiobutton("r_visualacuity_near", "opdrecord_r_visualacuity_near", "");
  deselected_checkboxbutton("r_visualacuity_near_p", "opdrecord_r_visualacuity_near_p", "");
  $("#clear_r_visualacuity_near").hide()
  $("#opdrecord_r_visualacuity_near_comments").hide()
  $("#opdrecord_r_visualacuity_near_comments").val("")
  check_vision_status()
});

//\\\\\\\\\\\

if ($('input[name="opdrecord[r_visualacuity_ua_near]"]').val() == ""){
  $(".clear_r_visualacuity_ua_near").hide()
  $('input[name="opdrecord[r_visualacuity_ua_near_comments]"]').hide()
} else{
  $(".clear_r_visualacuity_ua_near").show()
  $('input[name="opdrecord[r_visualacuity_ua_near_comments]"]').show()
}

$(".r_visualacuity_ua_near").on("click",function(){
  setTimeout(function(){
    if ($('input[name="opdrecord[r_visualacuity_ua_near]"]').val() == ""){
      $(".clear_r_visualacuity_ua_near").hide()
      $("#opdrecord_r_visualacuity_ua_near_comments").hide()
    }
    else{
      $('input[name="opdrecord[r_visualacuity_ua_near]"]').val($('#opdrecord_r_visualacuity_ua_near').val())
      deselected_radiobutton('r_visualacuity_ua_near', 'opdrecord_r_visualacuity_ua_near', $('#opdrecord_r_visualacuity_ua_near').val())
      $(".clear_r_visualacuity_ua_near").show()
      $('input[name="opdrecord[r_visualacuity_ua_near_comments]"]').show()
    }
    check_vision_status()
  }, 200);
});

$(".clear_r_visualacuity_ua_near").on("click",function(){
  deselected_radiobutton("r_visualacuity_ua_near", "opdrecord_r_visualacuity_ua_near", "");
  deselected_checkboxbutton("r_visualacuity_ua_near_p", "opdrecord_r_visualacuity_ua_near_p", "");
  $(".clear_r_visualacuity_ua_near").hide()
  $('input[name="opdrecord[r_visualacuity_ua_near_comments]"]').hide()
  $('input[name="opdrecord[r_visualacuity_ua_near_comments]"]').val("")
  check_vision_status()
});

//(left eye opto) code for clear///////////////////////////////////////////////////////


if ($("#opdrecord_be_visualacuity_unaided").val() == ""){
  $("#clear_be_visualacuity_unaided").hide()
  $("#opdrecord_be_visualacuity_unaided_comments").hide()
}
else{
  $("#clear_be_visualacuity_unaided").show()
  $("#opdrecord_be_visualacuity_unaided_comments").show()
}

$(".be_visualacuity_unaided").on("click",function(){
  setTimeout(function(){
    if ($('input[name="opdrecord[be_visualacuity_unaided]"]').val() == ""){
      $(".clear_be_visualacuity_unaided").hide()
      $('input[name="opdrecord[be_visualacuity_unaided_comments]"]').hide()
    }
    else{
      $(".clear_be_visualacuity_unaided").show()
      $('input[name="opdrecord[be_visualacuity_unaided_comments]"]').show()
    }
  }, 200);
});

$(".clear_be_visualacuity_unaided").on("click",function(){
  deselected_radiobutton("be_visualacuity_unaided", "opdrecord_be_visualacuity_unaided", "");
  deselected_checkboxbutton("be_visualacuity_unaided_p", "opdrecord_be_visualacuity_unaided_p", "");
  $("#opdrecord_be_visualacuity_unaided").val("")
  $(".clear_be_visualacuity_unaided").hide()
  $('input[name="opdrecord[be_visualacuity_unaided_comments]"]').hide()
  $('input[name="opdrecord[be_visualacuity_unaided_comments]"]').val("")
});

if ($('input[name="opdrecord[l_visualacuity_unaided]"]').val() == ""){
  $(".clear_l_visualacuity_unaided").hide()
  $('input[name="opdrecord[l_visualacuity_unaided_comments]"]').hide()
} else{
  $(".clear_l_visualacuity_unaided").show()
  $('input[name="opdrecord[l_visualacuity_unaided_comments]"]').show()
}

$(".l_visualacuity_unaided").on("click",function(){
  setTimeout(function(){
    if ($('input[name="opdrecord[l_visualacuity_unaided]"]').val() == ""){
      $(".clear_l_visualacuity_unaided").hide()
      $('input[name="opdrecord[l_visualacuity_unaided_comments]"]').hide()
    }
    else{
      $('input[name="opdrecord[l_visualacuity_unaided]"]').val($('#opdrecord_l_visualacuity_unaided').val())
      deselected_radiobutton('l_visualacuity_unaided', 'opdrecord_l_visualacuity_unaided', $('#opdrecord_l_visualacuity_unaided').val())
      $(".clear_l_visualacuity_unaided").show()
      $('input[name="opdrecord[l_visualacuity_unaided_comments]"]').show()
    }
    check_vision_status()
  }, 200);
});

$(document).ready(function() {
  if($('input[name="opdrecord[r_visualacuity_unaided_p]"]').val() == 'P,P'){
    $('input[name="opdrecord[r_visualacuity_unaided_p]"]').val('P')
  }
  if($('input[name="opdrecord[l_visualacuity_unaided_p]"]').val() == 'P,P'){
    $('input[name="opdrecord[l_visualacuity_unaided_p]"]').val('P')
  }
  if($('input[name="opdrecord[r_visualacuity_ua_near_p]"]').val() == 'P,P'){
    $('input[name="opdrecord[r_visualacuity_ua_near_p]"]').val('P')
  }
  if($('input[name="opdrecord[l_visualacuity_ua_near_p]"]').val() == 'P,P'){
    $('input[name="opdrecord[l_visualacuity_ua_near_p]"]').val('P')
  }
});

$('.l_visualacuity_unaided_p').on("click", function(){
  if(!jQuery(this).hasClass("btn-darkblue")){
    $('.l_visualacuity_unaided_p').not(this).addClass('btn-darkblue')
    if($('.l_unaided_p')){
      $('.l_unaided_p').parent().siblings().children().val('P')
    }
  } else {
    $('.l_visualacuity_unaided_p').not(this).removeClass('btn-darkblue')
  }
});

$('.r_visualacuity_unaided_p').on("click", function(){
  if(!jQuery(this).hasClass("btn-darkblue")){
    $('.r_visualacuity_unaided_p').not(this).addClass('btn-darkblue')
    if($('.r_unaided_p')){
      $('.r_unaided_p').parent().siblings().children().val('P')
    }
  } else {
    $('.r_visualacuity_unaided_p').not(this).removeClass('btn-darkblue')
  }
});

$('.r_visualacuity_ua_near_p').on("click", function(){
  if(!jQuery(this).hasClass("btn-darkblue")){
    $('.r_visualacuity_ua_near_p').not(this).addClass('btn-darkblue')
    if($('.r_ua_near_p')){
      $('.r_ua_near_p').parent().siblings().children().val('P')
    }
  } else {
    $('.r_visualacuity_ua_near_p').not(this).removeClass('btn-darkblue')
  }
});

$('.l_visualacuity_ua_near_p').on("click", function(){
  if(!jQuery(this).hasClass("btn-darkblue")){
    $('.l_visualacuity_ua_near_p').not(this).addClass('btn-darkblue')
    if($('.l_ua_near_p')){
      $('.l_ua_near_p').parent().siblings().children().val('P')
    }
  } else {
    $('.l_visualacuity_ua_near_p').not(this).removeClass('btn-darkblue')
  }
});


$(".clear_l_visualacuity_unaided").on("click",function(){
  deselected_radiobutton("l_visualacuity_unaided", "opdrecord_l_visualacuity_unaided", "");
  deselected_checkboxbutton("l_visualacuity_unaided_p", "opdrecord_l_visualacuity_unaided_p", "");
//  $("#opdrecord_r_visualacuity_unaided").val("")
  $(".clear_l_visualacuity_unaided").hide()
  $('input[name="opdrecord[l_visualacuity_unaided_comments]"]').hide()
  $('input[name="opdrecord[l_visualacuity_unaided_comments]"]').val("")
  check_vision_status()
});
/////////////////////////////////////////////
if ($("#opdrecord_l_visualacuity_pinhole").val() == ""){
  $("#clear_l_visualacuity_pinhole").hide()
  $("#opdrecord_l_visualacuity_pinhole_comments").hide()
}
else{
  $("#clear_l_visualacuity_pinhole").show()
  $("#opdrecord_l_visualacuity_pinhole_comments").show()
}

$(".l_visualacuity_pinhole").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_l_visualacuity_pinhole").val() == ""){
      $("#clear_l_visualacuity_pinhole").hide()
      $("#opdrecord_l_visualacuity_pinhole_comments").hide()
    }
    else{
      $("#clear_l_visualacuity_pinhole").show()
      $("#opdrecord_l_visualacuity_pinhole_comments").show()
    }
    check_vision_status()
  }, 200);
});

$("#clear_l_visualacuity_pinhole").on("click",function(){
  deselected_radiobutton("l_visualacuity_pinhole", "opdrecord_l_visualacuity_pinhole", "");
  deselected_checkboxbutton("l_visualacuity_pinhole_p", "opdrecord_l_visualacuity_pinhole_p", "");
  $("#clear_l_visualacuity_pinhole").hide()
  $("#opdrecord_l_visualacuity_pinhole_comments").hide()
  $("#opdrecord_l_visualacuity_pinhole_comments").val("")
  check_vision_status()
});
/////////////////////////////////////////////////////////////////////////////////////************************
if ($("#opdrecord_l_visualacuity_glasses").val() == ""){
  $("#clear_l_visualacuity_glasses").hide()
  $("#opdrecord_l_visualacuity_glasses_comments").hide()
}
else{
  $("#clear_l_visualacuity_glasses").show()
  $("#opdrecord_l_visualacuity_glasses_comments").show()
}

$(".l_visualacuity_glasses").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_l_visualacuity_glasses").val() == ""){
      $("#clear_l_visualacuity_glasses").hide()
      $("#opdrecord_l_visualacuity_glasses_comments").hide()
    }
    else{
      $("#clear_l_visualacuity_glasses").show()
      $("#opdrecord_l_visualacuity_glasses_comments").show()
    }
    check_vision_status()
  }, 200);
});

$("#clear_l_visualacuity_glasses").on("click",function(){
  deselected_radiobutton("l_visualacuity_glasses", "opdrecord_l_visualacuity_glasses", "");
  deselected_checkboxbutton("l_visualacuity_glasses_p", "opdrecord_l_visualacuity_glasses_p", "");
  $("#clear_l_visualacuity_glasses").hide()
  $("#opdrecord_l_visualacuity_glasses_comments").hide()
  $("#opdrecord_l_visualacuity_glasses_comments").val("")
  check_vision_status()
});

if ($("#opdrecord_l_visualacuity_lens").val() == ""){
  $("#clear_l_visualacuity_lens").hide()
  $("#opdrecord_l_visualacuity_lens_comments").hide()
}
else{
  $("#clear_l_visualacuity_lens").show()
  $("#opdrecord_l_visualacuity_lens_comments").show()
}

$(".l_visualacuity_lens").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_l_visualacuity_lens").val() == ""){
      $("#clear_l_visualacuity_lens").hide()
      $("#opdrecord_l_visualacuity_lens_comments").hide()
    }
    else{
      $("#clear_l_visualacuity_lens").show()
      $("#opdrecord_l_visualacuity_lens_comments").show()
    }
    check_vision_status()
  }, 200);
});

$("#clear_l_visualacuity_lens").on("click",function(){
  deselected_radiobutton("l_visualacuity_lens", "opdrecord_l_visualacuity_lens", "");
  deselected_checkboxbutton("l_visualacuity_lens_p", "opdrecord_l_visualacuity_lens_p", "");
  $("#clear_l_visualacuity_lens").hide()
  $("#opdrecord_l_visualacuity_lens_comments").hide()
  $("#opdrecord_l_visualacuity_lens_comments").val("")
  check_vision_status()
});


if ($("#opdrecord_l_visualacuity_near").val() == ""){
  $("#clear_l_visualacuity_near").hide()
  $("#opdrecord_l_visualacuity_near_comments").hide()
}
else{
  $("#clear_l_visualacuity_near").show()
  $("#opdrecord_l_visualacuity_near_comments").show()
}

$(".l_visualacuity_near").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_l_visualacuity_near").val() == ""){
      $("#clear_l_visualacuity_near").hide()
      $("#opdrecord_l_visualacuity_near_comments").hide()
    }
    else{
      $("#clear_l_visualacuity_near").show()
      $("#opdrecord_l_visualacuity_near_comments").show()
    }
    check_vision_status()
  }, 200);
});

$('.l_visualacuity_near_p').on("click",function(){
  deselected_checkboxbutton("opdrecord_l_visualacuity_near_p", "opdrecord_l_visualacuity_near_p", $('#opdrecord_l_visualacuity_near_p').val());
});

$("#clear_l_visualacuity_near").on("click",function(){
  deselected_radiobutton("l_visualacuity_near", "opdrecord_l_visualacuity_near", "");
  deselected_checkboxbutton("l_visualacuity_near_p", "opdrecord_l_visualacuity_near_p", "");
  $("#clear_l_visualacuity_near").hide()
  $("#opdrecord_l_visualacuity_near_comments").hide()
  $("#opdrecord_l_visualacuity_near_comments").val("")
  check_vision_status()
});

//\\\\\\\\\\\
if ($('input[name="opdrecord[l_visualacuity_ua_near]"]').val() == ""){
  $(".clear_l_visualacuity_ua_near").hide()
  $('input[name="opdrecord[l_visualacuity_ua_near_comments]"]').hide()
} else{
  $(".clear_l_visualacuity_ua_near").show()
  $('input[name="opdrecord[l_visualacuity_ua_near_comments]"]').show()
}

$(".l_visualacuity_ua_near").on("click",function(){
  setTimeout(function(){
    if ($('input[name="opdrecord[l_visualacuity_ua_near]"]').val() == ""){
      $(".clear_l_visualacuity_ua_near").hide()
      $("#opdrecord_l_visualacuity_ua_near_comments").hide()
    }
    else{
      $('input[name="opdrecord[l_visualacuity_ua_near]"]').val($('#opdrecord_l_visualacuity_ua_near').val())
      deselected_radiobutton('l_visualacuity_ua_near', 'opdrecord_l_visualacuity_ua_near', $('#opdrecord_l_visualacuity_ua_near').val())
      $(".clear_l_visualacuity_ua_near").show()
      $('input[name="opdrecord[l_visualacuity_ua_near_comments]"]').show()
    }
    check_vision_status()
  }, 200);
});

$(".clear_l_visualacuity_ua_near").on("click",function(){
  deselected_radiobutton("l_visualacuity_ua_near", "opdrecord_l_visualacuity_ua_near", "");
  deselected_checkboxbutton("l_visualacuity_ua_near_p", "opdrecord_l_visualacuity_ua_near_p", "");
  $(".clear_l_visualacuity_ua_near").hide()
  $('input[name="opdrecord[l_visualacuity_ua_near_comments]"]').hide()
  $('input[name="opdrecord[l_visualacuity_ua_near_comments]"]').val("")
  check_vision_status()
});

/////////////////////////////////////////////////////////

if ($('input[name="opdrecord[be_visualacuity_ua_near]"]').val() == ""){
  $(".clear_be_visualacuity_ua_near").hide()
  $('input[name="opdrecord[be_visualacuity_ua_near_comments]"]').hide()
} else{
  $(".clear_be_visualacuity_ua_near").show()
  $('input[name="opdrecord[be_visualacuity_ua_near_comments]"]').show()
}

$(".be_visualacuity_ua_near").on("click",function(){
  setTimeout(function(){
    if ($('input[name="opdrecord[be_visualacuity_ua_near]"]').val() == ""){
      $(".clear_be_visualacuity_ua_near").hide()
      $("#opdrecord_be_visualacuity_ua_near_comments").hide()
    }
    else{
      $('input[name="opdrecord[be_visualacuity_ua_near]"]').val($('#opdrecord_be_visualacuity_ua_near').val())
      $(".clear_be_visualacuity_ua_near").show()
      $('input[name="opdrecord[be_visualacuity_ua_near_comments]"]').show()
    }
  }, 200);
});

$(".clear_be_visualacuity_ua_near").on("click",function(){
  deselected_radiobutton("be_visualacuity_ua_near", "opdrecord_be_visualacuity_ua_near", "");
  deselected_checkboxbutton("be_visualacuity_ua_near_p", "opdrecord_be_visualacuity_ua_near_p", "");
  $(".clear_be_visualacuity_ua_near").hide()
  $('input[name="opdrecord[be_visualacuity_ua_near_comments]"]').hide()
  $('input[name="opdrecord[be_visualacuity_ua_near_comments]"]').val("")
});

$('.r_visualacuity_ua_s').on('click', function(){
  $('.r_visualacuity_ua_s').val($(this).val()).trigger('change');
});

$('.r_visualacuity_ua_i').on('click', function(){
  $('.r_visualacuity_ua_i').val($(this).val()).trigger('change');
});

$('.r_visualacuity_ua_n').on('click', function(){
  $('.r_visualacuity_ua_n').val($(this).val()).trigger('change');
});

$('.r_visualacuity_ua_t').on('click', function(){
  $('.r_visualacuity_ua_t').val($(this).val()).trigger('change');
});

$('.r_visualacuity_comments').on('keyup',function(){
  $('[name="opdrecord[r_visualacuity_comments]"]').val($(this).code())
})

$('.l_visualacuity_comments').on('keyup',function(){
  $('[name="opdrecord[l_visualacuity_comments]"]').val($(this).code())
})

$('.r_visualacuity_unaided_comments').on('keyup',function(){
  $('[name="opdrecord[r_visualacuity_unaided_comments]"]').val($(this).val())
})

$('.l_visualacuity_unaided_comments').on('keyup',function(){
  $('[name="opdrecord[l_visualacuity_unaided_comments]"]').val($(this).val())
})

$('.r_visualacuity_ua_near_comments').on('keyup',function(){
  $('[name="opdrecord[r_visualacuity_ua_near_comments]"]').val($(this).val())
})

$('.l_visualacuity_ua_near_comments').on('keyup',function(){
  $('[name="opdrecord[l_visualacuity_ua_near_comments]"]').val($(this).val())
})

$('.l_visualacuity_ua_s').on('click', function(){
  $('.l_visualacuity_ua_s').val($(this).val()).trigger('change');
});

$('.l_visualacuity_ua_i').on('click', function(){
  $('.l_visualacuity_ua_i').val($(this).val()).trigger('change');
});

$('.l_visualacuity_ua_n').on('click', function(){
  $('.l_visualacuity_ua_n').val($(this).val()).trigger('change');
});

$('.l_visualacuity_ua_t').on('click', function(){
  $('.l_visualacuity_ua_t').val($(this).val()).trigger('change');
});

//\\\\\\\\\\\

if ($("#opdrecord_l_contrastsensitivity").val() == "" || $('.l-answersforcontrastsensitivity .editview_toggle_l').attr('style') == "display:none;"){
  $("#clear_l_contrastsensitivity").hide()
}
else{
  $("#clear_l_contrastsensitivity").show()
}


$(".l_contrastsensitivity").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_l_contrastsensitivity").val() == ""){
      $("#clear_l_contrastsensitivity").hide()
    }
    else{

      $("#clear_l_contrastsensitivity").show()
    }
  }, 200);
});

$("#clear_l_contrastsensitivity").on("click",function(){
  deselected_radiobutton("l_contrastsensitivity", "opdrecord_l_contrastsensitivity", "");
  $("#clear_l_contrastsensitivity").hide()
});

//\\\\\\\\\\\

if ($("#opdrecord_r_contrastsensitivity").val() == ""  || $('.r-answersforcontrastsensitivity .editview_toggle_r').attr('style') == "display:none;"){
  $("#clear_r_contrastsensitivity").hide()
}
else{
  $("#clear_r_contrastsensitivity").show()
}

$(".r_contrastsensitivity").on("click",function(){
  setTimeout(function(){
    if ($("#opdrecord_r_contrastsensitivity").val() == ""){
      $("#clear_r_contrastsensitivity").hide()
    }
    else{

      $("#clear_r_contrastsensitivity").show()
    }
  }, 200);
});

$("#clear_r_contrastsensitivity").on("click",function(){
  deselected_radiobutton("r_contrastsensitivity", "opdrecord_r_contrastsensitivity", "");
  $("#clear_r_contrastsensitivity").hide()
});



$('input[name="opdrecord[r_keratometry_near_axis]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[l_keratometry_distant_kh]"]').focus();
    e.preventDefault();
  }
});
$('input[name="opdrecord[l_keratometry_near_axis]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[r_pgp_distant_sph]"]').focus();
    e.preventDefault();
  }
});

$('select[name="opdrecord[r_pgp_typeoflens]"]').on('keydown', function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[l_pgp_distant_sph]"]').focus();
    e.preventDefault();
  }
});

$('select[name="opdrecord[l_pgp_typeoflens]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[r_refraction_distant_sph]"]').focus();
    e.preventDefault();
  }
});

$('.r_pgp_distant_sph').on('keyup',function(){
  $('[name="opdrecord[r_pgp_distant_sph]"]').val($('#opdrecord_r_pgp_distant_sph').val())
})

$('.r_pgp_distant_cyl').on('keyup',function(){
  $('[name="opdrecord[r_pgp_distant_cyl]"]').val($('#opdrecord_r_pgp_distant_cyl').val())
})

$('.r_pgp_distant_axis').on('keyup',function(){
  $('[name="opdrecord[r_pgp_distant_axis]"]').val($('#opdrecord_r_pgp_distant_axis').val())
})

$('.r_pgp_distant_vision').on('keyup',function(){
  $('[name="opdrecord[r_pgp_distant_vision]"]').val($('#opdrecord_r_pgp_distant_vision').val())
})

$('.r_pgp_comments').on('keyup',function(){
  $('[name="opdrecord[r_pgp_comments]"]').val($('#opdrecord_r_pgp_comments').val())
})

$('.l_pgp_distant_sph').on('keyup',function(){
  $('[name="opdrecord[l_pgp_distant_sph]"]').val($('#opdrecord_l_pgp_distant_sph').val())
})

$('.l_pgp_distant_cyl').on('keyup',function(){
  $('[name="opdrecord[l_pgp_distant_cyl]"]').val($('#opdrecord_l_pgp_distant_cyl').val())
})

$('.l_pgp_distant_axis').on('keyup',function(){
  $('[name="opdrecord[l_pgp_distant_axis]"]').val($('#opdrecord_l_pgp_distant_axis').val())
})

$('.l_pgp_distant_vision').on('keyup',function(){
  $('[name="opdrecord[l_pgp_distant_vision]"]').val($('#opdrecord_l_pgp_distant_vision').val())
})

$('.l_pgp_comments').on('keyup',function(){
  $('[name="opdrecord[l_pgp_comments]"]').val($('#opdrecord_l_pgp_comments').val())
})


$('input[name="opdrecord[r_refraction_near_vision]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[l_refraction_distant_sph]"]').focus();
    e.preventDefault();
  }
});
$('input[name="opdrecord[l_refraction_near_visionision]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[r_acceptance_distant_sph]"]').focus();
    e.preventDefault();
  }
});
$('select[name="opdrecord[r_acceptance_framematerial]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[l_acceptance_distant_sph]"]').focus();
    e.preventDefault();
  }
});
$('select[name="opdrecord[l_acceptance_framematerial]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[r_intraocularpressure]"]').focus();
    e.preventDefault();
  }
});
$('input[name="opdrecord[r_intraocularpressure]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[l_intraocularpressure]"]').focus();
    e.preventDefault();
  }
  //check_visual_acuity_and_iop()
});
$('input[name="opdrecord[l_intraocularpressure]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[r_glassesprescriptions_distant_sph]"]').focus();
    e.preventDefault();
  }
  //check_visual_acuity_and_iop()
});
$('input[name="opdrecord[r_glassesprescriptions_near_vision]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('input[name="opdrecord[l_glassesprescriptions_distant_sph]"]').focus();
    e.preventDefault();
  }
});
$('textarea[name="opdrecord[r_objectivecomments]"]').keydown(function(e) {
  var code = e.keyCode || e.which;
  if (code === 9) {
    $('textarea[name="opdrecord[l_objectivecomments]').focus();
    e.preventDefault();
  }
});
if("<%= @organisations_setting.mandatory_opd_templates %>" == "true"){
  $(document).ready(() => {
    check_iop_status()
    check_vision_status()
  });

  //toggle no right vs advised checkbox
  $('#opdrecord_no_right_va_advised').on('click',() => {
    if($('#opdrecord_no_right_va_advised').is(':checked')){
      $('.r_va').prop("disabled", true);
      $('#opdrecord_no_right_va_advised').val(true)
      $('#opdrecord_r_visualacuity_ua_s').val('')
      $('#opdrecord_r_visualacuity_ua_i').val('')
      $('#opdrecord_r_visualacuity_ua_n').val('')
      $('#opdrecord_r_visualacuity_ua_t').val('')
    } else{
      $('.r_va').prop("disabled", false);
      $('#opdrecord_no_right_va_advised').val(false)
    }
    check_vision_status()
  });

  //toggle no left va advised checkbox
  $('#opdrecord_no_left_va_advised').on('click',() => {
    if($('#opdrecord_no_left_va_advised').is(':checked')){
      $('.l_va').prop("disabled", true);
      $('#opdrecord_no_left_va_advised').val(true)
      $('#opdrecord_l_visualacuity_ua_s').val('')
      $('#opdrecord_l_visualacuity_ua_i').val('')
      $('#opdrecord_l_visualacuity_ua_n').val('')
      $('#opdrecord_l_visualacuity_ua_t').val('')
    } else{
      $('.l_va').prop("disabled", false);
      $('#opdrecord_no_left_va_advised').val(false)
    }
    check_vision_status()
  });

  //toggle right iop advised checkbox
  $('#opdrecord_no_right_iop_advised').on('click',() => {
    if($('#opdrecord_no_right_iop_advised').is(':checked')){
      $('.right_iop_row').hide()
      $('#opdrecord_no_right_iop_advised').val(true)
    } else{
      $('.right_iop_row').show()
      $('#opdrecord_no_right_iop_advised').val(false)
    }
    check_iop_status()
  });

  //toggle left iop advised checkbox
  $('#opdrecord_no_left_iop_advised').on('click',() => {
    if($('#opdrecord_no_left_iop_advised').is(':checked')){
      $('.left_iop_row').hide()
      $('#opdrecord_no_left_iop_advised').val(true)
    } else{
      $('.left_iop_row').show()
      $('#opdrecord_no_left_iop_advised').val(false)
    }
    check_iop_status()
  });
}

toggle_iop_clear_button()
function toggle_iop_clear_button(){
  if($("#opdrecord_r_intraocularpressure").val() == ""){
    $(".clear_r_iop").hide()
  }
  else{
    $(".clear_r_iop").show()
  }

  if($('#opdrecord_l_intraocularpressure').val() == ""){
    $(".clear_l_iop").hide()
  }
  else{
    $(".clear_l_iop").show()
  }
  check_iop_status()
}

$(".clear_r_iop").on("click",function(){
  $(".r_intraocularpressure").val("")
  $('.r-intraocularpressure-slider-range').find('.ui-slider-handle').css('left','0%')
  $('.r-intraocularpressure-slider-range').find('.ui-slider-range').css('width','100%')
  $('.r_intraocularpressure').val('')
  $(".clear_r_iop").hide()
  check_iop_status()
});

$(".clear_l_iop").on("click",function(){
  $(".l_intraocularpressure").val("")
  $('.l-intraocularpressure-slider-range').find('.ui-slider-handle').css('left','0%')
  $('.l-intraocularpressure-slider-range').find('.ui-slider-range').css('width','100%')
  $('.l_intraocularpressure').val('')
  $(".clear_l_iop").hide()
  check_iop_status()
});

$('.r_intraocularpressure_time').timepicker({minuteStep: 5});
$('.l_intraocularpressure_time').timepicker({minuteStep: 5});
$('.r_intraocularpressure_time_a').timepicker({minuteStep: 5});
$('.l_intraocularpressure_time_a').timepicker({minuteStep: 5});
$('.r_intraocularpressure_time').on('change', function() {
    var time = $(".r_intraocularpressure_time").val();
    jQuery(".r_intraocularpressure_time_a").val(time)
});
$('.l_intraocularpressure_time').on('change', function() {
    var time = $(".l_intraocularpressure_time").val();
    jQuery(".l_intraocularpressure_time_a").val(time)
});
$('.r_intraocularpressure_time_a').on('change', function() {
    var time = $(".r_intraocularpressure_time_a").val();
    jQuery(".r_intraocularpressure_time").val(time)
});
$('.l_intraocularpressure_time_a').on('change', function() {
    var time = $(".l_intraocularpressure_time_a").val();
    jQuery(".l_intraocularpressure_time").val(time)
});
function deselected_radiobutton(fieldname, input_fieldname, value) {
  jQuery.each(jQuery("." + fieldname), function(index, button) {
    if (jQuery(button).attr("input-value") === value) {
      jQuery(button).addClass("btn-brown");
      jQuery("#" + input_fieldname).val(value);
    } else {
      jQuery(button).removeClass("btn-brown");
      jQuery("#" + input_fieldname).val(value);
    }
  });
}

function deselected_checkboxbutton(fieldname, input_fieldname, value){
  jQuery.each(jQuery("." + fieldname), function(index, button) {
    if (jQuery(button).attr("input-value") === value) {
      jQuery(button).addClass("btn-darkblue");
      jQuery("#" + input_fieldname).val(value);
    } else {
      jQuery(button).removeClass("btn-darkblue");
      jQuery("#" + input_fieldname).val(value);
    }
  });
}

function formatAMPM(date) {
  var hours = date.getHours();
  var minutes = date.getMinutes();
  var ampm = hours >= 12 ? 'PM' : 'AM';
  hours = hours % 12;
  hours = hours ? hours : 12; // the hour '0' should be '12'
  minutes = minutes < 10 ? '0'+minutes : minutes;
  var strTime = hours + ':' + minutes + ' ' + ampm;
  return strTime;
}


jQuery(".r-intraocularpressure-slider-range").slider({
  range: "max",
  min: 0,
  max: 60,
  value: 0,
  slide: function(event, ui) {
    jQuery(".r_intraocularpressure").val(ui.value);
    jQuery(".r_intraocularpressure_time").val(formatAMPM(new Date()))
    jQuery(".r_intraocularpressure_time_a").val(formatAMPM(new Date()))
    //check_iop_status()
    toggle_iop_clear_button()
    jQuery(".r-intraocularpressure-slider-range").slider({
      range: "max",
      min: 0,
      max: 60,
      value: ui.value,
    });
  }
});

var r_intraocularpressure = "<%= escape_javascript (@opdrecord.read_attribute(:r_intraocularpressure)) %>";
if (r_intraocularpressure.length == 0) {
  //jQuery(".r_intraocularpressure").val(jQuery(".r-intraocularpressure-slider-range").slider("value"));
} else {
  jQuery(".r-intraocularpressure-slider-range").slider("value", r_intraocularpressure);
//  jQuery(".r-intraocularpressure-slider-range-2").slider("value", r_intraocularpressure);
}

$(".r_intraocularpressure").keyup(function(e){
  jQuery(".r_intraocularpressure_time").val(formatAMPM(new Date()))
  jQuery(".r_intraocularpressure_time_a").val(formatAMPM(new Date()))
  value = jQuery(this).val()
  jQuery(".r_intraocularpressure").val(value);

  jQuery(".r-intraocularpressure-slider-range").slider({
    range: "max",
    min: 0,
    max: 60,
    value: value,
    slide: function(event, ui) {
      jQuery(".r_intraocularpressure").val(ui.value);
      jQuery(".r_intraocularpressure_time").val(formatAMPM(new Date()))
      jQuery(".r_intraocularpressure_time_a").val(formatAMPM(new Date()))
    }
  });
  //check_visual_acuity_and_iop()
  toggle_iop_clear_button()
})
// pupi value
jQuery(".l-pupilsize-slider-range").slider({
  range: "max",
  min: 0,
  max: 10,
  value: 0,
  slide: function(event, ui) {
    jQuery(".l_pupilsize").val(ui.value);
    jQuery(".l-pupilsize-slider-range").slider({
      range: "max",
      min: 0,
      max: 10,
      value: ui.value,
    });
  }
});

var l_pupilsize = "<%= escape_javascript (@opdrecord.read_attribute(:l_pupilsize)) %>";
if (l_pupilsize.length == 0) {

} else {
  jQuery(".l-pupilsize-slider-range").slider("value", l_pupilsize);
}

$(".l_pupilsize").keyup(function(e){
  value = jQuery(this).val()
  jQuery(".l_pupilsize").val(value);

  jQuery(".l-pupilsize-slider-range").slider({
    range: "max",
    min: 0,
    max: 10,
    value: value,
    slide: function(event, ui) {
      jQuery(".l_pupilsize").val(ui.value);
    }
  });
})

jQuery(".r-pupilsize-slider-range").slider({
  range: "max",
  min: 0,
  max: 10,
  value: 0,
  slide: function(event, ui) {
    jQuery(".r_pupilsize").val(ui.value);
    jQuery(".r-pupilsize-slider-range").slider({
      range: "max",
      min: 0,
      max: 10,
      value: ui.value,
    });
  }
});

var r_pupilsize = "<%= escape_javascript (@opdrecord.read_attribute(:r_pupilsize)) %>";
if (r_pupilsize.length == 0) {

} else {
  jQuery(".r-pupilsize-slider-range").slider("value", r_pupilsize);
}

$(".r_pupilsize").keyup(function(e){
  value = jQuery(this).val()
  jQuery(".r_pupilsize").val(value);

  jQuery(".r-pupilsize-slider-range").slider({
    range: "max",
    min: 0,
    max: 10,
    value: value,
    slide: function(event, ui) {
      jQuery(".r_pupilsize").val(ui.value);
    }
  });
})

jQuery(".l-intraocularpressure-slider-range").slider({
  range: "max",
  min: 0,
  max: 60,
  value: 0,
  slide: function(event, ui) {
    jQuery(".l_intraocularpressure").val(ui.value);
    jQuery(".l_intraocularpressure_time").val(formatAMPM(new Date()))
    jQuery(".l_intraocularpressure_time_a").val(formatAMPM(new Date()))
    //check_visual_acuity_and_iop()
    toggle_iop_clear_button()
    jQuery(".l-intraocularpressure-slider-range").slider({
      range: "max",
      min: 0,
      max: 60,
      value: ui.value,
    });
  }
});
var l_intraocularpressure = "<%= escape_javascript (@opdrecord.read_attribute(:l_intraocularpressure)) %>";
if (l_intraocularpressure.length == 0) {
  //jQuery(".l_intraocularpressure").val(jQuery(".l-intraocularpressure-slider-range").slider("value"));
} else {
  jQuery(".l-intraocularpressure-slider-range").slider("value", l_intraocularpressure);
}

$(".l_intraocularpressure").keyup(function(e){
  jQuery(".l_intraocularpressure_time").val(formatAMPM(new Date()))
  jQuery(".l_intraocularpressure_time_a").val(formatAMPM(new Date()))
  value = jQuery(this).val()
  jQuery(".l_intraocularpressure").val(value);

  jQuery(".l-intraocularpressure-slider-range").slider({
    range: "max",
    min: 0,
    max: 60,
    value: value,
    slide: function(event, ui) {
      jQuery(".l_intraocularpressure").val(ui.value);
      jQuery(".l_intraocularpressure_time").val(formatAMPM(new Date()))
      jQuery(".l_intraocularpressure_time_a").val(formatAMPM(new Date()))
    }
  });
  //check_visual_acuity_and_iop()
  toggle_iop_clear_button()
})

$('.rcopybutton').click(function(){
  var radio_array = ['Normal', 'Abnormal']
  $(this).parent().parent().parent().parent().find('table tr td,textarea,select,input').each(function(){
    var a = $(this);
    if (a.attr('id')) {
      var r_id =  a.attr('id');
      var l_id =  a.attr('id').replace('_r_','_l_');
      var r_val = $('#'+r_id).val()
      $('#'+l_id).val(r_val)
      let l_name = $('#'+l_id).attr('name')
      $("[name='"+l_name+"']").val(r_val)
      if (radio_array.includes(r_val)) {
        copy_selected_radiobutton(l_id.replace('opdrecord_',''), l_id , r_val);
      }
      //for intraocular pressure slider
      if (a.attr('id')== 'opdrecord_r_intraocularpressure') {
        //check_visual_acuity_and_iop()
        toggle_iop_clear_button()
        $(".l-intraocularpressure-slider-range").slider("value", r_val);
        $('.l_intraocularpressure').val(r_val);
      }

      if (a.attr('id')== 'opdrecord_no_right_iop_advised') {
        check_iop_status()
        if($('#opdrecord_no_right_iop_advised').is(':checked')){
          $('#opdrecord_no_left_iop_advised').prop("checked", true);
          $('#opdrecord_no_left_iop_advised').val(true);
          $('.left_iop_row').hide()
        } else if(!$('#opdrecord_no_right_iop_advised').is(':checked')){
          $('#opdrecord_no_left_iop_advised').prop("checked", false);
          $('#opdrecord_no_left_iop_advised').val(false);
          $('.left_iop_row').show()
        }
      }
      check_glass_prescription_status()
    }
  });

  if($(this).closest('.glasses-prescription-block').length > 0){
    $(".glasses-details-block").find('table tr td,textarea,select,input').each(function(){
      var a = $(this);
      if (a.attr('id')) {
        var r_id =  a.attr('id');
        var l_id =  a.attr('id').replace('_r_','_l_');
        var r_val = $('#'+r_id).val()
        $('#'+l_id).val(r_val)
        let l_name = $('#'+l_id).attr('name')
        $("[name='"+l_name+"']").val(r_val)
        //for intraocular pressure slider
        if (a.attr('id')== 'opdrecord_r_intraocularpressure') {
          jQuery(".l-intraocularpressure-slider-range").slider("value", r_val);
          $('.l_intraocularpressure').val(r_val)
        }
      }
    });
  }
});

$('.lcopybutton').click(function(){
  var radio_array = ['Normal', 'Abnormal']
  $(this).parent().parent().parent().parent().find('table tr td,textarea,select,input').each(function(){
    var a = $(this);
    if (a.attr('id')) {
      var l_id =  a.attr('id');
      var r_id =  a.attr('id').replace('_l_','_r_');
      var l_val = $('#'+l_id).val();
      $('#'+r_id).val(l_val)
      let r_name = $('#'+r_id).attr('name')
      $("[name='"+r_name+"']").val(l_val)
      if (radio_array.includes(l_val)) {
        copy_selected_radiobutton(r_id.replace('opdrecord_',''), r_id , l_val);
      }

      //for intraocular pressure slider
      if (a.attr('id')== 'opdrecord_l_intraocularpressure') {
        //check_visual_acuity_and_iop()
        toggle_iop_clear_button()
        $(".r-intraocularpressure-slider-range").slider("value", l_val);
        $('.r_intraocularpressure').val(l_val)
      }

      if (a.attr('id')== 'opdrecord_no_left_iop_advised') {
        check_iop_status()
        if($('#opdrecord_no_left_iop_advised').is(':checked')){
          $('#opdrecord_no_right_iop_advised').prop("checked", true);
          $('#opdrecord_no_right_iop_advised').val(true);
          $('.right_iop_row').hide()
        } else if(!$('#opdrecord_no_left_iop_advised').is(':checked')){
          $('#opdrecord_no_right_iop_advised').prop("checked", false);
            $('#opdrecord_no_right_iop_advised').val(false);
          $('.right_iop_row').show()
        }
      }

      check_glass_prescription_status()
    }
  });

  if($(this).closest('.glasses-prescription-block').length > 0){
    $(".glasses-details-block").find('table tr td,textarea,select,input').each(function(){
      var a = $(this);
      if (a.attr('id')) {
        var l_id =  a.attr('id');
        var r_id =  a.attr('id').replace('_l_','_r_');
        var l_val = $('#'+l_id).val();
        $('#'+r_id).val(l_val)
        let r_name = $('#'+r_id).attr('name')
        $("[name='"+r_name+"']").val(l_val)
        //for intraocular pressure slider
        if (a.attr('id')== 'opdrecord_l_intraocularpressure') {
          jQuery(".r-intraocularpressure-slider-range").slider("value", l_val);
          $('.r_intraocularpressure').val(l_val)
        }
      }
    });
  }
});

$('.rvacopybutton').click(function(){
  var radio_array = ['opdrecord_r_visualacuity_unaided','opdrecord_r_visualacuity_ua_near','opdrecord_r_visualacuity_pinhole','opdrecord_r_visualacuity_glasses','opdrecord_r_visualacuity_near','opdrecord_r_visualacuity_lens']
  var checkbox_array = ['opdrecord_r_visualacuity_unaided_p','opdrecord_r_visualacuity_ua_near_p','opdrecord_r_visualacuity_pinhole_p','opdrecord_r_visualacuity_pinhole_ni','opdrecord_r_visualacuity_glasses_p','opdrecord_r_visualacuity_near_p','opdrecord_r_visualacuity_lens_p']
  $(this).parent().parent().parent().next().find('input,select,textarea').each(function(){
    var a = $(this);
    if (a.attr('id')) {
      var r_id =  a.attr('id')
      var l_id =  a.attr('id').replace('_r_','_l_')
      var r_val = $('#'+r_id).val()
      $('#'+l_id).val(r_val)
      if (radio_array.includes(r_id)) {
        copy_selected_radiobutton(l_id.replace('opdrecord_',''), l_id , r_val);
      }
      if (checkbox_array.includes(r_id)) {
        copy_selected_checkbox(l_id.replace('opdrecord_',''), l_id , r_val)
      }
      if ($('input[name="opdrecord[l_visualacuity_unaided]"]').val() == ""){
        $(".clear_l_visualacuity_unaided").hide()
        $('input[name="opdrecord[l_visualacuity_unaided_comments]"]').hide()
      }
      else{
        $('input[name="opdrecord[l_visualacuity_unaided]"]').val($('#opdrecord_l_visualacuity_unaided').val())
        deselected_radiobutton('l_visualacuity_unaided', 'opdrecord_l_visualacuity_unaided', $('#opdrecord_l_visualacuity_unaided').val())
        $(".clear_l_visualacuity_unaided").show()
        $('input[name="opdrecord[l_visualacuity_unaided_comments]"]').show()
      }

      $('.r_visualacuity_ua_s').val($('#opdrecord_r_visualacuity_ua_s').val()).trigger('change');
      $('.r_visualacuity_ua_i').val($('#opdrecord_r_visualacuity_ua_i').val()).trigger('change');
      $('.r_visualacuity_ua_n').val($('#opdrecord_r_visualacuity_ua_n').val()).trigger('change');
      $('.r_visualacuity_ua_t').val($('#opdrecord_r_visualacuity_ua_t').val()).trigger('change');
      $('[name="opdrecord[r_visualacuity_comments]"]').val($('#opdrecord_r_visualacuity_comments').code())
      $('[name="opdrecord[l_visualacuity_comments]"]').val($('#opdrecord_l_visualacuity_comments').code())
      $('[name="opdrecord[r_visualacuity_unaided_comments]"]').val($('#opdrecord_r_visualacuity_unaided_comments').val())
      $('[name="opdrecord[l_visualacuity_unaided_comments]"]').val($('#opdrecord_l_visualacuity_unaided_comments').val())
      $('[name="opdrecord[r_visualacuity_ua_near_comments]"]').val($('#opdrecord_r_visualacuity_ua_near_comments').val())
      $('[name="opdrecord[l_visualacuity_ua_near_comments]"]').val($('#opdrecord_l_visualacuity_ua_near_comments').val())
      $('.l_visualacuity_ua_s').val($('#opdrecord_l_visualacuity_ua_s').val()).trigger('change');
      $('.l_visualacuity_ua_i').val($('#opdrecord_l_visualacuity_ua_i').val()).trigger('change');
      $('.l_visualacuity_ua_n').val($('#opdrecord_l_visualacuity_ua_n').val()).trigger('change');
      $('.l_visualacuity_ua_t').val($('#opdrecord_l_visualacuity_ua_t').val()).trigger('change');

    if($('#opdrecord_no_right_va_advised').is(':checked')){
        $('#opdrecord_no_left_va_advised').prop("checked", true);
        $('.l_va').prop("disabled", true);
      } else if(!$('#opdrecord_no_right_va_advised').is(':checked')){
        $('#opdrecord_no_left_va_advised').prop("checked", false);
        $('.l_va').prop("disabled", false);
      }
      check_vision_status()
    }
  });
});

$('.lvacopybutton').click(function(){
  var radio_array = ['opdrecord_l_visualacuity_unaided','opdrecord_l_visualacuity_ua_near','opdrecord_l_visualacuity_pinhole','opdrecord_l_visualacuity_glasses','opdrecord_l_visualacuity_near','opdrecord_l_visualacuity_lens']
  var checkbox_array = ['opdrecord_l_visualacuity_unaided_p','opdrecord_l_visualacuity_ua_near_p','opdrecord_l_visualacuity_pinhole_p','opdrecord_l_visualacuity_pinhole_ni','opdrecord_l_visualacuity_glasses_p','opdrecord_l_visualacuity_near_p','opdrecord_l_visualacuity_lens_p']
  $(this).parent().parent().parent().next().find('input,select,textarea').each(function(){
    var a = $(this);
    if (a.attr('id')) {
      var l_id =  a.attr('id')
      var r_id =  a.attr('id').replace('_l_','_r_')
      var l_val = $('#'+l_id).val()
      $('#'+r_id).val(l_val)
      if (radio_array.includes(l_id)) {
        copy_selected_radiobutton(r_id.replace('opdrecord_',''), r_id , l_val);
      }
      if (checkbox_array.includes(l_id)) {
        copy_selected_checkbox(r_id.replace('opdrecord_',''), r_id , l_val)
      }
      $('.r_visualacuity_ua_s').val($('#opdrecord_r_visualacuity_ua_s').val()).trigger('change');
      $('.r_visualacuity_ua_i').val($('#opdrecord_r_visualacuity_ua_i').val()).trigger('change');
      $('.r_visualacuity_ua_n').val($('#opdrecord_r_visualacuity_ua_n').val()).trigger('change');
      $('.r_visualacuity_ua_t').val($('#opdrecord_r_visualacuity_ua_t').val()).trigger('change');
      $('[name="opdrecord[r_visualacuity_comments]"]').val($('#opdrecord_r_visualacuity_comments').code())
      $('[name="opdrecord[l_visualacuity_comments]"]').val($('#opdrecord_l_visualacuity_comments').code())
      $('[name="opdrecord[r_visualacuity_unaided_comments]"]').val($('#opdrecord_r_visualacuity_unaided_comments').val())
      $('[name="opdrecord[l_visualacuity_unaided_comments]"]').val($('#opdrecord_l_visualacuity_unaided_comments').val())
      $('[name="opdrecord[r_visualacuity_ua_near_comments]"]').val($('#opdrecord_r_visualacuity_ua_near_comments').val())
      $('[name="opdrecord[l_visualacuity_ua_near_comments]"]').val($('#opdrecord_l_visualacuity_ua_near_comments').val())
      $('.l_visualacuity_ua_s').val($('#opdrecord_l_visualacuity_ua_s').val()).trigger('change');
      $('.l_visualacuity_ua_i').val($('#opdrecord_l_visualacuity_ua_i').val()).trigger('change');
      $('.l_visualacuity_ua_n').val($('#opdrecord_l_visualacuity_ua_n').val()).trigger('change');
      $('.l_visualacuity_ua_t').val($('#opdrecord_l_visualacuity_ua_t').val()).trigger('change');
      if($('#opdrecord_no_left_va_advised').is(':checked')){
        $('#opdrecord_no_right_va_advised').prop("checked", true);
        $('.r_va').prop("disabled", true);
      } else if(!$('#opdrecord_no_left_va_advised').is(':checked')){
        $('#opdrecord_no_right_va_advised').prop("checked", false);
        $('.r_va').prop("disabled", false);
      }
      check_vision_status()
    }
  });
});


function copy_selected_radiobutton(fieldname, input_fieldname, value) {
  var flag = 0;
  jQuery.each(jQuery("." + fieldname), function(index, button) {
    if (jQuery(button).attr("input-value") === value) {
      jQuery(button).addClass("btn-brown");
      jQuery(button).trigger('click')
      flag = 1;
      jQuery("#" + input_fieldname).val(value);
    } else {
      jQuery(button).removeClass("btn-brown");
      jQuery("#" + input_fieldname).val(value);
    }
  });
  if(!flag) jQuery("#"+"clear_"+fieldname).trigger('click')
}

function copy_selected_checkbox(fieldname, input_fieldname,value){
  jQuery.each(jQuery("." + fieldname), function(index, button) {
    if (value) {
      if (!jQuery(button).hasClass("btn-darkblue")) {
        jQuery(button).addClass("btn-darkblue")
        jQuery('#'+input_fieldname).val(value);
      }
    }
    else{
      if (jQuery(button).hasClass("btn-darkblue")) {
        jQuery(button).removeClass("btn-darkblue")
        jQuery('#'+input_fieldname).val('');
      }
    }
  });
}

$('.glasses-prescription').on('blur', function() {
  check_glass_prescription_status()
});
$('.intermediate-glasses-prescription').on('blur', function() {
  check_glass_prescription_status()
});

$('#opdrecord_view_optical_store_id').select2();

$("#opdrecord_view_optical_store_id").on("change",function(){
  <% if @disabled_optical.present? && @optical_prescription.present? %>
    $(this).find("option[value='<%=@disabled_optical.id.to_s%>']").remove()
  <% end %>
  $(this).find("option[value='']").remove()
  $(".opdrecord_optical_store_id").val($(this).val())
  $(".opdrecord_optical_store_name").val($("#opdrecord_view_optical_store_id option:selected").text())
})
<% if @opdrecord.new_record? %>
  $("#opdrecord_view_optical_store_id").trigger("change");
<% end %>

$(".select-ipdrecord").on("change",function(){
  var ipd_record_id = $(".select-ipdrecord option:selected").val()
  var row_count = $(".post-op-record-table-body-added").find('.postoprecords').length
  var command
  var first_row = $($(".post-op-record-table-body-added").find('.postoprecords')[0]).find('.surgery_name').val()
  if (first_row == "") {
    command = 'replace'
    row_count = 0
  }else{
    command = 'append'
  }

  if (ipd_record_id == 0) {
    $("#delete_postop_records").val('true')
  }else{
    $("#delete_postop_records").val('false')
  }

  $.ajax({
    url: "/opd_records/ophthalmology_notes/get_ipd_data",
    dataType: 'script',
    data: {
      ipd_record_id: ipd_record_id, row_count: row_count, command: command
    }
  })
});


if ($('input[name="opdrecord[stereopsis_random_dot]"]').val() == ""){
  $("#clear_stereopsis_random_dot").hide()
} else{
  $("#clear_stereopsis_random_dot").show()
}

$(".stereopsis_random_dot").on("click",function(){
  setTimeout(function(){
    if ($('input[name="opdrecord[stereopsis_random_dot]"]').val() == ""){
      $("#clear_stereopsis_random_dot").hide()
    }
    else{
      $("#clear_stereopsis_random_dot").show()
    }
  }, 200);
});

$("#clear_stereopsis_random_dot").on("click",function(){
  deselected_radiobutton("stereopsis_random_dot", "opdrecord_stereopsis_random_dot", "");
  $("#clear_stereopsis_random_dot").hide()
});