<% counter = @counter %>
<% radiology_name =  (@radiology_investigation.try(:investigation_type) + ", " if @radiology_investigation.try(:investigation_type).present?) + @radiology_investigation.investigation_name.to_s %>
<div class="row patient-radiology_investigation new-entry">
  <hr style="border-top: 1px solid #ccc;margin: 10px auto 15px;" />
  <div class="col-md-12">
    <div class="row agreed_declined_row">
      <!-- Investigation Hidden Fields -->
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][record_id]", params[:counsellor_record_id] %>
      <!-- Hack for matching case_sheet_ophthal_investigation_id to AppointmentRecord::RadiologyInvestigation"s _id.Avoid Reverse Update -->
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][case_sheet_radiology_investigation_id]", BSON::ObjectId.new() %> 
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][investigationname]', @radiology_investigation.investigation_name %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][investigation_id]', @radiology_investigation.investigation_id %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][radiologyoptions]", "", class: "radiologyoptions" %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][investigationfullcode]', @radiology_investigation.investigation_id %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][investigationstage]', "Counselled", class: "investigationstage" %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][haslaterality]', @radiology_investigation.has_laterality %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][is_spine]', "" %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][laterality]', "" %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][investigation_type]', params[:investigation_type] %>
      <!-- Entered Hidden Fields -->
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][entered_by_id]", @current_user.id %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][entered_by]", @current_user.fullname %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][entered_from]", "counsellor_record" %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][entered_at_facility_id]", @current_facility.id %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][entered_at_facility]", @current_facility.name %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][entered_datetime]", Time.current %>
      <!-- Advised Hidden Fields -->
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][advised_by_id]", @current_user.id %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][advised_by]", @current_user.fullname %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][advised_from]", "counsellor_record" %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][advised_at_facility_id]", @current_facility.id %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][advised_at_facility]", @current_facility.name %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][advised_datetime]", Time.current %>
      <!-- Counselled Hidden Fields -->
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][is_counselled]', true %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][counselled_by_id]', @current_user.id %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][counselled_by]', @current_user.fullname %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][counselled_from]', "counsellor_record" %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][counselled_at_facility_id]', @current_facility.id %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][counselled_at_facility]', @current_facility.name %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][counselled_datetime]', Time.current %>
      <!-- Agreed Hidden Fields -->
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][agreed_by]', "", class: 'agreed_by' %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][agreed_from]', "", class: 'agreed_from' %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][agreed_at_facility_id]', "", class: 'agreed_at_facility_id' %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][agreed_at_facility]', "", class: 'agreed_at_facility' %>
      <!-- Payment Taken Hidden Fields -->
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][payment_taken_by]', "", class: 'payment_taken_by' %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][payment_taken_from]', "", class: 'payment_taken_from' %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][payment_taken_at_facility_id]', "", class: 'payment_taken_at_facility_id' %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][payment_taken_at_facility]', "", class: 'payment_taken_at_facility' %>
      <!-- Declined Hidden Fields -->
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][declined_by]', "", class: 'declined_by' %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][declined_from]', "", class: 'declined_from' %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][declined_at_facility_id]', "", class: 'declined_at_facility_id' %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][declined_at_facility]', "", class: 'declined_at_facility' %>
      <!-- Removed Hidden Fields -->
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][is_removed]", false, class: "is_removed" %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][removed_by_id]", "", class: "removed_by_id" %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][removed_by]", "", class: "removed_by" %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][removed_from]", "", class: "removed_from" %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][removed_at_facility_id]", "", class: "removed_at_facility_id" %>
      <%= hidden_field_tag "counsellor_record[radiology_investigations]["+counter.to_s+"][removed_at_facility]", "", class: "removed_at_facility" %>
      <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][removed_datetime]', "", class: 'removed_datetime' %>

      <div class="col-md-12">
        <div class="row">
          <div class="col-md-3">
            <div class="row">
              <div class="col-md-12">
                <span class="radiology_investigation-name"><%= radiology_name %>&emsp;</span>
                <% if @radiology_investigation.try(:investigation_type) != 'X-Ray' && @radiology_investigation.try(:investigation_type) != 'ECHO' %>
                  <% radiologyoptions = [{option_name: 'w/o contrast', option_id: '90084008'}, {option_name: 'with contrast', option_id: '51619007'}, {option_name: 'with complete screening', option_id: '429859008'}, {option_name: 'screening of other region', option_id: '431985004'}, {option_name: '3D-reconstruction', option_id: '22400007'}] %>
                  <select class="radiologyoptions">
                    <option value=''></option>
                    <% radiologyoptions.each do |option| %>
                      <option value='<%= option[:option_id] %>'><%= option[:option_name] %></option>
                    <% end %>
                  </select>
                <% end %>
                <button class="btn btn-link btn-xs btn-remove-radiology_investigation" id='<%=counter%>'>Remove</button>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-md-9-shared agreed_by_details">
            <div class="row">
              <div class="col-md-3">
                <div class="ckbox ckbox-primary ckbox-agreed">
                  <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][has_agreed]', false %>
                  <%= check_box_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][has_agreed]', true, false, {id: "radiology_investigation_#{counter}_has_agreed", class: 'has_agreed'} %>
                  <label for="radiology_investigation_<%= counter.to_s %>_has_agreed">Agreed</label>
                </div>
              </div>
              <div class="agreed_fields" style="display:none;">
                <div class="col-md-4 col-md-9-shared">
                  <div class="input-group">
                    <span class="input-group-addon" style="padding: 5px 10px;font-size: 10px;"><i class="fa fa-calendar"></i></span>
                    <%= text_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][agreed_datetime]', "", class: 'agreed_datetime form-control p3_10', readonly: 'readonly' %>
                  </div>
                </div>
                <div class="col-md-4 col-md-9-shared">
                  <%= select_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][agreed_by_id]', options_for_select(@counsellor_options, @current_user.id.to_s), {include_blank: "Select", class: "agreed_by_id form-control p3_10"} %>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-md-9-shared declined_by_details">
            <div class="row">
              <div class="col-md-3">
                <div class="ckbox ckbox-danger ckbox-declined">
                  <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][has_declined]', false %>
                  <%= check_box_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][has_declined]', true, false, {id: "radiology_investigation_#{counter}_has_declined", class: 'has_declined'} %>
                  <label for="radiology_investigation_<%= counter.to_s %>_has_declined">Declined</label>
                </div>
              </div>
              <div class="declined_fields" style="display:none;">
                <div class="col-md-4 col-md-9-shared">
                  <div class="input-group">
                    <span class="input-group-addon" style="padding: 5px 10px;font-size: 10px;"><i class="fa fa-calendar"></i></span>
                    <%= text_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][declined_datetime]', "", class: 'declined_datetime form-control p3_10', readonly: 'readonly' %>
                  </div>
                </div>
                <div class="col-md-4 col-md-9-shared">
                  <%= select_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][declined_by_id]', options_for_select(@counsellor_options, @current_user.id.to_s), {include_blank: "Select", class: "declined_by_id form-control p3_10"} %>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-3">
          </div>
          <div class="agreed-options" style="display: none;">
            <div class="col-md-4 col-md-9-shared payment_taken_by_details">
              <div class="row">
                <div class="col-md-3">
                  <div class="ckbox ckbox-success ckbox-payment-taken">
                    <%= hidden_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][payment_taken]', false %>
                    <%= check_box_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][payment_taken]', true, false, {id: "radiology_investigation_#{counter}_payment_taken", class: 'payment_taken'} %>
                    <label for="radiology_investigation_<%= counter.to_s %>_payment_taken">Paid</label>
                  </div>
                </div>
                <div class="payment_taken_fields" style="display:none;">
                  <div class="col-md-4 col-md-9-shared">
                    <div class="input-group">
                      <span class="input-group-addon" style="padding: 5px 10px;font-size: 10px;"><i class="fa fa-calendar"></i></span>
                      <%= text_field_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][payment_taken_datetime]', "", class: 'payment_taken_datetime form-control p3_10', readonly: 'readonly' %>
                    </div>
                  </div>
                  <div class="col-md-4 col-md-9-shared">
                    <%= select_tag 'counsellor_record[radiology_investigations]['+counter.to_s+'][payment_taken_by_id]', options_for_select(@counsellor_options, @current_user.id.to_s), {include_blank: "Select", class: "payment_taken_by_id form-control p3_10"} %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>